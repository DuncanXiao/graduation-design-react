(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[5407],{35099:function(Mt,Q,U){"use strict";var ie=U(67294),re=U(83280),m=U(23185),he=U(4322),V=U(24770),ue=U(89182),ce=function(ee,Xe){var Je={};for(var Ze in ee)Object.prototype.hasOwnProperty.call(ee,Ze)&&Xe.indexOf(Ze)<0&&(Je[Ze]=ee[Ze]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ze=Object.getOwnPropertySymbols(ee);gt<Ze.length;gt++)Xe.indexOf(Ze[gt])<0&&Object.prototype.propertyIsEnumerable.call(ee,Ze[gt])&&(Je[Ze[gt]]=ee[Ze[gt]]);return Je},Le=(0,ie.forwardRef)(function(ee,Xe){var Je=ee.chartRef,Ze=ee.style,gt=Ze===void 0?{height:"inherit"}:Ze,tr=ee.className,yt=ee.loading,Wt=ee.loadingTemplate,bt=ee.errorTemplate,at=ce(ee,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),nt=(0,m.Z)(re.aC,at),Zt=nt.chart,Y=nt.container;return(0,ie.useEffect)(function(){(0,he.J)(Je,Zt.current)},[Zt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ie.createElement(V.Z,{errorTemplate:bt},yt&&ie.createElement(ue.Z,{loadingTemplate:Wt,theme:ee.theme}),ie.createElement("div",{className:tr,style:gt,ref:Y}))});Q.Z=Le},65337:function(Mt,Q,U){"use strict";var ie=U(67294),re=U(83280),m=U(23185),he=U(4322),V=U(24770),ue=U(89182),ce=function(ee,Xe){var Je={};for(var Ze in ee)Object.prototype.hasOwnProperty.call(ee,Ze)&&Xe.indexOf(Ze)<0&&(Je[Ze]=ee[Ze]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ze=Object.getOwnPropertySymbols(ee);gt<Ze.length;gt++)Xe.indexOf(Ze[gt])<0&&Object.prototype.propertyIsEnumerable.call(ee,Ze[gt])&&(Je[Ze[gt]]=ee[Ze[gt]]);return Je},Le=(0,ie.forwardRef)(function(ee,Xe){var Je=ee.chartRef,Ze=ee.style,gt=Ze===void 0?{height:"inherit"}:Ze,tr=ee.className,yt=ee.loading,Wt=ee.loadingTemplate,bt=ee.errorTemplate,at=ce(ee,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),nt=(0,m.Z)(re.Kj,at),Zt=nt.chart,Y=nt.container;return(0,ie.useEffect)(function(){(0,he.J)(Je,Zt.current)},[Zt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ie.createElement(V.Z,{errorTemplate:bt},yt&&ie.createElement(ue.Z,{loadingTemplate:Wt,theme:ee.theme}),ie.createElement("div",{className:tr,style:gt,ref:Y}))});Q.Z=Le},90829:function(Mt,Q,U){"use strict";var ie=U(67294),re=U(83280),m=U(23185),he=U(4322),V=U(24770),ue=U(89182),ce=function(ee,Xe){var Je={};for(var Ze in ee)Object.prototype.hasOwnProperty.call(ee,Ze)&&Xe.indexOf(Ze)<0&&(Je[Ze]=ee[Ze]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ze=Object.getOwnPropertySymbols(ee);gt<Ze.length;gt++)Xe.indexOf(Ze[gt])<0&&Object.prototype.propertyIsEnumerable.call(ee,Ze[gt])&&(Je[Ze[gt]]=ee[Ze[gt]]);return Je},Le=(0,ie.forwardRef)(function(ee,Xe){var Je=ee.chartRef,Ze=ee.style,gt=Ze===void 0?{height:"inherit"}:Ze,tr=ee.className,yt=ee.loading,Wt=ee.loadingTemplate,bt=ee.errorTemplate,at=ce(ee,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),nt=(0,m.Z)(re.TZ,at),Zt=nt.chart,Y=nt.container;return(0,ie.useEffect)(function(){(0,he.J)(Je,Zt.current)},[Zt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ie.createElement(V.Z,{errorTemplate:bt},yt&&ie.createElement(ue.Z,{loadingTemplate:Wt,theme:ee.theme}),ie.createElement("div",{className:tr,style:gt,ref:Y}))});Q.Z=Le},93343:function(Mt,Q,U){"use strict";var ie=U(67294),re=U(83280),m=U(23185),he=U(4322),V=U(24770),ue=U(89182),ce=function(ee,Xe){var Je={};for(var Ze in ee)Object.prototype.hasOwnProperty.call(ee,Ze)&&Xe.indexOf(Ze)<0&&(Je[Ze]=ee[Ze]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ze=Object.getOwnPropertySymbols(ee);gt<Ze.length;gt++)Xe.indexOf(Ze[gt])<0&&Object.prototype.propertyIsEnumerable.call(ee,Ze[gt])&&(Je[Ze[gt]]=ee[Ze[gt]]);return Je},Le=(0,ie.forwardRef)(function(ee,Xe){var Je=ee.chartRef,Ze=ee.style,gt=Ze===void 0?{height:"inherit"}:Ze,tr=ee.className,yt=ee.loading,Wt=ee.loadingTemplate,bt=ee.errorTemplate,at=ce(ee,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),nt=(0,m.Z)(re.m,at),Zt=nt.chart,Y=nt.container;return(0,ie.useEffect)(function(){(0,he.J)(Je,Zt.current)},[Zt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ie.createElement(V.Z,{errorTemplate:bt},yt&&ie.createElement(ue.Z,{loadingTemplate:Wt,theme:ee.theme}),ie.createElement("div",{className:tr,style:gt,ref:Y}))});Q.Z=Le},92688:function(Mt,Q,U){"use strict";var ie=U(67294),re=U(83280),m=U(23185),he=U(4322),V=U(24770),ue=U(89182),ce=function(ee,Xe){var Je={};for(var Ze in ee)Object.prototype.hasOwnProperty.call(ee,Ze)&&Xe.indexOf(Ze)<0&&(Je[Ze]=ee[Ze]);if(ee!=null&&typeof Object.getOwnPropertySymbols=="function")for(var gt=0,Ze=Object.getOwnPropertySymbols(ee);gt<Ze.length;gt++)Xe.indexOf(Ze[gt])<0&&Object.prototype.propertyIsEnumerable.call(ee,Ze[gt])&&(Je[Ze[gt]]=ee[Ze[gt]]);return Je},Le=(0,ie.forwardRef)(function(ee,Xe){var Je=ee.chartRef,Ze=ee.style,gt=Ze===void 0?{height:"inherit"}:Ze,tr=ee.className,yt=ee.loading,Wt=ee.loadingTemplate,bt=ee.errorTemplate,at=ce(ee,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),nt=(0,m.Z)(re.kB,at),Zt=nt.chart,Y=nt.container;return(0,ie.useEffect)(function(){(0,he.J)(Je,Zt.current)},[Zt.current]),(0,ie.useImperativeHandle)(Xe,function(){return{getChart:function(){return Zt.current}}}),ie.createElement(V.Z,{errorTemplate:bt},yt&&ie.createElement(ue.Z,{loadingTemplate:Wt,theme:ee.theme}),ie.createElement("div",{className:tr,style:gt,ref:Y}))});Q.Z=Le},64335:function(Mt,Q,U){"use strict";var ie=U(67294),re=(0,ie.createContext)({});Q.Z=re},21349:function(Mt,Q,U){"use strict";var ie=U(84305),re=U(75901),m=U(94184),he=U.n(m),V=U(67294),ue=U(64335),ce=U(53645),Le=U.n(ce),ee=function(Je){var Ze=(0,V.useContext)(ue.Z),gt=Je.children,tr=Je.contentWidth,yt=Je.className,Wt=Je.style,bt=(0,V.useContext)(re.ZP.ConfigContext),at=bt.getPrefixCls,nt=Je.prefixCls||at("pro"),Zt=tr||Ze.contentWidth,Y="".concat(nt,"-grid-content");return V.createElement("div",{className:he()(Y,yt,{wide:Zt==="Fixed"}),style:Wt},V.createElement("div",{className:"".concat(nt,"-grid-content-children")},gt))};Q.Z=ee},18871:function(Mt,Q,U){"use strict";U.d(Q,{zP:function(){return u3},JE:function(){return _M},ns:function(){return s3}});var ie={};U.r(ie),U.d(ie,{add:function(){return qr},adjoint:function(){return kd},clone:function(){return gc},copy:function(){return Po},create:function(){return Ki},determinant:function(){return vh},equals:function(){return Vr},exactEquals:function(){return xn},frob:function(){return Rr},fromQuat:function(){return vr},fromQuat2:function(){return Be},fromRotation:function(){return Lf},fromRotationTranslation:function(){return ge},fromRotationTranslationScale:function(){return Jt},fromRotationTranslationScaleOrigin:function(){return cr},fromScaling:function(){return Wl},fromTranslation:function(){return zp},fromValues:function(){return Zs},fromXRotation:function(){return mh},fromYRotation:function(){return Dd},fromZRotation:function(){return N},frustum:function(){return yr},getRotation:function(){return Lt},getScaling:function(){return ir},getTranslation:function(){return Dt},identity:function(){return dh},invert:function(){return Np},lookAt:function(){return _r},mul:function(){return Er},multiply:function(){return Sl},multiplyScalar:function(){return er},multiplyScalarAndAdd:function(){return nr},ortho:function(){return st},orthoNO:function(){return Ar},orthoZO:function(){return Vt},perspective:function(){return Tr},perspectiveFromFieldOfView:function(){return mr},perspectiveNO:function(){return wr},perspectiveZO:function(){return jr},rotate:function(){return ed},rotateX:function(){return lp},rotateY:function(){return nf},rotateZ:function(){return Ea},scale:function(){return Hl},set:function(){return Jh},str:function(){return lr},sub:function(){return Xr},subtract:function(){return Bn},targetTo:function(){return Nr},translate:function(){return up},transpose:function(){return Ld}});var re=U(67294),m=(0,re.createContext)({});function he(){return(0,re.useContext)(m)}var V={},ue={},ce=function(i){return ue[i]},Le=function(i,r){ue[i]=r},ee=function(i){return V[i]},Xe=function(i,r){V[i]=r},Je={},Ze={},gt=34,tr=10,yt=13;function Wt(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function bt(e,i){var r=Wt(e);return function(n,a){return i(r(n),a,e)}}function at(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var a in n)a in i||r.push(i[a]=a)}),r}function nt(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function Zt(e){return e<0?"-"+nt(-e,6):e>9999?"+"+nt(e,6):nt(e,4)}function Y(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),a=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Zt(e.getUTCFullYear(),4)+"-"+nt(e.getUTCMonth()+1,2)+"-"+nt(e.getUTCDate(),2)+(a?"T"+nt(i,2)+":"+nt(r,2)+":"+nt(n,2)+"."+nt(a,3)+"Z":n?"T"+nt(i,2)+":"+nt(r,2)+":"+nt(n,2)+"Z":r||i?"T"+nt(i,2)+":"+nt(r,2)+"Z":"")}function qt(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(T,R){var F,G,q=a(T,function(te,Se){if(F)return F(te,Se-1);G=te,F=R?bt(te,R):Wt(te)});return q.columns=G||[],q}function a(T,R){var F=[],G=T.length,q=0,te=0,Se,Ne=G<=0,Ke=!1;T.charCodeAt(G-1)===tr&&--G,T.charCodeAt(G-1)===yt&&--G;function it(){if(Ne)return Ze;if(Ke)return Ke=!1,Je;var Tt,$t=q,sr;if(T.charCodeAt($t)===gt){for(;q++<G&&T.charCodeAt(q)!==gt||T.charCodeAt(++q)===gt;);return(Tt=q)>=G?Ne=!0:(sr=T.charCodeAt(q++))===tr?Ke=!0:sr===yt&&(Ke=!0,T.charCodeAt(q)===tr&&++q),T.slice($t+1,Tt-1).replace(/""/g,'"')}for(;q<G;){if((sr=T.charCodeAt(Tt=q++))===tr)Ke=!0;else if(sr===yt)Ke=!0,T.charCodeAt(q)===tr&&++q;else if(sr!==r)continue;return T.slice($t,Tt)}return Ne=!0,T.slice($t,G)}for(;(Se=it())!==Ze;){for(var St=[];Se!==Je&&Se!==Ze;)St.push(Se),Se=it();R&&(St=R(St,te++))==null||F.push(St)}return F}function s(T,R){return T.map(function(F){return R.map(function(G){return C(F[G])}).join(e)})}function p(T,R){return R==null&&(R=at(T)),[R.map(C).join(e)].concat(s(T,R)).join(`
`)}function v(T,R){return R==null&&(R=at(T)),s(T,R).join(`
`)}function g(T){return T.map(x).join(`
`)}function x(T){return T.map(C).join(e)}function C(T){return T==null?"":T instanceof Date?Y(T):i.test(T+="")?'"'+T.replace(/"/g,'""')+'"':T}return{parse:n,parseRows:a,format:p,formatBody:v,formatRows:g,formatRow:x,formatValue:C}}var ut=qt(","),Qe=ut.parse,Ct=ut.parseRows,$e=ut.format,Kt=ut.formatBody,xr=ut.formatRows,kr=ut.formatRow,Kr=ut.formatValue,A=U(96156),Ae=U(85061),De=U(38163),At=U.n(De);function mt(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ft(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mt(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mt(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yt(e,i){var r=i.x,n=i.y,a=i.x1,s=i.y1,p=i.coordinates,v=[];return Array.isArray(e)?(e.forEach(function(g,x){var C=[];if(r&&n&&(C=[parseFloat(g[r]),parseFloat(g[n])]),r&&n&&a&&s){var T=[parseFloat(g[r]),parseFloat(g[n])],R=[parseFloat(g[a]),parseFloat(g[s])];C=[T,R]}if(p){var F="Polygon";Array.isArray(p[0])||(F="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(F="LineString");var G={type:F,coordinates:(0,Ae.Z)(g[p])};At()(G,!0),C=G.coordinates}var q=Ft(Ft({},g),{},{_id:x,coordinates:C});v.push(q)}),{dataArray:v}):{dataArray:[]}}var Sr=[{lng1:100,lat1:30,lng2:130,lat2:30}],qn={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function hn(e,i){var r=Qe(e);return Yt(r,i)}var fi=63710088e-1,Gn={centimeters:fi*100,centimetres:fi*100,degrees:fi/111325,feet:fi*3.28084,inches:fi*39.37,kilometers:fi/1e3,kilometres:fi/1e3,meters:fi,metres:fi,miles:fi/1609.344,millimeters:fi*1e3,millimetres:fi*1e3,nauticalmiles:fi/1852,radians:1,yards:fi*1.0936},ni={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/fi,yards:1.0936133},pi={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Wn(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function hi(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ua(i).geometry;case"LineString":return la(i).geometry;case"Polygon":return Di(i).geometry;case"MultiPoint":return Si(i).geometry;case"MultiLineString":return Xn(i).geometry;case"MultiPolygon":return Zi(i).geometry;default:throw new Error(e+" is invalid")}}function ua(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Sn(e[0])||!Sn(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return Wn(n,i,r)}function Gi(e,i,r){return r===void 0&&(r={}),ma(e.map(function(n){return ua(n,i)}),r)}function Di(e,i,r){r===void 0&&(r={});for(var n=0,a=e;n<a.length;n++){var s=a[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var v={type:"Polygon",coordinates:e};return Wn(v,i,r)}function $i(e,i,r){return r===void 0&&(r={}),ma(e.map(function(n){return Di(n,i)}),r)}function la(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return Wn(n,i,r)}function Mi(e,i,r){return r===void 0&&(r={}),ma(e.map(function(n){return la(n,i)}),r)}function ma(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function Xn(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return Wn(n,i,r)}function Si(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return Wn(n,i,r)}function Zi(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return Wn(n,i,r)}function Qi(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return Wn(n,i,r)}function ko(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function me(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e*r}function kn(e,i){i===void 0&&(i="kilometers");var r=Gn[i];if(!r)throw new Error(i+" units is invalid");return e/r}function Ha(e,i){return Bt(kn(e,i))}function ns(e){var i=e%360;return i<0&&(i+=360),i}function Bt(e){var i=e%(2*Math.PI);return i*180/Math.PI}function rr(e){var i=e%360;return i*Math.PI/180}function Cr(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return me(kn(e,i),r)}function Qr(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=pi[i];if(!n)throw new Error("invalid original units");var a=pi[r];if(!a)throw new Error("invalid final units");return e/n*a}function Sn(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Fn(e){return!!e&&e.constructor===Object}function di(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Sn(i))throw new Error("bbox must only contain numbers")})}function Kn(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function an(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Fi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Li(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Li(e[0]);throw new Error("coordinates must only contain numbers")}function ao(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function vs(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Zo(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,a=e.features;n<a.length;n++){var s=a[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function za(e){return e.type==="Feature"?e.geometry:e}function ba(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function H(e,i,r){if(e!==null)for(var n,a,s,p,v,g,x,C=0,T=0,R,F=e.type,G=F==="FeatureCollection",q=F==="Feature",te=G?e.features.length:1,Se=0;Se<te;Se++){x=G?e.features[Se].geometry:q?e.geometry:e,R=x?x.type==="GeometryCollection":!1,v=R?x.geometries.length:1;for(var Ne=0;Ne<v;Ne++){var Ke=0,it=0;if(p=R?x.geometries[Ne]:x,p!==null){g=p.coordinates;var St=p.type;switch(C=r&&(St==="Polygon"||St==="MultiPolygon")?1:0,St){case null:break;case"Point":if(i(g,T,Se,Ke,it)===!1)return!1;T++,Ke++;break;case"LineString":case"MultiPoint":for(n=0;n<g.length;n++){if(i(g[n],T,Se,Ke,it)===!1)return!1;T++,St==="MultiPoint"&&Ke++}St==="LineString"&&Ke++;break;case"Polygon":case"MultiLineString":for(n=0;n<g.length;n++){for(a=0;a<g[n].length-C;a++){if(i(g[n][a],T,Se,Ke,it)===!1)return!1;T++}St==="MultiLineString"&&Ke++,St==="Polygon"&&it++}St==="Polygon"&&Ke++;break;case"MultiPolygon":for(n=0;n<g.length;n++){for(it=0,a=0;a<g[n].length;a++){for(s=0;s<g[n][a].length-C;s++){if(i(g[n][a][s],T,Se,Ke,it)===!1)return!1;T++}it++}Ke++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(H(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function J(e,i,r,n){var a=r;return H(e,function(s,p,v,g,x){p===0&&r===void 0?a=s:a=i(a,s,p,v,g,x)},n),a}function ae(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function ye(e,i,r){var n=r;return ae(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function Pe(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function He(e,i,r){var n=r;return Pe(e,function(a,s){s===0&&r===void 0?n=a:n=i(n,a,s)}),n}function tt(e){var i=[];return H(e,function(r){i.push(r)}),i}function fe(e,i){var r,n,a,s,p,v,g,x,C,T,R=0,F=e.type==="FeatureCollection",G=e.type==="Feature",q=F?e.features.length:1;for(r=0;r<q;r++){for(v=F?e.features[r].geometry:G?e.geometry:e,x=F?e.features[r].properties:G?e.properties:{},C=F?e.features[r].bbox:G?e.bbox:void 0,T=F?e.features[r].id:G?e.id:void 0,g=v?v.type==="GeometryCollection":!1,p=g?v.geometries.length:1,a=0;a<p;a++){if(s=g?v.geometries[a]:v,s===null){if(i(null,R,x,C,T)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,R,x,C,T)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],R,x,C,T)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function ke(e,i,r){var n=r;return fe(e,function(a,s,p,v,g){s===0&&r===void 0?n=a:n=i(n,a,s,p,v,g)}),n}function ht(e,i){fe(e,function(r,n,a,s,p){var v=r===null?null:r.type;switch(v){case null:case"Point":case"LineString":case"Polygon":return i(Wn(r,a,{bbox:s,id:p}),n,0)===!1?!1:void 0}var g;switch(v){case"MultiPoint":g="Point";break;case"MultiLineString":g="LineString";break;case"MultiPolygon":g="Polygon";break}for(var x=0;x<r.coordinates.length;x++){var C=r.coordinates[x],T={type:g,coordinates:C};if(i(Wn(T,a),n,x)===!1)return!1}})}function pr(e,i,r){var n=r;return ht(e,function(a,s,p){s===0&&p===0&&r===void 0?n=a:n=i(n,a,s,p)}),n}function kt(e,i){ht(e,function(r,n,a){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var v,g=0,x=0,C=0;if(H(r,function(T,R,F,G,q){if(v===void 0||n>g||G>x||q>C){v=T,g=n,x=G,C=q,s=0;return}var te=lineString([v,T],r.properties);if(i(te,n,a,q,s)===!1)return!1;s++,v=T})===!1)return!1}}})}function Nt(e,i,r){var n=r,a=!1;return kt(e,function(s,p,v,g,x){a===!1&&r===void 0?n=s:n=i(n,s,p,v,g,x),a=!0}),n}function hr(e,i){if(!e)throw new Error("geojson is required");ht(e,function(r,n,a){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,a,0,0)===!1)return!1;break;case"Polygon":for(var v=0;v<p.length;v++)if(i(lineString(p[v],r.properties),n,a,v)===!1)return!1;break}}})}function _n(e,i,r){var n=r;return hr(e,function(a,s,p,v){s===0&&r===void 0?n=a:n=i(n,a,s,p,v)}),n}function fn(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=g.length+s-1),lineString([g[s],g[s+1]],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s-1),lineString([g[a][s],g[a][s+1]],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s-1),lineString([g[n][s],g[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s-1),lineString([g[n][a][s],g[n][a][s+1]],p,i)}throw new Error("geojson is invalid")}function Pt(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,a=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,v;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,v=e.features[r].geometry;break;case"Feature":p=p||e.properties,v=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":v=e;break;default:throw new Error("geojson is invalid")}if(v===null)return null;var g=v.coordinates;switch(v.type){case"Point":return point(g,p,i);case"MultiPoint":return n<0&&(n=g.length+n),point(g[n],p,i);case"LineString":return s<0&&(s=g.length+s),point(g[s],p,i);case"Polygon":return a<0&&(a=g.length+a),s<0&&(s=g[a].length+s),point(g[a][s],p,i);case"MultiLineString":return n<0&&(n=g.length+n),s<0&&(s=g[n].length+s),point(g[n][s],p,i);case"MultiPolygon":return n<0&&(n=g.length+n),a<0&&(a=g[n].length+a),s<0&&(s=g[n][a].length-s),point(g[n][a][s],p,i)}throw new Error("geojson is invalid")}function Jr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Br(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jr(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Hr(e,i){var r=[],n={};if(!e.features)return e.features=[],{dataArray:[]};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),At()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var a=0;return ht(e,function(s,p){var v=Fi(s),g=p,x=Br(Br({},s.properties),{},{coordinates:v,_id:g});r.push(x)}),{dataArray:r,featureKeys:n}}function gi(e){var i=131,r=137,n=0;e+="x";for(var a=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>a&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function en(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var yn=U(28481),Xi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function vi(e){this.message=e}vi.prototype=new Error,vi.prototype.name="InvalidCharacterError";function Pi(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new vi("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,a,s,p=0;s=i.charAt(p++);~s&&(a=n%4?a*64+s:s,n++%4)?r+=String.fromCharCode(255&a>>(-2*n&6)):0)s=Xi.indexOf(s);return r}function xi(e){e=String(e);for(var i,r,n,a,s="",p=0,v=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(a=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|a,s+=Xi.charAt(i>>18&63)+Xi.charAt(i>>12&63)+Xi.charAt(i>>6&63)+Xi.charAt(i&63)}return v?s.slice(0,v-3)+"===".substring(v):s}var dt=U(6610),It=U(5991),Ta=function(){function e(i,r){(0,dt.Z)(this,e),this.buffers=i,this.type=r}return(0,It.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,a){throw new Error("not implemented")}}]),e}(),Ci;typeof window=="undefined"?Ci={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:Ci=window;var Ii=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ji=Ii?my.getSystemInfoSync().pixelRatio:Ci.devicePixelRatio,Ir=U(10379),on=U(46070),_t=U(77608),na=(0,It.Z)(function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"cancelBubble",void 0),(0,A.Z)(this,"cancelable",void 0),(0,A.Z)(this,"target",void 0),(0,A.Z)(this,"currentTarget",void 0),(0,A.Z)(this,"preventDefault",void 0),(0,A.Z)(this,"stopPropagation",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),de=U(63349);function Ko(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ra(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function ra(e,i){if(!!e){if(typeof e=="string")return _u(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _u(e,i)}}function _u(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ua=new WeakMap,Ma=function(){function e(){(0,dt.Z)(this,e),Ua.set(this,{})}return(0,It.Z)(e,[{key:"addEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Ua.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),Ua.set(this,s),a.capture,a.once,a.passive}},{key:"removeEventListener",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=Ua.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var v=p.length;v--;v>0)if(p[v]===n){p.splice(v,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=Ua.get(this)[r.type];if(n){var a=Ko(n),s;try{for(a.s();!(s=a.n()).done;){var p=s.value;p(r)}}catch(v){a.e(v)}finally{a.f()}}}}]),e}();function Ka(e){var i=ia();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ia(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ao=function(e){(0,Ir.Z)(r,e);var i=Ka(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,de.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,It.Z)(r,[{key:"appendChild",value:function(a){this.childNodes.push(a)}},{key:"cloneNode",value:function(){var a=Object.create(this);return Object.assign(a,this),a}},{key:"removeChild",value:function(a){var s=this.childNodes.findIndex(function(p){return p===a});return s>-1?this.childNodes.splice(s,1):null}}]),r}(Ma);function jo(e){var i=Cu();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Cu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vo=function(e){(0,Ir.Z)(r,e);var i=jo(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,de.Z)(n),"className",void 0),(0,A.Z)((0,de.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,It.Z)(r,[{key:"setAttribute",value:function(a,s){this[a]=s}},{key:"getAttribute",value:function(a){return this[a]}},{key:"setAttributeNS",value:function(a,s){this[a]=s}},{key:"getAttributeNS",value:function(a){return this[a]}}]),r}(Ao),Do=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,aa,$a,Fo,Qa;if(Do){var ws=my.getSystemInfoSync();aa=ws.screenWidth,$a=ws.screenHeight,Fo=ws.windowWidth,Qa=ws.windowHeight}else{var wl=Ci.innerWidth,ms=Ci.innerHeight;aa=wl,$a=ms,Fo=wl,Qa=ms}var ne={width:aa,height:$a,availWidth:Fo,availHeight:Qa,availLeft:0,availTop:0},be=ne.availWidth,Ye=ne.availHeight,Rt={style:[]};function Or(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return Rt}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return Rt}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function Pn(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:be+"px",height:Ye+"px",margin:"0px",padding:"0px"})}function Oi(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=be,e.clientHeight=Ye),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function oo(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=be,e.offsetHeight=Ye)}function La(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=be,e.scrollHeight=Ye)}function Za(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Vo(e){var i=gs();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function gs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function lo(){}var wo=function(e){(0,Ir.Z)(r,e);var i=Vo(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,de.Z)(n),"className",void 0),(0,A.Z)((0,de.Z)(n),"children",void 0),(0,A.Z)((0,de.Z)(n),"focus",void 0),(0,A.Z)((0,de.Z)(n),"blur",void 0),(0,A.Z)((0,de.Z)(n),"insertBefore",void 0),(0,A.Z)((0,de.Z)(n),"appendChild",void 0),(0,A.Z)((0,de.Z)(n),"removeChild",void 0),(0,A.Z)((0,de.Z)(n),"remove",void 0),(0,A.Z)((0,de.Z)(n),"innerHTML",void 0),(0,A.Z)((0,de.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=lo,n.blur=lo,n.insertBefore=lo,n.appendChild=lo,n.removeChild=lo,n.remove=lo,n.innerHTML="",n.tagName=a.toUpperCase(),Or((0,de.Z)(n),s),Pn((0,de.Z)(n)),Za((0,de.Z)(n)),Oi((0,de.Z)(n)),oo((0,de.Z)(n)),La((0,de.Z)(n)),n}return(0,It.Z)(r)}(vo);function ys(e){var i=Ts();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Fs=function(e){(0,Ir.Z)(r,e);var i=ys(r);function r(n){return(0,dt.Z)(this,r),i.call(this,n)}return(0,It.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(wo);function uu(e){var i=_s();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _s(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ga=function(e){(0,Ir.Z)(r,e);var i=uu(r);function r(){return(0,dt.Z)(this,r),i.call(this,"video")}return(0,It.Z)(r)}(Fs),xa={},is={};function hf(e,i){xa=e,xa.id=i,"tagName"in xa||(xa.tagName="CANVAS"),xa.type="canvas",Mixin.parentNode(xa),Mixin.style(xa),Mixin.classList(xa),Mixin.clientRegion(xa),Mixin.offsetRegion(xa),xa.focus=function(){},xa.blur=function(){}}function Tl(e,i){var r=1024,n=1024;is={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in is||(is.tagName="CANVAS"),Mixin.parentNode(is),Mixin.style(is),Mixin.classList(is),Mixin.clientRegion(is),Mixin.offsetRegion(is),is.getContext=function(a){if(a==="2d")return e},is.focus=function(){},is.blur=function(){}}function Xs(){return xa}function tc(){return is}var Wu=(0,It.Z)(function e(){(0,dt.Z)(this,e);var i=Xs(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Or(r),Za(r),Object.assign(r,{addEventListener:function(a,s){r["on".concat(a)]=s.bind(r)},removeEventListener:function(a){r["on".concat(a)]=null}}),r}),Ys={href:"",protocol:"",host:""};function al(e){var i=_();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M=function(e){(0,Ir.Z)(r,e);var i=al(r);function r(){return(0,dt.Z)(this,r),i.call(this,"body",0)}return(0,It.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s,p){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),B=function(e){(0,Ir.Z)(r,e);var i=al(r);function r(){return(0,dt.Z)(this,r),i.call(this,"html",0)}return(0,It.Z)(r,[{key:"addEventListener",value:function(a,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(a,s){}},{key:"dispatchEvent",value:function(a){}}]),r}(wo),O={},$={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Ys,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new Wu:i==="video"?new ga:new wo(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){O[i]||(O[i]=[]),O[i].push(r)},removeEventListener:function(i,r){var n=O[i];if(n&&n.length>0){for(var a=n.length;a--;a>0)if(n[a]===r){n.splice(a,1);break}}},dispatchEvent:function(i){var r=i.type,n=O[r];if(n)for(var a=0;a<n.length;a++)n[a](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new na(i)}};$.documentElement=new B,$.head=new wo("head"),$.body=new M;var xe=Object,We=U(90484),ft=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"_w",void 0),(0,A.Z)(this,"_h",void 0),(0,A.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,We.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,It.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ar,ur,Tn;if(pt){var ii=my.getSystemInfoSync();ar=ii.system,ur=ii.platform,Tn=ii.language}else{var Rn={versions:function(){var e=Ci.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:(Ci.navigator.browserLanguage||Ci.navigator.language).toLowerCase()};Rn.versions.android?ur="android":Rn.versions.trident?ur="IE":Rn.versions.presto?ur="Opera":Rn.versions.webKit?ur="webKit":Rn.versions.gecko?ur="Firefox":Rn.versions.mobile?ur="mobile":Rn.versions.ios?ur="ios":Rn.versions.iPhone?ur="iPhone":Rn.versions.iPad?ur="ipad":Rn.versions.webApp?ur="webApp":Rn.versions.weixin?ur="weixin":Rn.versions.qq&&(ur="qq"),ar=Ci.navigator.userAgent,Tn=Rn.language}var Yi=ar.toLowerCase().indexOf("android")!==-1,da=Yi?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Ca="Mozilla/5.0 (".concat(da,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Tn),Hi={platform:ur,language:Tn,appVersion:"5.0 (".concat(da,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Ca},xs={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},lu=0,Xu=0;function df(e){var i=Date.now(),r=Math.max(lu+23,i);return Xu=setTimeout(function(){e(lu=r)},r-i),Xu}function ol(e){var i=Xs();return i.requestAnimationFrame?i.requestAnimationFrame(e):df(e)}function kc(e){var i=Xs();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var Au=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,dt.Z)(this,e),(0,A.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,It.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],a=r.type,s=wu(n),p="data:".concat(a,";base64, ");return p+s}}]),e}();function wu(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,a=0;a<n;a++)i+=String.fromCharCode(r[a]);return xi(i)}var Tu={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},co={};function jf(e){var i=Vf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $o=new Map,Dc=new Map,Mu=new Map,cu={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function vf(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function Ml(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,vf.call(this,"readystatechange",i)}var Ni=function(e){(0,Ir.Z)(r,e);var i=jf(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,de.Z)(n),"onabort",void 0),(0,A.Z)((0,de.Z)(n),"onerror",void 0),(0,A.Z)((0,de.Z)(n),"onload",void 0),(0,A.Z)((0,de.Z)(n),"onloadstart",void 0),(0,A.Z)((0,de.Z)(n),"onprogress",void 0),(0,A.Z)((0,de.Z)(n),"ontimeout",void 0),(0,A.Z)((0,de.Z)(n),"onloadend",void 0),(0,A.Z)((0,de.Z)(n),"onreadystatechange",void 0),(0,A.Z)((0,de.Z)(n),"readyState",void 0),(0,A.Z)((0,de.Z)(n),"response",void 0),(0,A.Z)((0,de.Z)(n),"responseText",void 0),(0,A.Z)((0,de.Z)(n),"_responseType",void 0),(0,A.Z)((0,de.Z)(n),"responseXML",void 0),(0,A.Z)((0,de.Z)(n),"status",void 0),(0,A.Z)((0,de.Z)(n),"statusText",void 0),(0,A.Z)((0,de.Z)(n),"upload",void 0),(0,A.Z)((0,de.Z)(n),"withCredentials",void 0),(0,A.Z)((0,de.Z)(n),"timeout",void 0),(0,A.Z)((0,de.Z)(n),"_url",void 0),(0,A.Z)((0,de.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,$o.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,It.Z)(r,[{key:"responseType",set:function(a){this._responseType=a}},{key:"abort",value:function(){var a=Mu.get("requestTask");a&&a.abort()}},{key:"getAllResponseHeaders",value:function(){var a=Dc.get("responseHeader");return Object.keys(a).map(function(s){return"".concat(s,": ").concat(a[s])}).join(`
`)}},{key:"getResponseHeader",value:function(a){return Dc.get("responseHeader")[a]}},{key:"open",value:function(a,s,p){this._method=a,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(a,s){var p=$o.get("requestHeader");p[a]=s,$o.set("requestHeader",p)}},{key:"addEventListener",value:function(a,s){var p=this;typeof s=="function"&&(this["on"+a]=function(){var v=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};v.target=v.target||p,s.call(p,v)})}},{key:"removeEventListener",value:function(a,s){this["on"+a]===s&&(this["on"+a]=null)}}]),r}(Ma);(0,A.Z)(Ni,"UNSEND",void 0),(0,A.Z)(Ni,"OPENED",void 0),(0,A.Z)(Ni,"HEADERS_RECEIVED",void 0),(0,A.Z)(Ni,"LOADING",void 0),(0,A.Z)(Ni,"DONE",void 0),Ni.UNSEND=0,Ni.OPENED=1,Ni.HEADERS_RECEIVED=2,Ni.LOADING=3,Ni.DONE=4;function Pl(e){var i=Cp();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Cp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sl=function(e){(0,Ir.Z)(r,e);var i=Pl(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,de.Z)(a),"touches",void 0),(0,A.Z)((0,de.Z)(a),"targetTouches",void 0),(0,A.Z)((0,de.Z)(a),"changedTouches",void 0),a.touches=[],a.targetTouches=[],a.changedTouches=[],a.target=Xs(),a.currentTarget=Xs(),a}return(0,It.Z)(r)}(na);function Fc(e){var i=e||{},r=i.x,n=r===void 0?0:r,a=i.y,s=a===void 0?0:a,p=i.clientX,v=p===void 0?0:p,g=i.clientY,x=g===void 0?0:g;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=v,e.y=x)}function Gf(e){return function(i){var r=new sl(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return Fc(n)}),r.touches.forEach(function(n){return Fc(n)}),r.targetTouches.forEach(function(n){return Fc(n)}),$.dispatchEvent(r)}}function Ap(e){return function(i){i.type=e,$.dispatchEvent(i)}}var Hf=Gf("touchstart"),Bc=Gf("touchmove"),rc=Gf("touchend"),nc=Ap("mapCameaParams");function Il(e){var i=ul();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ul(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ol=function(e){(0,Ir.Z)(r,e);var i=Il(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,de.Z)(a),"buttons",void 0),(0,A.Z)((0,de.Z)(a),"which",void 0),(0,A.Z)((0,de.Z)(a),"pointerId",void 0),(0,A.Z)((0,de.Z)(a),"bubbles",void 0),(0,A.Z)((0,de.Z)(a),"button",void 0),(0,A.Z)((0,de.Z)(a),"width",void 0),(0,A.Z)((0,de.Z)(a),"height",void 0),(0,A.Z)((0,de.Z)(a),"pressure",void 0),(0,A.Z)((0,de.Z)(a),"isPrimary",void 0),(0,A.Z)((0,de.Z)(a),"pointerType",void 0),(0,A.Z)((0,de.Z)(a),"altKey",void 0),(0,A.Z)((0,de.Z)(a),"ctrlKey",void 0),(0,A.Z)((0,de.Z)(a),"metaKey",void 0),(0,A.Z)((0,de.Z)(a),"shiftKey",void 0),a.target=Xs(),a.currentTarget=Xs(),a}return(0,It.Z)(r)}(na),Yu=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],qs=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],mf="touch";function gf(e,i,r){for(var n=new Ol(e),a=0;a<Yu.length;a++){var s=Yu[a];n[s]=i[s]||qs[a]}return n.type=e,n.target=Xs(),n.currentTarget=Xs(),n.buttons=Wf(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=ic(i),n.pointerType=mf,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Wf(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var fu=null;function ic(e){return fu===e.identifier}function Nc(e){fu===null&&(fu=e.identifier)}function yf(e){fu===e.identifier&&(fu=null)}function Rl(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var a=r[n];n===0&&e==="pointerdown"?Nc(a):(e==="pointerup"||e==="pointercancel")&&yf(a);var s=gf(e,a,i);$.dispatchEvent(s)}}}var uh=Rl("pointerdown"),_f=Rl("pointermove"),Ll=Rl("pointerup");function xf(e){var i=bf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function bf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kl=function(e){(0,Ir.Z)(r,e);var i=xf(r);function r(n){return(0,dt.Z)(this,r),i.call(this,n)}return(0,It.Z)(r)}(na);function zc(e){return function(i){i.type=e,$.dispatchEvent(i)}}var wp=zc("mousedown"),Tp=zc("mousemove"),ac=zc("mouseup"),Mp=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Dl=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ji=Mp||Dl,oc={atob:Pi,btoa:xi,devicePixelRatio:ji,Blob:Ta,document:$,Element:vo,Event:na,EventTarget:Ma,HTMLCanvasElement:xe,HTMLElement:wo,HTMLMediaElement:Fs,HTMLVideoElement:ga,Image:Wu,ImageData:ft,navigator:Hi,Node:Ao,requestAnimationFrame:ol,cancelAnimationFrame:kc,screen:ne,XMLHttpRequest:Ni,performance:xs,URL:Au,WebGLRenderingContext:Tu,WebGL2RenderingContext:co,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};$.addEventListener(i,r,n)},removeEventListener:function(i,r,n){$.removeEventListener(i,r)},dispatchEvent:function(i){$.dispatchEvent(i)},innerWidth:ne.availWidth,innerHeight:ne.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ca=Ji?oc:Ci,Pu=Ji?Ni:Ci.XMLHttpRequest,qi=Ji?Ys:Ci.location;function Pa(e){var i=e;return typeof e=="string"&&(i=ca.document.getElementById(e)),i}function bs(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Uc(e){return bs(e).split(/\s+/)}function qu(e){var i,r,n=ca==null||(i=ca.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var a in e)if(e[a]&&e[a]in n)return e[a];return e[0]}function ja(e,i,r){var n=ca.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function sc(e){var i=e.parentNode;i&&i.removeChild(e)}function Fl(e,i){if(e.classList!==void 0)for(var r=Uc(i),n=0,a=r.length;n<a;n++)e.classList.add(r[n]);else if(!Zc(e,i)){var s=mo(e);Iu(e,(s?s+" ":"")+i)}}function Ku(e,i){e.classList!==void 0?e.classList.remove(i):Iu(e,bs((" "+mo(e)+" ").replace(" "+i+" "," ")))}function Zc(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=mo(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function Iu(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function mo(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Bl(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var uc=qu(["transform","WebkitTransform"]);function go(e,i){e.style[uc]=i}function dn(){if(typeof Event=="function")ca.dispatchEvent(new Event("resize"));else{var e=ca.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ca,0),ca.dispatchEvent(e)}}function fo(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function $u(){var e,i=ca.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(a){var s=a.split("="),p=(0,yn.Z)(s,2),v=p[0],g=p[1];return v==="initial-scale"});return n?n.split("=")[1]*1:1}var ka=$u()<1?1:ca.devicePixelRatio,Ks=U(14665);function Ms(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var Ef=U(51814);function Zr(e,i,r){return(0,Ef.Z)()?Zr=Reflect.construct:Zr=function(a,s,p){var v=[null];v.push.apply(v,s);var g=Function.bind.apply(a,v),x=new g;return p&&(0,Ks.Z)(x,p.prototype),x},Zr.apply(null,arguments)}function lc(e){var i=typeof Map=="function"?new Map:void 0;return lc=function(n){if(n===null||!Ms(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,a)}function a(){return Zr(n,arguments,(0,_t.Z)(this).constructor)}return a.prototype=Object.create(n.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),(0,Ks.Z)(a,n)},lc(e)}function Sf(e){var i=ll();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ll(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Aa=function(e){(0,Ir.Z)(r,e);var i=Sf(r);function r(n,a,s){var p;return(0,dt.Z)(this,r),p=i.call(this,n),(0,A.Z)((0,de.Z)(p),"status",void 0),(0,A.Z)((0,de.Z)(p),"url",void 0),p.status=a,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,It.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(lc(Error));function Es(e){var i=new Pu;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var Cf=function(i,r){var n=Es(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var a;try{a=JSON.parse(n.response)}catch(s){return r(s)}r(null,a)}else n.status===401?r(new Aa("".concat(n.statusText),n.status,i.url)):r(new Aa(n.statusText,n.status,i.url))},n.send(),n},Ou=function(i,r){var n=Es(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var a=n.response;if(a.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:a,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Aa(n.statusText,n.status,i.url))},n.send(),n};function Bs(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ru="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Xf=function(i,r){return Ou(i,function(n,a){if(n)r(n);else if(a){var s=new ca.Image;s.crossOrigin="anonymous";var p=ca.URL||ca.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var v=new ca.Blob([new Uint8Array(a.data)],{type:"image/png"});s.src=a.data.byteLength?p.createObjectURL(v):Ru}})},cl=2*Math.PI*6378137/2;function Yf(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;Af(i,n)}),i}function Af(e,i){return Array.isArray(i[0])?i.forEach(function(r){Af(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function pu(e,i){return Ps(e,i)}function Ps(e,i){return Array.isArray(e[0])?e.map(function(r){return Ps(r,i)}):i(e)}function Ti(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=fl(e,i);var n=e[0],a=e[1],s=n*cl/180,p=Math.log(Math.tan((90+a)*Math.PI/360))/(Math.PI/180);return p=p*cl/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function Lu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],a=r/cl*180,s=n/cl*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(a=Number(a.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[a,s,e[2]]:[a,s]}function hu(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Go(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function fl(e,i){if(i===!1)return e;var r=hu(e[0]),n=Go(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function as(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,a=Math.PI/180,s=e[0]*a,p=r*a;p=Math.log(Math.tan(Math.PI/4+p/2));var v=.5/Math.PI,g=.5,x=-.5/Math.PI;return a=.5,s=n*(v*s+g),p=n*(x*p+a),[Math.floor(s),Math.floor(p)]}function $s(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,a=.5,s=256<<20,p=_slicedToArray(e,2),v=p[0],g=p[1];v=(v/s-r)/i,g=(g/s-a)/n,g=(Math.atan(Math.pow(Math.E,g))-Math.PI/4)*2,a=Math.PI/180;var x=g/a,C=v/a;return[C,x]}function Ss(e,i,r){var n=rr(i[1]-e[1]),a=rr(i[0]-e[0]),s=rr(e[1]),p=rr(i[1]),v=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(p);return me(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),r="meters")}function xu(e){var i=Math.PI/180,r=85.0511287798,n=6378137,a=Math.max(Math.min(r,e[1]),-r),s=Math.sin(a*i),p=n*e[0]*i,v=n*Math.log((1+s)/(1-s))/2;return[p,v]}function On(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function Cn(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function jc(e){return[[e[0],e[1]],[e[2],e[3]]]}function Qo(e){var i=Qs(e,[0,0]);return[e[0]/i,e[1]/i]}function Qs(e,i){return Math.sqrt(Math.pow(e[0]-i[0],2)+Math.pow(e[1]-i[1],2))}function Ho(e,i){return e[0]*i[0]+e[1]*i[1]}function du(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function qf(e,i){return Math.acos(Ho(e,i)/(du(e)*du(i)))*180/Math.PI}function Vc(e,i){return i[0]>0?i[1]>0?90-Math.atan(i[1]/i[0])*180/Math.PI:90+Math.atan(-i[1]/i[0])*180/Math.PI:i[1]<0?180+(90-Math.atan(i[1]/i[0])*180/Math.PI):270+Math.atan(i[1]/-i[0])*180/Math.PI}function ya(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var r=[0,1],n=0,a=[],s=0;s<e.length-1;s++){var p=e[s],v=e[s+1],g=Qs(p,v);n+=g;var x=[p[0]-v[0],p[1]-v[1]],C=Vc(r,x);if(s>0){var T=a[s-1].rotation;T-C>360-T+C&&(C=C+360)}a.push({start:p,end:v,dis:g,rotation:C,duration:0})}return a.map(function(R){R.duration=i*(R.dis/n)}),a}}var Da=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,dt.Z)(this,e),(0,A.Z)(this,"limit",void 0),(0,A.Z)(this,"cache",void 0),(0,A.Z)(this,"destroy",void 0),(0,A.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,It.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(a){return a===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function pl(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var cc=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,dt.Z)(this,e),(0,A.Z)(this,"duration",16),(0,A.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,It.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),a=n-this.timestamp;this.timestamp=n,a>=this.duration&&r()}}]),e}(),Js=U(2650);function vu(e){return typeof e=="string"?!!Js.ZP(e):!1}function bi(e){var i=Js.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function Ns(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],a=i+r*256+n*65536-1;return a}function Is(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function hl(e){var i=ca.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),a=null,s=e.positions[0],p=e.positions[e.positions.length-1],v=0;v<e.colors.length;++v){var g=(e.positions[v]-s)/(p-s);n.addColorStop(g,e.colors[v])}if(r.fillStyle=n,r.fillRect(0,0,256,1),Ji)return a=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),{data:a,width:256,height:1};a=r.getImageData(0,0,256,1).data;for(var x=r.createImageData(256,1),C=0;C<x.data.length;C+=4)x.data[C+0]=a[C+0],x.data[C+1]=a[C+1],x.data[C+2]=a[C+2],x.data[C+3]=a[C+3];return x}var ku;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(ku||(ku={}));var Qu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gc(e,i,r){var n=e.classList;for(var a in Qu)Qu.hasOwnProperty(a)&&n.remove("l7-".concat(r,"-anchor-").concat(a));n.add("l7-".concat(r,"-anchor-").concat(i))}function Ia(e,i){return{enable:e,mask:255,func:{cmp:514,ref:i?1:0,mask:255}}}var eu={BACK:1029,FRONT:1028};function Nl(e){switch(e){case"GAODE1.x":return eu.BACK;case"GAODE2.x":return eu.BACK;case"MAPBOX":return eu.FRONT;case"SIMPLE":return eu.FRONT;case"GLOBEL":return eu.BACK;case"L7MAP":return eu.FRONT;default:return eu.FRONT}}function dl(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function vl(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function Hc(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function ml(e){if(e.length===0)throw new Error("mean requires at least one data point");return Hc(e)/e.length}function tu(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,a=1,s=1;s<e.length+1;s++)e[s]!==i?(a>n&&(n=a,r=i),a=1,i=e[s]):a++;return r*1}var fc={min:vl,max:dl,mean:ml,sum:Hc,mode:tu};function zl(e,i){return e.map(function(r){return r[i]})}function Kf(e,i){return fc[e](i)}function Ul(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,a=new Promise(function(p){l(e,function(v){p(v)})}),s={originData:e,images:a,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function l(e,i){var r=e,n=[];if(typeof r=="string")Xf({url:r},function(p,v){n.push(v),i(n)});else{var a=r.length,s=0;r.forEach(function(p){Xf({url:p},function(v,g){s++,n.push(g),s===a&&i(n)})})}return Ul}function f(e,i){var r=i.extent,n=i.width,a=i.height,s=i.min,p=i.max,v={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:a,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return v}var c=U(30236),d=U.n(c),E=U(47037),w=U.n(E),P=U(23560),k=U.n(P),Z=U(50361),X=U.n(Z),le=U(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function pe(e,i,r,n){function a(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function v(C){try{x(n.next(C))}catch(T){p(T)}}function g(C){try{x(n.throw(C))}catch(T){p(T)}}function x(C){C.done?s(C.value):a(C.value).then(v,g)}x((n=n.apply(e,i||[])).next())})}function ve(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,a,s,p;return p={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function v(x){return function(C){return g([x,C])}}function g(x){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,a&&(s=x[0]&2?a.return:x[0]?a.throw||((s=a.return)&&s.call(a),0):a.next)&&!(s=s.call(a,x[1])).done)return s;switch(a=0,s&&(x=[x[0]&2,s.value]),x[0]){case 0:case 1:s=x;break;case 4:return r.label++,{value:x[1],done:!1};case 5:r.label++,a=x[1],x=[0];continue;case 7:x=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(x[0]===6||x[0]===2)){r=0;continue}if(x[0]===3&&(!s||x[1]>s[0]&&x[1]<s[3])){r.label=x[1];break}if(x[0]===6&&r.label<s[1]){r.label=s[1],s=x;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(x);break}s[2]&&r.ops.pop(),r.trys.pop();continue}x=i.call(e,r)}catch(C){x=[6,C],a=0}finally{n=s=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}function Re(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,s=[],p;try{for(;(i===void 0||i-- >0)&&!(a=n.next()).done;)s.push(a.value)}catch(v){p={error:v}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function Ie(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Re(arguments[i]));return e}function ze(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ee(e,i){return i={exports:{}},e(i,i.exports),i.exports}var Ve=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});ze(Ve);var et=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],a=arguments.length;a--;)n[a]=arguments[a];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});ze(et);var vt=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=a,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof le=="object"&&typeof le.nextTick=="function";function a(v){setTimeout(v,0)}function s(v){return function(g){for(var x=[],C=arguments.length-1;C-- >0;)x[C]=arguments[C+1];return v(function(){return g.apply(void 0,x)})}}var p;r?p=setImmediate:n?p=le.nextTick:p=a,i.default=s(p)});ze(vt);var Xt=vt.fallback,jt=vt.wrap,Qt=vt.hasSetImmediate,dr=vt.hasNextTick,Lr=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(et),n=a(vt);function a(g){return g&&g.__esModule?g:{default:g}}function s(g){return(0,gr.isAsync)(g)?function(){for(var x=[],C=arguments.length;C--;)x[C]=arguments[C];var T=x.pop(),R=g.apply(this,x);return p(R,T)}:(0,r.default)(function(x,C){var T;try{T=g.apply(this,x)}catch(R){return C(R)}if(T&&typeof T.then=="function")return p(T,C);C(null,T)})}function p(g,x){return g.then(function(C){v(x,null,C)},function(C){v(x,C&&C.message?C:new Error(C))})}function v(g,x,C){try{g(x,C)}catch(T){(0,n.default)(function(R){throw R},T)}}e.exports=i.default});ze(Lr);var gr=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Lr);function n(g){return g&&g.__esModule?g:{default:g}}function a(g){return g[Symbol.toStringTag]==="AsyncFunction"}function s(g){return g[Symbol.toStringTag]==="AsyncGenerator"}function p(g){return typeof g[Symbol.asyncIterator]=="function"}function v(g){if(typeof g!="function")throw new Error("expected a function");return a(g)?(0,r.default)(g):g}i.default=v,i.isAsync=a,i.isAsyncGenerator=s,i.isAsyncIterable=p});ze(gr);var sn=gr.isAsyncIterable,zn=gr.isAsyncGenerator,Un=gr.isAsync,Ln=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,a){if(a===void 0&&(a=n.length),!a)throw new Error("arity is undefined");function s(){for(var p=this,v=[],g=arguments.length;g--;)v[g]=arguments[g];return typeof v[a-1]=="function"?n.apply(this,v):new Promise(function(x,C){v[a-1]=function(T){for(var R=[],F=arguments.length-1;F-- >0;)R[F]=arguments[F+1];if(T)return C(T);x(R.length>1?R:R[0])},n.apply(p,v)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});ze(Ln);var ki=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Ve),n=s(gr),a=s(Ln);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,a.default)(function(p,v,g){var x=(0,r.default)(v)?[]:{};p(v,function(C,T,R){(0,n.default)(C)(function(F){for(var G,q=[],te=arguments.length-1;te-- >0;)q[te]=arguments[te+1];q.length<2&&(G=q,q=G[0]),x[T]=q,R(F)})},function(C){return g(C,x)})},3),e.exports=i.default});ze(ki);var tn=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function a(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var v=n;n=null,v.apply(this,s)}}return Object.assign(a,n),a}e.exports=i.default});ze(tn);var ai=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});ze(ai);var li=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=g;var r=a(Ve),n=a(ai);function a(x){return x&&x.__esModule?x:{default:x}}function s(x){var C=-1,T=x.length;return function(){return++C<T?{value:x[C],key:C}:null}}function p(x){var C=-1;return function(){var R=x.next();return R.done?null:(C++,{value:R.value,key:C})}}function v(x){var C=x?Object.keys(x):[],T=-1,R=C.length;return function(){var G=C[++T];return T<R?{value:x[G],key:G}:null}}function g(x){if((0,r.default)(x))return s(x);var C=(0,n.default)(x);return C?p(C):v(x)}e.exports=i.default});ze(li);var $n=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,a)}}e.exports=i.default});ze($n);var jn=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});ze(jn);var mi=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=a;var r=n(jn);function n(s){return s&&s.__esModule?s:{default:s}}function a(s,p,v,g){var x=!1,C=!1,T=!1,R=0,F=0;function G(){R>=p||T||x||(T=!0,s.next().then(function(Se){var Ne=Se.value,Ke=Se.done;if(!(C||x)){if(T=!1,Ke){x=!0,R<=0&&g(null);return}R++,v(Ne,F,q),F++,G()}}).catch(te))}function q(Se,Ne){if(R-=1,!C){if(Se)return te(Se);if(Se===!1){x=!0,C=!0;return}if(Ne===r.default||x&&R<=0)return x=!0,g(null);G()}}function te(Se){C||(T=!1,x=!0,g(Se))}G()}e.exports=i.default});ze(mi);var Yn=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=v(tn),n=v(li),a=v($n),s=v(mi),p=v(jn);function v(g){return g&&g.__esModule?g:{default:g}}i.default=function(g){return function(x,C,T){if(T=(0,r.default)(T),g<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!x)return T(null);if((0,gr.isAsyncGenerator)(x))return(0,s.default)(x,g,C,T);if((0,gr.isAsyncIterable)(x))return(0,s.default)(x[Symbol.asyncIterator](),g,C,T);var R=(0,n.default)(x),F=!1,G=!1,q=0,te=!1;function Se(Ke,it){if(!G)if(q-=1,Ke)F=!0,T(Ke);else if(Ke===!1)F=!0,G=!0;else{if(it===p.default||F&&q<=0)return F=!0,T(null);te||Ne()}}function Ne(){for(te=!0;q<g&&!F;){var Ke=R();if(Ke===null){F=!0,q<=0&&T(null);return}q+=1,C(Ke.value,Ke.key,(0,a.default)(Se))}te=!1}Ne()}},e.exports=i.default});ze(Yn);var Hn=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Yn),n=s(gr),a=s(Ln);function s(v){return v&&v.__esModule?v:{default:v}}function p(v,g,x,C){return(0,r.default)(g)(v,(0,n.default)(x),C)}i.default=(0,a.default)(p,4),e.exports=i.default});ze(Hn);var yo=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=a(Hn),n=a(Ln);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v,g){return(0,r.default)(p,1,v,g)}i.default=(0,n.default)(s,3),e.exports=i.default});ze(yo);var Ja=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(ki),n=a(yo);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,r.default)(n.default,p,v)}e.exports=i.default}),To=ze(Ja),Fa=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,To(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(a){r.apply(void 0,Ie(n.args)),a(null,i)})},e}(),Wa=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=x(Ve),n=x(jn),a=x(Hn),s=x(tn),p=x($n),v=x(gr),g=x(Ln);function x(F){return F&&F.__esModule?F:{default:F}}function C(F,G,q){q=(0,s.default)(q);var te=0,Se=0,Ne=F.length,Ke=!1;Ne===0&&q(null);function it(St,Tt){St===!1&&(Ke=!0),Ke!==!0&&(St?q(St):(++Se===Ne||Tt===n.default)&&q(null))}for(;te<Ne;te++)G(F[te],te,(0,p.default)(it))}function T(F,G,q){return(0,a.default)(F,Infinity,G,q)}function R(F,G,q){var te=(0,r.default)(F)?C:T;return te(F,(0,v.default)(G),q)}i.default=(0,g.default)(R,3),e.exports=i.default});ze(Wa);var po=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=a(Wa),n=a(ki);function a(p){return p&&p.__esModule?p:{default:p}}function s(p,v){return(0,n.default)(r.default,p,v)}e.exports=i.default}),Os=ze(po),os=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Os(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(a){return pe(n,void 0,void 0,function(){return ve(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),a(null,i),[2]}})})})},e}(),Du=Ee(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(tn),n=p($n),a=p(gr),s=p(Ln);function p(g){return g&&g.__esModule?g:{default:g}}function v(g,x){if(x=(0,r.default)(x),!Array.isArray(g))return x(new Error("First argument to waterfall must be an array of functions"));if(!g.length)return x();var C=0;function T(F){var G=(0,a.default)(g[C++]);G.apply(void 0,F.concat([(0,n.default)(R)]))}function R(F){for(var G=[],q=arguments.length-1;q-- >0;)G[q]=arguments[q+1];if(F!==!1){if(F||C===g.length)return x.apply(void 0,[F].concat(G));T(G)}}T([])}i.default=(0,s.default)(v),e.exports=i.default}),ss=ze(Du),mu=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return ss(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var a=r();n(a?null:!1,a)}):this.tasks.push(function(n,a){var s=r();a(s?null:!1,i)})},e}(),Rs=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return To(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var a=r();n(a,i)})},e}(),Cs=U(26729),Zl=U.n(Cs),Fu=U(69848),gl=U.n(Fu);function jl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ru(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yl(e,i){var r=i.radius,n=r===void 0?40:r,a=i.maxZoom,s=a===void 0?18:a,p=i.minZoom,v=p===void 0?0:p,g=i.zoom,x=g===void 0?2:g;if(e.pointIndex){var C=e.pointIndex.getClusters(e.extent,Math.floor(x));return e.dataArray=bu(C),e}var T=new(gl())({radius:n,minZoom:v,maxZoom:s}),R={type:"FeatureCollection",features:[]};return R.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:ru({},F)}}),T.load(R.features),T}function bu(e){return e.map(function(i,r){return ru({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function Eo(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function Bu(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function Nu(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,a=1;a<e.length;a++)n=i+e[a]*1,Math.abs(i)>=Math.abs(e[a])?r+=i-n+e[a]:r+=e[a]-n+i,i=n;return i+r*1}function Ju(e){if(e.length===0)throw new Error("mean requires at least one data point");return Nu(e)/e.length}var oa={min:Bu,max:Eo,mean:Ju,sum:Nu};function zs(e,i){return e.map(function(r){return r[i]*1})}function Jo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Jo(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Jo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wc(e){var i=Xc();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function wf(e,i){if(Array.isArray(i))return i}var nu=function(e){(0,Ir.Z)(r,e);var i=Wc(r);function r(n,a){var s;return(0,dt.Z)(this,r),s=i.call(this),(0,A.Z)((0,de.Z)(s),"data",void 0),(0,A.Z)((0,de.Z)(s),"extent",void 0),(0,A.Z)((0,de.Z)(s),"hooks",{init:new Fa}),(0,A.Z)((0,de.Z)(s),"parser",{type:"geojson"}),(0,A.Z)((0,de.Z)(s),"transforms",[]),(0,A.Z)((0,de.Z)(s),"cluster",!1),(0,A.Z)((0,de.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,A.Z)((0,de.Z)(s),"mapService",void 0),(0,A.Z)((0,de.Z)(s),"invalidExtent",!1),(0,A.Z)((0,de.Z)(s),"dataArrayChanged",!1),(0,A.Z)((0,de.Z)(s),"originData",void 0),(0,A.Z)((0,de.Z)(s),"rawData",void 0),(0,A.Z)((0,de.Z)(s),"cfg",{}),(0,A.Z)((0,de.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(a),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,It.Z)(r,[{key:"setData",value:function(a,s){this.originData=a,this.dataArrayChanged=!1,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(a){return this.clusterIndex.getClusters(this.caculClusterExtent(2),a)}},{key:"getClustersLeaves",value:function(a){return this.clusterIndex.getLeaves(a,Infinity)}},{key:"updateClusterData",value:function(a){var s=this,p=this.clusterOptions,v=p.method,g=v===void 0?"sum":v,x=p.field,C=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(a));this.clusterOptions.zoom=a,C.forEach(function(T){T.id||(T.properties.point_count=1)}),(x||k()(g))&&(C=C.map(function(T){var R=T.id;if(R){var F=s.clusterIndex.getLeaves(R,Infinity),G=F.map(function(Se){return Se.properties}),q;if(w()(g)&&x){var te=zs(G,x);q=oa[g](te)}k()(g)&&(q=g(G)),T.properties.stat=q}else T.properties.point_count=1;return T})),this.data=ce("geojson")({type:"FeatureCollection",features:C}),this.executeTrans()}},{key:"getFeatureById",value:function(a){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var v=a<this.originData.features.length?this.originData.features[a]:"null",g=X()(v);if(this.transforms.length!==0||this.dataArrayChanged){var x=this.data.dataArray.find(function(C){return C._id===a});g.properties=x}return g}else return a<this.data.dataArray.length?this.data.dataArray[a]:"null"}},{key:"updateFeaturePropertiesById",value:function(a,s){this.data.dataArray=this.data.dataArray.map(function(p){return p._id===a?gu(gu({},p),s):p}),this.dataArrayChanged=!0,this.emit("update")}},{key:"getFeatureId",value:function(a,s){var p=this.data.dataArray.find(function(v){return v[a]===s});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(a){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=On(jc(this.extent),a)),s[0].concat(s[1])}},{key:"initCfg",value:function(a){this.cfg=d()(this.cfg,a,wf);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=gu(gu({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var a=this.parser,s=a.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=ce(s);this.data=p(this.originData,a),this.extent=Yf(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var a=this,s=this.transforms;s.forEach(function(p){var v=p.type,g=ee(v)(a.data,p);Object.assign(a.data,g)})}},{key:"initCluster",value:function(){if(!!this.cluster){var a=this.clusterOptions||{};this.clusterIndex=yl(this.data,a)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Cs.EventEmitter);function pc(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function iu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_l(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function _l(e,i){if(!!e){if(typeof e=="string")return hc(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hc(e,i)}}function hc(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var au=6378e3;function Bo(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=a/(2*Math.PI*au)*(256<<20)/2,p=Yc(r,a),v=p.gridHash,g=p.gridOffset,x=lh(v,g,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:x}}function Yc(e,i){var r=Infinity,n=-Infinity,a,s=iu(e),p;try{for(s.s();!(p=s.n()).done;){var v=p.value;a=v.coordinates[1],Number.isFinite(a)&&(r=a<r?a:r,n=a>n?a:n)}}catch(Ke){s.e(Ke)}finally{s.f()}var g=(r+n)/2,x=$f(i,g);if(x.xOffset<=0||x.yOffset<=0)return{gridHash:{},gridOffset:x};var C={},T=iu(e),R;try{for(T.s();!(R=T.n()).done;){var F=R.value,G=F.coordinates[1],q=F.coordinates[0];if(Number.isFinite(G)&&Number.isFinite(q)){var te=Math.floor((G+90)/x.yOffset),Se=Math.floor((q+180)/x.xOffset),Ne="".concat(te,"-").concat(Se);C[Ne]=C[Ne]||{count:0,points:[]},C[Ne].count+=1,C[Ne].points.push(F)}}}catch(Ke){T.e(Ke)}finally{T.f()}return{gridHash:C,gridOffset:x}}function $f(e,i){var r=Pp(e),n=Qf(i,e);return{yOffset:r,xOffset:n}}function Pp(e){return e/au*(180/Math.PI)}function Qf(e,i){return i/au*(180/Math.PI)/Math.cos(e*Math.PI/180)}function lh(e,i,r){return Object.keys(e).reduce(function(n,a,s){var p=a.split("-"),v=parseInt(p[0],10),g=parseInt(p[1],10),x={};if(r.field&&r.method){var C=zl(e[a].points,r.field);x[r.method]=fc[r.method](C)}return Object.assign(x,{_id:s,coordinates:as([-180+i.xOffset*(g+.5),-90+i.yOffset*(v+.5)]),rawData:e[a].points,count:e[a].count}),n.push(x),n},[])}var dc=Math.PI/3,vc=[0,dc,2*dc,3*dc,4*dc,5*dc];function Tf(e){return e[0]}function Ip(e){return e[1]}function Hh(){var e=0,i=0,r=1,n=1,a=Tf,s=Ip,p,v,g;function x(T){var R={},F=[],G,q=T.length;for(G=0;G<q;++G)if(!(isNaN(Se=+a.call(null,te=T[G],G,T))||isNaN(Ne=+s.call(null,te,G,T)))){var te,Se,Ne,Ke=Math.round(Ne=Ne/g),it=Math.round(Se=Se/v-(Ke&1)/2),St=Ne-Ke;if(Math.abs(St)*3>1){var Tt=Se-it,$t=it+(Se<it?-1:1)/2,sr=Ke+(Ne<Ke?-1:1),Pr=Se-$t,$r=Ne-sr;Tt*Tt+St*St>Pr*Pr+$r*$r&&(it=$t+(Ke&1?1:-1)/2,Ke=sr)}var br=it+"-"+Ke,mn=R[br];mn?mn.push(te):(F.push(mn=R[br]=[te]),mn.x=(it+(Ke&1)/2)*v,mn.y=Ke*g)}return F}function C(T){var R=0,F=0;return vc.map(function(G){var q=Math.sin(G)*T,te=-Math.cos(G)*T,Se=q-R,Ne=te-F;return R=q,F=te,[Se,Ne]})}return x.hexagon=function(T){return"m"+C(T==null?p:+T).join("l")+"z"},x.centers=function(){for(var T=[],R=Math.round(i/g),F=Math.round(e/v),G=R*g;G<n+p;G+=g,++R)for(var q=F*v+(R&1)*v/2;q<r+v/2;q+=v)T.push([q,G]);return T},x.mesh=function(){var T=C(p).slice(0,4).join("l");return x.centers().map(function(R){return"M"+R+"m"+T}).join("")},x.x=function(T){return arguments.length?(a=T,x):a},x.y=function(T){return arguments.length?(s=T,x):s},x.radius=function(T){return arguments.length?(p=+T,v=p*2*Math.sin(dc),g=p*1.5,x):p},x.size=function(T){return arguments.length?(e=i=0,r=+T[0],n=+T[1],x):[r-e,n-i]},x.extent=function(T){return arguments.length?(e=+T[0][0],i=+T[0][1],r=+T[1][0],n=+T[1][1],x):[[e,i],[r,n]]},x.radius(1)}function xl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xl(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Wh=6378e3;function Md(e,i){var r=e.dataArray,n=i.size,a=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,v=a/(2*Math.PI*Wh)*(256<<20)/2,g=r.map(function(R){var F=as(R.coordinates),G=(0,yn.Z)(F,2),q=G[0],te=G[1];return qc(qc({},R),{},{coordinates:[q,te]})}),x=Hh().radius(v).x(function(R){return R.coordinates[0]}).y(function(R){return R.coordinates[1]}),C=x(g),T={dataArray:C.map(function(R,F){var G;if(i.field&&p){var q=zl(R,i.field);R[p]=fc[p](q)}return G={},(0,A.Z)(G,i.method,R[p]),(0,A.Z)(G,"count",R.length),(0,A.Z)(G,"rawData",R),(0,A.Z)(G,"coordinates",[R.x,R.y]),(0,A.Z)(G,"_id",F),G}),radius:v,xOffset:v,yOffset:v,type:"hexagon"};return T}function Kc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Op(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Kc(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pd(e,i){var r=i.sourceField,n=i.targetField,a=i.data,s={};return a.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var v=p[n];return Op(Op({},p),s[v])}),e}function Id(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Le("geojson",Hr),Le("image",Ul),Le("csv",hn),Le("json",Yt),Le("raster",f),Xe("cluster",yl),Xe("filter",pc),Xe("join",Pd),Xe("map",Id),Xe("grid",Bo),Xe("hexagon",Md);var Xh=Sr,ch=qn,fh=nu,Jf=U(28660),Wr=U(86700),Mo=U(84879),Ht={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Yh=U(31745),Rp=U.n(Yh);function ep(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Mf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ep(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ep(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=rp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function rp(e,i){if(!!e){if(typeof e=="string")return Vl(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Vl(e,i)}}function Vl(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bl=30;function np(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,a=e.buffer,s=e.maxCanvasWidth,p=e.mapping,v=p===void 0?{}:p,g=e.xOffset,x=g===void 0?0:g,C=e.yOffset,T=C===void 0?0:C,R=0,F=x;Array.from(i).forEach(function(q,te){if(!v[q]){var Se=r(q,te);F+bl>s&&(F=0,R++),v[q]={x:F,y:T+R*bl,width:bl,height:bl,advance:Se},F+=bl}});var G=n+a*2;return{mapping:v,xOffset:F,yOffset:T+R*G,canvasHeight:ip(T+(R+1)*G)}}function Lp(e,i,r){var n=0,a=0,s=0,p=[],v={},g=tp(e),x;try{for(g.s();!(x=g.n()).done;){var C=x.value;if(!v[C.id]){var T=C.size;n+T+i>r&&(Gl(v,p,a),n=0,a=s+a+i,s=0,p=[]),p.push({icon:C,xOffset:n}),n=n+T+i,s=Math.max(s,T)}}}catch(F){g.e(F)}finally{g.f()}p.length>0&&Gl(v,p,a);var R=ip(s+a+i);return{mapping:v,canvasHeight:R}}function Gl(e,i,r){var n=tp(i),a;try{for(n.s();!(a=n.n()).done;){var s=a.value,p=s.icon,v=s.xOffset;e[p.id]=Mf(Mf({},p),{},{x:v,y:r,image:p.image,width:p.width,height:p.height})}}catch(g){n.e(g)}finally{n.f()}}function ip(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Pf,ap;function $c(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=If(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function If(e,i){if(!!e){if(typeof e=="string")return Us(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Us(e,i)}}function Us(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Of(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Qc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Of(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Of(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var op=Fp(),sp="sans-serif",kp="normal",El=24,Jc=3,qh=.25,Dp=8,ph=1024,Od=1,Kh=1,Eu=3,Rd=null;function Fp(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function ef(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function zu(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var $h=(Pf=(0,Wr.b2)(),Pf(ap=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"fontAtlas",void 0),(0,A.Z)(this,"iconFontMap",void 0),(0,A.Z)(this,"iconFontGlyphs",{}),(0,A.Z)(this,"fontOptions",void 0),(0,A.Z)(this,"key",void 0),(0,A.Z)(this,"cache",new Da(Eu))}return(0,It.Z)(e,[{key:"scale",get:function(){return Kh}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:sp,fontWeight:kp,characterSet:op,fontSize:El,buffer:Jc,sdf:!0,cutoff:qh,radius:Dp,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(a){n.iconFontGlyphs[a.name]=a.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Qc(Qc({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),a=this.cache.get(this.key);if(!(a&&n.length===0)){var s=this.generateFontAtlas(this.key,n,a);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,a){var s=this.fontOptions,p=s.fontFamily,v=s.fontWeight,g=s.fontSize,x=s.buffer,C=s.sdf,T=s.radius,R=s.cutoff,F=s.iconfont,G=a&&a.data;G||(G=ca.document.createElement("canvas"),G.width=ph);var q=G.getContext("2d");ef(q,p,g,v);var te=np(Qc({getFontWidth:function(ks){return q.measureText(ks).width},fontHeight:g*Kh,buffer:x,characterSet:n,maxCanvasWidth:ph},a&&{mapping:a.mapping,xOffset:a.xOffset,yOffset:a.yOffset})),Se=te.mapping,Ne=te.canvasHeight,Ke=te.xOffset,it=te.yOffset,St=q.getImageData(0,0,G.width,G.height);if(G.height=Ne,q.putImageData(St,0,0),ef(q,p,g,v),C){var Tt=new(Rp())(g,x,T,R,p,v),$t=q.getImageData(0,0,Tt.size,Tt.size),sr=$c(n),Pr;try{for(sr.s();!(Pr=sr.n()).done;){var $r=Pr.value;if(F){var br=String.fromCharCode(parseInt($r.replace("&#x","").replace(";",""),16)),mn=Tt.draw(br);zu(mn,$t)}else zu(Tt.draw($r),$t);q.putImageData($t,Se[$r].x,Se[$r].y)}}catch(qo){sr.e(qo)}finally{sr.f()}}else{var Mn=$c(n),Qn;try{for(Mn.s();!(Qn=Mn.n()).done;){var Na=Qn.value;q.fillText(Na,Se[Na].x,Se[Na].y+g*Od)}}catch(qo){Mn.e(qo)}finally{Mn.f()}}return{xOffset:Ke,yOffset:it,mapping:Se,data:G,width:G.width,height:G.height}}},{key:"getKey",value:function(){return"key";var r,n,a,s,p,v,g,x}},{key:"getNewChars",value:function(r,n){var a=this.cache.get(r);if(!a)return n;var s=[],p=a.mapping,v=new Set(Object.keys(p)),g=new Set(n);return g.forEach(function(x){v.has(x)||s.push(x)}),s}}]),e}())||ap),Qh,el;function Rf(e){var i=tf();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function tf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mc=3,hh=1024,rf=64,Bp=(Qh=(0,Wr.b2)(),Qh(el=function(e){(0,Ir.Z)(r,e);var i=Rf(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"canvasHeight",128),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"canvas",void 0),(0,A.Z)((0,de.Z)(n),"iconData",void 0),(0,A.Z)((0,de.Z)(n),"iconMap",void 0),(0,A.Z)((0,de.Z)(n),"ctx",void 0),(0,A.Z)((0,de.Z)(n),"loadingImageCount",0),n}return(0,It.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ca.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(a,s){var p=this,v=new Image;if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:rf}),this.updateIconMap(),this.loadImage(s).then(function(g){v=g;var x=p.iconData.find(function(C){return C.id===a});x&&(x.image=v,x.width=v.width,x.height=v.height),p.update()})}},{key:"addImageMini",value:function(a,s,p){var v=this,g=p.getSceneConfig().canvas,x=g.createImage();if(this.loadingImageCount++,this.hasImage(a))throw new Error("Image Id already exists");this.iconData.push({id:a,size:rf}),this.updateIconMap(),this.loadImageMini(s,g).then(function(C){x=C;var T=v.iconData.find(function(R){return R.id===a});T&&(T.image=x,T.width=x.width,T.height=x.height),v.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(a){return this.iconMap.hasOwnProperty(a)}},{key:"removeImage",value:function(a){this.hasImage(a)&&(this.iconData=this.iconData.filter(function(s){return s.id!==a}),delete this.iconMap[a],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(a){return new Promise(function(s,p){if(a instanceof HTMLImageElement){s(a);return}var v=new Image;v.crossOrigin="anonymous",v.onload=function(){s(v)},v.onerror=function(){p(new Error("Could not load image at "+a))},v.src=a instanceof File?URL.createObjectURL(a):a})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var a=this;this.canvas.width=hh,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=a.iconMap[s],v=p.x,g=p.y,x=p.image,C=p.width,T=C===void 0?64:C,R=p.height,F=R===void 0?64:R,G=Math.max(T,F),q=G/rf,te=F/q,Se=T/q;x&&a.ctx.drawImage(x,v+(rf-Se)/2,g+(rf-te)/2,Se,te)})}},{key:"updateIconMap",value:function(){var a=Lp(this.iconData,mc,hh),s=a.mapping,p=a.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImageMini",value:function(a,s){return new Promise(function(p,v){var g=s.createImage();g.crossOrigin="anonymous",g.onload=function(){p(g)},g.onerror=function(){v(new Error("Could not load image at "+a))},g.src=a})}}]),r}(Cs.EventEmitter))||el),Oa=U(49685);function Ki(){var e=new Oa.WT(16);return Oa.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function gc(e){var i=new Oa.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Po(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Zs(e,i,r,n,a,s,p,v,g,x,C,T,R,F,G,q){var te=new Oa.WT(16);return te[0]=e,te[1]=i,te[2]=r,te[3]=n,te[4]=a,te[5]=s,te[6]=p,te[7]=v,te[8]=g,te[9]=x,te[10]=C,te[11]=T,te[12]=R,te[13]=F,te[14]=G,te[15]=q,te}function Jh(e,i,r,n,a,s,p,v,g,x,C,T,R,F,G,q,te){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e[4]=s,e[5]=p,e[6]=v,e[7]=g,e[8]=x,e[9]=C,e[10]=T,e[11]=R,e[12]=F,e[13]=G,e[14]=q,e[15]=te,e}function dh(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ld(e,i){if(e===i){var r=i[1],n=i[2],a=i[3],s=i[6],p=i[7],v=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=a,e[13]=p,e[14]=v}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Np(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],R=i[10],F=i[11],G=i[12],q=i[13],te=i[14],Se=i[15],Ne=r*v-n*p,Ke=r*g-a*p,it=r*x-s*p,St=n*g-a*v,Tt=n*x-s*v,$t=a*x-s*g,sr=C*q-T*G,Pr=C*te-R*G,$r=C*Se-F*G,br=T*te-R*q,mn=T*Se-F*q,Mn=R*Se-F*te,Qn=Ne*Mn-Ke*mn+it*br+St*$r-Tt*Pr+$t*sr;return Qn?(Qn=1/Qn,e[0]=(v*Mn-g*mn+x*br)*Qn,e[1]=(a*mn-n*Mn-s*br)*Qn,e[2]=(q*$t-te*Tt+Se*St)*Qn,e[3]=(R*Tt-T*$t-F*St)*Qn,e[4]=(g*$r-p*Mn-x*Pr)*Qn,e[5]=(r*Mn-a*$r+s*Pr)*Qn,e[6]=(te*it-G*$t-Se*Ke)*Qn,e[7]=(C*$t-R*it+F*Ke)*Qn,e[8]=(p*mn-v*$r+x*sr)*Qn,e[9]=(n*$r-r*mn-s*sr)*Qn,e[10]=(G*Tt-q*it+Se*Ne)*Qn,e[11]=(T*it-C*Tt-F*Ne)*Qn,e[12]=(v*Pr-p*br-g*sr)*Qn,e[13]=(r*br-n*Pr+a*sr)*Qn,e[14]=(q*Ke-G*St-te*Ne)*Qn,e[15]=(C*St-T*Ke+R*Ne)*Qn,e):null}function kd(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=i[4],v=i[5],g=i[6],x=i[7],C=i[8],T=i[9],R=i[10],F=i[11],G=i[12],q=i[13],te=i[14],Se=i[15];return e[0]=v*(R*Se-F*te)-T*(g*Se-x*te)+q*(g*F-x*R),e[1]=-(n*(R*Se-F*te)-T*(a*Se-s*te)+q*(a*F-s*R)),e[2]=n*(g*Se-x*te)-v*(a*Se-s*te)+q*(a*x-s*g),e[3]=-(n*(g*F-x*R)-v*(a*F-s*R)+T*(a*x-s*g)),e[4]=-(p*(R*Se-F*te)-C*(g*Se-x*te)+G*(g*F-x*R)),e[5]=r*(R*Se-F*te)-C*(a*Se-s*te)+G*(a*F-s*R),e[6]=-(r*(g*Se-x*te)-p*(a*Se-s*te)+G*(a*x-s*g)),e[7]=r*(g*F-x*R)-p*(a*F-s*R)+C*(a*x-s*g),e[8]=p*(T*Se-F*q)-C*(v*Se-x*q)+G*(v*F-x*T),e[9]=-(r*(T*Se-F*q)-C*(n*Se-s*q)+G*(n*F-s*T)),e[10]=r*(v*Se-x*q)-p*(n*Se-s*q)+G*(n*x-s*v),e[11]=-(r*(v*F-x*T)-p*(n*F-s*T)+C*(n*x-s*v)),e[12]=-(p*(T*te-R*q)-C*(v*te-g*q)+G*(v*R-g*T)),e[13]=r*(T*te-R*q)-C*(n*te-a*q)+G*(n*R-a*T),e[14]=-(r*(v*te-g*q)-p*(n*te-a*q)+G*(n*g-a*v)),e[15]=r*(v*R-g*T)-p*(n*R-a*T)+C*(n*g-a*v),e}function vh(e){var i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],p=e[5],v=e[6],g=e[7],x=e[8],C=e[9],T=e[10],R=e[11],F=e[12],G=e[13],q=e[14],te=e[15],Se=i*p-r*s,Ne=i*v-n*s,Ke=i*g-a*s,it=r*v-n*p,St=r*g-a*p,Tt=n*g-a*v,$t=x*G-C*F,sr=x*q-T*F,Pr=x*te-R*F,$r=C*q-T*G,br=C*te-R*G,mn=T*te-R*q;return Se*mn-Ne*br+Ke*$r+it*Pr-St*sr+Tt*$t}function Sl(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=i[8],R=i[9],F=i[10],G=i[11],q=i[12],te=i[13],Se=i[14],Ne=i[15],Ke=r[0],it=r[1],St=r[2],Tt=r[3];return e[0]=Ke*n+it*v+St*T+Tt*q,e[1]=Ke*a+it*g+St*R+Tt*te,e[2]=Ke*s+it*x+St*F+Tt*Se,e[3]=Ke*p+it*C+St*G+Tt*Ne,Ke=r[4],it=r[5],St=r[6],Tt=r[7],e[4]=Ke*n+it*v+St*T+Tt*q,e[5]=Ke*a+it*g+St*R+Tt*te,e[6]=Ke*s+it*x+St*F+Tt*Se,e[7]=Ke*p+it*C+St*G+Tt*Ne,Ke=r[8],it=r[9],St=r[10],Tt=r[11],e[8]=Ke*n+it*v+St*T+Tt*q,e[9]=Ke*a+it*g+St*R+Tt*te,e[10]=Ke*s+it*x+St*F+Tt*Se,e[11]=Ke*p+it*C+St*G+Tt*Ne,Ke=r[12],it=r[13],St=r[14],Tt=r[15],e[12]=Ke*n+it*v+St*T+Tt*q,e[13]=Ke*a+it*g+St*R+Tt*te,e[14]=Ke*s+it*x+St*F+Tt*Se,e[15]=Ke*p+it*C+St*G+Tt*Ne,e}function up(e,i,r){var n=r[0],a=r[1],s=r[2],p,v,g,x,C,T,R,F,G,q,te,Se;return i===e?(e[12]=i[0]*n+i[4]*a+i[8]*s+i[12],e[13]=i[1]*n+i[5]*a+i[9]*s+i[13],e[14]=i[2]*n+i[6]*a+i[10]*s+i[14],e[15]=i[3]*n+i[7]*a+i[11]*s+i[15]):(p=i[0],v=i[1],g=i[2],x=i[3],C=i[4],T=i[5],R=i[6],F=i[7],G=i[8],q=i[9],te=i[10],Se=i[11],e[0]=p,e[1]=v,e[2]=g,e[3]=x,e[4]=C,e[5]=T,e[6]=R,e[7]=F,e[8]=G,e[9]=q,e[10]=te,e[11]=Se,e[12]=p*n+C*a+G*s+i[12],e[13]=v*n+T*a+q*s+i[13],e[14]=g*n+R*a+te*s+i[14],e[15]=x*n+F*a+Se*s+i[15]),e}function Hl(e,i,r){var n=r[0],a=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*a,e[5]=i[5]*a,e[6]=i[6]*a,e[7]=i[7]*a,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function ed(e,i,r,n){var a=n[0],s=n[1],p=n[2],v=Math.hypot(a,s,p),g,x,C,T,R,F,G,q,te,Se,Ne,Ke,it,St,Tt,$t,sr,Pr,$r,br,mn,Mn,Qn,Na;return v<Oa.Ib?null:(v=1/v,a*=v,s*=v,p*=v,g=Math.sin(r),x=Math.cos(r),C=1-x,T=i[0],R=i[1],F=i[2],G=i[3],q=i[4],te=i[5],Se=i[6],Ne=i[7],Ke=i[8],it=i[9],St=i[10],Tt=i[11],$t=a*a*C+x,sr=s*a*C+p*g,Pr=p*a*C-s*g,$r=a*s*C-p*g,br=s*s*C+x,mn=p*s*C+a*g,Mn=a*p*C+s*g,Qn=s*p*C-a*g,Na=p*p*C+x,e[0]=T*$t+q*sr+Ke*Pr,e[1]=R*$t+te*sr+it*Pr,e[2]=F*$t+Se*sr+St*Pr,e[3]=G*$t+Ne*sr+Tt*Pr,e[4]=T*$r+q*br+Ke*mn,e[5]=R*$r+te*br+it*mn,e[6]=F*$r+Se*br+St*mn,e[7]=G*$r+Ne*br+Tt*mn,e[8]=T*Mn+q*Qn+Ke*Na,e[9]=R*Mn+te*Qn+it*Na,e[10]=F*Mn+Se*Qn+St*Na,e[11]=G*Mn+Ne*Qn+Tt*Na,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function lp(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[4],p=i[5],v=i[6],g=i[7],x=i[8],C=i[9],T=i[10],R=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*a+x*n,e[5]=p*a+C*n,e[6]=v*a+T*n,e[7]=g*a+R*n,e[8]=x*a-s*n,e[9]=C*a-p*n,e[10]=T*a-v*n,e[11]=R*a-g*n,e}function nf(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[8],C=i[9],T=i[10],R=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a-x*n,e[1]=p*a-C*n,e[2]=v*a-T*n,e[3]=g*a-R*n,e[8]=s*n+x*a,e[9]=p*n+C*a,e[10]=v*n+T*a,e[11]=g*n+R*a,e}function Ea(e,i,r){var n=Math.sin(r),a=Math.cos(r),s=i[0],p=i[1],v=i[2],g=i[3],x=i[4],C=i[5],T=i[6],R=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*a+x*n,e[1]=p*a+C*n,e[2]=v*a+T*n,e[3]=g*a+R*n,e[4]=x*a-s*n,e[5]=C*a-p*n,e[6]=T*a-v*n,e[7]=R*a-g*n,e}function zp(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Wl(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Lf(e,i,r){var n=r[0],a=r[1],s=r[2],p=Math.hypot(n,a,s),v,g,x;return p<Oa.Ib?null:(p=1/p,n*=p,a*=p,s*=p,v=Math.sin(i),g=Math.cos(i),x=1-g,e[0]=n*n*x+g,e[1]=a*n*x+s*v,e[2]=s*n*x-a*v,e[3]=0,e[4]=n*a*x-s*v,e[5]=a*a*x+g,e[6]=s*a*x+n*v,e[7]=0,e[8]=n*s*x+a*v,e[9]=a*s*x-n*v,e[10]=s*s*x+g,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function mh(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dd(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ge(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3],v=n+n,g=a+a,x=s+s,C=n*v,T=n*g,R=n*x,F=a*g,G=a*x,q=s*x,te=p*v,Se=p*g,Ne=p*x;return e[0]=1-(F+q),e[1]=T+Ne,e[2]=R-Se,e[3]=0,e[4]=T-Ne,e[5]=1-(C+q),e[6]=G+te,e[7]=0,e[8]=R+Se,e[9]=G-te,e[10]=1-(C+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Be(e,i){var r=new Oa.WT(3),n=-i[0],a=-i[1],s=-i[2],p=i[3],v=i[4],g=i[5],x=i[6],C=i[7],T=n*n+a*a+s*s+p*p;return T>0?(r[0]=(v*p+C*n+g*s-x*a)*2/T,r[1]=(g*p+C*a+x*n-v*s)*2/T,r[2]=(x*p+C*s+v*a-g*n)*2/T):(r[0]=(v*p+C*n+g*s-x*a)*2,r[1]=(g*p+C*a+x*n-v*s)*2,r[2]=(x*p+C*s+v*a-g*n)*2),ge(e,i,r),e}function Dt(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function ir(e,i){var r=i[0],n=i[1],a=i[2],s=i[4],p=i[5],v=i[6],g=i[8],x=i[9],C=i[10];return e[0]=Math.hypot(r,n,a),e[1]=Math.hypot(s,p,v),e[2]=Math.hypot(g,x,C),e}function Lt(e,i){var r=new Oa.WT(3);ir(r,i);var n=1/r[0],a=1/r[1],s=1/r[2],p=i[0]*n,v=i[1]*a,g=i[2]*s,x=i[4]*n,C=i[5]*a,T=i[6]*s,R=i[8]*n,F=i[9]*a,G=i[10]*s,q=p+C+G,te=0;return q>0?(te=Math.sqrt(q+1)*2,e[3]=.25*te,e[0]=(T-F)/te,e[1]=(R-g)/te,e[2]=(v-x)/te):p>C&&p>G?(te=Math.sqrt(1+p-C-G)*2,e[3]=(T-F)/te,e[0]=.25*te,e[1]=(v+x)/te,e[2]=(R+g)/te):C>G?(te=Math.sqrt(1+C-p-G)*2,e[3]=(R-g)/te,e[0]=(v+x)/te,e[1]=.25*te,e[2]=(T+F)/te):(te=Math.sqrt(1+G-p-C)*2,e[3]=(v-x)/te,e[0]=(R+g)/te,e[1]=(T+F)/te,e[2]=.25*te),e}function Jt(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3],g=a+a,x=s+s,C=p+p,T=a*g,R=a*x,F=a*C,G=s*x,q=s*C,te=p*C,Se=v*g,Ne=v*x,Ke=v*C,it=n[0],St=n[1],Tt=n[2];return e[0]=(1-(G+te))*it,e[1]=(R+Ke)*it,e[2]=(F-Ne)*it,e[3]=0,e[4]=(R-Ke)*St,e[5]=(1-(T+te))*St,e[6]=(q+Se)*St,e[7]=0,e[8]=(F+Ne)*Tt,e[9]=(q-Se)*Tt,e[10]=(1-(T+G))*Tt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function cr(e,i,r,n,a){var s=i[0],p=i[1],v=i[2],g=i[3],x=s+s,C=p+p,T=v+v,R=s*x,F=s*C,G=s*T,q=p*C,te=p*T,Se=v*T,Ne=g*x,Ke=g*C,it=g*T,St=n[0],Tt=n[1],$t=n[2],sr=a[0],Pr=a[1],$r=a[2],br=(1-(q+Se))*St,mn=(F+it)*St,Mn=(G-Ke)*St,Qn=(F-it)*Tt,Na=(1-(R+Se))*Tt,qo=(te+Ne)*Tt,ks=(G+Ke)*$t,Ds=(te-Ne)*$t,Ws=(1-(R+q))*$t;return e[0]=br,e[1]=mn,e[2]=Mn,e[3]=0,e[4]=Qn,e[5]=Na,e[6]=qo,e[7]=0,e[8]=ks,e[9]=Ds,e[10]=Ws,e[11]=0,e[12]=r[0]+sr-(br*sr+Qn*Pr+ks*$r),e[13]=r[1]+Pr-(mn*sr+Na*Pr+Ds*$r),e[14]=r[2]+$r-(Mn*sr+qo*Pr+Ws*$r),e[15]=1,e}function vr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r+r,v=n+n,g=a+a,x=r*p,C=n*p,T=n*v,R=a*p,F=a*v,G=a*g,q=s*p,te=s*v,Se=s*g;return e[0]=1-T-G,e[1]=C+Se,e[2]=R-te,e[3]=0,e[4]=C-Se,e[5]=1-x-G,e[6]=F+q,e[7]=0,e[8]=R+te,e[9]=F-q,e[10]=1-x-T,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function yr(e,i,r,n,a,s,p){var v=1/(r-i),g=1/(a-n),x=1/(s-p);return e[0]=s*2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*g,e[6]=0,e[7]=0,e[8]=(r+i)*v,e[9]=(a+n)*g,e[10]=(p+s)*x,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*x,e[15]=0,e}function wr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=(a+n)*p,e[14]=2*a*n*p):(e[10]=-1,e[14]=-2*n),e}var Tr=wr;function jr(e,i,r,n,a){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==Infinity?(p=1/(n-a),e[10]=a*p,e[14]=a*n*p):(e[10]=-1,e[14]=-n),e}function mr(e,i,r,n){var a=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),v=Math.tan(i.rightDegrees*Math.PI/180),g=2/(p+v),x=2/(a+s);return e[0]=g,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=-((p-v)*g*.5),e[9]=(a-s)*x*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function Ar(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=(p+s)*x,e[15]=1,e}var st=Ar;function Vt(e,i,r,n,a,s,p){var v=1/(i-r),g=1/(n-a),x=1/(s-p);return e[0]=-2*v,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*g,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=x,e[11]=0,e[12]=(i+r)*v,e[13]=(a+n)*g,e[14]=s*x,e[15]=1,e}function _r(e,i,r,n){var a,s,p,v,g,x,C,T,R,F,G=i[0],q=i[1],te=i[2],Se=n[0],Ne=n[1],Ke=n[2],it=r[0],St=r[1],Tt=r[2];return Math.abs(G-it)<Oa.Ib&&Math.abs(q-St)<Oa.Ib&&Math.abs(te-Tt)<Oa.Ib?dh(e):(C=G-it,T=q-St,R=te-Tt,F=1/Math.hypot(C,T,R),C*=F,T*=F,R*=F,a=Ne*R-Ke*T,s=Ke*C-Se*R,p=Se*T-Ne*C,F=Math.hypot(a,s,p),F?(F=1/F,a*=F,s*=F,p*=F):(a=0,s=0,p=0),v=T*p-R*s,g=R*a-C*p,x=C*s-T*a,F=Math.hypot(v,g,x),F?(F=1/F,v*=F,g*=F,x*=F):(v=0,g=0,x=0),e[0]=a,e[1]=v,e[2]=C,e[3]=0,e[4]=s,e[5]=g,e[6]=T,e[7]=0,e[8]=p,e[9]=x,e[10]=R,e[11]=0,e[12]=-(a*G+s*q+p*te),e[13]=-(v*G+g*q+x*te),e[14]=-(C*G+T*q+R*te),e[15]=1,e)}function Nr(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=n[0],g=n[1],x=n[2],C=a-r[0],T=s-r[1],R=p-r[2],F=C*C+T*T+R*R;F>0&&(F=1/Math.sqrt(F),C*=F,T*=F,R*=F);var G=g*R-x*T,q=x*C-v*R,te=v*T-g*C;return F=G*G+q*q+te*te,F>0&&(F=1/Math.sqrt(F),G*=F,q*=F,te*=F),e[0]=G,e[1]=q,e[2]=te,e[3]=0,e[4]=T*te-R*q,e[5]=R*G-C*te,e[6]=C*q-T*G,e[7]=0,e[8]=C,e[9]=T,e[10]=R,e[11]=0,e[12]=a,e[13]=s,e[14]=p,e[15]=1,e}function lr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Rr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function qr(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function Bn(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function er(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function nr(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function xn(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function Vr(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=e[4],v=e[5],g=e[6],x=e[7],C=e[8],T=e[9],R=e[10],F=e[11],G=e[12],q=e[13],te=e[14],Se=e[15],Ne=i[0],Ke=i[1],it=i[2],St=i[3],Tt=i[4],$t=i[5],sr=i[6],Pr=i[7],$r=i[8],br=i[9],mn=i[10],Mn=i[11],Qn=i[12],Na=i[13],qo=i[14],ks=i[15];return Math.abs(r-Ne)<=Oa.Ib*Math.max(1,Math.abs(r),Math.abs(Ne))&&Math.abs(n-Ke)<=Oa.Ib*Math.max(1,Math.abs(n),Math.abs(Ke))&&Math.abs(a-it)<=Oa.Ib*Math.max(1,Math.abs(a),Math.abs(it))&&Math.abs(s-St)<=Oa.Ib*Math.max(1,Math.abs(s),Math.abs(St))&&Math.abs(p-Tt)<=Oa.Ib*Math.max(1,Math.abs(p),Math.abs(Tt))&&Math.abs(v-$t)<=Oa.Ib*Math.max(1,Math.abs(v),Math.abs($t))&&Math.abs(g-sr)<=Oa.Ib*Math.max(1,Math.abs(g),Math.abs(sr))&&Math.abs(x-Pr)<=Oa.Ib*Math.max(1,Math.abs(x),Math.abs(Pr))&&Math.abs(C-$r)<=Oa.Ib*Math.max(1,Math.abs(C),Math.abs($r))&&Math.abs(T-br)<=Oa.Ib*Math.max(1,Math.abs(T),Math.abs(br))&&Math.abs(R-mn)<=Oa.Ib*Math.max(1,Math.abs(R),Math.abs(mn))&&Math.abs(F-Mn)<=Oa.Ib*Math.max(1,Math.abs(F),Math.abs(Mn))&&Math.abs(G-Qn)<=Oa.Ib*Math.max(1,Math.abs(G),Math.abs(Qn))&&Math.abs(q-Na)<=Oa.Ib*Math.max(1,Math.abs(q),Math.abs(Na))&&Math.abs(te-qo)<=Oa.Ib*Math.max(1,Math.abs(te),Math.abs(qo))&&Math.abs(Se-ks)<=Oa.Ib*Math.max(1,Math.abs(Se),Math.abs(ks))}var Er=Sl,Xr=Bn,Yr,yi,oi=(Yr=(0,Wr.b2)(),Yr(yi=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"overridedViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,A.Z)(this,"jitteredProjectionMatrix",void 0),(0,A.Z)(this,"viewMatrixInverse",void 0),(0,A.Z)(this,"cameraPosition",void 0)}return(0,It.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Ki(),Np(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,yn.Z)(r,2),a=n[0],s=n[1];return[a,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var a=zp(Ki(),[r,n,0]);this.jitteredProjectionMatrix=Sl(Ki(),a,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=Sl(Ki(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||yi),Gr,rn;function Jn(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=ci(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function ci(e,i){if(!!e){if(typeof e=="string")return zi(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zi(e,i)}}function zi(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var so=(Gr=(0,Wr.b2)(),Gr(rn=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"controlCorners",void 0),(0,A.Z)(this,"controlContainer",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"controls",[]),(0,A.Z)(this,"unAddControls",[])}return(0,It.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Ht.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var a=n.get(Ht.IMapService);a.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Jn(this.controls),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;a.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",a=this.controlContainer=ja("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],v=p.map(function(g){return n+g}).join(" ");r[p.join("")]=ja("div",v,a)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&sc(this.controlCorners[r]);this.controlContainer&&sc(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||rn),uo,Bi,es=(uo=(0,Wr.b2)(),uo(Bi=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"container",void 0),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"markers",[]),(0,A.Z)(this,"markerLayers",[]),(0,A.Z)(this,"unAddMarkers",[]),(0,A.Z)(this,"unAddMarkerLayers",[])}return(0,It.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Bi),Va,No,So=(Va=(0,Wr.b2)(),Va(No=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"scene",void 0),(0,A.Z)(this,"popup",void 0),(0,A.Z)(this,"mapsService",void 0),(0,A.Z)(this,"unAddPopup",void 0)}return(0,It.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Ht.IMapService)}}]),e}())||No),Wo=U(82492),Io=U.n(Wo),us={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},ho=us,_i,Oo;function ea(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function zo(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ea(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ea(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var ri={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Ui={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},va=(_i=(0,Wr.b2)(),_i(Oo=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"sceneConfigCache",{}),(0,A.Z)(this,"layerConfigCache",{})}return(0,It.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return ho[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=zo(zo({},ri),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,a){this.layerConfigCache[n]=zo({},Io()({},this.sceneConfigCache[r],Ui,a))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Oo);function Nn(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function si(e,i,r,n,a){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,v){return v(e,i,p)||p},s),a&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function Te(){var e=new Oa.WT(4);return Oa.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function zt(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function Et(e,i,r,n){var a=new Oa.WT(4);return a[0]=e,a[1]=i,a[2]=r,a[3]=n,a}function vn(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Wi(e,i,r,n,a){return e[0]=i,e[1]=r,e[2]=n,e[3]=a,e}function Ce(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function se(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function Ge(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function lt(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Ot(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function qe(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Fe(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function rt(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function _e(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function je(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function we(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function ct(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,a,s)}function wt(e,i){var r=i[0]-e[0],n=i[1]-e[1],a=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+a*a+s*s}function fr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return Math.hypot(i,r,n,a)}function zr(e){var i=e[0],r=e[1],n=e[2],a=e[3];return i*i+r*r+n*n+a*a}function Ur(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function nn(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function Dr(e,i){var r=i[0],n=i[1],a=i[2],s=i[3],p=r*r+n*n+a*a+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=a*p,e[3]=s*p,e}function An(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function un(e,i,r,n){var a=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],v=r[1]*n[2]-r[2]*n[1],g=r[1]*n[3]-r[3]*n[1],x=r[2]*n[3]-r[3]*n[2],C=i[0],T=i[1],R=i[2],F=i[3];return e[0]=T*x-R*g+F*v,e[1]=-(C*x)+R*p-F*s,e[2]=C*g-T*p+F*a,e[3]=-(C*v)+T*s-R*a,e}function En(e,i,r,n){var a=i[0],s=i[1],p=i[2],v=i[3];return e[0]=a+n*(r[0]-a),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=v+n*(r[3]-v),e}function bn(e,i){i=i||1;var r,n,a,s,p,v;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do a=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,v=a*a+s*s;while(v>=1);var g=Math.sqrt((1-p)/v);return e[0]=i*r,e[1]=i*n,e[2]=i*a*g,e[3]=i*s*g,e}function ln(e,i,r){var n=i[0],a=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*a+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*a+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*a+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*a+r[11]*s+r[15]*p,e}function ei(e,i,r){var n=i[0],a=i[1],s=i[2],p=r[0],v=r[1],g=r[2],x=r[3],C=x*n+v*s-g*a,T=x*a+g*n-p*s,R=x*s+p*a-v*n,F=-p*n-v*a-g*s;return e[0]=C*x+F*-p+T*-g-R*-v,e[1]=T*x+F*-v+R*-p-C*-g,e[2]=R*x+F*-g+C*-v-T*-p,e[3]=i[3],e}function Sa(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ls(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function Ga(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function _a(e,i){var r=e[0],n=e[1],a=e[2],s=e[3],p=i[0],v=i[1],g=i[2],x=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-v)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(a-g)<=glMatrix.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(s-x)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))}var Xl=null,js=null,Cl=null,Uu=null,td=null,Zu=null,af=null,Up=function(){var e=Te();return function(i,r,n,a,s,p){var v,g;for(r||(r=4),n||(n=0),a?g=Math.min(a*r+n,i.length):g=i.length,v=n;v<g;v+=r)e[0]=i[v],e[1]=i[v+1],e[2]=i[v+2],e[3]=i[v+3],s(e,e,p),i[v]=e[0],i[v+1]=e[1],i[v+2]=e[2],i[v+3]=e[3];return i}}(),rd=Math.PI/180,Xo=512,Zp=4003e4;function yc(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,a=n===void 0?0:n,s=e.scale,p=e.highPrecision,v=p===void 0?!1:p,g=e.flipY,x=g===void 0?!1:g;s=s!==void 0?s:Math.pow(2,a);var C={},T=Xo*s,R=Math.cos(r*rd),F=T/360,G=F/R,q=T/Zp/R;if(C.pixelsPerMeter=[q,-q,q],C.metersPerPixel=[1/q,-1/q,1/q],C.pixelsPerDegree=[F,-G,q],C.degreesPerPixel=[1/F,-1/G,1/q],v){var te=rd*Math.tan(r*rd)/R,Se=F*te/2,Ne=T/Zp*te,Ke=Ne/G*q;C.pixelsPerDegree2=[0,-Se,Ne],C.pixelsPerMeter2=[Ke,0,Ke],x&&(C.pixelsPerDegree2[1]=-C.pixelsPerDegree2[1],C.pixelsPerMeter2[1]=-C.pixelsPerMeter2[1])}return x&&(C.pixelsPerMeter[1]=-C.pixelsPerMeter[1],C.metersPerPixel[1]=-C.metersPerPixel[1],C.pixelsPerDegree[1]=-C.pixelsPerDegree[1],C.degreesPerPixel[1]=-C.degreesPerPixel[1]),C}var Yl;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Yl||(Yl={}));var _c={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},nd,cp,xc,id,Fd,yv=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],cs=(nd=(0,Wr.b2)(),cp=(0,Wr.f3)(Ht.ICameraService),nd(xc=(id=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"needRefresh",!0),Nn(this,"cameraService",Fd,this),(0,A.Z)(this,"coordinateSystem",void 0),(0,A.Z)(this,"viewportCenter",void 0),(0,A.Z)(this,"viewportCenterProjection",void 0),(0,A.Z)(this,"pixelsPerDegree",void 0),(0,A.Z)(this,"pixelsPerDegree2",void 0),(0,A.Z)(this,"pixelsPerMeter",void 0)}return(0,It.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),a=this.cameraService.getCenter(),s=yc({latitude:a[1],zoom:r}),p=s.pixelsPerMeter,v=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=v,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Yl.LNGLAT||this.coordinateSystem===Yl.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Yl.LNGLAT_OFFSET?this.calculateLnglatOffset(a,r):this.coordinateSystem===Yl.P20_OFFSET&&this.calculateLnglatOffset(a,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,a,s){var p=yc({latitude:r[1],zoom:n,scale:a,flipY:s,highPrecision:!0}),v=p.pixelsPerMeter,g=p.pixelsPerDegree,x=p.pixelsPerDegree2,C=this.cameraService.getViewMatrix(),T=this.cameraService.getProjectionMatrix(),R=Sl([],T,C),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=ln([],[F[0],F[1],0,1],R),C=this.cameraService.getViewMatrixUncentered()||C,R=Sl([],T,C),R=Sl([],R,yv),this.cameraService.setViewProjectionMatrix(R),this.pixelsPerMeter=v,this.pixelsPerDegree=g,this.pixelsPerDegree2=x}}]),e}(),Fd=si(id.prototype,"cameraService",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id))||xc),kf=U(20396),jp=U.n(kf),t;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(t||(t={}));var o,u,h,y,b;function S(e){var i=I();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function I(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var D={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},z=(o=(0,Wr.b2)(),u=(0,Wr.f3)(Ht.IMapService),o(h=(y=function(e){(0,Ir.Z)(r,e);var i=S(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"indragging",!1),Nn((0,de.Z)(n),"mapService",b,(0,de.Z)(n)),(0,A.Z)((0,de.Z)(n),"hammertime",void 0),(0,A.Z)((0,de.Z)(n),"lastClickTime",0),(0,A.Z)((0,de.Z)(n),"lastClickXY",[-1,-1]),(0,A.Z)((0,de.Z)(n),"clickTimer",void 0),(0,A.Z)((0,de.Z)(n),"$containter",void 0),(0,A.Z)((0,de.Z)(n),"onDrag",function(v){var g=n.interactionEvent(v);g.type=D[g.type],g.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(t.Drag,g)}),(0,A.Z)((0,de.Z)(n),"onHammer",function(v){v.srcEvent.stopPropagation();var g=n.interactionEvent(v);n.emit(t.Hover,g)}),(0,A.Z)((0,de.Z)(n),"onTouch",function(v){var g=v.touches[0];n.onHover({x:g.pageX,y:g.pageY,type:"touch"})}),(0,A.Z)((0,de.Z)(n),"onHover",function(v){var g=v.clientX,x=v.clientY,C=g,T=x,R=v.type,F=n.mapService.getMapContainer();if(F)if(Ji)C=C-F.left-0,T=T-F.top-0;else{var G=F.getBoundingClientRect(),q=G.top,te=G.left;C=C-te-F.clientLeft,T=T-q-F.clientTop}var Se=n.mapService.containerToLngLat([C,T]);if(R==="click"){if(!Ji&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(C,T,Se);return}if(R==="touch"){n.isDoubleTap(C,T,Se);return}R!=="click"&&R!=="dblclick"&&n.emit(t.Hover,{x:C,y:T,lngLat:Se,type:R,target:v})}),n}return(0,It.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(t.Hover)}},{key:"triggerHover",value:function(a){var s=a.x,p=a.y;this.emit(t.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(a){this.emit(t.Select,{featureId:a})}},{key:"triggerActive",value:function(a){this.emit(t.Active,{featureId:a})}},{key:"handleMiniEvent",value:function(a){this.onHover({clientX:a.touches[0].pageX,clientY:a.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var a=this.mapService.getMapContainer();if(a)if(Ji)ca.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(jp()).Manager(a);s.add(new(jp()).Tap({event:"dblclick",taps:2})),s.add(new(jp()).Tap({event:"click"})),s.add(new(jp()).Pan({threshold:0,pointers:0})),s.add(new(jp()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),a.addEventListener("mousemove",this.onHover),a.addEventListener("mousedown",this.onHover,!0),a.addEventListener("mouseup",this.onHover),a.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Ji)ca.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var a=this.mapService.getMapContainer();a&&(a.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),a.removeEventListener("mousedown",this.onHover),a.removeEventListener("mouseup",this.onHover),a.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(a){var s=a.type,p=a.pointerType,v,g;p==="touch"?(g=Math.floor(a.pointers[0].clientY),v=Math.floor(a.pointers[0].clientX)):(g=Math.floor(a.srcEvent.y),v=Math.floor(a.srcEvent.x));var x=this.mapService.getMapContainer();if(x){var C=x.getBoundingClientRect(),T=C.top,R=C.left;v-=R,g-=T}var F=this.mapService.containerToLngLat([v,g]);return{x:v,y:g,lngLat:F,type:s,target:a.srcEvent}}},{key:"isDoubleTap",value:function(a,s,p){var v=this,g=new Date().getTime(),x="click";g-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-a)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),x="dblclick",this.emit(t.Hover,{x:a,y:s,lngLat:p,type:x})):(this.lastClickTime=g,this.lastClickXY=[a,s],this.clickTimer=setTimeout(function(){x="click",v.emit(t.Hover,{x:a,y:s,lngLat:p,type:x})},400))}}]),r}(Zl()),b=si(y.prototype,"mapService",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y))||h),j=U(92137),W=U(87757),K=U.n(W),oe=0;function Me(e){if(Ji)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(oe++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function Oe(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(a){if(a!=null&&a.classList){var s;a==null||(s=a.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var L;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(L||(L={}));var Ue,ot,xt,Ut,Gt,or,Mr,Fr,Dn,cn,Zn,pn,Ri;function ti(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ti(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ti(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Vi=(Ue=(0,Wr.b2)(),ot=(0,Wr.f3)(Ht.IMapService),xt=(0,Wr.f3)(Ht.IRendererService),Ut=(0,Wr.f3)(Ht.IGlobalConfigService),Gt=(0,Wr.f3)(Ht.IInteractionService),or=(0,Wr.f3)(Ht.ILayerService),Ue(Mr=(Fr=function(){function e(){var i=this;(0,dt.Z)(this,e),Nn(this,"mapService",Dn,this),Nn(this,"rendererService",cn,this),Nn(this,"configService",Zn,this),Nn(this,"interactionService",pn,this),Nn(this,"layerService",Ri,this),(0,A.Z)(this,"pickingFBO",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0),(0,A.Z)(this,"alreadyInPicking",!1),(0,A.Z)(this,"pickBufferScale",1),(0,A.Z)(this,"lastPickTime",new Date().getTime()),(0,A.Z)(this,"pickFromPickingFBO",function(r,n){var a,s=n.x,p=n.y,v=n.lngLat,g=n.type,x=n.target,C=!1,T=i.rendererService,R=T.getViewportSize,F=T.readPixels,G=T.getContainer,q=i.getContainerSize(G()),te=q.width,Se=q.height;te*=ka,Se*=ka;var Ne=r.getLayerConfig(),Ke=Ne.enableHighlight,it=Ne.enableSelect,St=s*ka,Tt=p*ka;if(St>te-1*ka||St<0||Tt>Se-1*ka||Tt<0)return!1;var $t;if($t=F({x:Math.floor(St/i.pickBufferScale),y:Math.floor((Se-(p+1)*ka)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),$t[0]!==0||$t[1]!==0||$t[2]!==0){var sr=Ns($t),Pr=r.getSource().getFeatureById(sr);sr!==r.getCurrentPickId()&&g==="mousemove"&&(g="mouseenter");var $r={x:s,y:p,type:g,lngLat:v,featureId:sr,feature:Pr,target:x};Pr&&(C=!0,r.setCurrentPickId(sr),i.triggerHoverOnLayer(r,$r))}else{var br={x:s,y:p,lngLat:v,type:r.getCurrentPickId()!==null&&g==="mousemove"?"mouseout":"un"+g,featureId:null,target:x,feature:null};i.triggerHoverOnLayer(r,wn(wn({},br),{},{type:"unpick"})),i.triggerHoverOnLayer(r,br),r.setCurrentPickId(null)}if(Ke&&i.highlightPickedFeature(r,$t),it&&g==="click"&&((a=$t)===null||a===void 0?void 0:a.toString())!==[0,0,0,0].toString()){var mn=Ns($t);r.getCurrentSelectedId()===null||mn!==r.getCurrentSelectedId()?(i.selectFeature(r,$t),r.setCurrentSelectedId(mn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return C})}return(0,It.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,a=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,v=n.getContainer,g=this.getContainerSize(v()),x=g.width,C=g.height;x*=ka,C*=ka,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:a({width:Math.round(x/this.pickBufferScale),height:Math.round(C/this.pickBufferScale),wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,j.Z)(K().mark(function n(a,s,p){var v=this,g,x,C,T;return K().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:g=this.rendererService,x=g.useFramebuffer,C=g.clear,T=g.getContainer,this.resizePickingFBO(),x(this.pickingFBO,function(){C({framebuffer:v.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),a.hooks.beforePickingEncode.call(),a.renderModels(),a.hooks.afterPickingEncode.call();var G=v.pickBox(a,s);p(G)});case 3:case"end":return F.stop()}},n,this)}));function r(n,a,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var a=this,s=n.map(function(br){var mn=br<0?0:br;return Math.floor(mn*ka/a.pickBufferScale)}),p=(0,yn.Z)(s,4),v=p[0],g=p[1],x=p[2],C=p[3],T=this.rendererService,R=T.getViewportSize,F=T.readPixels,G=T.getContainer,q=this.getContainerSize(G()),te=q.width,Se=q.height;if(te*=ka,Se*=ka,v>(te-1)*ka/this.pickBufferScale||x<0||g>(Se-1)*ka/this.pickBufferScale||C<0)return[];var Ne,Ke=Math.min(te/this.pickBufferScale,x)-v,it=Math.min(Se/this.pickBufferScale,C)-g;Ne=F({x:v,y:Math.floor(Se/this.pickBufferScale-(C+1)),width:Ke,height:it,data:new Uint8Array(Ke*it*4),framebuffer:this.pickingFBO});for(var St=[],Tt={},$t=0;$t<Ne.length/4;$t=$t+1){var sr=Ne.slice($t*4,$t*4+4),Pr=Ns(sr);if(Pr!==-1&&!Tt[Pr]){var $r=r.getSource().getFeatureById(Pr);St.push(wn(wn({},$r),{},{pickedFeatureIdx:Pr})),Tt[Pr]=!0}}return St}},{key:"handleCursor",value:function(r,n){var a=r.getLayerConfig(),s=a.cursor,p=s===void 0?"":s,v=a.cursorEnabled;if(v){var g=this.mapService.version,x=g==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),C=x==null?void 0:x.style.getPropertyValue("cursor");n==="unmousemove"&&C!==""?x==null||x.style.setProperty("cursor",""):n==="mousemove"&&(x==null||x.style.setProperty("cursor",p))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/ka,height:r.height/ka}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,j.Z)(K().mark(function n(a){var s;return K().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())){v.next=2;break}return v.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||a.type==="contextmenu"||a.type==="click")){v.next=7;break}return v.next=7,this.pickingLayers(a);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return v.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),a=n.width,s=n.height;a*=ka,s*=ka,(this.width!==a||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=a,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,j.Z)(K().mark(function n(a){var s=this,p,v,g,x,C;return K().wrap(function(R){for(;;)switch(R.prev=R.next){case 0:p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=p.getContainer,this.resizePickingFBO(),g(this.pickingFBO,function(){var F=s.layerService.getRenderList();F.filter(function(G){return G.needPick(a.type)}).reverse().some(function(G){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),G.hooks.beforePickingEncode.call(),G.masks.length>0&&G.masks.map(function(te){te.hooks.beforeRenderData.call(),te.hooks.beforeRender.call(),te.render(),te.hooks.afterRender.call()}),G.renderModels(!0),G.hooks.afterPickingEncode.call();var q=s.pickFromPickingFBO(G,a);return s.layerService.pickedLayerId=q?+G.id:-1,q&&!G.getLayerConfig().enablePropagation})});case 3:case"end":return R.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){Oe(n)&&(this.handleCursor(r,n.type),r.emit(n.type,n))}},{key:"highlightPickedFeature",value:function(r,n){var a=(0,yn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeHighlight.call([s,p,v])}},{key:"selectFeature",value:function(r,n){var a=(0,yn.Z)(n,3),s=a[0],p=a[1],v=a[2];r.hooks.beforeSelect.call([s,p,v])}}]),e}(),Dn=si(Fr.prototype,"mapService",[ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cn=si(Fr.prototype,"rendererService",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=si(Fr.prototype,"configService",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pn=si(Fr.prototype,"interactionService",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=si(Fr.prototype,"layerService",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fr))||Mr),Ai=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,dt.Z)(this,e),(0,A.Z)(this,"autoStart",void 0),(0,A.Z)(this,"startTime",0),(0,A.Z)(this,"oldTime",0),(0,A.Z)(this,"running",!1),(0,A.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,It.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),ta,Vn,fa,eo,_o,Xa,to,xo,Yo;function ts(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Vs(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Vs(e,i){if(!!e){if(typeof e=="string")return rs(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rs(e,i)}}function rs(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Gs=(ta=(0,Wr.b2)(),Vn=(0,Wr.f3)(Ht.IRendererService),fa=(0,Wr.f3)(Ht.IMapService),eo=(0,Wr.f3)(Ht.IGlobalConfigService),ta(_o=(Xa=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"pickedLayerId",-1),(0,A.Z)(this,"clock",new Ai),(0,A.Z)(this,"alreadyInRendering",!1),(0,A.Z)(this,"layers",[]),(0,A.Z)(this,"layerList",[]),(0,A.Z)(this,"layerRenderID",void 0),(0,A.Z)(this,"sceneInited",!1),(0,A.Z)(this,"animateInstanceCount",0),(0,A.Z)(this,"shaderPicking",!0),(0,A.Z)(this,"enableRender",!0),Nn(this,"renderService",to,this),Nn(this,"mapService",xo,this),Nn(this,"configService",Yo,this)}return(0,It.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"addMask",value:function(r){this.sceneInited&&r.init()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var a=n.layerChildren.indexOf(r);a>-1&&n.layerChildren.splice(a,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){var i=(0,j.Z)(K().mark(function n(){var a,s,p;return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){g.next=2;break}return g.abrupt("return");case 2:this.alreadyInRendering=!0,this.clear(),a=ts(this.layerList),g.prev=5,a.s();case 7:if((s=a.n()).done){g.next=21;break}if(p=s.value,p.hooks.beforeRenderData.call(),p.hooks.beforeRender.call(),!p.isLayerGroup&&p.masks.length>0&&(this.renderService.clear({stencil:0,depth:1,framebuffer:null}),p.masks.map(function(x){x.hooks.beforeRenderData.call(),x.hooks.beforeRender.call(),x.render(),x.hooks.afterRender.call()})),!p.getLayerConfig().enableMultiPassRenderer){g.next=17;break}return g.next=15,p.renderMultiPass();case 15:g.next=18;break;case 17:p.render();case 18:p.hooks.afterRender.call();case 19:g.next=7;break;case 21:g.next=26;break;case 23:g.prev=23,g.t0=g.catch(5),a.e(g.t0);case 26:return g.prev=26,a.f(),g.finish(26);case 29:this.alreadyInRendering=!1;case 30:case"end":return g.stop()}},n,this,[[5,23,26,29]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).sort(function(n,a){return n.zIndex-a.zIndex}).forEach(function(n){n.isLayerGroup?n.layerChildren.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){r.layerList.push(a)}):r.layerList.push(n)})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var r=bi(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ca.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){ca.cancelAnimationFrame(this.layerRenderID)}}]),e}(),to=si(Xa.prototype,"renderService",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=si(Xa.prototype,"mapService",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yo=si(Xa.prototype,"configService",[eo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa))||_o),ro=U(81253),fs=U(14293),wi=U.n(fs),Ba=function(){function e(i){var r=this;(0,dt.Z)(this,e),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"type",void 0),(0,A.Z)(this,"scale",void 0),(0,A.Z)(this,"descriptor",void 0),(0,A.Z)(this,"featureBufferLayout",[]),(0,A.Z)(this,"needRescale",!1),(0,A.Z)(this,"needRemapping",!1),(0,A.Z)(this,"needRegenerateVertices",!1),(0,A.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,A.Z)(this,"vertexAttribute",void 0),(0,A.Z)(this,"defaultCallback",function(n){if(n.length===0){var a;return((a=r.scale)===null||a===void 0?void 0:a.defaultValues)||[]}return n.map(function(s,p){var v,g=(v=r.scale)===null||v===void 0?void 0:v.scalers[p].func,x=g(s);return x})}),this.setProps(i)}return(0,It.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var a,s=(a=this.scale)===null||a===void 0?void 0:a.callback.apply(a,(0,Ae.Z)(r));if(!wi()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),wa=["buffer","update","name"],sa=["buffer","update","name"],ps,As,Ya,Ro,hs,pa;function ql(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ou(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ql(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ql(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function of(e){return new Promise(function(i){return setTimeout(i,e)})}var Lo=(ps={},(0,A.Z)(ps,L.FLOAT,4),(0,A.Z)(ps,L.UNSIGNED_BYTE,1),(0,A.Z)(ps,L.UNSIGNED_SHORT,2),ps),bc=(As=(0,Wr.b2)(),Ya=(0,Wr.f3)(Ht.IRendererService),As(Ro=(hs=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"attributesAndIndices",void 0),Nn(this,"rendererService",pa,this),(0,A.Z)(this,"attributes",[]),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,It.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Ba(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,a){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(ou(ou({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,a&&a.featureRange&&(s.featureRange=a.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,a=this.getLayerStyleAttribute(r),s=a==null||(n=a.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(it){return it.name===r});if(p&&p.descriptor){var v=p.descriptor,g=v.update,x=v.buffer,C=v.size,T=C===void 0?0:C,R=Lo[x.type||L.FLOAT];if(g){var F=this.featureLayout,G=F.elements,q=F.sizePerElement,te=G.slice(a,s);if(!te.length)return;var Se=te[0].offset,Ne=Se*T*R,Ke=te.map(function(it,St){for(var Tt=it.featureIdx,$t=it.vertices,sr=it.normals,Pr=$t.length/q,$r=[],br=0;br<Pr;br++){var mn=sr?sr.slice(br*3,br*3+3):[];$r.push.apply($r,(0,Ae.Z)(g(n[Tt],Tt,$t.slice(br*q,br*q+q),St,mn)))}return $r}).reduce(function(it,St){return it.push.apply(it,(0,Ae.Z)(St)),it},[]);p.vertexAttribute.updateBuffer({data:Ke,offset:Ne})}}}},{key:"createAttributesAndIndices",value:function(r,n,a){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(Ne){return Ne.resetDescriptor(),Ne.descriptor}),v=0,g=[],x=[],C=[],T=3;r.forEach(function(Ne,Ke){var it=s.triangulation(Ne,a),St=it.indices,Tt=it.vertices,$t=it.normals,sr=it.size,Pr=it.indexes;St.forEach(function(Mn){x.push(Mn+v)}),T=sr;var $r=Tt.length/sr;s.featureLayout.sizePerElement=T,s.featureLayout.elements.push({featureIdx:Ke,vertices:Tt,normals:$t,offset:v}),v+=$r;for(var br=function(Qn){var Na=($t==null?void 0:$t.slice(Qn*3,Qn*3+3))||[],qo=Tt.slice(Qn*sr,Qn*sr+sr),ks=0;Pr&&Pr[Qn]!==void 0&&(ks=Pr[Qn]),p.forEach(function(Ds,Ws){if(Ds&&Ds.update){var pf;(pf=Ds.buffer.data).push.apply(pf,(0,Ae.Z)(Ds.update(Ne,Ke,qo,Qn,Na,ks)))}})},mn=0;mn<$r;mn++)br(mn)});var R=this.rendererService,F=R.createAttribute,G=R.createBuffer,q=R.createElements,te={};p.forEach(function(Ne,Ke){if(Ne){var it=Ne.buffer,St=Ne.update,Tt=Ne.name,$t=(0,ro.Z)(Ne,wa),sr=F(ou({buffer:G(it)},$t));te[Ne.name||""]=sr,s.attributes[Ke].vertexAttribute=sr}});var Se=q({data:x,type:L.UNSIGNED_INT,count:x.length});return this.attributesAndIndices={attributes:te,elements:Se},this.attributesAndIndices}},{key:"createAttributes",value:function(r,n){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(F){return F.resetDescriptor(),F.descriptor}),p=0,v=[],g=3;r.forEach(function(F,G){var q=a.triangulation(F),te=q.indices,Se=q.vertices,Ne=q.normals,Ke=q.size,it=q.indexes;te.forEach(function(sr){v.push(sr+p)}),g=Ke;var St=Se.length/Ke;a.featureLayout.sizePerElement=g,a.featureLayout.elements.push({featureIdx:G,vertices:Se,normals:Ne,offset:p}),p+=St;for(var Tt=function(Pr){var $r=(Ne==null?void 0:Ne.slice(Pr*3,Pr*3+3))||[],br=Se.slice(Pr*Ke,Pr*Ke+Ke),mn=0;it&&it[Pr]!==void 0&&(mn=it[Pr]),s.forEach(function(Mn,Qn){if(Mn&&Mn.update){var Na;(Na=Mn.buffer.data).push.apply(Na,(0,Ae.Z)(Mn.update(F,G,br,Pr,$r,mn)))}})},$t=0;$t<St;$t++)Tt($t)});var x=this.rendererService,C=x.createAttribute,T=x.createBuffer,R={};return s.forEach(function(F,G){if(F){var q=F.buffer,te=F.update,Se=F.name,Ne=(0,ro.Z)(F,sa),Ke=C(ou({buffer:T(q)},Ne));R[F.name||""]=Ke,a.attributes[G].vertexAttribute=Ke}}),{attributes:R}}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),pa=si(hs.prototype,"rendererService",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hs))||Ro),tl=U(67709),Vp=U.n(tl),Df,fp,Ec,pp,gh,hp,Gp,yh,_h,Sc,Hp,dp,sf,vp,xh,bh,Wp,ds,Eh,Xp,Yp,qp,Sh,mp,Ch,gp,Kp,Ff,$p,yp,ad,Bd,od;function g0(e){var i=Nd();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Nd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _v=(Df=(0,Wr.b2)(),fp=(0,Wr.f3)(Ht.SceneID),Ec=(0,Wr.f3)(Ht.IIconService),pp=(0,Wr.f3)(Ht.IFontService),gh=(0,Wr.f3)(Ht.IControlService),hp=(0,Wr.f3)(Ht.IGlobalConfigService),Gp=(0,Wr.f3)(Ht.IMapService),yh=(0,Wr.f3)(Ht.ICoordinateSystemService),_h=(0,Wr.f3)(Ht.IRendererService),Sc=(0,Wr.f3)(Ht.ILayerService),Hp=(0,Wr.f3)(Ht.ICameraService),dp=(0,Wr.f3)(Ht.IInteractionService),sf=(0,Wr.f3)(Ht.IPickingService),vp=(0,Wr.f3)(Ht.IShaderModuleService),xh=(0,Wr.f3)(Ht.IMarkerService),bh=(0,Wr.f3)(Ht.IPopupService),Df(Wp=(ds=function(e){(0,Ir.Z)(r,e);var i=g0(r);function r(){var n;return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,de.Z)(n),"destroyed",!1),(0,A.Z)((0,de.Z)(n),"loaded",!1),(0,A.Z)((0,de.Z)(n),"loadFont",!1),(0,A.Z)((0,de.Z)(n),"fontFamily",""),Nn((0,de.Z)(n),"id",Eh,(0,de.Z)(n)),Nn((0,de.Z)(n),"iconService",Xp,(0,de.Z)(n)),Nn((0,de.Z)(n),"fontService",Yp,(0,de.Z)(n)),Nn((0,de.Z)(n),"controlService",qp,(0,de.Z)(n)),Nn((0,de.Z)(n),"configService",Sh,(0,de.Z)(n)),Nn((0,de.Z)(n),"map",mp,(0,de.Z)(n)),Nn((0,de.Z)(n),"coordinateSystemService",Ch,(0,de.Z)(n)),Nn((0,de.Z)(n),"rendererService",gp,(0,de.Z)(n)),Nn((0,de.Z)(n),"layerService",Kp,(0,de.Z)(n)),Nn((0,de.Z)(n),"cameraService",Ff,(0,de.Z)(n)),Nn((0,de.Z)(n),"interactionService",$p,(0,de.Z)(n)),Nn((0,de.Z)(n),"pickingService",yp,(0,de.Z)(n)),Nn((0,de.Z)(n),"shaderModuleService",ad,(0,de.Z)(n)),Nn((0,de.Z)(n),"markerService",Bd,(0,de.Z)(n)),Nn((0,de.Z)(n),"popupService",od,(0,de.Z)(n)),(0,A.Z)((0,de.Z)(n),"inited",!1),(0,A.Z)((0,de.Z)(n),"initPromise",void 0),(0,A.Z)((0,de.Z)(n),"rendering",!1),(0,A.Z)((0,de.Z)(n),"$container",void 0),(0,A.Z)((0,de.Z)(n),"canvas",void 0),(0,A.Z)((0,de.Z)(n),"markerContainer",void 0),(0,A.Z)((0,de.Z)(n),"hooks",void 0),(0,A.Z)((0,de.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),dn(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,A.Z)((0,de.Z)(n),"handleMapCameraChanged",function(a){n.cameraService.update(a),n.render()}),n.hooks={init:new os},n}return(0,It.Z)(r,[{key:"init",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,j.Z)(K().mark(function p(){return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.version!=="GAODE2.x"?s.map.init():x()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){g.next=6;break}return g.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 13:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,j.Z)(K().mark(function p(){var v,g;return K().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(v=Me(s.configService.getSceneConfig(s.id).id||""),s.$container=v,!v){C.next=11;break}return s.canvas=ja("canvas","",v),s.setCanvas(),C.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:Vp()(s.$container,s.handleWindowResized),ca.matchMedia&&((g=ca.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||g===void 0||g.addListener(s.handleWindowResized)),C.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return C.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(a){var s=this;this.configService.setSceneConfig(this.id,a),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return s.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,j.Z)(K().mark(function p(){return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,new Promise(function(x){s.map.onCameraChanged(function(C){s.cameraService.init(),s.cameraService.update(C),s.map.version!=="GAODE2.x"&&x()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(t.Drag,s.addSceneEvent.bind(s));case 5:case"end":return g.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,j.Z)(K().mark(function p(){var v;return K().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(v=a.canvas,s.$container=v||null,!s.$container){x.next=7;break}return x.next=5,s.rendererService.init(a.canvas,s.configService.getSceneConfig(s.id));case 5:x.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return x.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(a){this.layerService.sceneService=this,this.layerService.add(a),this.render()}},{key:"addMask",value:function(a){this.layerService.sceneService=this,this.layerService.addMask(a),this.render()}},{key:"render",value:function(){var n=(0,j.Z)(K().mark(function s(){return K().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(!(this.rendering||this.destroyed)){v.next=2;break}return v.abrupt("return");case 2:if(this.rendering=!0,this.inited){v.next=23;break}return v.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){v.next=18;break}return v.prev=8,v.next=11,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 11:v.next=18;break;case 13:v.prev=13,v.t0=v.catch(8),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(v.t0);case 18:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 23:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 26:case"end":return v.stop()}},s,this,[[8,13]])}));function a(){return n.apply(this,arguments)}return a}()},{key:"addFontFace",value:function(a,s){this.fontFamily=a;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(a,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(a){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var v=a==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return v}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var a=this.$container.parentElement;a!==null&&(this.markerContainer=ja("div","l7-marker-container",a))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var a=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.pickingService.destroy(),this.layerService.destroy(),setTimeout(function(){var g;(g=a.$container)===null||g===void 0||g.removeChild(a.canvas),a.canvas=null,a.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,tl.unbind)(this.$container,this.handleWindowResized),ca.matchMedia){var v;(v=ca.matchMedia("screen and (min-resolution: 2dppx)"))===null||v===void 0||v.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var a,s,p=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x&&(x.width=v*p,x.height=g*p),this.rendererService.viewport({x:0,y:0,width:p*v,height:p*g})}},{key:"setCanvas",value:function(){var a,s,p=ka,v=((a=this.$container)===null||a===void 0?void 0:a.clientWidth)||400,g=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,x=this.canvas;x.width=v*p,x.height=g*p,x.style.width="100%",x.style.height="100%"}},{key:"addSceneEvent",value:function(a){this.emit(a.type,a)}}]),r}(Cs.EventEmitter),Eh=si(ds.prototype,"id",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=si(ds.prototype,"iconService",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yp=si(ds.prototype,"fontService",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=si(ds.prototype,"controlService",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=si(ds.prototype,"configService",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=si(ds.prototype,"map",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=si(ds.prototype,"coordinateSystemService",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=si(ds.prototype,"rendererService",[_h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=si(ds.prototype,"layerService",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=si(ds.prototype,"cameraService",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=si(ds.prototype,"interactionService",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yp=si(ds.prototype,"pickingService",[sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=si(ds.prototype,"shaderModuleService",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=si(ds.prototype,"markerService",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=si(ds.prototype,"popupService",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ds))||Wp),Ah=U(44908),Co=U.n(Ah);function Kl(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var xv=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function uf(e){var i={};return e=e.replace(xv,function(r,n,a){var s=a.split(":"),p=s[0].trim(),v="";switch(s.length>1&&(v=s[1].trim()),n){case"bool":v=v==="true";break;case"float":case"int":v=Number(v);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":v?v=v.replace("[","").replace("]","").split(",").reduce(function(g,x){return g.push(Number(x.trim())),g},[]):v=new Array(Kl(n)).fill(0);break;default:}return i[p]=v,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var sd,zd;function wh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ju(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?wh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Th="#define PI 3.14159265359",Mh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,ud=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,ld=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ud=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,y0=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec3 u_CurrentSelectedId : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform vec4 u_SelectColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;
uniform float u_EnableSelect: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {
  //   // \u9009\u4E2D\u6001
  //   v_PickingResult.a = SELECT;
  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {
  //   // \u9AD8\u4EAE\u6001
  //   v_PickingResult.a = HIGHLIGHT;
  // } else {
  //   v_PickingResult.a = NORMAL;
  // }

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Ph=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,_0=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,x0=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,b0=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,E0=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,S0=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,Vu=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,cd=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,C0=/precision\s+(high|low|medium)p\s+float/,Cc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,bv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,A0=(sd=(0,Wr.b2)(),sd(zd=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"moduleCache",{}),(0,A.Z)(this,"rawContentCache",{})}return(0,It.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Th,fs:Th}),this.registerModule("decode",{vs:Mh,fs:""}),this.registerModule("projection",{vs:_0,fs:""}),this.registerModule("project",{vs:Ph,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:x0}),this.registerModule("lighting",{vs:ld,fs:""}),this.registerModule("light",{vs:ud,fs:""}),this.registerModule("picking",{vs:y0,fs:Ud}),this.registerModule("styleMapping",{vs:b0,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:cd,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:E0,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:S0,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:Vu,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var a=n.vs,s=n.fs,p=n.uniforms,v=uf(a),g=v.content,x=v.uniforms,C=uf(s),T=C.content,R=C.uniforms;this.rawContentCache[r]={fs:T,uniforms:ju(ju(ju({},x),R),p),vs:g}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var a=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(a,[],"vs"),v=p.content,g=p.includeList,x=this.processModule(s,[],"fs"),C=x.content,T=x.includeList,R=C,F=Co()(g.concat(T).concat(r)).reduce(function(G,q){return ju(ju({},G),n.rawContentCache[q].uniforms)},{});return C0.test(C)||(R=Cc+C),this.moduleCache[r]={fs:R.trim(),uniforms:F,vs:v.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,a){var s=this,p=r.replace(bv,function(v,g){var x=g.split(" "),C=x[0].replace(/"/g,"");if(n.indexOf(C)>-1)return"";var T=s.rawContentCache[C][a];n.push(C);var R=s.processModule(T,n,a),F=R.content;return F});return{content:p,includeList:n}}}]),e}())||zd),Ac=U(66213),rl;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(rl||(rl={}));var _p,xp,lf=(_p=(0,Wr.b2)(),_p(xp=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"config",void 0)}return(0,It.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return rl.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ht.IRendererService),this.cameraService=r.getContainer().get(Ht.ICameraService),this.mapService=r.getContainer().get(Ht.IMapService),this.interactionService=r.getContainer().get(Ht.IInteractionService),this.layerService=r.getContainer().get(Ht.ILayerService),this.shaderModuleService=r.getContainer().get(Ht.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||xp),Zd,jd;function w0(e){var i=T0();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function T0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vd=(Zd=(0,Wr.b2)(),Zd(jd=function(e){(0,Ir.Z)(r,e);var i=w0(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(lf))||jd),fd,wc,Gd,Ih,pd;function M0(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Hd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function Hd(e,i){if(!!e){if(typeof e=="string")return Wd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Wd(e,i)}}function Wd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var P0=(fd=(0,Wr.b2)(),wc=(0,Wr.f3)(Ht.IPostProcessor),fd(Gd=(Ih=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"passes",[]),Nn(this,"postProcessor",pd,this),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"renderFlag",void 0),(0,A.Z)(this,"width",0),(0,A.Z)(this,"height",0)}return(0,It.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,j.Z)(K().mark(function n(){var a,s,p;return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a=M0(this.passes),g.prev=1,a.s();case 3:if((s=a.n()).done){g.next=9;break}return p=s.value,g.next=7,p.render(this.layer);case 7:g.next=3;break;case 9:g.next=14;break;case 11:g.prev=11,g.t0=g.catch(1),a.e(g.t0);case 14:return g.prev=14,a.f(),g.finish(14);case 17:return g.next=19,this.postProcessor.render(this.layer);case 19:case"end":return g.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.postProcessor.resize(r,n),this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===rl.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,a){r.init(this.layer,n),this.passes.splice(a,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),pd=si(Ih.prototype,"postProcessor",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih))||Gd),hd,Xd;function Qp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Yd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qp(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function dd(e){var i=Ev();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Ev(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I0=(hd=(0,Wr.b2)(),hd(Xd=function(e){(0,Ir.Z)(r,e);var i=dd(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"pickingFBO",void 0),(0,A.Z)((0,de.Z)(n),"layer",void 0),(0,A.Z)((0,de.Z)(n),"width",0),(0,A.Z)((0,de.Z)(n),"height",0),(0,A.Z)((0,de.Z)(n),"alreadyInRendering",!1),(0,A.Z)((0,de.Z)(n),"pickFromPickingFBO",function(v){var g=v.x,x=v.y,C=v.lngLat,T=v.type;if(!(!n.layer.isVisible()||!n.layer.needPick(T))){var R=n.rendererService,F=R.getViewportSize,G=R.readPixels,q=R.useFramebuffer,te=F(),Se=te.width,Ne=te.height,Ke=n.layer.getLayerConfig(),it=Ke.enableHighlight,St=Ke.enableSelect,Tt=g*ka,$t=x*ka;if(!(Tt>Se||Tt<0||$t>Ne||$t<0)){var sr;q(n.pickingFBO,function(){var Pr;if(sr=G({x:Math.round(Tt),y:Math.round(Ne-(x+1)*ka),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),sr[0]!==0||sr[1]!==0||sr[2]!==0){var $r=Ns(sr),br=n.layer.getSource().getFeatureById($r),mn={x:g,y:x,type:T,lngLat:C,featureId:$r,feature:br};br&&(n.layer.setCurrentPickId($r),n.triggerHoverOnLayer(mn))}else{var Mn={x:g,y:x,lngLat:C,type:n.layer.getCurrentPickId()===null?"un"+T:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(Yd(Yd({},Mn),{},{type:"unpick"})),n.triggerHoverOnLayer(Mn),n.layer.setCurrentPickId(null)}it&&n.highlightPickedFeature(sr),St&&T==="click"&&((Pr=sr)===null||Pr===void 0?void 0:Pr.toString())!==[0,0,0,0].toString()&&n.selectFeature(sr)})}}}),n}return(0,It.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s),this.layer=a;var p=this.rendererService,v=p.createTexture2D,g=p.createFramebuffer,x=p.getViewportSize,C=x(),T=C.width,R=C.height;this.pickingFBO=g({color:v({width:T,height:R,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})}),this.interactionService.on(t.Hover,this.pickFromPickingFBO),this.interactionService.on(t.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(t.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(a){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,v=p.getViewportSize,g=p.useFramebuffer,x=p.clear,C=v(),T=C.width,R=C.height;this.alreadyInRendering=!0,(this.width!==T||this.height!==R)&&(this.pickingFBO.resize({width:T,height:R}),this.width=T,this.height=R),g(this.pickingFBO,function(){x({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),a.hooks.beforePickingEncode.call(),a.render(),a.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(F),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(a){this.layer.emit(a.type,a)}},{key:"highlightPickedFeature",value:function(a){var s=(0,yn.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeHighlight.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(a){var s=(0,yn.Z)(a,3),p=s[0],v=s[1],g=s[2];this.layer.hooks.beforeSelect.call([p,v,g]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(a){var s=a.featureId,p=Is(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(a){var s=a.featureId,p=Is(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(lf))||Xd),Sv=U(11700),Cv=U.n(Sv),Av=U(68929),wv=U.n(Av),O0,R0,L0,qd,$l;function Oh(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Oh(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oh(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Rh=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Tc=(O0=(0,Wr.b2)(),R0=(0,Wr.f3)(Ht.IShaderModuleService),O0(L0=(qd=function(){function e(){(0,dt.Z)(this,e),Nn(this,"shaderModuleService",$l,this),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"config",void 0),(0,A.Z)(this,"quad",Rh),(0,A.Z)(this,"enabled",!0),(0,A.Z)(this,"renderToScreen",!1),(0,A.Z)(this,"model",void 0),(0,A.Z)(this,"name",void 0),(0,A.Z)(this,"optionsToUpdate",{})}return(0,It.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return rl.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Ht.IRendererService),this.shaderModuleService=r.getContainer().get(Ht.IShaderModuleService);var a=this.rendererService,s=a.createAttribute,p=a.createBuffer,v=a.createModel,g=this.setupShaders(),x=g.vs,C=g.fs,T=g.uniforms;this.model=v({vs:x,fs:C,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:L.FLOAT}),size:2})},uniforms:Jp(Jp({u_Texture:null},T),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r,n){var a=this,s=r.multiPassRenderer.getPostProcessor(),p=this.rendererService,v=p.useFramebuffer,g=p.getViewportSize,x=p.clear,C=g(),T=C.width,R=C.height;v(this.renderToScreen?null:s.getWriteFBO(),function(){x({framebuffer:s.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var F=Jp({u_BloomFinal:0,u_Texture:s.getReadFBO(),u_ViewportSize:[T,R]},a.convertOptionsToUniforms(a.optionsToUpdate));n&&(F.u_BloomFinal=1,F.u_Texture2=n),a.model.draw({uniforms:F})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Jp(Jp({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(a){wi()(r[a])||(n["u_".concat(Cv()(wv()(a)))]=r[a])}),n}}]),e}(),$l=si(qd.prototype,"shaderModuleService",[R0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd))||L0),fm,pm;function hm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lx(e){var i=kx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function kx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dx=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,Fx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Bx=(fm=(0,Wr.b2)(),fm(pm=function(e){(0,Ir.Z)(r,e);var i=Lx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Fx,fs:Dx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:dm(dm({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return wi()(a.bloomRadius)||(s.u_radius=a.bloomRadius),wi()(a.bloomIntensity)||(s.u_intensity=a.bloomIntensity),wi()(a.bloomBaseRadio)||(s.u_baseRadio=a.bloomBaseRadio),s}}]),r}(Tc))||pm),vm,mm;function gm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ym(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?gm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nx(e){var i=zx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function zx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ux=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Zx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,jx=(vm=(0,Wr.b2)(),vm(mm=function(e){(0,Ir.Z)(r,e);var i=Nx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Zx,fs:Ux});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:ym(ym({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return wi()(a.blurRadius)||(s.u_BlurDir=[a.blurRadius,0]),s}}]),r}(Tc))||mm),_m,xm;function bm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Em(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Vx(e){var i=Gx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Wx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xx=(_m=(0,Wr.b2)(),_m(xm=function(e){(0,Ir.Z)(r,e);var i=Vx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Wx,fs:Hx});var a=this.shaderModuleService.getModule("blur-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Em(Em({},v),{},{u_ViewportSize:[x,C]})}}},{key:"convertOptionsToUniforms",value:function(a){var s={};return wi()(a.blurRadius)||(s.u_BlurDir=[0,a.blurRadius]),s}}]),r}(Tc))||xm),Sm,Cm;function Am(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function wm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Am(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Am(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yx(e){var i=qx();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function qx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,$x=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qx=(Sm=(0,Wr.b2)(),Sm(Cm=function(e){(0,Ir.Z)(r,e);var i=Yx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:$x,fs:Kx});var a=this.shaderModuleService.getModule("colorhalftone-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:wm(wm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Tc))||Cm),Tm,Mm;function Jx(e){var i=eb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function eb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,rb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,nb=(Tm=(0,Wr.b2)(),Tm(Mm=function(e){(0,Ir.Z)(r,e);var i=Jx(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:rb,fs:tb}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Tc))||Mm),Pm,Im;function Om(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Om(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Om(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ib(e){var i=ab();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ob=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,sb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ub=(Pm=(0,Wr.b2)(),Pm(Im=function(e){(0,Ir.Z)(r,e);var i=ib(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:sb,fs:ob});var a=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Rm(Rm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Tc))||Im),Lm,km;function Dm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lb(e){var i=cb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,hb=(Lm=(0,Wr.b2)(),Lm(km=function(e){(0,Ir.Z)(r,e);var i=lb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:pb,fs:fb});var a=this.shaderModuleService.getModule("ink-pass"),s=a.vs,p=a.fs,v=a.uniforms,g=this.rendererService.getViewportSize(),x=g.width,C=g.height;return{vs:s,fs:p,uniforms:Fm(Fm({},v),{},{u_ViewportSize:[x,C]})}}}]),r}(Tc))||km),Bm,Nm;function db(e){var i=vb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function vb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,gb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yb=(Bm=(0,Wr.b2)(),Bm(Nm=function(e){(0,Ir.Z)(r,e);var i=db(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:gb,fs:mb}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Tc))||Nm),zm,Um;function _b(e){var i=xb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function xb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Eb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Sb=(zm=(0,Wr.b2)(),zm(Um=function(e){(0,Ir.Z)(r,e);var i=_b(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:bb,fs:Eb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Tc))||Um),Zm,jm,Vm,Gm,vd,Hm,Cb=(Zm=(0,Wr.b2)(),jm=(0,Wr.f3)(Ht.IRendererService),Vm=(0,Wr.zY)(),Zm(Gm=(vd=function(){function e(){(0,dt.Z)(this,e),Nn(this,"rendererService",Hm,this),(0,A.Z)(this,"passes",[]),(0,A.Z)(this,"readFBO",void 0),(0,A.Z)(this,"writeFBO",void 0)}return(0,It.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var r=this.rendererService,n=r.getViewportSize,a=r.createTexture2D,s=n(),p=s.width,v=s.height;return a({x:0,y:0,width:p,height:v,copy:!0})}},{key:"getReadFBOTex",value:function(){var r=this,n=this.rendererService.useFramebuffer;return new Promise(function(a,s){n(r.readFBO,(0,j.Z)(K().mark(function p(){return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:a(r.getCurrentFBOTex());case 1:case"end":return g.stop()}},p)})))})}},{key:"renderBloomPass",value:function(){var i=(0,j.Z)(K().mark(function n(a,s){var p,v;return K().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,this.getReadFBOTex();case 2:p=x.sent,v=0;case 4:if(!(v<4)){x.next=11;break}return x.next=7,s.render(a,p);case 7:this.swap(),v++,x.next=4;break;case 11:case"end":return x.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"render",value:function(){var i=(0,j.Z)(K().mark(function n(a){var s,p;return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:s=0;case 1:if(!(s<this.passes.length)){g.next=15;break}if(p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),p.getName()!=="bloom"){g.next=9;break}return g.next=7,this.renderBloomPass(a,p);case 7:g.next=12;break;case 9:return g.next=11,p.render(a);case 11:s!==this.passes.length-1&&this.swap();case 12:s++,g.next=1;break;case 15:case"end":return g.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,a){r.init(n,a),this.passes.push(r)}},{key:"insert",value:function(r,n,a,s){r.init(a,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){var r=this.rendererService,n=r.createFramebuffer,a=r.createTexture2D;this.readFBO=n({color:a({width:1,height:1,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})}),this.writeFBO=n({color:a({width:1,height:1,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),Hm=si(vd.prototype,"rendererService",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),si(vd.prototype,"init",[Vm],Object.getOwnPropertyDescriptor(vd.prototype,"init"),vd.prototype),vd))||Gm),Wm,Xm;function Ab(e){var i=wb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function wb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tb=(Wm=(0,Wr.b2)(),Wm(Xm=function(e){(0,Ir.Z)(r,e);var i=Ab(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s)}},{key:"render",value:function(a){var s=this.rendererService,p=s.useFramebuffer,v=s.clear,g=a.multiPassRenderer.getPostProcessor().getReadFBO();p(g,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:g}),a.multiPassRenderer.setRenderFlag(!1),a.models.forEach(function(x){x.draw({uniforms:a.layerModel.getUninforms()})}),a.multiPassRenderer.setRenderFlag(!0)})}}]),r}(lf))||Xm),Ym,qm,Km,Tv,$m;function Qm(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qm(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qm(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mb(e){var i=Pb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ib=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,eg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ob=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function tg(e,i){for(var r=0,n=1/i,a=e;a>0;)r=r+n*(a%i),a=Math.floor(a/i),n=n/i;return r}var Rb=1,Lb=(Ym=(0,Wr.b2)(),qm=(0,Wr.f3)(Ht.IShaderModuleService),Ym(Km=(Tv=function(e){(0,Ir.Z)(r,e);var i=Mb(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),Nn((0,de.Z)(n),"shaderModuleService",$m,(0,de.Z)(n)),(0,A.Z)((0,de.Z)(n),"haltonSequence",[]),(0,A.Z)((0,de.Z)(n),"accumulatingId",0),(0,A.Z)((0,de.Z)(n),"frame",0),(0,A.Z)((0,de.Z)(n),"timer",void 0),(0,A.Z)((0,de.Z)(n),"sampleRenderTarget",void 0),(0,A.Z)((0,de.Z)(n),"prevRenderTarget",void 0),(0,A.Z)((0,de.Z)(n),"outputRenderTarget",void 0),(0,A.Z)((0,de.Z)(n),"copyRenderTarget",void 0),(0,A.Z)((0,de.Z)(n),"blendModel",void 0),(0,A.Z)((0,de.Z)(n),"outputModel",void 0),(0,A.Z)((0,de.Z)(n),"copyModel",void 0),n}return(0,It.Z)(r,[{key:"getType",value:function(){return rl.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(a,s){(0,Ac.Z)((0,_t.Z)(r.prototype),"init",this).call(this,a,s);var p=this.rendererService,v=p.createFramebuffer,g=p.createTexture2D;this.sampleRenderTarget=v({color:g({width:1,height:1,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})}),this.prevRenderTarget=v({color:g({width:1,height:1,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})}),this.outputRenderTarget=v({color:g({width:1,height:1,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})}),this.copyRenderTarget=v({color:g({width:1,height:1,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE})});for(var x=0;x<30;x++)this.haltonSequence.push([tg(x,2),tg(x,3)]);this.blendModel=this.createTriangleModel("blend-pass",Ib),this.outputModel=this.createTriangleModel("copy-pass",eg,{blend:{enable:!0,func:{srcRGB:L.ONE,dstRGB:L.ONE_MINUS_SRC_ALPHA,srcAlpha:L.ONE,dstAlpha:L.ONE_MINUS_SRC_ALPHA},equation:{rgb:L.FUNC_ADD,alpha:L.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",eg)}},{key:"render",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),T=C.width,R=C.height;this.sampleRenderTarget.resize({width:T,height:R}),this.prevRenderTarget.resize({width:T,height:R}),this.outputRenderTarget.resize({width:T,height:R}),this.copyRenderTarget.resize({width:T,height:R}),this.resetFrame(),this.stopAccumulating();var F=a.multiPassRenderer.getPostProcessor().getReadFBO();x(F,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),a.multiPassRenderer.setRenderFlag(!1),a.render(),a.multiPassRenderer.setRenderFlag(!0)});var G=function q(te){!s.accumulatingId||te!==s.accumulatingId||s.isFinished()||(s.doRender(a),ca.requestAnimationFrame(function(){q(te)}))};this.accumulatingId=Rb++,this.timer=ca.setTimeout(function(){G(s.accumulatingId)},50)}},{key:"doRender",value:function(a){var s=this,p=this.rendererService,v=p.clear,g=p.getViewportSize,x=p.useFramebuffer,C=g(),T=C.width,R=C.height,F=a.getLayerConfig(),G=F.jitterScale,q=G===void 0?1:G,te=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((te[0]*2-1)/T*q,(te[1]*2-1)/R*q),a.multiPassRenderer.setRenderFlag(!1),a.hooks.beforeRender.call(),x(this.sampleRenderTarget,function(){v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),a.render()}),a.hooks.afterRender.call(),a.multiPassRenderer.setRenderFlag(!0);var Se=a.getLayerConfig();x(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:Se.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?a.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&v({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(x(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),x(a.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),a.multiPassRenderer.getPostProcessor().render(a));var Ne=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Ne,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ca.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(a,s,p){this.shaderModuleService.registerModule(a,{vs:Ob,fs:s});var v=this.shaderModuleService.getModule(a),g=v.vs,x=v.fs,C=v.uniforms,T=this.rendererService,R=T.createAttribute,F=T.createBuffer,G=T.createModel;return G(Jm({vs:g,fs:x,attributes:{a_Position:R({buffer:F({data:[-4,-4,4,-4,0,4],type:L.FLOAT}),size:2})},uniforms:Jm({},C),depth:{enable:!1},count:3},p))}}]),r}(lf),$m=si(Tv.prototype,"shaderModuleService",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv))||Km),Kd=new Wr.W2;Kd.bind(Ht.IGlobalConfigService).to(va).inSingletonScope(),(0,Wr.GW)((0,Wr.b2)(),Cs.EventEmitter),Kd.bind(Ht.IEventEmitter).to(Cs.EventEmitter);var rg=(0,Mo.Z)(Kd,!1),Mv=function(i){var r=rg.lazyInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},O3=function(i){var r=rg.lazyMultiInject(i);return function(n,a,s){r.call(this,n,a),s&&(s.initializer=function(){return n[a]})}},Ql=Kd,kb=0;function Db(){var e=new Wr.W2;return e.parent=Kd,e.bind(Ht.SceneID).toConstantValue("".concat(kb++)),e.bind(Ht.IShaderModuleService).to(A0).inSingletonScope(),e.bind(Ht.ILayerService).to(Gs).inSingletonScope(),e.bind(Ht.ISceneService).to(_v).inSingletonScope(),e.bind(Ht.ICameraService).to(oi).inSingletonScope(),e.bind(Ht.ICoordinateSystemService).to(cs).inSingletonScope(),e.bind(Ht.IInteractionService).to(z).inSingletonScope(),e.bind(Ht.IPickingService).to(Vi).inSingletonScope(),e.bind(Ht.IControlService).to(so).inSingletonScope(),e.bind(Ht.IMarkerService).to(es).inSingletonScope(),e.bind(Ht.IIconService).to(Bp).inSingletonScope(),e.bind(Ht.IFontService).to($h).inSingletonScope(),e.bind(Ht.IPopupService).to(So).inSingletonScope(),e.bind(Ht.INormalPass).to(Vd).whenTargetNamed("clear"),e.bind(Ht.INormalPass).to(I0).whenTargetNamed("pixelPicking"),e.bind(Ht.INormalPass).to(Tb).whenTargetNamed("render"),e.bind(Ht.INormalPass).to(Lb).whenTargetNamed("taa"),e.bind(Ht.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Ht.INormalPass,r)}}),e.bind(Ht.IPostProcessingPass).to(nb).whenTargetNamed("copy"),e.bind(Ht.IPostProcessingPass).to(Bx).whenTargetNamed("bloom"),e.bind(Ht.IPostProcessingPass).to(jx).whenTargetNamed("blurH"),e.bind(Ht.IPostProcessingPass).to(Xx).whenTargetNamed("blurV"),e.bind(Ht.IPostProcessingPass).to(yb).whenTargetNamed("noise"),e.bind(Ht.IPostProcessingPass).to(Sb).whenTargetNamed("sepia"),e.bind(Ht.IPostProcessingPass).to(Qx).whenTargetNamed("colorHalftone"),e.bind(Ht.IPostProcessingPass).to(ub).whenTargetNamed("hexagonalPixelate"),e.bind(Ht.IPostProcessingPass).to(hb).whenTargetNamed("ink"),e.bind(Ht.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Ht.IPostProcessingPass,r);return n.setName(r),n}}),e}function ng(e){var i=new Wr.W2;return i.parent=e,i.bind(Ht.IStyleAttributeService).to(bc).inSingletonScope(),i.bind(Ht.IMultiPassRenderer).to(P0).inSingletonScope(),i.bind(Ht.IPostProcessor).to(Cb).inSingletonScope(),i}var R3=U(74691),Fb=null;function L3(e){return Fb.indexOf(e)}var Bb=2,k3=4,Nb=64,D3=128,zb=256,Ub=512,F3=8192,B3=16384,N3=32768,Zb=null,ig=131072,z3=262144,jb=524288,U3=1048576,Vb=2097152,Z3=4194304,Gb=8388608,Hb=16777216,Wb=null;function k0(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function j3(e){var i=e.color,r=e.radius,n=e.tileX,a=e.tileY,s=e.shape,p=e.opacity,v=e.stroke,g=e.strokeWidth,x=e.strokeOpacity,C=[],T=[],R=[],F=[k0(i[0],i[1]),k0(i[2],i[3])],G=[k0(v[0],v[1]),k0(v[2],v[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(q){var te=_slicedToArray(q,2),Se=te[0],Ne=te[1];C.push([].concat(F,[(Se+1)*Gb+(Ne+1)*Vb+getShapeIndex(s)*ig+r,(n+512)*jb+(a+512)*Nb])),T.push([].concat(G,[g,x])),R.push([p,0,0,0])}),{packedBuffer:C,packedBuffer2:T,packedBuffer3:R}}function V3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Wb+r*Hb+n*ig+r*Zb+n*Ub+r*zb+n*Bb+r}var Mc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(Mc||(Mc={}));var su;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(su||(su={}));var eh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(eh||(eh={}));var In;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(In||(In={}));var Xb=["mapload","mapchange","mapAfterFrameChange"],Lh={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Pv=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],th;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(th||(th={}));function ag(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function og(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ag(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ag(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yb(e){var i=qb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kb=0,D0=function(e){(0,Ir.Z)(r,e);var i=Yb(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,A.Z)((0,de.Z)(a),"controlOption",void 0),(0,A.Z)((0,de.Z)(a),"container",void 0),(0,A.Z)((0,de.Z)(a),"sceneContainer",void 0),(0,A.Z)((0,de.Z)(a),"mapsService",void 0),(0,A.Z)((0,de.Z)(a),"renderService",void 0),(0,A.Z)((0,de.Z)(a),"layerService",void 0),(0,A.Z)((0,de.Z)(a),"controlService",void 0),(0,A.Z)((0,de.Z)(a),"isShow",void 0),a.controlOption=og(og({},a.getDefault()),n||{}),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:th.TOPRIGHT,name:"".concat(Kb++)}}},{key:"setPosition",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:th.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=a,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(a){this.mapsService=a.get(Ht.IMapService),this.renderService=a.get(Ht.IRendererService),this.layerService=a.get(Ht.ILayerService),this.controlService=a.get(Ht.IControlService),this.sceneContainer=a,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,v=this.controlService.controlCorners[p];return Fl(s,"l7-control"),p.indexOf("bottom")!==-1?v.insertBefore(s,v.firstChild):v.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var a=this.container;Fl(a,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var a=this.container;Ku(a,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;sc(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(a){if(this.mapsService&&a&&a.screenX>0&&a.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Cs.EventEmitter);function $b(e){var i=Qb();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G3=function(e){(0,Ir.Z)(r,e);var i=$b(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,de.Z)(a),"layerControlInputs",void 0),(0,A.Z)((0,de.Z)(a),"layers",void 0),(0,A.Z)((0,de.Z)(a),"lastZIndex",void 0),(0,A.Z)((0,de.Z)(a),"handlingClick",void 0),(0,A.Z)((0,de.Z)(a),"layersLink",void 0),(0,A.Z)((0,de.Z)(a),"baseLayersList",void 0),(0,A.Z)((0,de.Z)(a),"separator",void 0),(0,A.Z)((0,de.Z)(a),"overlaysList",void 0),(0,A.Z)((0,de.Z)(a),"form",void 0),a.layerControlInputs=[],a.layers=[],a.lastZIndex=0,a.handlingClick=!1,a.initLayers(),pl(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,de.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:th.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var a=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",a.onLayerChange),s.layer.on("add",a.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(a,s){return this.addLayer(a,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var a=this.renderService.getViewportSize(),s=a.height;Fl(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Fl(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):Ku(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ku(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var a=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",a.onLayerChange),s.layer.off("add",a.onLayerChange)}))}},{key:"initLayout",value:function(){var a="l7-control-layers",s=this.container=ja("div",a),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var v=this.form=ja("form",a+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=ja("a",a+"-toggle",s);var g=this.layersLink;g.title="Layers",p||this.expand(),this.baseLayersList=ja("div",a+"-base",v),this.separator=ja("div",a+"-separator",v),this.overlaysList=ja("div",a+"-overlays",v),s.appendChild(v)}},{key:"initLayers",value:function(){var a=this,s=this.controlOption,p=s.baseLayers,v=p===void 0?{}:p,g=s.overlayers,x=g===void 0?{}:g;Object.keys(v).forEach(function(C,T){a.addLayer(v[C],C,!1)}),Object.keys(x).forEach(function(C,T){a.addLayer(x[C],C,!0)})}},{key:"update",value:function(){if(!this.container)return this;Bl(this.baseLayersList),Bl(this.overlaysList),this.layerControlInputs=[];var a,s,p,v,g=0;for(p=0;p<this.layers.length;p++)v=this.layers[p],this.addItem(v),s=s||v.overlay,a=a||!v.overlay,g+=v.overlay?0:1;return this.controlOption.hideSingleBase&&(a=a&&g>1,this.baseLayersList.style.display=a?"":"none"),this.separator.style.display=s&&a?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var a=this.layerControlInputs,s,p,v=this.mapsService.getZoom(),g=a.length-1;g>=0;g--)if(s=a[g],p=this.layerService.getLayer(s.layerId),p&&p.inited){var x=p.getMinZoom(),C=p.getMaxZoom();s.disabled=v<x||v>C}}},{key:"addLayer",value:function(a,s,p){this.mapsService&&(a.on("add",this.onLayerChange),a.on("remove",this.onLayerChange)),this.layers.push({layer:a,name:s,overlay:p});var v=this.controlOption,g=v.sortLayers,x=v.sortFunction,C=v.autoZIndex;g&&this.layers.sort(function(T,R){return x(T.layer,R.layer,T.name,R.name)}),C&&a.setZIndex&&(this.lastZIndex++,a.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(a){this.handlingClick||this.update();var s=this.layerService.getLayer(a.target.layerId),p=s!=null&&s.overlay?a.type==="add"?"overlayadd":"overlayremove":a.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(a,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+a+'"'+(s?' checked="checked"':"")+"/>",v=document.createElement("div");return v.innerHTML=p,v.firstChild}},{key:"addItem",value:function(a){var s=document.createElement("label"),p=this.layerService.getLayer(a.layer.id),v=p&&p.inited&&a.layer.isVisible(),g;a.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="l7-control-layers-selector",g.defaultChecked=v):g=this.createRadioElement("l7-base-layers",v),this.layerControlInputs.push(g),g.layerId=a.layer.id,g.addEventListener("click",this.onInputClick);var x=document.createElement("span");x.innerHTML=" "+a.name;var C=document.createElement("div");s.appendChild(C),C.appendChild(g),C.appendChild(x);var T=a.overlay?this.overlaysList:this.baseLayersList;return T.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var a=this.layerControlInputs,s,p,v=[],g=[];this.handlingClick=!0;for(var x=a.length-1;x>=0;x--)s=a[x],p=this.layerService.getLayer(s.layerId),s.checked?v.push(p):s.checked||g.push(p);g.forEach(function(C){C.hide()}),v.forEach(function(C){C.show()}),this.handlingClick=!1}}]),r}(D0);function Jb(e){var i=e2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function e2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var t2=function(e){(0,Ir.Z)(r,e);var i=Jb(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:th.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var a="l7-control-logo",s=ja("div",a),p=ja("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(D0);function r2(e){var i=n2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function n2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H3=function(e){(0,Ir.Z)(r,e);var i=r2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,de.Z)(a),"mScale",void 0),(0,A.Z)((0,de.Z)(a),"iScale",void 0),pl(["update"],(0,de.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:th.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var a="l7-control-scale",s=ja("div",a);this.addScales(a+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var a=this.controlOption.updateWhenIdle;this.mapsService.off(a?"zoomend":"zoomchange",this.update),this.mapsService.off(a?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var a=this.mapsService,s=this.controlOption.maxWidth,p=a.getSize()[1]/2,v=a.containerToLngLat([0,p]),g=a.containerToLngLat([s,p]),x=Ss([v.lng,v.lat],[g.lng,g.lat]);this.updateScales(x)}},{key:"updateScales",value:function(a){var s=this.controlOption,p=s.metric,v=s.imperial;p&&a&&this.updateMetric(a),v&&a&&this.updateImperial(a)}},{key:"updateMetric",value:function(a){var s=this.getRoundNum(a),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/a)}},{key:"updateImperial",value:function(a){var s=a*3.2808399,p,v,g;s>5280?(p=s/5280,v=this.getRoundNum(p),this.updateScale(this.iScale,v+" mi",v/p)):(g=this.getRoundNum(s),this.updateScale(this.iScale,g+" ft",g/s))}},{key:"updateScale",value:function(a,s,p){var v=this.controlOption.maxWidth;a.style.width=Math.round(v*p)+"px",a.innerHTML=s}},{key:"getRoundNum",value:function(a){var s=Math.pow(10,(Math.floor(a)+"").length-1),p=a/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(a,s){var p=this.controlOption,v=p.metric,g=p.imperial;v&&(this.mScale=ja("div",a,s)),g&&(this.iScale=ja("div",a,s))}}]),r}(D0);function i2(e){var i=a2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function a2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var W3=function(e){(0,Ir.Z)(r,e);var i=i2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this,n),(0,A.Z)((0,de.Z)(a),"disabled",void 0),(0,A.Z)((0,de.Z)(a),"zoomInButton",void 0),(0,A.Z)((0,de.Z)(a),"zoomOutButton",void 0),pl(["updateDisabled","zoomIn","zoomOut"],(0,de.Z)(a)),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{position:th.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var a="l7-control-zoom",s=ja("div",a+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,a+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,a+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(a,s,p,v,g){var x=ja("a",p,v);return x.innerHTML=a,x.title=s,x.href="javascript:void(0)",x.addEventListener("click",g),x}},{key:"updateDisabled",value:function(){var a=this.mapsService,s="l7-disabled";Ku(this.zoomInButton,s),Ku(this.zoomOutButton,s),(this.disabled||a.getZoom()<=a.getMinZoom())&&Fl(this.zoomOutButton,s),(this.disabled||a.getZoom()>=a.getMaxZoom())&&Fl(this.zoomInButton,s)}}]),r}(D0);function sg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ug(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function o2(e){var i=s2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function s2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lg=function(e){(0,Ir.Z)(r,e);var i=o2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,A.Z)((0,de.Z)(a),"markerOption",void 0),(0,A.Z)((0,de.Z)(a),"defaultMarker",void 0),(0,A.Z)((0,de.Z)(a),"popup",void 0),(0,A.Z)((0,de.Z)(a),"mapsService",void 0),(0,A.Z)((0,de.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,de.Z)(a),"lngLat",void 0),(0,A.Z)((0,de.Z)(a),"scene",void 0),(0,A.Z)((0,de.Z)(a),"added",!1),(0,A.Z)((0,de.Z)(a),"eventHandle",function(s){a.emit(s.type,{target:s,data:a.markerOption.extData,lngLat:a.lngLat})}),a.markerOption=ug(ug({},a.getDefault()),n),pl(["update","onMove","onUp","addDragHandler","onMapClick"],(0,de.Z)(a)),a.init(),a}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:ku.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(a){this.scene=a,this.mapsService=a.get(Ht.IMapService),this.sceneSerive=a.get(Ht.ISceneService);var s=this.markerOption,p=s.element,v=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var a=this.markerOption.element;return a&&sc(a),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(a){var s=this;if(!this.added)return this.once("added",function(){s.setElement(a)}),this;var p=this.markerOption.element;return p&&sc(p),this.markerOption.element=a,this.init(),this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.update(),this}},{key:"openPopup",value:function(){var a=this;if(!this.added)return this.once("added",function(){a.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var a=this;this.added||this.once("added",function(){a.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(a){return this.popup=a,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var a=this.popup;if(a)a.isOpen()?a.remove():a.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(a){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(a){this.markerOption.extData=a}},{key:"update",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.anchor;this.updatePosition(),go(s,"".concat(Qu[p]))}}},{key:"onMapClick",value:function(a){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.markerOption,s=a.element,p=a.offsets,v=this.lngLat,g=v.lng,x=v.lat,C=this.mapsService.getBounds(),T=this.mapsService.lngLatToContainer([g,x]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var R=this.mapsService.getContainer(),F=0,G=0;if(R&&(F=R.scrollWidth,G=R.scrollHeight),Math.abs(C[0][0])>180||Math.abs(C[1][0])>180){if(T.x>F){var q=this.mapsService.lngLatToContainer([g-360,x]);T.x=q.x}if(T.x<0){var te=this.mapsService.lngLatToContainer([g+360,x]);T.x=te.x}}(T.x>F||T.x<0||T.y>G||T.y<0)&&(s.style.display="none"),s.style.left=T.x+p[0]+"px",s.style.top=T.y-p[1]+"px"}}}},{key:"init",value:function(){var a=this,s=this.markerOption.element,p=this.markerOption,v=p.color,g=p.anchor;if(!s){this.defaultMarker=!0,s=ja("div"),this.markerOption.element=s;var x=document.createElementNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","48px"),x.setAttributeNS(null,"width","48px"),x.setAttributeNS(null,"viewBox","0 0 1024 1024");var C=document.createElementNS("http://www.w3.org/2000/svg","path");C.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),C.setAttributeNS(null,"fill",v),x.appendChild(C),s.appendChild(x)}Fl(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(T){var R,F,G=((R=a.markerOption)===null||R===void 0?void 0:R.style)&&((F=a.markerOption)===null||F===void 0?void 0:F.style[T]);s&&(s.style[T]=G)}),s.addEventListener("click",function(T){a.onMapClick(T)}),s.addEventListener("click",this.eventHandle),Gc(s,g,"marker")}},{key:"registerMarkerEvent",value:function(a){a.addEventListener("mousemove",this.eventHandle),a.addEventListener("click",this.eventHandle),a.addEventListener("mousedown",this.eventHandle),a.addEventListener("mouseup",this.eventHandle),a.addEventListener("dblclick",this.eventHandle),a.addEventListener("contextmenu",this.eventHandle),a.addEventListener("mouseover",this.eventHandle),a.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var a=this.getElement();a.removeEventListener("mousemove",this.eventHandle),a.removeEventListener("click",this.eventHandle),a.removeEventListener("mousedown",this.eventHandle),a.removeEventListener("mouseup",this.eventHandle),a.removeEventListener("dblclick",this.eventHandle),a.removeEventListener("contextmenu",this.eventHandle),a.removeEventListener("mouseover",this.eventHandle),a.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(a){throw new Error("Method not implemented.")}},{key:"onUp",value:function(a){throw new Error("Method not implemented.")}}]),r}(Cs.EventEmitter);function cg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function fg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function u2(e){var i=l2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function l2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=function(e){(0,Ir.Z)(r,e);var i=u2(r);function r(n){var a,s;return(0,dt.Z)(this,r),s=i.call(this),(0,A.Z)((0,de.Z)(s),"markers",[]),(0,A.Z)((0,de.Z)(s),"markerLayerOption",void 0),(0,A.Z)((0,de.Z)(s),"clusterIndex",void 0),(0,A.Z)((0,de.Z)(s),"points",[]),(0,A.Z)((0,de.Z)(s),"clusterMarkers",[]),(0,A.Z)((0,de.Z)(s),"mapsService",void 0),(0,A.Z)((0,de.Z)(s),"scene",void 0),(0,A.Z)((0,de.Z)(s),"zoom",void 0),(0,A.Z)((0,de.Z)(s),"bbox",void 0),s.markerLayerOption=Io()(s.getDefault(),n),pl(["update"],(0,de.Z)(s)),s.zoom=((a=s.markerLayerOption.clusterOption)===null||a===void 0?void 0:a.zoom)||-99,s}return(0,It.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(a){return this.scene=a,this.mapsService=a.get(Ht.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(a){var s=this.markerLayerOption.cluster;if(s&&(this.addPoint(a,this.markers.length),this.mapsService)){var p=this.mapsService.getZoom(),v=this.mapsService.getBounds();this.bbox=On(v,.5),this.zoom=Math.floor(p),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(a)}},{key:"removeMarker",value:function(a){this.markers.indexOf(a);var s=this.markers.indexOf(a);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(a){a.getElement().style.opacity="0"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(a){a.getElement().style.opacity="1"}),this.clusterMarkers.map(function(a){a.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var a=this.markerLayerOption.cluster;return a?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var a=this;this.getMarkers().forEach(function(s){s.addTo(a.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(a){a.remove()}),this.clusterMarkers.forEach(function(a){a.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(a,s){var p=a.getLnglat(),v=p.lng,g=p.lat,x={geometry:{type:"Point",coordinates:[v,g]},properties:fg(fg({},a.getExtData()),{},{marker_id:s})};this.points.push(x),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var a=this.markerLayerOption.clusterOption,s=a.radius,p=a.minZoom,v=p===void 0?0:p,g=a.maxZoom;this.clusterIndex=new(gl())({radius:s,minZoom:v,maxZoom:g}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(a,s){var p=this,v=a[0].concat(a[1]),g=this.clusterIndex.getClusters(v,s);this.clusterMarkers.forEach(function(x){x.remove()}),this.clusterMarkers=[],g.forEach(function(x){var C,T=p.markerLayerOption.clusterOption,R=T.field,F=T.method;if(x.properties&&(C=x.properties)!==null&&C!==void 0&&C.cluster_id){var G,q=p.getLeaves((G=x.properties)===null||G===void 0?void 0:G.cluster_id);if(x.properties.clusterData=q,R&&F){var te=q==null?void 0:q.map(function(St){var Tt=(0,A.Z)({},R,St.properties[R]);return Tt}),Se=zl(te,R),Ne=Kf(F,Se),Ke="point_"+F;x.properties[Ke]=Ne.toFixed(2)}}var it=p.clusterMarker(x);p.clusterMarkers.push(it),it.addTo(p.scene)})}},{key:"getLeaves",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return a?this.clusterIndex.getLeaves(a,s,p):null}},{key:"clusterMarker",value:function(a){var s=this.markerLayerOption.clusterOption,p=s,v=p.element,g=v===void 0?this.generateElement.bind(this):v,x=new lg({element:g(a)}).setLnglat({lng:a.geometry.coordinates[0],lat:a.geometry.coordinates[1]});return x}},{key:"normalMarker",value:function(a){var s=a.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){if(!!this.mapsService){var a=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(a-this.zoom)>=1||!Cn(this.bbox,s))&&(this.bbox=On(s,.5),this.zoom=Math.floor(a),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(a){var s=ja("div","l7-marker-cluster"),p=ja("div","",s),v=ja("span","",p),g=this.markerLayerOption.clusterOption,x=g.field,C=g.method;a.properties.point_count=a.properties.point_count||1;var T=x&&C?a.properties["point_"+C]||a.properties[x]:a.properties.point_count;return v.textContent=T,s}}]),r}(Cs.EventEmitter);function pg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?pg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function c2(e){var i=f2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function f2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var dg=function(e){(0,Ir.Z)(r,e);var i=c2(r);function r(n){var a;return(0,dt.Z)(this,r),a=i.call(this),(0,A.Z)((0,de.Z)(a),"popupOption",void 0),(0,A.Z)((0,de.Z)(a),"mapsService",void 0),(0,A.Z)((0,de.Z)(a),"sceneSerive",void 0),(0,A.Z)((0,de.Z)(a),"lngLat",void 0),(0,A.Z)((0,de.Z)(a),"content",void 0),(0,A.Z)((0,de.Z)(a),"closeButton",void 0),(0,A.Z)((0,de.Z)(a),"timeoutInstance",void 0),(0,A.Z)((0,de.Z)(a),"container",void 0),(0,A.Z)((0,de.Z)(a),"tip",void 0),(0,A.Z)((0,de.Z)(a),"scene",void 0),a.popupOption=hg(hg({},a.getdefault()),n),pl(["update","onClickClose","remove"],(0,de.Z)(a)),a}return(0,It.Z)(r,[{key:"addTo",value:function(a){var s=this;return this.mapsService=a.get(Ht.IMapService),this.sceneSerive=a.get(Ht.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=a,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(a){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),v;for(p.innerHTML=a;v=p.firstChild,!!v;)s.appendChild(v);return this.setDOMContent(s)}},{key:"setLnglat",value:function(a){return this.lngLat=a,Array.isArray(a)&&(this.lngLat={lng:a[0],lat:a[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(a){return this.setDOMContent(window.document.createTextNode(a))}},{key:"setMaxWidth",value:function(a){return this.popupOption.maxWidth=a,this.update(),this}},{key:"setDOMContent",value:function(a){return this.createContent(),this.content.appendChild(a),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&sc(this.content),this.content=ja("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=ja("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(a,s,p){var v=window.document.createElement(a);return s!==void 0&&(v.className=s),p&&p.appendChild(v),v}},{key:"removeDom",value:function(a){a.parentNode&&a.parentNode.removeChild(a)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:ku.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(a){a.stopPropagation&&a.stopPropagation(),this.remove()}},{key:"update",value:function(){var a=this,s=this.lngLat,p=this.popupOption,v=p.className,g=p.maxWidth,x=p.anchor;if(!(!this.mapsService||!s||!this.content)){var C=this.mapsService.getMarkerContainer();if(!this.container&&C){this.container=this.creatDom("div","l7-popup",C),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),v&&v.split(" ").forEach(function(R){return a.container.classList.add(R)});var T=this.popupOption.stopPropagation;T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(R){a.container.addEventListener(R,function(F){F.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}g&&this.container.style.maxWidth!==g&&(this.container.style.maxWidth=g),this.updatePosition(),go(this.container,"".concat(Qu[x])),Gc(this.container,x,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var a=this.lngLat,s=a.lng,p=a.lat,v=this.popupOption.offsets,g=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=g.x+v[0]+"px",this.container.style.top=g.y-v[1]+"px"}}}]),r}(Cs.EventEmitter);function p2(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}p2(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(59, 58, 58, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var h2=U(52353),d2=U.n(h2),v2=U(13218),Gu=U.n(v2),rh,vg=(rh={},(0,A.Z)(rh,Mc.additive,{enable:!0,func:{srcRGB:L.ONE,dstRGB:L.ONE,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Mc.none,{enable:!1}),(0,A.Z)(rh,Mc.normal,{enable:!0,func:{srcRGB:L.SRC_ALPHA,dstRGB:L.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,A.Z)(rh,Mc.subtractive,{enable:!0,func:{srcRGB:L.ONE,dstRGB:L.ONE,srcAlpha:L.ZERO,dstAlpha:L.ONE_MINUS_SRC_COLOR},equation:{rgb:L.FUNC_SUBTRACT,alpha:L.FUNC_SUBTRACT}}),(0,A.Z)(rh,Mc.max,{enable:!0,func:{srcRGB:L.ONE,dstRGB:L.ONE},equation:{rgb:L.MAX_EXT}}),(0,A.Z)(rh,Mc.min,{enable:!0,func:{srcRGB:L.ONE,dstRGB:L.ONE},equation:{rgb:L.MIN_EXT}}),rh),m2=U(81763),ha=U.n(m2),Y3=1024;function nl(e,i,r,n,a){i.updateStyleAttribute(e,r,n,a)}function g2(e,i){e.opacity&&F0("opacity",i,e.opacity),e.strokeWidth&&F0("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&F0("strokeOpacity",i,e.strokeOpacity),e.stroke&&y2("stroke",i,e.stroke),e.offsets&&mg("offsets",i,e.offsets),e.textOffset&&mg("textOffset",i,e.textOffset),e.thetaOffset&&F0("thetaOffset",i,e.thetaOffset)}function F0(e,i,r){w()(r)?nl(e,i,r,function(n){return n}):ha()(r)?nl(e,i,[r],void 0):Array.isArray(r)&&r.length===2?w()(r[0])&&k()(r[1])||w()(r[0])&&Array.isArray(r[1])&&ha()(r[1][0])&&ha()(r[1][1])?nl(e,i,r[0],r[1]):nl(e,i,[1],void 0):nl(e,i,[1],void 0)}function mg(e,i,r){w()(r)?nl(e,i,r,function(n){return n}):Array.isArray(r)&&r.length===2&&w()(r[0])&&k()(r[1])?nl(e,i,r[0],r[1]):Array.isArray(r)&&r.length===2&&ha()(r[0])&&ha()(r[1])?nl(e,i,r,void 0):nl(e,i,[0,0],void 0)}function y2(e,i,r){w()(r)?nl(e,i,r,void 0):Array.isArray(r)&&r.length===2&&(w()(r[0])&&k()(r[1])||w()(r[0])&&Array.isArray(r[1])&&r[1].length>0)?nl(e,i,r[0],r[1]):nl(e,i,"#fff",void 0)}var Ls;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL"})(Ls||(Ls={}));function _2(e,i){var r=[i[0]-e[0],i[1]-e[1]],n=Qo(r),a=[e[0]+n[0]*1e-4,e[1]+n[1]*1e-4];return a}function x2(e,i){var r=this;e.length>0&&i.version===Ls["GAODE2.x"]&&(typeof e[0].coordinates[0]=="number"?e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Ls["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoord(n.coordinates)}):e.filter(function(n){return!n.originCoordinates}).map(function(n){n.version=Ls["GAODE2.x"],n.originCoordinates=cloneDeep(n.coordinates),n.coordinates=r.mapService.lngLatToCoords(n.coordinates)}))}function b2(e,i){e.length>0&&i.version===Ls.SIMPLE&&e.map(function(r){r.simpleCoordinate||(r.coordinates=E2(r.coordinates,i),r.simpleCoordinate=!0)})}function E2(e,i){if(typeof e[0]=="number")return i.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var r=[];return e.map(function(a){var s=[];a.map(function(p){s.push(i.simpleMapCoord.unproject(p))}),r.push(s)}),r}else{var n=[];return e.map(function(a){n.push(i.simpleMapCoord.unproject(a))}),n}}function S2(e,i,r){var n;if(!e.scale)return[];var a=(e==null||(n=e.scale)===null||n===void 0?void 0:n.scalers)||[],s=[];a.forEach(function(v){var g,x=v.field;(i.hasOwnProperty(x)||((g=e.scale)===null||g===void 0?void 0:g.type)==="variable")&&s.push(i[x])});var p=e.mapping?e.mapping(s):[];return e.name==="color"&&!vu(p[0])?[r]:p}function C2(e,i,r,n,a,s){var p=s==null?void 0:s.getLayerConfig(),v=p.arrow,g=v===void 0?{enable:!1}:v,x=i.map(function(C){var T={id:C._id,coordinates:C.coordinates};if(e.filter(function(G){return G.scale!==void 0}).forEach(function(G){var q=S2(G,C,a);G.needRemapping=!1,G.name==="color"&&(q=q.map(function(te){return bi(te)})),T[G.name]=Array.isArray(q)&&q.length===1?q[0]:q,G.name==="shape"&&(T.shape=r.getIconFontKey(T[G.name]))}),T.shape==="line"&&g.enable){var R=T.coordinates,F=_2(R[0],R[1]);T.coordinates.splice(1,0,F,F)}return T});return x2(x,n),b2(x,n),x}function A2(e,i,r,n,a,s){var p=new fh(a,s),v=e.getBottomColor(),g=n.getLayerStyleAttributes()||[],x=p.data.dataArray,C=x,T=C2(g,C,i,r,v,e);return p.destroy(),T}function gg(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}function yg(e,i,r,n){var a=e.multiPassRenderer,s=e.getLayerConfig(),p=s.enablePicking,v=s.enableTAA;return v?a.add(n("taa")):a.add(n("render")),gg(i).forEach(function(g){var x=(0,yn.Z)(g,2),C=x[0],T=x[1];a.add(r(C),T)}),a.add(r("copy")),a}var w2=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function T2(e,i,r){if(typeof i=="string"&&typeof r=="string"&&i!==r){if(e.type==="PointLayer"){e.dataState.dataSourceNeedUpdate=!0;return}w2.map(function(n){if(n.includes(i)&&n.includes(r)){e.dataState.dataSourceNeedUpdate=!0;return}})}}var M2=["passes"],P2=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],_g,Iv,xg;function I2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=O2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function O2(e,i){if(!!e){if(typeof e=="string")return bg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return bg(e,i)}}function bg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Eg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Hu(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Eg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Eg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function R2(e){var i=L2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function L2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sg=0,nh=(_g=Mv(Ht.IGlobalConfigService),Iv=function(e){(0,Ir.Z)(r,e);var i=R2(r);function r(){var n,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,dt.Z)(this,r),n=i.call(this),(0,A.Z)((0,de.Z)(n),"id","".concat(Sg++)),(0,A.Z)((0,de.Z)(n),"name","".concat(Sg)),(0,A.Z)((0,de.Z)(n),"type",void 0),(0,A.Z)((0,de.Z)(n),"visible",!0),(0,A.Z)((0,de.Z)(n),"zIndex",0),(0,A.Z)((0,de.Z)(n),"minZoom",void 0),(0,A.Z)((0,de.Z)(n),"maxZoom",void 0),(0,A.Z)((0,de.Z)(n),"inited",!1),(0,A.Z)((0,de.Z)(n),"layerModelNeedUpdate",!1),(0,A.Z)((0,de.Z)(n),"pickedFeatureID",null),(0,A.Z)((0,de.Z)(n),"selectedFeatureID",null),(0,A.Z)((0,de.Z)(n),"styleNeedUpdate",!1),(0,A.Z)((0,de.Z)(n),"rendering",void 0),(0,A.Z)((0,de.Z)(n),"clusterZoom",0),(0,A.Z)((0,de.Z)(n),"layerType",void 0),(0,A.Z)((0,de.Z)(n),"isLayerGroup",!1),(0,A.Z)((0,de.Z)(n),"triangulation",void 0),(0,A.Z)((0,de.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,A.Z)((0,de.Z)(n),"hooks",{init:new Rs,afterInit:new Rs,beforeRender:new Rs,beforeRenderData:new mu,afterRender:new Fa,beforePickingEncode:new Fa,afterPickingEncode:new Fa,beforeHighlight:new Fa(["pickedColor"]),afterHighlight:new Fa,beforeSelect:new Fa(["pickedColor"]),afterSelect:new Fa,beforeDestroy:new Fa,afterDestroy:new Fa}),(0,A.Z)((0,de.Z)(n),"models",[]),(0,A.Z)((0,de.Z)(n),"multiPassRenderer",void 0),(0,A.Z)((0,de.Z)(n),"plugins",void 0),(0,A.Z)((0,de.Z)(n),"sourceOption",void 0),(0,A.Z)((0,de.Z)(n),"layerModel",void 0),(0,A.Z)((0,de.Z)(n),"shapeOption",void 0),(0,A.Z)((0,de.Z)(n),"sceneContainer",void 0),(0,A.Z)((0,de.Z)(n),"layerChildren",[]),(0,A.Z)((0,de.Z)(n),"masks",[]),Nn((0,de.Z)(n),"configService",xg,(0,de.Z)(n)),(0,A.Z)((0,de.Z)(n),"shaderModuleService",void 0),(0,A.Z)((0,de.Z)(n),"cameraService",void 0),(0,A.Z)((0,de.Z)(n),"coordinateService",void 0),(0,A.Z)((0,de.Z)(n),"iconService",void 0),(0,A.Z)((0,de.Z)(n),"fontService",void 0),(0,A.Z)((0,de.Z)(n),"pickingService",void 0),(0,A.Z)((0,de.Z)(n),"rendererService",void 0),(0,A.Z)((0,de.Z)(n),"layerService",void 0),(0,A.Z)((0,de.Z)(n),"interactionService",void 0),(0,A.Z)((0,de.Z)(n),"mapService",void 0),(0,A.Z)((0,de.Z)(n),"styleAttributeService",void 0),(0,A.Z)((0,de.Z)(n),"layerSource",void 0),(0,A.Z)((0,de.Z)(n),"postProcessingPassFactory",void 0),(0,A.Z)((0,de.Z)(n),"normalPassFactory",void 0),(0,A.Z)((0,de.Z)(n),"animateOptions",{enable:!1}),(0,A.Z)((0,de.Z)(n),"container",void 0),(0,A.Z)((0,de.Z)(n),"encodedData",void 0),(0,A.Z)((0,de.Z)(n),"configSchema",void 0),(0,A.Z)((0,de.Z)(n),"currentPickId",null),(0,A.Z)((0,de.Z)(n),"rawConfig",void 0),(0,A.Z)((0,de.Z)(n),"needUpdateConfig",void 0),(0,A.Z)((0,de.Z)(n),"pendingStyleAttributes",[]),(0,A.Z)((0,de.Z)(n),"scaleOptions",{}),(0,A.Z)((0,de.Z)(n),"animateStartTime",void 0),(0,A.Z)((0,de.Z)(n),"aniamateStatus",!1),(0,A.Z)((0,de.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,A.Z)((0,de.Z)(n),"isDestroied",!1),(0,A.Z)((0,de.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,v=s.fitBoundsOptions;p&&n.fitBounds(v),n.reRender()}),n.name=a.name||n.id,n.zIndex=a.zIndex||0,n.rawConfig=a,n}return(0,It.Z)(r,[{key:"addMaskLayer",value:function(a){this.masks.push(a)}},{key:"removeMaskLayer",value:function(a){var s=this.masks.indexOf(a);s>-1&&this.masks.splice(s,1),a.destroy()}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(a){if(!this.inited)this.needUpdateConfig=Hu(Hu({},this.needUpdateConfig),a);else{var s=this.container.get(Ht.SceneID);g2(a,this),this.configService.setLayerConfig(s,this.id,Hu(Hu(Hu({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),a)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(a,s){this.container=a,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(a){this.bottomColor=a}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(a){return this.plugins.push(a),this}},{key:"init",value:function(){var a=this,s=this.container.get(Ht.SceneID);this.configService.setLayerConfig(s,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Ht.IIconService),this.fontService=this.container.get(Ht.IFontService),this.rendererService=this.container.get(Ht.IRendererService),this.layerService=this.container.get(Ht.ILayerService),this.interactionService=this.container.get(Ht.IInteractionService),this.pickingService=this.container.get(Ht.IPickingService),this.mapService=this.container.get(Ht.IMapService);var p=this.getLayerConfig(),v=p.enableMultiPassRenderer,g=p.passes;v&&g!==null&&g!==void 0&&g.length&&g.length>0&&this.mapService.on("mapAfterFrameChange",function(){a.renderLayers()}),this.cameraService=this.container.get(Ht.ICameraService),this.coordinateService=this.container.get(Ht.ICoordinateSystemService),this.shaderModuleService=this.container.get(Ht.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Ht.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Ht.IFactoryNormalPass),this.styleAttributeService=this.container.get(Ht.IStyleAttributeService),this.multiPassRenderer=this.container.get(Ht.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(R){var F=R.attributeName,G=R.attributeField,q=R.attributeValues,te=R.updateOptions;a.styleAttributeService.updateStyleAttribute(F,{scale:Hu({field:G},a.splitValuesAndCallbackInAttribute(q,a.getLayerConfig()[F]))},te)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Ht.ILayerPlugin);var x=I2(this.plugins),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(R){x.e(R)}finally{x.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models.map(function(s){s.updateAttributesAndElements(a.attributes,a.elements)}):console.warn("data error")}},{key:"createModelData",value:function(a,s){if(this.layerModel.createModelData)return this.layerModel.createModelData(s);var p=this.calculateEncodeData(a,s),v=this.triangulation;return p&&v?this.styleAttributeService.createAttributesAndIndices(p,v):{attributes:void 0,elements:void 0}}},{key:"calculateEncodeData",value:function(a,s){return this.inited?A2(this,this.fontService,this.mapService,this.styleAttributeService,a,s):(console.warn("layer not inited!"),null)}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Hu(Hu({},this.getDefaultConfig()),this.rawConfig));var a=this.getLayerConfig(),s=a.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(a,s,p){return this.updateStyleAttribute("color",a,s,p),this}},{key:"texture",value:function(a,s,p){return this.updateStyleAttribute("texture",a,s,p),this}},{key:"rotate",value:function(a,s,p){return this.updateStyleAttribute("rotate",a,s,p),this}},{key:"size",value:function(a,s,p){return this.updateStyleAttribute("size",a,s,p),this}},{key:"filter",value:function(a,s,p){return this.updateStyleAttribute("filter",a,s,p),this}},{key:"shape",value:function(a,s,p){var v,g,x,C=(v=this.styleAttributeService)===null||v===void 0||(g=v.getLayerStyleAttribute("shape"))===null||g===void 0||(x=g.scale)===null||x===void 0?void 0:x.field,T=a;return this.shapeOption={field:a,values:s},this.updateStyleAttribute("shape",a,s,p),T2(this,C,T),this}},{key:"label",value:function(a,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:a,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(a){var s={};return Gu()(a)?(s.enable=!0,s=Hu(Hu({},s),a)):s.enable=a,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(a,s){return a!=null&&a.data?(this.setSource(a),this):(this.sourceOption={data:a,options:s},this.clusterZoom=0,this)}},{key:"setData",value:function(a,s){var p=this;return this.inited?this.layerSource.setData(a,s):this.on("inited",function(){var v=p.getSource();v?p.layerSource.setData(a,s):(p.source(new fh(a,s)),p.sourceEvent())}),this}},{key:"style",value:function(a){var s=this,p=this.getLayerConfig(),v=a.passes,g=(0,ro.Z)(a,M2);return v&&gg(v).forEach(function(x){var C=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(x[0]);C&&C.updateOptions(x[1])}),this.rawConfig=Hu(Hu({},this.rawConfig),g),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),p&&p.mask===!0&&a.mask===!1&&(this.clearModels(),this.models=this.layerModel.buildModels()),this}},{key:"scale",value:function(a,s){return Gu()(a)?this.scaleOptions=Hu(Hu({},this.scaleOptions),a):this.scaleOptions[a]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"renderMultiPass",value:function(){var n=(0,j.Z)(K().mark(function s(){return K().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(this.getEncodedData().length===0){v.next=7;break}if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){v.next=6;break}return v.next=4,this.multiPassRenderer.render();case 4:v.next=7;break;case 6:this.multiPassRenderer?this.renderModels():this.renderModels();case 7:case"end":return v.stop()}},s,this)}));function a(){return n.apply(this,arguments)}return a}()},{key:"active",value:function(a){var s={};return s.enableHighlight=Gu()(a)?!0:a,Gu()(a)?(s.enableHighlight=!0,a.color&&(s.highlightColor=a.color),a.mix&&(s.activeMix=a.mix)):s.enableHighlight=!!a,this.updateLayerConfig(s),this}},{key:"setActive",value:function(a,s){var p=this;if(Gu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({highlightColor:Gu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Gu()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,highlightColor:Gu()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:Gu()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(Is(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(a){var s={};return s.enableSelect=Gu()(a)?!0:a,Gu()(a)?(s.enableSelect=!0,a.color&&(s.selectColor=a.color),a.mix&&(s.selectMix=a.mix)):s.enableSelect=!!a,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(a,s){var p=this;if(Gu()(a)){var v=a.x,g=v===void 0?0:v,x=a.y,C=x===void 0?0:x;this.updateLayerConfig({selectColor:Gu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Gu()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:g,y:C})}else this.updateLayerConfig({pickedFeatureID:a,selectColor:Gu()(s)?s.color:this.getLayerConfig().selectColor,selectMix:Gu()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Is(a)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(a){return this.updateLayerConfig({blend:a}),this.layerModelNeedUpdate=!0,this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.type==="CanvasLayer"&&this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(a){return this.zIndex=a,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(a){this.currentPickId=a}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(a){this.selectedFeatureID=a}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var a=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,v=s.minZoom,g=v===void 0?-Infinity:v,x=s.maxZoom,C=x===void 0?Infinity:x;return!!p&&a>=g&&a<=C}},{key:"setMultiPass",value:function(a,s){if(this.updateLayerConfig({enableMultiPassRenderer:a}),s&&this.updateLayerConfig({passes:s}),a){var p=this.getLayerConfig(),v=p.passes,g=v===void 0?[]:v;this.multiPassRenderer=yg(this,g,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var x=this.rendererService.getViewportSize(),C=x.width,T=x.height;this.multiPassRenderer.resize(C,T)}return this}},{key:"setMinZoom",value:function(a){return this.updateLayerConfig({minZoom:a}),this}},{key:"getMinZoom",value:function(){var a=this.getLayerConfig(),s=a.minZoom;return s}},{key:"getMaxZoom",value:function(){var a=this.getLayerConfig(),s=a.maxZoom;return s}},{key:"get",value:function(a){var s=this.getLayerConfig();return s[a]}},{key:"setMaxZoom",value:function(a){return this.updateLayerConfig({maxZoom:a}),this}},{key:"setAutoFit",value:function(a){return this.updateLayerConfig({autoFit:a}),this}},{key:"fitBounds",value:function(a){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,v=p.some(function(g){return Math.abs(g)===Infinity});return v?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],a),this)}},{key:"destroy",value:function(){var a;this.isDestroied||(this.layerChildren.map(function(s){return s.destroy()}),this.layerChildren=[],this.masks.map(function(s){return s.destroy()}),this.masks=[],this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(a=this.layerModel)===null||a===void 0||a.clearModels(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(a){return a.destroy()}),this.layerModel.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(a){return a.needRescale||a.needRemapping||a.needRegenerateVertices}).length}},{key:"setSource",value:function(a){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=a,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(a){this.encodedData=a}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(a){return this.styleAttributeService.getLayerAttributeScale(a)}},{key:"getLegendItems",value:function(a){var s=this.styleAttributeService.getLayerAttributeScale(a);if(!s)return[];if(s.invertExtent){var p=s.range().map(function(x){return(0,A.Z)({value:s.invertExtent(x)},a,x)});return p}else if(s.ticks){var v=s.ticks().map(function(x){return(0,A.Z)({value:x},a,s(x))});return v}else if(s!=null&&s.domain){var g=s.domain().filter(function(x){return!d2()(x)}).map(function(x){return(0,A.Z)({value:x},a,s(x))});return g}return[]}},{key:"pick",value:function(a){var s=a.x,p=a.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(a,s){this.pickingService.boxPickLayer(this,a,s)}},{key:"buildLayerModel",value:function(a){var s=a.moduleName,p=a.vertexShader,v=a.fragmentShader,g=a.triangulation,x=a.segmentNumber,C=(0,ro.Z)(a,P2);this.shaderModuleService.registerModule(s,{vs:p,fs:v});var T=this.shaderModuleService.getModule(s),R=T.vs,F=T.fs,G=T.uniforms,q=this.rendererService.createModel,te=this.styleAttributeService.createAttributesAndIndices(this.encodedData,g,x),Se=te.attributes,Ne=te.elements;return q(Hu({attributes:Se,uniforms:G,fs:F,vs:R,elements:Ne,blend:vg[Mc.normal]},C))}},{key:"createAttrubutes",value:function(a){var s=a.triangulation,p=this.styleAttributeService.createAttributes(this.encodedData,s),v=p.attributes;return v}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(a){var s=this.getLayerConfig(),p=s.enableHighlight,v=p===void 0?!0:p,g=s.enableSelect,x=g===void 0?!0:g,C=this.eventNames().indexOf(a)!==-1||this.eventNames().indexOf("un"+a)!==-1;return(a==="click"||a==="dblclick")&&x&&(C=!0),a==="mousemove"&&(v||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(C=!0),this.isVisible()&&C}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderMulPass",value:function(){var n=(0,j.Z)(K().mark(function s(p){return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.next=2,p.render();case 2:case"end":return g.stop()}},s)}));function a(s){return n.apply(this,arguments)}return a}()},{key:"renderModels",value:function(a){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.layerModel.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},a)})),this}},{key:"updateStyleAttribute",value:function(a,s,p,v){this.inited?this.styleAttributeService.updateStyleAttribute(a,{scale:Hu({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},v):this.pendingStyleAttributes.push({attributeName:a,attributeField:s,attributeValues:p,updateOptions:v})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(a){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(a,s){return{values:k()(a)?void 0:a||s,callback:k()(a)?a:void 0}}}]),r}(Cs.EventEmitter),xg=si(Iv.prototype,"configService",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv),k2=U(18446),md=U.n(k2),Cg,Ov,Ag;function D2(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=F2(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function F2(e,i){if(!!e){if(typeof e=="string")return wg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wg(e,i)}}function wg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bo=(Cg=Mv(Ht.IGlobalConfigService),Ov=function(){function e(i){(0,dt.Z)(this,e),(0,A.Z)(this,"triangulation",void 0),(0,A.Z)(this,"createTexture2D",void 0),(0,A.Z)(this,"layer",void 0),(0,A.Z)(this,"dataTexture",void 0),(0,A.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,A.Z)(this,"rowCount",void 0),(0,A.Z)(this,"cacheStyleProperties",void 0),(0,A.Z)(this,"cellLength",void 0),(0,A.Z)(this,"cellProperties",void 0),(0,A.Z)(this,"cellTypeLayout",void 0),(0,A.Z)(this,"stylePropertyesExist",void 0),(0,A.Z)(this,"dataTextureTest",void 0),Nn(this,"configService",Ag,this),(0,A.Z)(this,"shaderModuleService",void 0),(0,A.Z)(this,"rendererService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"styleAttributeService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"cameraService",void 0),(0,A.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Ht.IRendererService),this.shaderModuleService=i.getContainer().get(Ht.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Ht.IStyleAttributeService),this.mapService=i.getContainer().get(Ht.IMapService),this.iconService=i.getContainer().get(Ht.IIconService),this.fontService=i.getContainer().get(Ht.IFontService),this.cameraService=i.getContainer().get(Ht.ICameraService),this.layerService=i.getContainer().get(Ht.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8Array(4),mag:L.NEAREST,min:L.NEAREST,width:1,height:1}))}return(0,It.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return md()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),md()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),md()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),md()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),md()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),md()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!ha()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!ha()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!ha()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!ha()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return w()(r)?!!(0,Js.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=bi(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(Array.isArray(r)&&r.length===2&&ha()(r[0])&&ha()(r[1]))}},{key:"patchMod",value:function(r,n){for(var a=0;a<n;a++)r.push(-1)}},{key:"patchData",value:function(r,n,a){var s=D2(a),p;try{for(s.s();!(p=s.n()).done;){var v=p.value,g=v.attr,x=v.count,C=n[g];C!==void 0?g==="stroke"?r.push.apply(r,(0,Ae.Z)(bi(C))):g==="offsets"?this.isOffsetStatic(C)?r.push(-C[0],C[1]):r.push(0,0):r.push(ha()(C)?C:1):this.patchMod(r,x)}}catch(T){s.e(T)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,a){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),v=p*this.DATA_TEXTURE_WIDTH,g=[],x=0;x<s;x++){var C=n[x];this.patchData(g,C,a)}for(var T=g.length;T<v;T++)g.push(-1);return{data:g,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,a=n===void 0?"normal":n;return vg[Mc[a]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Ag=si(Ov.prototype,"configService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ov),B2=U(9187),Bf=U.n(B2),Tg=100,q3=36,K3=40;function Mg(e){return e/180*Math.acos(-1)}function Pg(e){var i=Mg(e[0])+Math.PI/2,r=Mg(e[1]),n=Tg+Math.random()*.4,a=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,a]}function $3(e,i){var r=mat4.create(),n=mat4.create(),a=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,v=2+p,g=2*v,x=[],C=[],T=[],R=[],F=[],G=[],q=0;q<=v;q++){for(var te=q/v,Se=te*Math.PI,Ne=0;Ne<=g;Ne++){var Ke=Ne/g,it=Ke*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-Se),mat4.identity(r),mat4.rotateY(r,r,it),vec3.transformMat4(s,a,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),T.push(s.slice()),R.push.apply(R,_toConsumableArray(s.slice())),vec3.normalize(s,s),F.push.apply(F,_toConsumableArray(s.slice())),G.push([Ke,1-te]),R.push(Ke,1-te)}if(q>0)for(var St=T.length,Tt=St-2*(g+1);Tt+g+2<St;Tt++)x.push([Tt,Tt+1,Tt+g+1]),C.push(Tt,Tt+1,Tt+g+1),x.push([Tt+g+1,Tt+1,Tt+g+2]),C.push(Tt+g+1,Tt+1,Tt+g+2)}return{cells:x,positions:T,uvs:G,positionsArr:R,indicesArr:C,normalArr:F}}var Ei=U(31437),B0=Ei.Ue(),Q3=Ei.Ue(),Hs=Ei.Ue(),ih=Ei.Ue(),gd=Ei.Ue();function Rv(e,i,r,n,a){Ei.IH(e,r,n),Ei.Fv(e,e),i=Ei.al(-e[1],e[0]);var s=Ei.al(-r[1],r[0]);return[a/Ei.AK(i,s),i]}function ah(e,i){return Ei.t8(e,-i[1],i[0])}function yd(e,i,r){return Ei.lu(e,i,r),Ei.Fv(e,e),e}function Lv(e,i){return e[0]===i[0]&&e[1]===i[1]}function J3(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var Ig=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,dt.Z)(this,e),(0,A.Z)(this,"complex",void 0),(0,A.Z)(this,"join",void 0),(0,A.Z)(this,"cap",void 0),(0,A.Z)(this,"miterLimit",void 0),(0,A.Z)(this,"thickness",void 0),(0,A.Z)(this,"normal",void 0),(0,A.Z)(this,"lastFlip",-1),(0,A.Z)(this,"miter",Ei.al(0,0)),(0,A.Z)(this,"started",!1),(0,A.Z)(this,"dash",!1),(0,A.Z)(this,"totalDistance",0),(0,A.Z)(this,"currentIndex",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,It.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var G=n[v],q=v<r.length-1?[].concat((0,Ae.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Se=this.segment_gaode2(a,p,T,F,q,R,G,te);p+=Se}if(this.dash)for(var Ne=0;Ne<a.positions.length/6;Ne++)a.positions[Ne*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"simpleExtrude_gaode2",value:function(r,n){var a=this.complex;if(r.length<=1)return a;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=a.startIndex,v=1;v<s;v++){var g,x,C,T=r[v-1];T.push((g=n[v-1][2])!==null&&g!==void 0?g:0);var R=n[v-1],F=r[v];F.push((x=n[v][2])!==null&&x!==void 0?x:0);var G=n[v],q=v<r.length-1?[].concat((0,Ae.Z)(r[v+1]),[(C=n[v+1][2])!==null&&C!==void 0?C:0]):null,te=v<n.length-1?n[v+1]:null,Se=this.simpleSegment(a,p,T,F,q,R,G,te);p+=Se}if(this.dash)for(var Ne=0;Ne<a.positions.length/6;Ne++)a.positions[Ne*6+5]=this.totalDistance;return a.startIndex=a.positions.length/6,a}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.segment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=r.length,s=n.startIndex,p=1;p<a;p++){var v=r[p-1],g=r[p],x=p<r.length-1?r[p+1]:null,C=this.simpleSegment(n,s,v,g,x);s+=C}if(this.dash)for(var T=0;T<n.positions.length/6;T++)n.positions[T*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,a,s,p,v,g,x){var C=0,T=r.indices,R=r.positions,F=r.normals,G=this.cap==="square",q=this.join==="bevel",te=as([g[0],g[1]]),Se=as([v[0],v[1]]);yd(Hs,s,a);var Ne=0;if(this.dash&&(Ne=this.lineSegmentDistance(te,Se),this.totalDistance+=Ne),this.normal||(this.normal=Ei.Ue(),ah(this.normal,Hs)),!this.started)if(this.started=!0,G){var Ke=Ei.Ue(),it=Ei.Ue();Ei.IH(Ke,this.normal,Hs),Ei.IH(it,this.normal,Hs),F.push(it[0],it[1],0),F.push(Ke[0],Ke[1],0),R.push(a[0],a[1],a[2]|0,this.totalDistance-Ne,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),R.push(a[0],a[1],a[2]|0,this.totalDistance-Ne,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(R,F,a,this.normal,this.thickness,this.totalDistance-Ne);if(T.push(n+0,n+1,n+2),p){Lv(s,p)&&Ei.IH(p,s,Ei.Fv(p,Ei.$X(p,s,a))),yd(ih,p,s);var $t=Rv(gd,Ei.Ue(),Hs,ih,this.thickness),sr=(0,yn.Z)($t,2),Pr=sr[0],$r=sr[1],br=Ei.AK(gd,this.normal)<0?-1:1,mn=q;if(!mn&&this.join==="miter"){var Mn=Pr;Mn>this.miterLimit&&(mn=!0)}mn?(F.push(this.normal[0],this.normal[1],0),F.push($r[0],$r[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,T.push.apply(T,(0,Ae.Z)(this.lastFlip!==-br?[n,n+2,n+3]:[n+2,n+1,n+3])),T.push(n+2,n+3,n+4),ah(B0,ih),Ei.JG(this.normal,B0),F.push(this.normal[0],this.normal[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*br,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,C+=3):(this.extrusions(R,F,s,$r,Pr,this.totalDistance),T.push.apply(T,(0,Ae.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),br=-1,Ei.JG(this.normal,$r),C+=2),this.lastFlip=br}else{if(ah(this.normal,Hs),G){var St=Ei.Ue(),Tt=Ei.Ue();Ei.lu(Tt,Hs,this.normal),Ei.IH(St,Hs,this.normal),F.push(Tt[0],Tt[1],0),F.push(St[0],St[1],0),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),R.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(R,F,s,this.normal,this.thickness,this.totalDistance);T.push.apply(T,(0,Ae.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),C+=2}return C}},{key:"simpleSegment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,T=as([s[0],s[1]]),R=as([a[0],a[1]]);yd(Hs,T,R);var F=0;if(this.dash&&(F=this.lineSegmentDistance(T,R),this.totalDistance+=F),this.normal||(this.normal=Ei.Ue(),ah(this.normal,Hs)),this.started||(this.started=!0,this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-F)),g.push(n+0,n+1,n+2),!p)ah(this.normal,Hs),this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance),g.push.apply(g,(0,Ae.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2;else{var G=as([p[0],p[1]]);Lv(T,G)&&Ei.IH(G,T,Ei.Fv(G,Ei.$X(G,T,R))),yd(ih,G,T);var q=Rv(gd,Ei.Ue(),Hs,ih,this.thickness),te=(0,yn.Z)(q,2),Se=te[0],Ne=te[1],Ke=Ei.AK(gd,this.normal)<0?-1:1;this.extrusions(x,C,s,Ne,Se,this.totalDistance),g.push.apply(g,(0,Ae.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Ke=-1,Ei.JG(this.normal,Ne),v+=2,this.lastFlip=Ke}return v}},{key:"segment",value:function(r,n,a,s,p){var v=0,g=r.indices,x=r.positions,C=r.normals,T=this.cap==="square",R=this.join==="bevel",F=as([s[0],s[1]]),G=as([a[0],a[1]]);yd(Hs,F,G);var q=0;if(this.dash&&(q=this.lineSegmentDistance(F,G),this.totalDistance+=q),this.normal||(this.normal=Ei.Ue(),ah(this.normal,Hs)),!this.started)if(this.started=!0,T){var te=Ei.Ue(),Se=Ei.Ue();Ei.IH(te,this.normal,Hs),Ei.IH(Se,this.normal,Hs),C.push(Se[0],Se[1],0),C.push(te[0],te[1],0),x.push(a[0],a[1],a[2]|0,this.totalDistance-q,-this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),x.push(a[0],a[1],a[2]|0,this.totalDistance-q,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,a,this.normal,this.thickness,this.totalDistance-q);if(g.push(n+0,n+1,n+2),p){var it=as([p[0],p[1]]);Lv(F,it)&&Ei.IH(it,F,Ei.Fv(it,Ei.$X(it,F,G))),yd(ih,it,F);var St=Rv(gd,Ei.Ue(),Hs,ih,this.thickness),Tt=(0,yn.Z)(St,2),$t=Tt[0],sr=Tt[1],Pr=Ei.AK(gd,this.normal)<0?-1:1,$r=R;if(!$r&&this.join==="miter"){var br=$t;br>this.miterLimit&&($r=!0)}$r?(C.push(this.normal[0],this.normal[1],0),C.push(sr[0],sr[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,g.push.apply(g,(0,Ae.Z)(this.lastFlip!==-Pr?[n,n+2,n+3]:[n+2,n+1,n+3])),g.push(n+2,n+3,n+4),ah(B0,ih),Ei.JG(this.normal,B0),C.push(this.normal[0],this.normal[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Pr,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,v+=3):(this.extrusions(x,C,s,sr,$t,this.totalDistance),g.push.apply(g,(0,Ae.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Pr=-1,Ei.JG(this.normal,sr),v+=2),this.lastFlip=Pr}else{if(ah(this.normal,Hs),T){var Ne=Ei.Ue(),Ke=Ei.Ue();Ei.lu(Ke,Hs,this.normal),Ei.IH(Ne,Hs,this.normal),C.push(Ke[0],Ke[1],0),C.push(Ne[0],Ne[1],0),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),x.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(x,C,s,this.normal,this.thickness,this.totalDistance);g.push.apply(g,(0,Ae.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),v+=2}return v}},{key:"extrusions",value:function(r,n,a,s,p,v){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(a[0],a[1],a[2]|0,v,-p,a[2]|0),this.complex.indexes.push(this.currentIndex),r.push(a[0],a[1],a[2]|0,v,p,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(r,n){var a=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(a*a+s*s)}}]),e}();function kh(e){if(ha()(e[0]))return e;if(ha()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ha()(e[0][0][0])){var i=e,r=0,n=0,a=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],a++})}),[r/a,n/a,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function N2(e){for(var i=e[0],r=e[1],n=e[0],a=e[1],s=0,p=0,v=0,g=0;g<e.length;g+=2){var x=e[g],C=e[g+1];x&&C&&(i=Math.max(x,i),r=Math.max(C,r),n=Math.min(x,n),a=Math.min(C,a),s+=x,p+=C,v++)}return{center:[s/v,p/v],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-a,2))/2}}var qa=U(77160);function z2(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,a=Bf().flatten(e),s=a.vertices,p=a.dimensions,v=[],g=[],x=0;x<s.length/p;x++)p===2?v.push(s[x*2],s[x*2+1],1):v.push(s[x*3],s[x*3+1],1);var C=Bf()(a.vertices,a.holes,a.dimensions);g.push.apply(g,(0,Ae.Z)(C));for(var T=function(G){var q=a.vertices.slice(G*p,(G+1)*p),te=a.vertices.slice((G+1)*p,(G+2)*p);te.length===0&&(te=a.vertices.slice(0,p));var Se=v.length/3;v.push(q[0],q[1],1,te[0],te[1],1,q[0],q[1],0,te[0],te[1],0),g.push.apply(g,(0,Ae.Z)([0,2,1,2,3,1].map(function(Ne){return Ne+Se})))},R=0;R<n;R++)T(R);return{positions:v,index:g}}function U2(e){var i=Bf().flatten(e),r=Bf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function Og(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var a=e[0].length,s=Bf().flatten(e),p=s.vertices,v=s.dimensions,g=[],x=[],C=[],T=0;T<p.length/v;T++)v===2?g.push(p[T*2],p[T*2+1],1,-1,-1):g.push(p[T*3],p[T*3+1],1,-1,-1),C.push(0,0,1);var R=Bf()(s.vertices,s.holes,s.dimensions);x.push.apply(x,(0,Ae.Z)(R));for(var F=function(te){var Se=s.vertices.slice(te*v,(te+1)*v),Ne=s.vertices.slice((te+1)*v,(te+2)*v);Ne.length===0&&(Ne=s.vertices.slice(0,v));var Ke=g.length/5;g.push(Se[0],Se[1],1,0,0,Ne[0],Ne[1],1,.1,0,Se[0],Se[1],0,0,.8,Ne[0],Ne[1],0,.1,.8);var it=Z2([Ne[0],Ne[1],1],[Se[0],Se[1],0],[Se[0],Se[1],1],i);C.push.apply(C,(0,Ae.Z)(it).concat((0,Ae.Z)(it),(0,Ae.Z)(it),(0,Ae.Z)(it))),x.push.apply(x,(0,Ae.Z)([1,2,0,3,2,1].map(function(St){return St+Ke})))},G=0;G<a;G++)F(G);return{positions:g,index:x,normals:C}}function Z2(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=qa.create(),s=qa.create(),p=qa.create();n&&(e=Ti(e),i=Ti(i),r=Ti(r));var v=qa.fromValues.apply(qa,(0,Ae.Z)(e)),g=qa.fromValues.apply(qa,(0,Ae.Z)(i)),x=qa.fromValues.apply(qa,(0,Ae.Z)(r));qa.sub(a,x,g),qa.sub(s,v,g),qa.cross(p,a,s);var C=qa.create();return qa.normalize(C,p),C}var Pc,Dh;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Dh||(Dh={}));var Fh;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Fh||(Fh={}));function $d(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],a=0;a<e;a++)n.push(r*a+i*Math.PI/12);var s=n.map(function(p){var v=Math.sin(p+Math.PI/4),g=Math.cos(p+Math.PI/4);return[v,g,0]});return s}function Rg(){return $d(30)}function Lg(){return $d(4)}function kg(){return $d(3)}function Dg(){return $d(6,1)}function Fg(){return $d(5)}var _d=(Pc={},(0,A.Z)(Pc,Fh.CIRCLE,Rg),(0,A.Z)(Pc,Fh.HEXAGON,Dg),(0,A.Z)(Pc,Fh.TRIANGLE,kg),(0,A.Z)(Pc,Fh.SQUARE,Lg),(0,A.Z)(Pc,Fh.PENTAGON,Fg),(0,A.Z)(Pc,Dh.CYLINDER,Rg),(0,A.Z)(Pc,Dh.HEXAGONCOLUMN,Dg),(0,A.Z)(Pc,Dh.TRIANGLECOLUMN,kg),(0,A.Z)(Pc,Dh.SQUARECOLUMN,Lg),(0,A.Z)(Pc,Dh.PENTAGONCOLUMN,Fg),Pc),N0={};function Bh(e){var i=kh(e.coordinates);return{vertices:[].concat((0,Ae.Z)(i),(0,Ae.Z)(i),(0,Ae.Z)(i),(0,Ae.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function Bg(e){var i=kh(e.coordinates),r=Pg(i);return{vertices:[].concat((0,Ae.Z)(r),(0,Ae.Z)(r),(0,Ae.Z)(r),(0,Ae.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Ng(e){var i=e.shape,r=G2(i,!1),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function zg(e){var i=kh(e.coordinates);return{vertices:(0,Ae.Z)(i),indices:[0],size:i.length}}function Qd(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Ig({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.extrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.extrude(R)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,indexes:T.indexes,size:6}}function j2(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,a=new Ig({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var v=0;v<s.length;v++){var g=s[v],x=p[v];a.simpleExtrude_gaode2(g,x)}}else{var C=i;C[0]&&!Array.isArray(C[0][0])&&(C=[i]),C.forEach(function(R){a.simpleExtrude(R)})}var T=a.complex;return{vertices:T.positions,indices:T.indices,normals:T.normals,size:6}}function Jd(e){var i=e.coordinates,r=Bf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Bf()(n,s,a),vertices:n,size:a}}function Ug(e){var i=e.coordinates,r=Bf().flatten(i),n=r.vertices,a=r.dimensions,s=r.holes;return{indices:Bf()(n,s,a),vertices:V2(n),size:a+4}}function V2(e){for(var i=[],r=N2(e),n=r.center,a=r.radius,s=0;s<e.length;s+=2){var p=e[s],v=e[s+1];i.push.apply(i,[p,v,0].concat((0,Ae.Z)(n),[a]))}return i}function Zg(e){var i=e.coordinates,r=Og(i,!0),n=r.positions,a=r.index,s=r.normals;return{vertices:n,indices:a,normals:s,size:5}}function jg(e){var i=e.shape,r=W2(i),n=r.positions,a=r.index;return{vertices:n,indices:a,size:3}}function Vg(e){var i=e.coordinates,r=[].concat((0,Ae.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,Ae.Z)(i[1]),[0,1,0],(0,Ae.Z)(i[0]),[0,0,1],(0,Ae.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function z0(e,i){for(var r=i||30,n=e.coordinates,a=[],s=[],p=function(x){a.push(x,1,x,n[0][0],n[0][1],n[1][0],n[1][1],x,-1,x,n[0][0],n[0][1],n[1][0],n[1][1]),x!==r-1&&s.push.apply(s,(0,Ae.Z)([0,1,2,1,3,2].map(function(C){return x*2+C})))},v=0;v<r;v++)p(v);return{vertices:a,indices:s,size:7}}function Gg(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=U0(-1,1),a=U0(1,1),s=U0(-1,-1),p=U0(1,-1),v=[].concat((0,Ae.Z)(i),(0,Ae.Z)(n),(0,Ae.Z)(i),(0,Ae.Z)(s),(0,Ae.Z)(i),(0,Ae.Z)(p),(0,Ae.Z)(i),(0,Ae.Z)(a)),g=[0,1,2,3,0,2];return{vertices:v,indices:g,size:5}}function G2(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(N0&&N0[e])return N0[e];var r=_d[e]?_d[e]():_d.cylinder(),n=Og([r],i);return N0[e]=n,n}function eP(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,a=new Float32Array(e.length/r*3),s,p,v,g=vec3.create(),x=vec3.create(),C=vec3.create(),T=0,R=i.length;T<R;T+=3){s=i[T+0]*3,p=i[T+1]*3,v=i[T+2]*3;var F=[e[s],e[s+1]],G=[e[p],e[p+1]],q=[e[v],e[v+1]];n&&(F=lngLatToMeters(F),G=lngLatToMeters(G),q=lngLatToMeters(q));var te=F,Se=_slicedToArray(te,2),Ne=Se[0],Ke=Se[1],it=vec3.fromValues(Ne,Ke,e[s+2]),St=G,Tt=_slicedToArray(St,2),$t=Tt[0],sr=Tt[1],Pr=vec3.fromValues($t,sr,e[p+2]),$r=q,br=_slicedToArray($r,2),mn=br[0],Mn=br[1],Qn=vec3.fromValues(mn,Mn,e[v+2]);vec3.sub(g,Qn,Pr),vec3.sub(x,it,Pr),vec3.cross(C,g,x),a[s]+=g[0],a[s+1]+=g[1],a[s+2]+=g[2],a[p]+=g[0],a[p+1]+=g[1],a[p+2]+=g[2],a[v]+=g[0],a[v+1]+=g[1],a[v+2]+=g[2]}return H2(a),a}function H2(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),a=vec3.create();vec3.normalize(a,n),e.set(a,i)}}function tP(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function W2(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=_d[e]?_d[e]():_d.circle(),n=i.indexOf(e)===-1?U2([r]):z2([r]);return n}function U0(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function rP(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function nP(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function X2(e){var i=Y2();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function Y2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q2=`uniform float u_opacity;
varying vec4 v_Color;

void main() {
  gl_FragColor = v_Color;
  gl_FragColor.a *= u_opacity;
}
`,K2=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;

#pragma include "projection"

void main() {

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,$2=function(e){(0,Ir.Z)(r,e);var i=X2(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?0:s;return{u_opacity:ha()(p)?p:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"mask",vertexShader:K2,fragmentShader:q2,triangulation:Jd,blend:this.getBlend(),depth:{enable:!1},stencil:{enable:!0,mask:255,func:{cmp:L.ALWAYS,ref:1,mask:255},opFront:{fail:L.REPLACE,zfail:L.REPLACE,zpass:L.REPLACE}}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),r}(bo),Q2={fill:$2},J2=Q2;function eE(e){var i=tE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function tE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rE=function(e){(0,Ir.Z)(r,e);var i=eE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","MaskLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new J2[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"fill"}}]),r}(nh),nE=U(88307),iE=U.n(nE),aE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"attribute",void 0),(0,A.Z)(this,"buffer",void 0);var n=r.buffer,a=r.offset,s=r.stride,p=r.normalized,v=r.size,g=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:a||0,stride:s||0,normalized:p||!1,divisor:g||0},v&&(this.attribute.size=v)}return(0,It.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),bp,e0,Ep,Ic,t0,oh,r0,Z0,Nf,Nh,Su,zf,Uf,j0,oE=(bp={},(0,A.Z)(bp,L.POINTS,"points"),(0,A.Z)(bp,L.LINES,"lines"),(0,A.Z)(bp,L.LINE_LOOP,"line loop"),(0,A.Z)(bp,L.LINE_STRIP,"line strip"),(0,A.Z)(bp,L.TRIANGLES,"triangles"),(0,A.Z)(bp,L.TRIANGLE_FAN,"triangle fan"),(0,A.Z)(bp,L.TRIANGLE_STRIP,"triangle strip"),bp),Hg=(e0={},(0,A.Z)(e0,L.STATIC_DRAW,"static"),(0,A.Z)(e0,L.DYNAMIC_DRAW,"dynamic"),(0,A.Z)(e0,L.STREAM_DRAW,"stream"),e0),kv=(Ep={},(0,A.Z)(Ep,L.BYTE,"int8"),(0,A.Z)(Ep,L.UNSIGNED_INT,"int16"),(0,A.Z)(Ep,L.INT,"int32"),(0,A.Z)(Ep,L.UNSIGNED_BYTE,"uint8"),(0,A.Z)(Ep,L.UNSIGNED_SHORT,"uint16"),(0,A.Z)(Ep,L.UNSIGNED_INT,"uint32"),(0,A.Z)(Ep,L.FLOAT,"float"),Ep),sE=(Ic={},(0,A.Z)(Ic,L.ALPHA,"alpha"),(0,A.Z)(Ic,L.LUMINANCE,"luminance"),(0,A.Z)(Ic,L.LUMINANCE_ALPHA,"luminance alpha"),(0,A.Z)(Ic,L.RGB,"rgb"),(0,A.Z)(Ic,L.RGBA,"rgba"),(0,A.Z)(Ic,L.RGBA4,"rgba4"),(0,A.Z)(Ic,L.RGB5_A1,"rgb5 a1"),(0,A.Z)(Ic,L.RGB565,"rgb565"),(0,A.Z)(Ic,L.DEPTH_COMPONENT,"depth"),(0,A.Z)(Ic,L.DEPTH_STENCIL,"depth stencil"),Ic),uE=(t0={},(0,A.Z)(t0,L.DONT_CARE,"dont care"),(0,A.Z)(t0,L.NICEST,"nice"),(0,A.Z)(t0,L.FASTEST,"fast"),t0),Wg=(oh={},(0,A.Z)(oh,L.NEAREST,"nearest"),(0,A.Z)(oh,L.LINEAR,"linear"),(0,A.Z)(oh,L.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,A.Z)(oh,L.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,A.Z)(oh,L.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,A.Z)(oh,L.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),oh),Xg=(r0={},(0,A.Z)(r0,L.REPEAT,"repeat"),(0,A.Z)(r0,L.CLAMP_TO_EDGE,"clamp"),(0,A.Z)(r0,L.MIRRORED_REPEAT,"mirror"),r0),lE=(Z0={},(0,A.Z)(Z0,L.NONE,"none"),(0,A.Z)(Z0,L.BROWSER_DEFAULT_WEBGL,"browser"),Z0),cE=(Nf={},(0,A.Z)(Nf,L.NEVER,"never"),(0,A.Z)(Nf,L.ALWAYS,"always"),(0,A.Z)(Nf,L.LESS,"less"),(0,A.Z)(Nf,L.LEQUAL,"lequal"),(0,A.Z)(Nf,L.GREATER,"greater"),(0,A.Z)(Nf,L.GEQUAL,"gequal"),(0,A.Z)(Nf,L.EQUAL,"equal"),(0,A.Z)(Nf,L.NOTEQUAL,"notequal"),Nf),Yg=(Nh={},(0,A.Z)(Nh,L.FUNC_ADD,"add"),(0,A.Z)(Nh,L.MIN_EXT,"min"),(0,A.Z)(Nh,L.MAX_EXT,"max"),(0,A.Z)(Nh,L.FUNC_SUBTRACT,"subtract"),(0,A.Z)(Nh,L.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Nh),V0=(Su={},(0,A.Z)(Su,L.ZERO,"zero"),(0,A.Z)(Su,L.ONE,"one"),(0,A.Z)(Su,L.SRC_COLOR,"src color"),(0,A.Z)(Su,L.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,A.Z)(Su,L.SRC_ALPHA,"src alpha"),(0,A.Z)(Su,L.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,A.Z)(Su,L.DST_COLOR,"dst color"),(0,A.Z)(Su,L.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,A.Z)(Su,L.DST_ALPHA,"dst alpha"),(0,A.Z)(Su,L.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,A.Z)(Su,L.CONSTANT_COLOR,"constant color"),(0,A.Z)(Su,L.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,A.Z)(Su,L.CONSTANT_ALPHA,"constant alpha"),(0,A.Z)(Su,L.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,A.Z)(Su,L.SRC_ALPHA_SATURATE,"src alpha saturate"),Su),fE=(zf={},(0,A.Z)(zf,L.NEVER,"never"),(0,A.Z)(zf,L.ALWAYS,"always"),(0,A.Z)(zf,L.LESS,"less"),(0,A.Z)(zf,L.LEQUAL,"lequal"),(0,A.Z)(zf,L.GREATER,"greater"),(0,A.Z)(zf,L.GEQUAL,"gequal"),(0,A.Z)(zf,L.EQUAL,"equal"),(0,A.Z)(zf,L.NOTEQUAL,"notequal"),zf),xd=(Uf={},(0,A.Z)(Uf,L.ZERO,"zero"),(0,A.Z)(Uf,L.KEEP,"keep"),(0,A.Z)(Uf,L.REPLACE,"replace"),(0,A.Z)(Uf,L.INVERT,"invert"),(0,A.Z)(Uf,L.INCR,"increment"),(0,A.Z)(Uf,L.DECR,"decrement"),(0,A.Z)(Uf,L.INCR_WRAP,"increment wrap"),(0,A.Z)(Uf,L.DECR_WRAP,"decrement wrap"),Uf),pE=(j0={},(0,A.Z)(j0,L.FRONT,"front"),(0,A.Z)(j0,L.BACK,"back"),j0),hE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"buffer",void 0);var n=r.data,a=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:Hg[a||L.STATIC_DRAW],type:kv[s||L.UNSIGNED_BYTE]})}return(0,It.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,a=r.offset;this.buffer.subdata(n,a)}}]),e}(),dE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"elements",void 0);var n=r.data,a=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:Hg[a||L.STATIC_DRAW],type:kv[s||L.UNSIGNED_BYTE],count:p})}return(0,It.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),vE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"framebuffer",void 0);var n=r.width,a=r.height,s=r.color,p=r.colors,v=r.depth,g=r.stencil,x={width:n,height:a};Array.isArray(p)&&(x.colors=p.map(function(C){return C.get()})),s&&typeof s!="boolean"&&(x.color=s.get()),this.framebuffer=i.framebuffer(x)}return(0,It.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.framebuffer.resize(n,a)}}]),e}(),mE=U(36719),gE=U.n(mE),yE=U(68630),_E=U.n(yE);function qg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Oc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?qg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var xE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"reGl",void 0),(0,A.Z)(this,"destroyed",!1),(0,A.Z)(this,"drawCommand",void 0),(0,A.Z)(this,"drawPickCommand",void 0),(0,A.Z)(this,"drawParams",void 0),(0,A.Z)(this,"options",void 0),(0,A.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,a=r.fs,s=r.attributes,p=r.uniforms,v=r.primitive,g=r.count,x=r.elements,C=r.depth,T=r.blend,R=r.stencil,F=r.cull,G=r.instances,q={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(Ke){q[Ke]=i.prop(Ke)}));var te={};Object.keys(s).forEach(function(Ke){te[Ke]=s[Ke].get()});var Se={attributes:te,frag:a,uniforms:q,vert:n,blend:{},primitive:oE[v===void 0?L.TRIANGLES:v]};G&&(Se.instances=G),g&&(Se.count=g),x&&(Se.elements=x.get()),this.initDepthDrawParams({depth:C},Se),this.initBlendDrawParams({blend:T},Se),this.initStencilDrawParams({stencil:R},Se),this.initCullDrawParams({cull:F},Se),this.drawCommand=i(Se);var Ne=X()(Se);Ne.blend=Oc(Oc({},Ne.blend),{},{enable:!1}),this.drawPickCommand=i(Ne),this.drawParams=Se}return(0,It.Z)(e,[{key:"updateAttributesAndElements",value:function(r,n){var a={};Object.keys(r).forEach(function(p){a[p]=r[p].get()}),this.drawParams.attributes=a,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams);var s=X()(this.drawParams);s.blend=Oc(Oc({},s.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(s)}},{key:"updateAttributes",value:function(r){var n={};Object.keys(r).forEach(function(s){n[s]=r[s].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams);var a=X()(this.drawParams);a.blend=Oc(Oc({},a.blend),{},{enable:!1}),this.drawPickCommand=this.reGl(a)}},{key:"addUniforms",value:function(r){this.uniforms=Oc(Oc({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var a=Oc(Oc({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(a).forEach(function(p){var v=(0,We.Z)(a[p]);v==="boolean"||v==="number"||Array.isArray(a[p])||a[p].BYTES_PER_ELEMENT?s[p]=a[p]:s[p]=a[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var a=r.depth;a&&(n.depth={enable:a.enable===void 0?!0:!!a.enable,mask:a.mask===void 0?!0:!!a.mask,func:cE[a.func||L.LESS],range:a.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var a=r.blend;if(a){var s=a.enable,p=a.func,v=a.equation,g=a.color,x=g===void 0?[0,0,0,0]:g;n.blend={enable:!!s,func:{srcRGB:V0[p&&p.srcRGB||L.SRC_ALPHA],srcAlpha:V0[p&&p.srcAlpha||L.SRC_ALPHA],dstRGB:V0[p&&p.dstRGB||L.ONE_MINUS_SRC_ALPHA],dstAlpha:V0[p&&p.dstAlpha||L.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Yg[v&&v.rgb||L.FUNC_ADD],alpha:Yg[v&&v.alpha||L.FUNC_ADD]},color:x}}}},{key:"initStencilDrawParams",value:function(r,n){var a=r.stencil;if(a){var s=a.enable,p=a.mask,v=p===void 0?-1:p,g=a.func,x=g===void 0?{cmp:L.ALWAYS,ref:0,mask:-1}:g,C=a.opFront,T=C===void 0?{fail:L.KEEP,zfail:L.KEEP,zpass:L.KEEP}:C,R=a.opBack,F=R===void 0?{fail:L.KEEP,zfail:L.KEEP,zpass:L.KEEP}:R;n.stencil={enable:!!s,mask:v,func:Oc(Oc({},x),{},{cmp:fE[x.cmp]}),opFront:{fail:xd[T.fail],zfail:xd[T.zfail],zpass:xd[T.zpass]},opBack:{fail:xd[F.fail],zfail:xd[F.zfail],zpass:xd[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var a=r.cull;if(a){var s=a.enable,p=a.face,v=p===void 0?L.BACK:p;n.cull={enable:!!s,face:pE[v]}}}},{key:"extractUniforms",value:function(r){var n=this,a={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],a,"")}),a}},{key:"extractUniformsRecursively",value:function(r,n,a,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||gE()(n)||n===""||"resize"in n){a["".concat(s&&s+".").concat(r)]=n;return}_E()(n)&&Object.keys(n).forEach(function(v){p.extractUniformsRecursively(v,n[v],a,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(v,g){Object.keys(v).forEach(function(x){p.extractUniformsRecursively(x,v[x],a,"".concat(s&&s+".").concat(r,"[").concat(g,"]"))})})}}]),e}(),bE=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"texture",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDistroy",!1);var n=r.data,a=r.type,s=a===void 0?L.UNSIGNED_BYTE:a,p=r.width,v=r.height,g=r.flipY,x=g===void 0?!1:g,C=r.format,T=C===void 0?L.RGBA:C,R=r.mipmap,F=R===void 0?!1:R,G=r.wrapS,q=G===void 0?L.CLAMP_TO_EDGE:G,te=r.wrapT,Se=te===void 0?L.CLAMP_TO_EDGE:te,Ne=r.aniso,Ke=Ne===void 0?0:Ne,it=r.alignment,St=it===void 0?1:it,Tt=r.premultiplyAlpha,$t=Tt===void 0?!1:Tt,sr=r.mag,Pr=sr===void 0?L.NEAREST:sr,$r=r.min,br=$r===void 0?L.NEAREST:$r,mn=r.colorSpace,Mn=mn===void 0?L.BROWSER_DEFAULT_WEBGL:mn,Qn=r.x,Na=Qn===void 0?0:Qn,qo=r.y,ks=qo===void 0?0:qo,Ds=r.copy,Ws=Ds===void 0?!1:Ds;this.width=p,this.height=v;var pf={width:p,height:v,type:kv[s],format:sE[T],wrapS:Xg[q],wrapT:Xg[Se],mag:Wg[Pr],min:Wg[br],alignment:St,flipY:x,colorSpace:lE[Mn],premultiplyAlpha:$t,aniso:Ke,x:Na,y:ks,copy:Ws};n&&(pf.data=n),typeof F=="number"?pf.mipmap=uE[F]:typeof F=="boolean"&&(pf.mipmap=F),this.texture=i.texture(pf)}return(0,It.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,a=r.height;this.texture.resize(n,a),this.width=n,this.height=a}},{key:"destroy",value:function(){if(!this.isDistroy){var r;(r=this.texture)===null||r===void 0||r.destroy()}this.isDistroy=!0}}]),e}(),Kg,$g,EE=(Kg=(0,Wr.b2)(),Kg($g=function(){function e(){var i=this;(0,dt.Z)(this,e),(0,A.Z)(this,"extensionObject",void 0),(0,A.Z)(this,"gl",void 0),(0,A.Z)(this,"$container",void 0),(0,A.Z)(this,"canvas",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"isDirty",void 0),(0,A.Z)(this,"createModel",function(r){return new xE(i.gl,r)}),(0,A.Z)(this,"createAttribute",function(r){return new aE(i.gl,r)}),(0,A.Z)(this,"createBuffer",function(r){return new hE(i.gl,r)}),(0,A.Z)(this,"createElements",function(r){return new dE(i.gl,r)}),(0,A.Z)(this,"createTexture2D",function(r){return new bE(i.gl,r)}),(0,A.Z)(this,"createFramebuffer",function(r){return new vE(i.gl,r)}),(0,A.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,A.Z)(this,"clear",function(r){var n=r.color,a=r.depth,s=r.stencil,p=r.framebuffer,v=p===void 0?null:p,g={color:n,depth:a,stencil:s};g.framebuffer=v===null?v:v.get(),i.gl.clear(g)}),(0,A.Z)(this,"viewport",function(r){var n=r.x,a=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,a,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,A.Z)(this,"readPixels",function(r){var n=r.framebuffer,a=r.x,s=r.y,p=r.width,v=r.height,g={x:a,y:s,width:p,height:v};return n&&(g.framebuffer=n.get()),i.gl.read(g)}),(0,A.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,A.Z)(this,"getContainer",function(){if(Ji)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,A.Z)(this,"getCanvas",function(){return i.canvas}),(0,A.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,A.Z)(this,"destroy",function(){i.canvas=null,i.gl.destroy(),i.gl=null})}return(0,It.Z)(e,[{key:"init",value:function(){var i=(0,j.Z)(K().mark(function n(a,s){var p=this;return K().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return this.canvas=a,g.next=3,new Promise(function(x,C){iE()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,stencil:s.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(R,F){(R||!F)&&C(R),x(F)}})});case 3:this.gl=g.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return g.stop()}},n,this)}));function r(n,a){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||$g);function Qg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Jg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Qg(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var SE=function(){function e(i){(0,dt.Z)(this,e),(0,A.Z)(this,"sceneService",void 0),(0,A.Z)(this,"mapService",void 0),(0,A.Z)(this,"controlService",void 0),(0,A.Z)(this,"layerService",void 0),(0,A.Z)(this,"iconService",void 0),(0,A.Z)(this,"markerService",void 0),(0,A.Z)(this,"popupService",void 0),(0,A.Z)(this,"fontService",void 0),(0,A.Z)(this,"interactionService",void 0),(0,A.Z)(this,"container",void 0);var r=i.id,n=i.map,a=i.canvas,s=i.hasBaseMap,p=Db();this.container=p,n.setContainer(p,r,a,s),p.bind(Ht.IRendererService).to(EE).inSingletonScope(),this.sceneService=p.get(Ht.ISceneService),this.mapService=p.get(Ht.IMapService),this.iconService=p.get(Ht.IIconService),this.fontService=p.get(Ht.IFontService),this.controlService=p.get(Ht.IControlService),this.layerService=p.get(Ht.ILayerService),this.markerService=p.get(Ht.IMarkerService),this.interactionService=p.get(Ht.IInteractionService),this.popupService=p.get(Ht.IPopupService),Ji?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,It.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var a=new r(this);a.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=ng(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r);var a=r.getLayerConfig();if(a){var s=a.mask,p=a.maskfence,v=a.maskColor,g=v===void 0?"#000":v,x=a.maskOpacity,C=x===void 0?0:x;if(s&&p){var T=new rE().source(p).shape("fill").color(g).style({opacity:C});this.addMask(T,r.id)}}else console.warn("addLayer should run after scene loaded!")}},{key:"addMask",value:function(r,n){var a=this.getLayer(n);if(a){var s=ng(this.container);r.setContainer(s,this.container),a.addMaskLayer(r),this.sceneService.addLayer(r)}else console.warn("parent layer not find!")}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(a){var s=(0,yn.Z)(a,2),p=s[0],v=s[1];n.fontService.addIconFont(p,v)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Ji?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Pv.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Pv.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Pv.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var a=this.sceneService.getSceneConfig(),s=a.fitBoundsOptions,p=a.animate;this.mapService.fitBounds(r,n||Jg(Jg({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Ht.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Pa(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,a=r.logoPosition;n&&this.addControl(new t2({position:a}))}}]),e}();function CE(e){var i=AE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function AE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wE=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,TE=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,ME=function(e){(0,Ir.Z)(r,e);var i=CE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"cityCenter",void 0),(0,A.Z)((0,de.Z)(n),"cityMinSize",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.baseColor,g=v===void 0?"rgb(16,16,16)":v,x=a.brightColor,C=x===void 0?"rgb(255,176,38)":x,T=a.windowColor,R=T===void 0?"rgb(30,60,89)":T,F=a.time,G=F===void 0?0:F,q=a.sweep,te=q===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:q;return{u_cityCenter:te.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*te.sweepRadius,u_circleSweep:te.enable?1:0,u_circleSweepColor:bi(te.sweepColor).slice(0,3),u_circleSweepSpeed:te.sweepSpeed,u_opacity:p,u_baseColor:bi(g),u_brightColor:bi(C),u_windowColor:bi(R),u_time:this.layer.getLayerAnimateTime()||G}}},{key:"calCityGeo",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(v+s)/2,(g+p)/2]);var x=this.mapService.lngLatToCoord([v,g]),C=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(x[0]-C[0],2)+Math.pow(x[1]-C[1],2))/4}else{var T=v-s,R=g-p;this.cityCenter=[(v+s)/2,(g+p)/2],this.cityMinSize=Math.sqrt(Math.pow(T,2)+Math.pow(R,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:TE,fragmentShader:wE,triangulation:Zg,cull:{enable:!0,face:L.BACK}})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?10:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){var x=s.size;return[v[3],v[4]]}}})}}]),r}(bo);function PE(e){var i=IE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function IE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OE=function(e){(0,Ir.Z)(r,e);var i=PE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","PolygonLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new ME(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(a){this.updateLayerConfig({time:a})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(nh);function RE(e){var i=LE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function LE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kE=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,DE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,FE=function(e){(0,Ir.Z)(r,e);var i=RE(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:kE,fragmentShader:DE,triangulation:jg,depth:{enable:!1},primitive:L.TRIANGLES,blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(bo);function BE(e){var i=NE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function NE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zE=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,UE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ZE=function(e){(0,Ir.Z)(r,e);var i=BE(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:zE,fragmentShader:UE,triangulation:Ng,depth:{enable:!0},blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size;return Array.isArray(x)?[x[0]]:[x]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(bo);function jE(e,i){for(var r=[],n=[],a=[],s=e+1,p=i+1,v=e/2,g=i/2,x=0;x<p;x++)for(var C=x-g,T=0;T<s;T++){var R=T-v;n.push(R/v,-C/g,0),a.push(T/e),a.push(1-x/i)}for(var F=0;F<i;F++)for(var G=0;G<e;G++){var q=G+s*F,te=G+s*(F+1),Se=G+1+s*(F+1),Ne=G+1+s*F;r.push(q,te,Ne),r.push(te,Se,Ne)}return{vertices:n,indices:r,uvs:a}}var ey,ty;function ry(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ny(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ry(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ry(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function VE(e){var i=GE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function GE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HE=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,WE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,XE=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26
uniform float u_opacity;
varying vec2 v_texCoord;

float getBlurIndusty() {
    float h = 2.0/512.0;
    vec2 vUv = v_texCoord;
    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y + 1.0 * h) ).r;
    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y + 1.0 * h) ).r;
    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y + 1.0 * h) ).r;

    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y) ).r;
    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;
    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y) ).r;

    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * h, vUv.y-1.0*h) ).r;
    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * h, vUv.y-1.0*h) ).r;
    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * h, vUv.y-1.0*h) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture2D(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));

    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,YE=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;

void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,qE=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,KE=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,iy=(ey=(0,Wr.b2)(),ey(ty=function(e){(0,Ir.Z)(r,e);var i=VE(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"colorTexture",void 0),(0,A.Z)((0,de.Z)(n),"heatmapFramerBuffer",void 0),(0,A.Z)((0,de.Z)(n),"intensityModel",void 0),(0,A.Z)((0,de.Z)(n),"colorModel",void 0),(0,A.Z)((0,de.Z)(n),"shapeType",void 0),n}return(0,It.Z)(r,[{key:"render",value:function(){var a=this,s=this.rendererService,p=s.clear,v=s.useFramebuffer;v(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.heatmapFramerBuffer}),a.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var a,s=this.rendererService,p=s.createFramebuffer,v=s.clear,g=s.getViewportSize,x=s.createTexture2D,C=s.useFramebuffer,T=this.styleAttributeService.getLayerStyleAttribute("shape"),R=(T==null||(a=T.scale)===null||a===void 0?void 0:a.field)||"heatmap";this.shapeType=R,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=R==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=g(),G=F.width,q=F.height;return this.heatmapFramerBuffer=p({color:x({width:Math.floor(G/4),height:Math.floor(q/4),wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE,min:L.LINEAR,mag:L.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:In.Attribute,descriptor:{name:"a_Dir",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return[C]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.triangulation=Gg,this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:KE,fragmentShader:qE,triangulation:Gg,depth:{enable:!1},cull:{enable:!0,face:Nl(this.mapService.version)},blend:{enable:!0,func:{srcRGB:L.ONE,srcAlpha:1,dstRGB:L.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.shaderModuleService.registerModule("heatmapColor",{vs:YE,fs:XE});var x=this.shaderModuleService.getModule("heatmapColor"),C=x.vs,T=x.fs,R=x.uniforms,F=this.rendererService,G=F.createAttribute,q=F.createElements,te=F.createBuffer,Se=F.createModel;return Se({vs:C,fs:T,attributes:{a_Position:G({buffer:te({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:L.FLOAT}),size:3}),a_Uv:G({buffer:te({data:[0,1,1,1,0,0,1,0],type:L.FLOAT}),size:2})},uniforms:ny({},R),depth:{enable:!1},blend:this.getBlend(),count:6,elements:q({data:[0,2,1,2,3,1],type:L.UNSIGNED_INT,count:6}),stencil:Ia(p,g)})}},{key:"drawIntensityMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.intensity,v=p===void 0?10:p,g=a.radius,x=g===void 0?5:g;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:x,u_intensity:v}})}},{key:"drawColorMode",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=Ki();Np(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Ae.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.rendererService.getViewportSize,C=x(),T=C.width,R=C.height,F=jE(T/4,R/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:WE,fs:HE});var G=this.shaderModuleService.getModule("heatmap3dColor"),q=G.vs,te=G.fs,Se=G.uniforms,Ne=this.rendererService,Ke=Ne.createAttribute,it=Ne.createElements,St=Ne.createBuffer,Tt=Ne.createModel;return Tt({vs:q,fs:te,attributes:{a_Position:Ke({buffer:St({data:F.vertices,type:L.FLOAT}),size:3}),a_Uv:Ke({buffer:St({data:F.uvs,type:L.FLOAT}),size:2})},primitive:L.TRIANGLES,uniforms:ny({},Se),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:L.SRC_ALPHA,srcAlpha:1,dstRGB:L.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:it({data:F.indices,type:L.UNSIGNED_INT,count:F.indices.length}),stencil:Ia(p,g)})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var a=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,v=hl(p);this.colorTexture=a({data:new Uint8Array(v.data),width:v.width,height:v.height,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE,min:L.NEAREST,mag:L.NEAREST,flipY:!1})}}]),r}(bo))||ty);function $E(e){var i=QE();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function QE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JE=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,eS=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,tS=function(e){(0,Ir.Z)(r,e);var i=$E(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.coverage,v=a.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:v||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:eS,fragmentShader:JE,triangulation:jg,depth:{enable:!1},primitive:L.TRIANGLES,blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p){var v=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[v[0],v[1],0]}}})}}]),r}(bo),rS={heatmap:iy,heatmap3d:iy,grid:FE,grid3d:ZE,hexagon:tS},nS=rS;function iS(e){var i=aS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=function(e){(0,Ir.Z)(r,e);var i=iS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","HeatMapLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new nS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var a=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:a.layerModel.getUninforms()})}),this)}},{key:"updateModelData",value:function(a){a.attributes&&a.elements?this.models[0].updateAttributesAndElements(a.attributes,a.elements):console.warn("data error")}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),v=p.shape3d,g=this.getSource(),x=g.data.type,C=(s==null||(a=s.scale)===null||a===void 0?void 0:a.field)||"heatmap";return C==="heatmap"||C==="heatmap3d"?"heatmap":x==="hexagon"?(v==null?void 0:v.indexOf(C))===-1?"hexagon":"grid3d":x==="grid"?(v==null?void 0:v.indexOf(C))===-1?"grid":"grid3d":"heatmap"}}]),r}(nh);function sS(e){var i=uS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function uS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lS=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,cS=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,fS=function(e){(0,Ir.Z)(r,e);var i=sS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mask,v=p===void 0?!1:p,g=s.maskInside,x=g===void 0?!0:g,C=this.layer.getSource(),T=this.rendererService.createTexture2D;if(this.texture=T({height:0,width:0}),Ji){var R=this.layerService.sceneService.getSceneConfig().canvas,F=R.createImage();F.crossOrigin="anonymous",F.src=C.data.originData,F.onload=function(){a.texture=T({data:F,width:F.width,height:F.height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}else C.data.images.then(function(G){a.texture=T({data:G[0],width:G[0].width,height:G[0].height}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:cS,fragmentShader:lS,triangulation:Vg,primitive:L.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ia(v,x)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}}]),r}(bo),pS={image:fS},hS=pS;function dS(e){var i=vS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function vS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mS=function(e){(0,Ir.Z)(r,e);var i=dS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","ImageLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new hS[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={image:{}};return s[a]}},{key:"getModelType",value:function(){return"image"}}]),r}(nh);function gS(e){var i=yS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function yS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _S=`
uniform float u_opacity;

varying vec4 v_dash_array;
varying vec4 v_color;

uniform float segmentNumber;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity;

  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;
  
  gl_FragColor = filterColor(gl_FragColor);
}`,xS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;


uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  vec2 s = source;
  vec2 t = target;
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  

   styleMappingMat[3].b = segmentIndex / segmentNumber;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,bS=`
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  gl_FragColor = v_color;
  
  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,ES=`#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,SS=`#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}`,CS=`
attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
varying vec4 v_color;

uniform float u_lineDir: 1.0;

uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,AS={solid:0,dash:1},wS=function(e){(0,Ir.Z)(r,e);var i=gS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.NEAREST,min:L.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,G=a.forward,q=G===void 0?!0:G,te=a.lineTexture,Se=te===void 0?!1:te,Ne=a.iconStep,Ke=Ne===void 0?100:Ne,it=a.segmentNumber,St=it===void 0?30:it,Tt=a.thetaOffset,$t=Tt===void 0?.314:Tt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:$t})){this.judgeStyleAttributes({opacity:s,thetaOffset:$t});var sr=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,sr,this.cellProperties),$r=Pr.data,br=Pr.width,mn=Pr.height;this.rowCount=mn,this.dataTexture=this.cellLength>0&&$r.length>0?this.createTexture2D({flipY:!0,data:$r,format:L.LUMINANCE,type:L.FLOAT,width:br,height:mn}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Mn=0,Qn=[0,0,0,0],Na=[0,0,0,0];return p&&v&&(Qn=bi(p),Na=bi(v),Mn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:ha()($t)?$t:0,u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:St,u_line_type:AS[T||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:q?1:-1,u_texture:this.texture,u_line_texture:Se?1:0,u_icon_step:Ke,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Mn,u_sourceColor:Qn,u_targetColor:Na}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:_S,vert:xS,type:"dash"}:s&&p?{frag:SS,vert:CS,type:"linear"}:{frag:bS,vert:ES,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,G=T.type;return[this.layer.buildLayerModel({moduleName:"arc2dline"+G,vertexShader:F,fragmentShader:R,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p,stencil:Ia(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}})}}]),r}(bo);function TS(e){var i=MS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;

  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,IS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,OS=`
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
varying float v_segmentIndex;
uniform float segmentNumber;


uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);

  gl_FragColor.a *= opacity;

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,RS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,LS={solid:0,dash:1},kS=function(e){(0,Ir.Z)(r,e);var i=TS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.NEAREST,min:L.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,G=a.lineTexture,q=G===void 0?!1:G,te=a.iconStep,Se=te===void 0?100:te,Ne=a.segmentNumber,Ke=Ne===void 0?30:Ne,it=a.globalArcHeight,St=it===void 0?10:it;F.length===2&&F.push(0,0);var Tt=0,$t=[0,0,0,0],sr=[0,0,0,0];if(p&&v&&($t=bi(p),sr=bi(v),Tt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Pr=this.layer.getEncodedData(),$r=this.calDataFrame(this.cellLength,Pr,this.cellProperties),br=$r.data,mn=$r.width,Mn=$r.height;this.rowCount=Mn,this.dataTexture=this.cellLength>0&&br.length>0?this.createTexture2D({flipY:!0,data:br,format:L.LUMINANCE,type:L.FLOAT,width:mn,height:Mn}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Tg,u_global_height:St,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ke,u_line_type:LS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Tt,u_sourceColor:$t,u_targetColor:sr}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return s&&p?{frag:OS,vert:RS,type:"linear"}:{frag:PS,vert:IS,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x,T=this.getShaders(),R=T.frag,F=T.vert,G=T.type;return[this.layer.buildLayerModel({moduleName:"arc3Dline"+G,vertexShader:F,fragmentShader:R,triangulation:z0,blend:this.getBlend(),segmentNumber:p,stencil:Ia(g,C)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}})}}]),r}(bo);function DS(e){var i=FS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function FS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,NS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,zS=function(e){(0,Ir.Z)(r,e);var i=DS(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.forward,x=g===void 0?!0:g,C=a.segmentNumber,T=C===void 0?30:C,R=a.thetaOffset,F=R===void 0?.314:R,G=0,q=[0,0,0,0],te=[0,0,0,0];return p&&v&&(q=bi(p),te=bi(v),G=1),{u_thetaOffset:F,u_opacity:ha()(s)?s:1,segmentNumber:T,u_blur:.9,u_lineDir:x?1:-1,u_linearColor:G,u_sourceColor:q,u_targetColor:te}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:NS,fragmentShader:BS,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:4,update:function(s,p,v,g){return[v[3],v[4],v[5],v[6]]}}})}}]),r}(bo);function US(e){var i=ZS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ZS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,VS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,GS={solid:0,dash:1},HS=function(e){(0,Ir.Z)(r,e);var i=US(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.NEAREST,min:L.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5]:R,G=a.lineTexture,q=G===void 0?!1:G,te=a.iconStep,Se=te===void 0?100:te,Ne=a.segmentNumber,Ke=Ne===void 0?30:Ne;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var it=0,St=[0,0,0,0],Tt=[0,0,0,0];if(p&&v&&(St=bi(p),Tt=bi(v),it=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var $t=this.layer.getEncodedData(),sr=this.calDataFrame(this.cellLength,$t,this.cellProperties),Pr=sr.data,$r=sr.width,br=sr.height;this.rowCount=br,this.dataTexture=this.cellLength>0&&Pr.length>0?this.createTexture2D({flipY:!0,data:Pr,format:L.LUMINANCE,type:L.FLOAT,width:$r,height:br}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,segmentNumber:Ke,u_line_type:GS[T]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:it,u_sourceColor:St,u_targetColor:Tt}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"greatcircleline",vertexShader:VS,fragmentShader:jS,triangulation:z0,depth:{enable:!1},blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:In.Attribute,descriptor:{name:"a_Instance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:4,update:function(p,v,g,x){return[g[3],g[4],g[5],g[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}})}}]),r}(bo);function WS(e){var i=XS();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=`#define LineTypeSolid 0.0
uniform float u_opacity : 1.0;

varying vec4 v_color;

// dash
varying vec4 v_dash_array;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
 // dash line
 
  float flag = 0.;
  float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
    flag = 1.;
  }
  gl_FragColor.a *=flag;

  gl_FragColor = filterColor(gl_FragColor);
}
`,qS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  vec2 offset = project_pixel(size.xy);

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = a_DistanceAndIndex.x / a_Total_Distance; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_DistanceAndIndex.x;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));
  } else {
    float lineHeight = a_Size.y;
 
    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,KS=`#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

varying vec2 v_iconMapUV;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  gl_FragColor = v_color;
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor += pattern;
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = pattern;
    }
  } 

  float v = styleMappingMat[3].a;
  float borderWidth = min(0.5, u_borderWidth);
  // \u7ED8\u5236 border
  if(borderWidth > 0.01) {
    float borderOuterWidth = borderWidth/2.0;

    if(v >= 1.0 - borderWidth || v <= borderWidth) {
      if(v > borderWidth) {
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
      } else if(v <= borderWidth) {
        float linear = smoothstep(0.0, 1.0, v/borderWidth);
        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  gl_FragColor = filterColor(gl_FragColor);
}
`,ay=`
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;
uniform float u_arrow: 0.0;
uniform float u_arrowHeight: 3.0;
uniform float u_arrowWidth: 2.0;
uniform float u_tailWidth: 1.0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

vec2 calculateArrow(vec2 offset) {
  /*
  * \u5728\u652F\u6301\u7BAD\u5934\u7684\u65F6\u5019\uFF0C\u7B2C\u4E8C\u3001\u7B2C\u4E09\u7EC4\u9876\u70B9\u662F\u989D\u5916\u63D2\u5165\u7528\u4E8E\u6784\u5EFA\u9876\u70B9\u7684
  */
  float arrowFlag = -1.0;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // \u9AD8\u5FB7 2.0 \u7684\u65CB\u8F6C\u89D2\u5EA6\u4E0D\u540C
    arrowFlag = 1.0;
  }
  float pi = arrowFlag * 3.1415926/2.;
  if(a_Miter < 0.) {
    // \u6839\u636E\u7EBF\u7684\u4E24\u4FA7\u504F\u79FB\u4E0D\u540C\u3001\u65CB\u8F6C\u7684\u65B9\u5411\u76F8\u53CD
    pi = -pi;
  }
  highp float angle_sin = sin(pi);
  highp float angle_cos = cos(pi);
  // \u8BA1\u7B97\u5782\u76F4\u4E0E\u7EBF\u65B9\u5411\u7684\u65CB\u8F6C\u77E9\u9635
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  float arrowWidth = u_arrowWidth;
  float arrowHeight = u_arrowHeight;

  vec2 arrowOffset = vec2(0.0);
  /*
  * a_DistanceAndIndex.y \u7528\u4E8E\u6807\u8BB0\u5F53\u524D\u9876\u70B9\u5C5E\u4E8E\u54EA\u4E00\u7EC4\uFF08\u4E24\u4E2A\u9876\u70B9\u4E00\u7EC4\uFF0C\u6784\u6210\u7EBF\u7684\u5176\u5B9E\u662F\u77E9\u5F62\uFF0C\u6700\u7B80\u9700\u8981\u56DB\u4E2A\u9876\u70B9\u3001\u4E24\u7EC4\u9876\u70B9\u6784\u6210\uFF09
  */
  if(a_DistanceAndIndex.y == 0.0) {
    // \u7BAD\u5934\u5C16\u90E8
    offset = vec2(0.0);
  } else if(a_DistanceAndIndex.y == 1.0) {
    // \u7BAD\u5934\u4E24\u4FA7
    arrowOffset = rotation_matrix*(offset * arrowHeight);
    offset += arrowOffset; // \u6CBF\u7EBF\u504F\u79FB
    offset = offset * arrowWidth; // \u5782\u76F4\u7EBF\u5411\u5916\u504F\u79FB\uFF08\u662F\u6784\u5EFA\u7BAD\u5934\u4E24\u4FA7\u7684\u9876\u70B9\uFF09
  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {
    // \u504F\u79FB\u5176\u4F59\u7684\u70B9\u4F4D\uFF08\u5C06\u957F\u5EA6\u8BA9\u4F4D\u7ED9\u7BAD\u5934\uFF09
    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;
    offset += arrowOffset;// \u6CBF\u7EBF\u504F\u79FB
  }

  return offset;
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 
  if(u_arrow > 0.0) {
      //  \u8BA1\u7B97\u7BAD\u5934
    offset = calculateArrow(offset);

    if(a_DistanceAndIndex.y > 4.0) {
      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);
    }
  }

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = lineDistance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,$S=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;

varying vec4 v_color;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"


varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,QS={solid:0,dash:1},oy=function(e){(0,Ir.Z)(r,e);var i=WS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.NEAREST,min:L.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.lineType,T=C===void 0?"solid":C,R=a.dashArray,F=R===void 0?[10,5,0,0]:R,G=a.lineTexture,q=G===void 0?!1:G,te=a.iconStep,Se=te===void 0?100:te,Ne=a.vertexHeightScale,Ke=Ne===void 0?20:Ne,it=a.borderWidth,St=it===void 0?0:it,Tt=a.borderColor,$t=Tt===void 0?"#ccc":Tt,sr=a.raisingHeight,Pr=sr===void 0?0:sr,$r=a.heightfixed,br=$r===void 0?!1:$r,mn=a.arrow,Mn=mn===void 0?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:mn;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Qn=0,Na=[0,0,0,0],qo=[0,0,0,0];if(p&&v&&(Na=bi(p),qo=bi(v),Qn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var ks=this.layer.getEncodedData(),Ds=this.calDataFrame(this.cellLength,ks,this.cellProperties),Ws=Ds.data,pf=Ds.width,gv=Ds.height;this.rowCount=gv,this.dataTexture=this.cellLength>0&&Ws.length>0?this.createTexture2D({flipY:!0,data:Ws,format:L.LUMINANCE,type:L.FLOAT,width:pf,height:gv}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_line_type:QS[T],u_dash_array:F,u_texture:this.texture,u_line_texture:q?1:0,u_icon_step:Se,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:St,u_borderColor:bi($t),u_linearColor:Qn,u_sourceColor:Na,u_targetColor:qo,u_heightfixed:Number(br),u_vertexScale:Ke,u_raisingHeight:Number(Pr),u_arrow:Number(Mn.enable),u_arrowHeight:Mn.arrowHeight||3,u_arrowWidth:Mn.arrowWidth||2,u_tailWidth:Mn.tailWidth===void 0?1:Mn.tailWidth}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),R=T.frag,F=T.vert,G=T.type;return this.layer.triangulation=Qd,[this.layer.buildLayerModel({moduleName:"line_"+G,vertexShader:F,fragmentShader:R,triangulation:Qd,primitive:L.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Ia(p,g)})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor,v=a.lineType;return v==="dash"?{frag:YS,vert:qS,type:"dash"}:s&&p?{frag:$S,vert:ay,type:"linear"}:{frag:KS,vert:ay,type:"normal"}}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:In.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x,C,T){return T===void 0?[g[3],10]:[g[3],T]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}})}}]),r}(bo);function JS(e){var i=eC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function eC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tC=`uniform float u_opacity : 1.0;
uniform sampler2D u_texture;

#pragma include "picking"

varying mat4 styleMappingMat;

void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = texture2D(u_texture, vec2(d_distance_ratio, 0.5));

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  gl_FragColor = filterColor(gl_FragColor);
}
`,rC=`
attribute float a_Miter;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

// dash line
attribute float a_Total_Distance;
attribute vec2 a_DistanceAndIndex;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_heightfixed: 0.0;
uniform float u_vertexScale: 1.0;
uniform float u_raisingHeight: 0.0;

uniform float u_opacity: 1.0;

#pragma include "projection"
#pragma include "picking"

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = currentLinePointRatio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,nC=function(e){(0,Ir.Z)(r,e);var i=JS(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"colorTexture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;n.colorTexture&&n.colorTexture.destroy();var g=n.layer.getLayerConfig(),x=g.rampColors,C=hl(x);n.colorTexture=v({data:new Uint8Array(C.data),width:C.width,height:C.height,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE,min:L.NEAREST,mag:L.NEAREST,flipY:!1})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.vertexHeightScale,v=p===void 0?20:p,g=a.raisingHeight,x=g===void 0?0:g,C=a.heightfixed,T=C===void 0?!1:C;if(this.rendererService.getDirty()&&this.colorTexture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var R=this.layer.getEncodedData(),F=this.calDataFrame(this.cellLength,R,this.cellProperties),G=F.data,q=F.width,te=F.height;this.rowCount=te,this.dataTexture=this.cellLength>0&&G.length>0?this.createTexture2D({flipY:!0,data:G,format:L.LUMINANCE,type:L.FLOAT,width:q,height:te}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_texture:this.colorTexture,u_heightfixed:Number(T),u_vertexScale:v,u_raisingHeight:Number(x)}}},{key:"initModels",value:function(){return this.updateTexture(),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.colorTexture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.depth,C=x===void 0?!1:x,T=this.getShaders(),R=T.frag,F=T.vert,G=T.type;return this.layer.triangulation=Qd,[this.layer.buildLayerModel({moduleName:"line_"+G,vertexShader:F,fragmentShader:R,triangulation:Qd,primitive:L.TRIANGLES,blend:this.getBlend(),depth:{enable:C},stencil:Ia(p,g)})]}},{key:"getShaders",value:function(){return{frag:tC,vert:rC,type:"linear_rampColors"}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:In.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g,x,C){return C===void 0?[v[3],10]:[v[3],C]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(bo);function iC(e){var i=aC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function aC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oC=`

uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,sC=`
varying vec4 v_color;
varying mat4 styleMappingMat;
void main() {
  float opacity = styleMappingMat[0][0];
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  gl_FragColor = v_color;
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
}
`,sy=`
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Position;


// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_vertexScale: 1.0;

#pragma include "projection"

varying vec4 v_color;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_color = a_Color;  

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // #define COORDINATE_SYSTEM_P20 5.0
    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0
    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
  }
}
`,uC=function(e){(0,Ir.Z)(r,e);var i=iC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.vertexHeightScale,x=g===void 0?20:g,C=0,T=[0,0,0,0],R=[0,0,0,0];if(p&&v&&(T=bi(p),R=bi(v),C=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var F=this.layer.getEncodedData(),G=this.calDataFrame(this.cellLength,F,this.cellProperties),q=G.data,te=G.width,Se=G.height;this.rowCount=Se,this.dataTexture=this.cellLength>0&&q.length>0?this.createTexture2D({flipY:!0,data:q,format:L.LUMINANCE,type:L.FLOAT,width:te,height:Se}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_linearColor:C,u_sourceColor:T,u_targetColor:R,u_vertexScale:x}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.sourceColor,p=a.targetColor;return s&&p?{frag:oC,vert:sy,type:"linear"}:{frag:sC,vert:sy,type:"normal"}}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"simpleline"+R,vertexShader:T,fragmentShader:C,triangulation:j2,primitive:L.LINES,blend:this.getBlend(),depth:{enable:!1},stencil:Ia(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:In.Attribute,descriptor:{name:"a_Distance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){return[v[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){return[v[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0],C[1]]:[C,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(s,p,v,g,x){return x}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){return[v[4]]}}})}}]),r}(bo);function lC(e){var i=cC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function cC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fC=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,pC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_float_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hC=function(e){(0,Ir.Z)(r,e);var i=lC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.NEAREST,min:L.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.sourceColor,v=a.targetColor,g=a.textureBlend,x=g===void 0?"normal":g,C=a.heightfixed,T=C===void 0?!1:C,R=a.lineTexture,F=R===void 0?!1:R,G=a.iconStep,q=G===void 0?100:G,te=a.iconStepCount,Se=te===void 0?1:te;this.rendererService.getDirty()&&this.texture.bind();var Ne=0,Ke=[0,0,0,0],it=[0,0,0,0];if(p&&v&&(Ke=bi(p),it=bi(v),Ne=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var St=this.layer.getEncodedData(),Tt=this.calDataFrame(this.cellLength,St,this.cellProperties),$t=Tt.data,sr=Tt.width,Pr=Tt.height;this.rowCount=Pr,this.dataTexture=this.cellLength>0&&$t.length>0?this.createTexture2D({flipY:!0,data:$t,format:L.LUMINANCE,type:L.FLOAT,width:sr,height:Pr}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_heightfixed:Number(T),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(s)?s:1,u_textureBlend:x==="normal"?0:1,u_texture:this.texture,u_line_texture:F?1:0,u_iconStepCount:Se,u_icon_step:q,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Ne,u_sourceColor:Ke,u_targetColor:it}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:pC,fragmentShader:fC,triangulation:Qd,primitive:L.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:In.Attribute,descriptor:{name:"a_Distance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){return[g[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:In.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){return[g[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=p.size,T=C===void 0?1:C;return Array.isArray(T)?[T[0],T[1]]:[T,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:In.Attribute,descriptor:{name:"a_Miter",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){return[g[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.texture,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}})}}]),r}(bo),dC={arc:wS,arcmini:zS,arc3d:kS,greatcircle:HS,wall:hC,line:oy,simple:uC,linearline:nC},vC=dC;function mC(e){var i=gC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function gC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yC=function(e){(0,Ir.Z)(r,e);var i=mC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","LineLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new vC[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[a]}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p||"line"}}]),r}(nh);function _C(e){var i=xC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function xC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bC=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;
uniform float u_pickLight: 0.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  if(u_pickLight > 0.0) {
    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,EC=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

 

  // vec2 offset = project_pixel(size.xy);
  // vec2 offset = (size.xy);

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    // offset = project_pixel(offset);
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);
  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  // float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;

  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,uy=function(e){(0,Ir.Z)(r,e);var i=_C(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"raiseCount",0),(0,A.Z)((0,de.Z)(n),"raiserepeat",0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,v=a.opacity,g=v===void 0?1:v,x=a.sourceColor,C=a.targetColor,T=a.pickLight,R=T===void 0?!1:T,F=a.heightfixed,G=F===void 0?!1:F,q=a.opacityLinear,te=q===void 0?{enable:!1,dir:"up"}:q,Se=a.lightEnable,Ne=Se===void 0?!0:Se;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var Ke=this.layer.getEncodedData(),it=this.calDataFrame(this.cellLength,Ke,this.cellProperties),St=it.data,Tt=it.width,$t=it.height;this.rowCount=$t,this.dataTexture=this.cellLength>0&&St.length>0?this.createTexture2D({flipY:!0,data:St,format:L.LUMINANCE,type:L.FLOAT,width:Tt,height:$t}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}var sr=0,Pr=[0,0,0,0],$r=[0,0,0,0];if(x&&C&&(Pr=bi(x),$r=bi(C),sr=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var br=p.speed,mn=br===void 0?.01:br,Mn=p.repeat,Qn=Mn===void 0?!1:Mn;this.raiseCount+=mn,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_pickLight:Number(R),u_heightfixed:Number(G),u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(g)?g:1,u_linearColor:sr,u_sourceColor:Pr,u_targetColor:$r,u_opacitylinear:Number(te.enable),u_opacitylinear_dir:te.dir==="up"?1:0,u_lightEnable:Number(Ne)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.depth,p=s===void 0?!0:s,v=a.animateOption.repeat,g=v===void 0?1:v;return this.raiserepeat=g,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:EC,fragmentShader:bC,triangulation:Ng,blend:this.getBlend(),cull:{enable:!0,face:Nl(this.mapService.version)},depth:{enable:p}})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v,g,x){var C=p.size;if(C){var T=[];return Array.isArray(C)&&(T=C.length===2?[C[0],C[0],C[1]]:C),Array.isArray(C)||(T=[C,C,C]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v,g,x,C){return C}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:In.Attribute,descriptor:{name:"a_Pos",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v){var g=kh(p.coordinates);return a?Pg([g[0],g[1]]):[g[0],g[1],0]}}})}}]),r}(bo);function SC(e){var i=CC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function CC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ly=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"

void main() {

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  
  outer_df = sdCircle(v_data.xy, 1.0);
  inner_df = sdCircle(v_data.xy, r);


  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

 gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  float d = length(v_data.xy);
  if(d > 0.5) {
    discard;
  }
  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
  
  // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
  if(u_additive > 0.0) {
    gl_FragColor *= intensity;
    // TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,AC=`
uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);
  } else {
    gl_FragColor.a *= opacity_t;
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,Dv=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;
uniform float u_raisingHeight: 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raiseHeight, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, u_raisingHeight, 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,cy=function(e){(0,Ir.Z)(r,e);var i=SC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"meter2coord",1),(0,A.Z)((0,de.Z)(n),"isMeter",!1),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,G=F===void 0?[0,0]:F,q=a.blend,te=a.blur,Se=te===void 0?0:te,Ne=a.raisingHeight,Ke=Ne===void 0?0:Ne;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:G})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:G});var it=this.layer.getEncodedData(),St=this.calDataFrame(this.cellLength,it,this.cellProperties),Tt=St.data,$t=St.width,sr=St.height;this.rowCount=sr,this.dataTexture=this.cellLength>0&&Tt.length>0?this.createTexture2D({flipY:!0,data:Tt,format:L.LUMINANCE,type:L.FLOAT,width:$t,height:sr}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_raisingHeight:Number(Ke),u_isMeter:Number(this.isMeter),u_blur:Se,u_additive:q==="additive"?1:0,u_globel:this.mapService.version===Ls.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_stroke_opacity:ha()(g)?g:1,u_stroke_width:ha()(C)?C:0,u_stroke_color:this.getStrokeColor(R),u_offsets:this.isOffsetStatic(G)?G:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Bh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),G=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),q=G.toLngLat();this.meter2coord=x[0]-q.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=a.animateOption,C=x===void 0?{enable:!1}:x,T=this.getShaders(C),R=T.frag,F=T.vert,G=T.type,q=this.mapService.version==="GLOBEL";return this.layer.triangulation=q?Bg:Bh,[this.layer.buildLayerModel({moduleName:"pointfill_"+G,vertexShader:F,fragmentShader:R,triangulation:q?Bg:Bh,depth:{enable:q},blend:this.getBlend(),stencil:Ia(p,g),cull:{enable:!0,face:Nl(this.mapService.version)}})]}},{key:"getShaders",value:function(a){if(a.enable)switch(a.type){case"wave":return{frag:ly,vert:Dv,type:"wave"};default:return{frag:ly,vert:Dv,type:"wave"}}else return{frag:AC,vert:Dv,type:"normal"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(v,g,x,C){var T;if(s){var R=(0,yn.Z)(x,3),F=R[0],G=R[1],q=R[2],te=qa.fromValues(0,0,1),Se=qa.fromValues(F,0,q),Ne=F>=0?qa.angle(te,Se):Math.PI*2-qa.angle(te,Se),Ke=Math.PI*2-Math.asin(G/100),it=Ki();nf(it,it,Ne),lp(it,it,Ke);var St=qa.fromValues(1,1,0);qa.transformMat4(St,St,it),qa.normalize(St,St);var Tt=qa.fromValues(-1,1,0);qa.transformMat4(Tt,Tt,it),qa.normalize(Tt,Tt);var $t=qa.fromValues(-1,-1,0);qa.transformMat4($t,$t,it),qa.normalize($t,$t);var sr=qa.fromValues(1,-1,0);qa.transformMat4(sr,sr,it),qa.normalize(sr,sr),T=[].concat((0,Ae.Z)(St),(0,Ae.Z)(Tt),(0,Ae.Z)($t),(0,Ae.Z)(sr))}else T=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Pr=C%4*3;return[T[Pr],T[Pr+1],T[Pr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(v,g,x,C){var T=v.size,R=T===void 0?5:T;return Array.isArray(R)?[R[0]*a.meter2coord]:[R*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:In.Attribute,descriptor:{name:"a_Shape",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(v,g,x,C){var T=v.shape,R=T===void 0?2:T,F=a.layer.getLayerConfig().shape2d,G=F.indexOf(R);return[G]}}})}}]),r}(bo);function wC(e){var i=TC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function TC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var MC=`uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv;

void main() {

  float opacity = styleMappingMat[0][0];

  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  gl_FragColor = texture2D(u_texture, pos);
  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,PC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute vec2 a_Uv;
attribute float a_Rotate;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform mat2 u_RotateMatrix;
uniform float u_isMeter;

varying float v_radius;
varying vec2 v_uv; // \u672C\u8EAB\u7684 uv \u5750\u6807
varying vec2 v_Iconuv; // icon \u8D34\u56FE\u7684 uv \u5750\u6807

uniform float u_opacity : 1;
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;

  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // radius(16-bit)
  v_radius = a_Size;

  // TODO: billboard
  // anti-alias
  

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);

  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,IC=function(e){(0,Ir.Z)(r,e);var i=wC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"meter2coord",1),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"isMeter",!1),(0,A.Z)((0,de.Z)(n),"radian",0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.LINEAR,min:L.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,G=F===void 0?[0,0]:F,q=a.blend,te=a.rotation;this.rendererService.getDirty()&&this.texture.bind();var Se=1;if((this.mapService.version==="GAODE2.x"||this.mapService.version==="GAODE1.x")&&(Se=-1),this.radian=te!==void 0?Se*Math.PI*te/180:Se*Math.PI*(this.mapService.getRotation()%360)/180,this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:G})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:G});var Ne=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,Ne,this.cellProperties),it=Ke.data,St=Ke.width,Tt=Ke.height;this.rowCount=Tt,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:L.LUMINANCE,type:L.FLOAT,width:St,height:Tt}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_additive:q==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(G)?G:[0,0]}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Bh)}},{key:"initModels",value:function(){this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture);var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),G=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),q=G.toLngLat();this.meter2coord=x[0]-q.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:T,fragmentShader:C,triangulation:Bh,depth:{enable:!1},blend:this.getBlend(),stencil:Ia(p,g),cull:{enable:!0,face:Nl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:MC,vert:PC,type:"normal"}}},{key:"clearModels",value:function(){var a,s;this.iconService.off("imageUpdate",this.updateTexture),(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:In.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.rotate,T=C===void 0?0:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.shape,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v,g,x){var C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}})}}]),r}(bo);function OC(e){var i=RC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function RC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,kC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,DC=function(e){(0,Ir.Z)(r,e);var i=OC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var a=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){a.updateTexture(),a.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:kC,fragmentShader:LC,triangulation:zg,primitive:L.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.fontService.mapping,T=p.shape,R=a.fontService.getGlyph(T),F=C[R],G=F.x,q=F.y;return[G,q]}}})}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=a({data:s,mag:L.LINEAR,min:L.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.fontWeight,v=p===void 0?"normal":p,g=s.fontFamily,x=g===void 0?"sans-serif":g,C=this.layer.getEncodedData(),T=[];C.forEach(function(R){var F=R.shape,G=F===void 0?"":F;G=G.toString();var q=a.fontService.getGlyph(G);T.indexOf(q)===-1&&T.push(q)}),this.fontService.setFontOptions({characterSet:T,fontWeight:v,fontFamily:x,fontSize:48})}}]),r}(bo);function FC(e){var i=BC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function BC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var NC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = styleMappingMat[1][0];
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,zC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,fy=function(e){(0,Ir.Z)(r,e);var i=FC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"updateTexture",function(){var v=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=v({data:n.iconService.getCanvas(),mag:L.LINEAR,min:L.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=a.offsets,v=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:v})){this.judgeStyleAttributes({opacity:s,offsets:v});var g=this.layer.getEncodedData(),x=this.calDataFrame(this.cellLength,g,this.cellProperties),C=x.data,T=x.width,R=x.height;this.rowCount=R,this.dataTexture=this.cellLength>0&&C.length>0?this.createTexture2D({flipY:!0,data:C,format:L.LUMINANCE,type:L.FLOAT,width:T,height:R}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:ha()(s)?s:1,u_offsets:this.isOffsetStatic(v)?v:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:zC,fragmentShader:NC,triangulation:zg,primitive:L.POINTS,depth:{enable:!1},blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(p,v,g,x){var C=a.iconService.getIconMap(),T=p.shape,R=C[T]||{x:0,y:0},F=R.x,G=R.y;return[F,G]}}})}}]),r}(bo);function UC(e){var i=ZC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var jC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,VC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function py(e){var i=e.coordinates;return{vertices:(0,Ae.Z)(i),indices:[0],size:i.length}}var hy=function(e){(0,Ir.Z)(r,e);var i=UC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:L.LUMINANCE,type:L.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=py,[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:VC,fragmentShader:jC,triangulation:py,depth:{enable:!1},primitive:L.POINTS,blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Mc.additive}}}]),r}(bo);function GC(e){var i=HC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function HC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var WC=`
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

#pragma include "sdf_2d"
#pragma include "picking"

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }

  if(gl_FragColor.a > 0.0) {
    gl_FragColor = filterColor(gl_FragColor);
  }

  vec2 extrude =  styleMappingMat[2].ba;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  // full circle
  // float rades = dot(dir, baseDir);
  // float flag = sign(dir.y);
  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;
  
  // half circle
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }



  gl_FragColor.a *= radar_v;
}
`,XC=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;
uniform float u_speed: 1.0;
uniform float u_time;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // empty - empty - empty - empty
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - a_Extrude.x - a_Extrude.y
    0.0, 0.0, 0.0, 0.0  // 
  );

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  styleMappingMat[2].ba = rotateMatrix * a_Extrude.xy;

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> empty -> empty ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;


  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec3 aPosition = a_Position;
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
    antialiasblur = max(antialiasblur, -0.01);
    // offset *= 0.5;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      aPosition.xy += offset;
      offset.x = 0.0;
      offset.y = 0.0;
    }
  }

  v_data = vec4(extrude.x, extrude.y, antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,YC=function(e){(0,Ir.Z)(r,e);var i=GC(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"meter2coord",1),(0,A.Z)((0,de.Z)(n),"isMeter",!1),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.strokeOpacity,g=v===void 0?1:v,x=a.strokeWidth,C=x===void 0?0:x,T=a.stroke,R=T===void 0?"rgba(0,0,0,0)":T,F=a.offsets,G=F===void 0?[0,0]:F,q=a.blend,te=a.speed,Se=te===void 0?1:te;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:G})){this.judgeStyleAttributes({opacity:p,strokeOpacity:g,strokeWidth:C,stroke:R,offsets:G});var Ne=this.layer.getEncodedData(),Ke=this.calDataFrame(this.cellLength,Ne,this.cellProperties),it=Ke.data,St=Ke.width,Tt=Ke.height;this.rowCount=Tt,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:L.LUMINANCE,type:L.FLOAT,width:St,height:Tt}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_speed:Se,u_additive:q==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(G)?G:[0,0]}}},{key:"getAnimateUniforms",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption,p=s===void 0?{enable:!1}:s;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Bh)}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.unit,p=s===void 0?"l7size":s,v=this.mapService.version;return p==="meter"&&v!==Ls.L7MAP&&v!==Ls.GLOBEL&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var a=(0,yn.Z)(this.layer.getSource().extent,4),s=a[0],p=a[1],v=a[2],g=a[3],x=[(s+v)/2,(p+g)/2],C=this.mapService.version;if(C===Ls.MAPBOX&&window.mapboxgl.MercatorCoordinate){var T=window.mapboxgl.MercatorCoordinate.fromLngLat({lng:x[0],lat:x[1]},0),R=1,F=R*T.meterInMercatorCoordinateUnits(),G=new window.mapboxgl.MercatorCoordinate(T.x-F,T.y,T.z),q=G.toLngLat();this.meter2coord=x[0]-q.lng;return}var te=this.mapService.meterToCoord(x,[s,p]),Se=this.mapService.meterToCoord(x,[v===s?v+.1:v,g===p?p+.1:g]);this.meter2coord=(te+Se)/2,Boolean(this.meter2coord)||(this.meter2coord=7.70681090738883)}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:"pointfill_"+R,vertexShader:T,fragmentShader:C,triangulation:Bh,depth:{enable:!1},blend:this.getBlend(),stencil:Ia(p,g),cull:{enable:!0,face:Nl(this.mapService.version)}})]}},{key:"getShaders",value:function(){return{frag:WC,vert:XC,type:"radar"}}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.speed||1,a.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var a=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:In.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(p,v,g,x){var C;C=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var T=x%4*3;return[C[T],C[T+1],C[T+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.size,T=C===void 0?5:C;return Array.isArray(T)?[T[0]*a.meter2coord]:[T*a.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:In.Attribute,descriptor:{name:"a_Shape",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(p,v,g,x){var C=p.shape,T=C===void 0?2:C,R=a.layer.getLayerConfig().shape2d,F=R.indexOf(T);return[F]}}})}}]),r}(bo);function qC(e){var i=KC();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function KC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $C=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,QC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function dy(e){var i=e.coordinates;return{vertices:(0,Ae.Z)(i),indices:[0],size:i.length}}var JC=function(e){(0,Ir.Z)(r,e);var i=qC(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.offsets,g=v===void 0?[0,0]:v,x=a.blend,C=a.strokeOpacity,T=C===void 0?1:C,R=a.strokeWidth,F=R===void 0?0:R,G=a.stroke,q=G===void 0?"#fff":G;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:g})){this.judgeStyleAttributes({opacity:p,offsets:g});var te=this.layer.getEncodedData(),Se=this.calDataFrame(this.cellLength,te,this.cellProperties),Ne=Se.data,Ke=Se.width,it=Se.height;this.rowCount=it,this.dataTexture=this.cellLength>0&&Ne.length>0?this.createTexture2D({flipY:!0,data:Ne,format:L.LUMINANCE,type:L.FLOAT,width:Ke,height:it}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_additive:x==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1,u_offsets:this.isOffsetStatic(g)?g:[0,0],u_stroke_opacity:ha()(T)?T:1,u_stroke_width:ha()(F)?F:0,u_stroke_color:this.getStrokeColor(q)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return this.layer.triangulation=dy,[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:QC,fragmentShader:$C,triangulation:dy,depth:{enable:!1},primitive:L.POINTS,blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?1:x;return Array.isArray(C)?[C[0]]:[C]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:Mc.additive}}}]),r}(bo);function eA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=tA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function tA(e,i){if(!!e){if(typeof e=="string")return vy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vy(e,i)}}function vy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var rA=function(){function e(i,r,n){(0,dt.Z)(this,e),(0,A.Z)(this,"boxCells",[]),(0,A.Z)(this,"xCellCount",void 0),(0,A.Z)(this,"yCellCount",void 0),(0,A.Z)(this,"boxKeys",void 0),(0,A.Z)(this,"bboxes",void 0),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"xScale",void 0),(0,A.Z)(this,"yScale",void 0),(0,A.Z)(this,"boxUid",void 0);var a=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)a.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,It.Z)(e,[{key:"insert",value:function(r,n,a,s,p){this.forEachCell(n,a,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!1,p)}},{key:"hitTest",value:function(r,n,a,s,p){return this.queryHitTest(r,n,a,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,a,s,p,v){this.boxCells[p].push(v)}},{key:"queryHitTest",value:function(r,n,a,s,p,v){if(a<0||r>this.width||s<0||n>this.height)return p?!1:[];var g=[];if(r<=0&&n<=0&&this.width<=a&&this.height<=s){if(p)return!0;for(var x=0;x<this.boxKeys.length;x++)g.push({key:this.boxKeys[x],x1:this.bboxes[x*4],y1:this.bboxes[x*4+1],x2:this.bboxes[x*4+2],y2:this.bboxes[x*4+3]});return v?g.filter(v):g}var C={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,a,s,this.queryCell,g,C,v),p?g.length>0:g}},{key:"queryCell",value:function(r,n,a,s,p,v,g,x){var C=g.seenUids,T=this.boxCells[p];if(T!==null){var R=this.bboxes,F=eA(T),G;try{for(F.s();!(G=F.n()).done;){var q=G.value;if(!C.box[q]){C.box[q]=!0;var te=q*4;if(r<=R[te+2]&&n<=R[te+3]&&a>=R[te+0]&&s>=R[te+1]&&(!x||x(this.boxKeys[q]))){if(g.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[q],x1:R[te],y1:R[te+1],x2:R[te+2],y2:R[te+3]})}}}}catch(Se){F.e(Se)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,n,a,s,p,v,g,x){for(var C=this.convertToXCellCoord(r),T=this.convertToYCellCoord(n),R=this.convertToXCellCoord(a),F=this.convertToYCellCoord(s),G=C;G<=R;G++)for(var q=T;q<=F;q++){var te=this.xCellCount*q+G;if(p.call(this,r,n,a,s,te,v,g,x))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),nA=rA,iA=function(){function e(i,r){(0,dt.Z)(this,e),(0,A.Z)(this,"width",void 0),(0,A.Z)(this,"height",void 0),(0,A.Z)(this,"grid",void 0),(0,A.Z)(this,"viewportPadding",100),(0,A.Z)(this,"screenRightBoundary",void 0),(0,A.Z)(this,"screenBottomBoundary",void 0),(0,A.Z)(this,"gridRightBoundary",void 0),(0,A.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new nA(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,It.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,a=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,a,s,p)||this.grid.hitTest(n,a,s,p)?{box:[]}:{box:[n,a,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var a={featureIndex:n};this.grid.insert(a,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,a){var s=Et(n,a,0,1),p=Te(),v=Zs.apply(ie,(0,Ae.Z)(r));return ln(p,s,v),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,a,s){return a>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function gy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=aA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function aA(e,i){if(!!e){if(typeof e=="string")return yy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yy(e,i)}}function yy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function _y(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function xy(e,i,r,n,a){if(!!a){var s=e[n],p=s.glyph;if(p)for(var v=i[p].advance*s.scale,g=(e[n].x+v)*a,x=r;x<=n;x++)e[x].x-=g}}function by(e,i,r,n,a,s,p){var v=(i-r)*a,g=(-n*p+.5)*s,x=gy(e),C;try{for(x.s();!(C=x.n()).done;){var T=C.value;T.x+=v,T.y+=g}}catch(R){x.e(R)}finally{x.f()}}function oA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Ne){if(Ne.split("").forEach(function(it){var St=i[it],Tt=0;St&&(T.push({glyph:it,x:g,y:x+Tt,vertical:!1,scale:1,metrics:St}),g+=St.advance+p)}),T.length!==F){var Ke=g-p;C=Math.max(Ke,C),xy(T,i,F,T.length-1,R)}g=0,x-=n+5});var G=_y(a),q=G.horizontalAlign,te=G.verticalAlign;by(T,R,q,te,C,n,r.length);var Se=x-v;e.top+=-te*Se,e.bottom=e.top-Se,e.left+=-q*C,e.right=e.left+C}function sA(e,i,r,n,a,s,p){var v=-8,g=0,x=v,C=0,T=e.positionedGlyphs,R=s==="right"?1:s==="left"?0:.5,F=T.length;r.forEach(function(Ne){var Ke=i[Ne],it=0;if(Ke&&(T.push({glyph:Ne,x:Ke.advance/2,y:x+it,vertical:!1,scale:1,metrics:Ke}),g+=Ke.advance+p),T.length!==F){var St=g-p;C=Math.max(St,C),xy(T,i,F,T.length-1,R)}g=0,x-=n+5});var G=_y(a),q=G.horizontalAlign,te=G.verticalAlign;by(T,R,q,te,C,n,r.length);var Se=x-v;e.top+=-te*Se,e.bottom=e.top-Se,e.left+=-q*C,e.right=e.left+C}function uA(e,i,r,n,a,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],v=arguments.length>7?arguments[7]:void 0,g=e.split(`
`),x=[],C={positionedGlyphs:x,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:g.length,text:e};return v?sA(C,i,g,r,n,a,s):oA(C,i,g,r,n,a,s),x.length?C:!1}function lA(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,a=n===void 0?[]:n,s=[],p=gy(a),v;try{for(p.s();!(v=p.n()).done;){var g=v.value,x=g.metrics,C=4,T=x.advance*g.scale/2,R=r?[g.x+T,g.y]:[0,0],F=r?[0,0]:[g.x+T+i[0],g.y+i[1]],G=(0-C)*g.scale-T+F[0],q=(0-C)*g.scale+F[1],te=G+x.width*g.scale,Se=q+x.height*g.scale,Ne={x:G,y:q},Ke={x:te,y:q},it={x:G,y:Se},St={x:te,y:Se};s.push({tl:Ne,tr:Ke,bl:it,br:St,tex:x,glyphOffset:R})}}catch(Tt){p.e(Tt)}finally{p.f()}return s}function cA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=fA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function fA(e,i){if(!!e){if(typeof e=="string")return Ey(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ey(e,i)}}function Ey(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function pA(e){var i=hA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function hA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Cy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_raisingHeight: 0.0;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));
  }

  gl_Position = vec4(
    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Ay(e){var i=this,r=e.id,n=[],a=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(v,g){n.push.apply(n,(0,Ae.Z)(p).concat([v.tex.x,v.tex.y+v.tex.height,v.tl.x,v.tl.y],(0,Ae.Z)(p),[v.tex.x+v.tex.width,v.tex.y+v.tex.height,v.tr.x,v.tr.y],(0,Ae.Z)(p),[v.tex.x+v.tex.width,v.tex.y,v.br.x,v.br.y],(0,Ae.Z)(p),[v.tex.x,v.tex.y,v.bl.x,v.bl.y])),a.push(0+g*4,1+g*4,2+g*4,2+g*4,3+g*4,0+g*4)}),{vertices:n,indices:a,size:7}}var wy=function(e){(0,Ir.Z)(r,e);var i=pA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"glyphInfo",void 0),(0,A.Z)((0,de.Z)(n),"glyphInfoMap",{}),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"currentZoom",-1),(0,A.Z)((0,de.Z)(n),"extent",void 0),(0,A.Z)((0,de.Z)(n),"textureHeight",0),(0,A.Z)((0,de.Z)(n),"textCount",0),(0,A.Z)((0,de.Z)(n),"preTextStyle",{}),(0,A.Z)((0,de.Z)(n),"buildModels",function(){var v=n.layer.getLayerConfig(),g=v.mask,x=g===void 0?!1:g,C=v.maskInside,T=C===void 0?!0:C;return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:Cy,fragmentShader:Sy,triangulation:Ay.bind((0,de.Z)(n)),depth:{enable:!1},blend:n.getBlend(),stencil:Ia(x,T)})]}),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.stroke,g=v===void 0?"#fff":v,x=a.strokeWidth,C=x===void 0?0:x,T=a.textAnchor,R=T===void 0?"center":T,F=a.textAllowOverlap,G=F===void 0?!1:F,q=a.halo,te=q===void 0?.5:q,Se=a.gamma,Ne=Se===void 0?2:Se,Ke=a.raisingHeight,it=Ke===void 0?0:Ke,St=this.fontService,Tt=St.canvas,$t=St.mapping;if(Object.keys($t).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys($t).length),this.preTextStyle={textAnchor:R,textAllowOverlap:G},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:C,stroke:g})){this.judgeStyleAttributes({opacity:p,strokeWidth:C,stroke:g});var sr=this.layer.getEncodedData(),Pr=this.calDataFrame(this.cellLength,sr,this.cellProperties),$r=Pr.data,br=Pr.width,mn=Pr.height;this.rowCount=mn,this.dataTexture=this.cellLength>0&&$r.length>0?this.createTexture2D({flipY:!0,data:$r,format:L.LUMINANCE,type:L.FLOAT,width:br,height:mn}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(it),u_opacity:ha()(p)?p:1,u_stroke_width:ha()(C)?C:0,u_stroke_color:this.getStrokeColor(g),u_sdf_map:this.texture,u_halo_blur:te,u_gamma_scale:Ne,u_sdf_map_size:[Tt.width,Tt.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var a=this.layer.getLayerConfig(),s=a.textAnchor,p=s===void 0?"center":s,v=a.textAllowOverlap,g=v===void 0?!0:v;return this.preTextStyle={textAnchor:p,textAllowOverlap:g},this.buildModels()}},{key:"needUpdate",value:function(){var a=this.layer.getLayerConfig(),s=a.textAllowOverlap,p=s===void 0?!1:s,v=this.mapService.getZoom(),g=this.mapService.getBounds(),x=Cn(this.extent,g);return!p&&(Math.abs(this.currentZoom-v)>1||!x)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:In.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.rotate,C=x===void 0?0:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:In.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){return[v[5],v[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(s,p,v,g){var x=s.size,C=x===void 0?12:x;return Array.isArray(C)?[C[0]]:[C]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:In.Attribute,descriptor:{name:"a_tex",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"textExtent",value:function(){var a=this.mapService.getBounds();return On(a,.5)}},{key:"initTextFont",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F=F.toString();var G=cA(F),q;try{for(G.s();!(q=G.n()).done;){var te=q.value;C.indexOf(te)===-1&&C.push(te)}}catch(Se){G.e(Se)}finally{G.f()}}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!1})}},{key:"initIconFontTex",value:function(){var a=this.layer.getLayerConfig(),s=a.fontWeight,p=s===void 0?"400":s,v=a.fontFamily,g=v===void 0?"sans-serif":v,x=this.layer.getEncodedData(),C=[];x.forEach(function(T){var R=T.shape,F=R===void 0?"":R;F="".concat(F),C.indexOf(F)===-1&&C.push(F)}),this.fontService.setFontOptions({characterSet:C,fontWeight:p,fontFamily:g,iconfont:!0})}},{key:"generateGlyphLayout",value:function(a){var s=this,p=this.fontService.mapping,v=this.layer.getLayerConfig(),g=v.spacing,x=g===void 0?2:g,C=v.textAnchor,T=C===void 0?"center":C,R=this.layer.getEncodedData();this.glyphInfo=R.map(function(F){var G=F.shape,q=G===void 0?"":G,te=F.id,Se=F.size,Ne=Se===void 0?1:Se,Ke=F.textOffset,it=Ke===void 0?[0,0]:Ke,St=uA(q.toString(),p,Ne,T,"left",x,it,a),Tt=lA(St,it,!1);return F.shaping=St,F.glyphQuads=Tt,F.centroid=kh(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?kh(F.originCoordinates):F.originCentroid=F.centroid,s.glyphInfoMap[te]={shaping:St,glyphQuads:Tt,centroid:kh(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.padding,v=p===void 0?[4,4]:p,g=s.textAllowOverlap,x=g===void 0?!1:g;if(!x){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var C=this.rendererService.getViewportSize(),T=C.width,R=C.height,F=new iA(T,R),G=this.glyphInfo.filter(function(q){var te=q.shaping,Se=q.id,Ne=Se===void 0?0:Se,Ke=q.version==="GAODE2.x"?q.originCentroid:q.centroid,it=q.size,St=it/24,Tt=a.mapService.lngLatToContainer(Ke),$t=F.placeCollisionBox({x1:te.left*St-v[0],x2:te.right*St+v[0],y1:te.top*St-v[1],y2:te.bottom*St+v[1],anchorPointX:Tt.x,anchorPointY:Tt.y}),sr=$t.box;return sr&&sr.length?(F.insertCollisionBox(sr,Ne),!0):!1});G.forEach(function(q){a.glyphInfoMap[q.id]=q})}}},{key:"initGlyph",value:function(){var a=this.layer.getLayerConfig(),s=a.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var a=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=a({data:s,mag:L.LINEAR,min:L.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Cy,fragmentShader:Sy,triangulation:Ay.bind(this),depth:{enable:!1},blend:this.getBlend(),stencil:Ia(p,g)})]}}]),r}(bo),dA={fillImage:IC,fill:cy,radar:YC,image:fy,normal:hy,simplePoint:JC,extrude:uy,text:wy,icon:DC},vA=dA;function mA(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gA(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(x){throw x},f:a}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,v;return{s:function(){r=r.call(e)},n:function(){var x=r.next();return s=x.done,x},e:function(x){p=!0,v=x},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw v}}}}function gA(e,i){if(!!e){if(typeof e=="string")return Ty(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ty(e,i)}}function Ty(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function yA(e){var i=_A();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function _A(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xA=function(e){(0,Ir.Z)(r,e);var i=yA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","PointLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new vA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var a=this.shapeOption,s=a.field,p=a.values,v=this.getLayerConfig(),g=v.shape2d,x=v.shape3d,C=this.iconService.getIconMap();if(s&&(g==null?void 0:g.indexOf(s))!==-1)return"fill";if(p&&p instanceof Array){var T=mA(p),R;try{for(T.s();!(R=T.n()).done;){var F=R.value;if(typeof F=="string"&&C.hasOwnProperty(F))return"image"}}catch(G){T.e(G)}finally{T.f()}}}return"normal"}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[a]}},{key:"getModelType",value:function(){var a=["fillImage","fill","radar","image","normal","simplePoint","extrude","text","icon"];if(this.layerType&&a.includes(this.layerType))return this.layerType;var s=this.getEncodedData(),p=this.getLayerConfig(),v=p.shape2d,g=p.shape3d,x=this.iconService.getIconMap(),C=s.find(function(R){return R.hasOwnProperty("shape")});if(C){var T=C.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":T==="fillImage"?"fillImage":(v==null?void 0:v.indexOf(T))!==-1?"fill":(g==null?void 0:g.indexOf(T))!==-1?"extrude":x.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return this.getModelTypeWillEmptyData()}}]),r}(nh);function bA(e){var i=EA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function EA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];  
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }

  } else {
     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,CA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  if(styleMappingMat[0][3] < 1.0 ) {
    // side
    styleMappingMat[0][0] = 0.0;
  } else {

  }

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,AA=`uniform sampler2D u_texture;
uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float lightWeight = styleMappingMat[3][1];
  float topU = styleMappingMat[2][2];
  float topV = styleMappingMat[2][3];

  float sidey = styleMappingMat[3][0];
  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      gl_FragColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    gl_FragColor = texture2D(u_texture, vec2(topU, topV));
  }
  

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,wA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  v_Color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - a_Position.z(judge side by a_Position.z)
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1] - u - v
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[2][2] = a_uvs[0];
  styleMappingMat[2][3] = 1.0 - a_uvs[1];
  styleMappingMat[3][0] = a_uvs[2];


  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // project_pos.z += 500000.0; // amap1

  // project_pos.z += (500000.0 * 4.0)/pow(2.0, 21.0 - u_Zoom); // mapbox
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,TA=`uniform float u_opacity: 1.0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;
uniform float u_linearColor: 0;

uniform float u_topsurface: 1.0;
uniform float u_sidesurface: 1.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float isSide = styleMappingMat[0][3];
  float sidey = styleMappingMat[3][0];
  float lightWeight = styleMappingMat[3][1];

  if(isSide < 1.0) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      gl_FragColor = linearColor;
    } else {
      // side notuse linear
       gl_FragColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    gl_FragColor = v_Color;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);
}
`,MA=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
attribute vec3 a_uvs;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
uniform float u_raisingHeight: 0.0;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - isSide
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // sidey
  );
  styleMappingMat[0][3] = a_Position.z;
  styleMappingMat[3][0] = a_uvs[2];

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  styleMappingMat[3][1] = lightWeight;

  setPickingColor(a_PickingColor);
}
`,PA=function(e){(0,Ir.Z)(r,e);var i=bA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.heightfixed,g=v===void 0?!1:v,x=a.raisingHeight,C=x===void 0?0:x,T=a.topsurface,R=T===void 0?!0:T,F=a.sidesurface,G=F===void 0?!0:F,q=a.sourceColor,te=a.targetColor;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Se=this.layer.getEncodedData(),Ne=this.calDataFrame(this.cellLength,Se,this.cellProperties),Ke=Ne.data,it=Ne.width,St=Ne.height;this.rowCount=St,this.dataTexture=this.cellLength>0&&Ke.length>0?this.createTexture2D({flipY:!0,data:Ke,format:L.LUMINANCE,type:L.FLOAT,width:it,height:St}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}var Tt=0,$t=[1,1,1,1],sr=[1,1,1,1];return q&&te&&($t=bi(q),sr=bi(te),Tt=1),{u_topsurface:Number(R),u_sidesurface:Number(G),u_heightfixed:Number(g),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(C),u_opacity:ha()(p)?p:1,u_linearColor:Tt,u_sourceColor:$t,u_targetColor:sr,u_texture:this.texture}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.getShaders(),C=x.frag,T=x.vert,R=x.type;return[this.layer.buildLayerModel({moduleName:R,vertexShader:T,fragmentShader:C,triangulation:Zg,stencil:Ia(p,g),cull:{enable:!0,face:L.BACK}})]}},{key:"getShaders",value:function(){var a=this.layer.getLayerConfig(),s=a.pickLight,p=a.mapTexture;return p?{frag:AA,vert:wA,type:"polygonExtrudeTexture"}:s?{frag:TA,vert:MA,type:"polygonExtrude"}:{frag:SA,vert:CA,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var a,s;(a=this.dataTexture)===null||a===void 0||a.destroy(),(s=this.texture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,yn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"uvs",type:In.Attribute,descriptor:{name:"a_uvs",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(F,G,q,te,Se){var Ne=q[0],Ke=q[1];return[(Ne-p)/C,(Ke-v)/T,q[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:In.Attribute,descriptor:{name:"a_Normal",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(F,G,q,te,Se){return Se}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:In.Attribute,descriptor:{name:"a_Size",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(F,G,q,te){var Se=F.size,Ne=Se===void 0?10:Se;return Array.isArray(Ne)?[Ne[0]]:[Ne]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.mapTexture,v=this.rendererService.createTexture2D;if(this.texture=v({height:0,width:0}),p){var g=new Image;g.crossOrigin="",g.src=p,g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:L.CLAMP_TO_EDGE,wrapT:L.CLAMP_TO_EDGE,min:L.LINEAR,mag:L.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}}]),r}(bo);function IA(e){var i=OA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function OA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var RA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,LA=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,kA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,DA=`attribute vec4 a_Color;
attribute vec3 a_Position;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

uniform float u_opacity: 1.0;
uniform float u_raisingHeight: 0.0;

varying vec4 v_Color;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,FA=function(e){(0,Ir.Z)(r,e);var i=IA(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.raisingHeight,p=s===void 0?0:s,v=a.opacity,g=v===void 0?1:v,x=a.opacityLinear,C=x===void 0?{enable:!1,dir:"in"}:x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:g})){this.judgeStyleAttributes({opacity:g});var T=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,T,this.cellProperties),F=R.data,G=R.width,q=R.height;this.rowCount=q,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:L.LUMINANCE,type:L.FLOAT,width:G,height:q}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_raisingHeight:Number(p),u_opacity:ha()(g)?g:1,u_opacitylinear:Number(C.enable),u_dir:C.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s,v=a.mask,g=v===void 0?!1:v,x=a.maskInside,C=x===void 0?!0:x;return this.layer.triangulation=p.enable?Ug:Jd,[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?kA:DA,fragmentShader:p.enable?LA:RA,triangulation:p.enable?Ug:Jd,blend:this.getBlend(),depth:{enable:!1},cull:{enable:!0,face:L.BACK},stencil:Ia(g,C)})]}},{key:"clearModels",value:function(){var a;(a=this.dataTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getLayerConfig(),s=a.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:In.Attribute,descriptor:{name:"a_linear",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:3,update:function(g,x,C,T,R){return[C[3],C[4],C[5]]}}})}}]),r}(bo);function BA(e){var i=NA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function NA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zA=`
uniform float u_time;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;
// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)
// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)
uniform vec4 u_watercolor;
uniform vec4 u_watercolor2;
vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture2D(u_texture2,p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture2D(u_texture1,fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    

  float opacity = styleMappingMat[0][0];
  gl_FragColor = vec4(col, opacity);

  // gl_FragColor = v_Color;
  
}
`,UA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,ZA=function(e){(0,Ir.Z)(r,e);var i=BA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture1",void 0),(0,A.Z)((0,de.Z)(n),"texture2",void 0),(0,A.Z)((0,de.Z)(n),"texture3",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.watercolor,g=v===void 0?"#6D99A8":v,x=a.watercolor2,C=x===void 0?"#0F121C":x;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var T=this.layer.getEncodedData(),R=this.calDataFrame(this.cellLength,T,this.cellProperties),F=R.data,G=R.width,q=R.height;this.rowCount=q,this.dataTexture=this.cellLength>0&&F.length>0?this.createTexture2D({flipY:!0,data:F,format:L.LUMINANCE,type:L.FLOAT,width:G,height:q}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:bi(g),u_watercolor2:bi(C),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:ha()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_ocean",vertexShader:UA,fragmentShader:zA,triangulation:Jd,depth:{enable:!1},stencil:Ia(p,g)})]}},{key:"clearModels",value:function(){var a,s,p,v;(a=this.texture1)===null||a===void 0||a.destroy(),(s=this.texture2)===null||s===void 0||s.destroy(),(p=this.texture3)===null||p===void 0||p.destroy(),(v=this.dataTexture)===null||v===void 0||v.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,yn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:In.Attribute,descriptor:{name:"a_uv",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(F,G,q,te,Se){var Ne=(0,yn.Z)(q,2),Ke=Ne[0],it=Ne[1];return[(Ke-p)/C,(it-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.rendererService.createTexture2D,p={height:0,width:0};this.texture1=s(p),this.texture2=s(p),this.texture3=s(p),v(function(x){a.texture1=g(x[0]),a.texture2=g(x[1]),a.texture3=g(x[2]),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()});function v(x){var C=0,T=[],R=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];R.map(function(F){var G=new Image;G.crossOrigin="",G.src=F,T.push(G),G.onload=function(){C++,C===3&&x(T)}})}function g(x){return s({data:x,width:x.width,height:x.height,wrapS:L.MIRRORED_REPEAT,wrapT:L.MIRRORED_REPEAT,min:L.LINEAR,mag:L.LINEAR})}}}]),r}(bo);function jA(e){var i=VA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function VA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GA=`
uniform sampler2D u_texture;
uniform float u_time;
uniform float u_speed: 1.0;
uniform float u_opacity: 1.0;

varying vec4 v_Color;
varying vec2 v_uv;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

  float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

  float water(vec3 p) {
    float t = u_time * u_speed;
    p.z += t * 2.; p.x += t * 2.;
    vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 3.; p.x += t * 0.52;
    vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;
    p.z += t * 4.; p.x += t * 0.8;
    vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;
    c1 += c2 - c3;
    float z = (c1.x + c1.y + c1.z) / 3.;
    return p.y + z / 4.;
  }

  float map(vec3 p) {
    float d = 100.0;
    d = water(p);
    return d;
  }

  float intersect(vec3 ro, vec3 rd) {
    float d = 0.0;
    for (int i = 0; i <= 100; i++) {
      float h = map(ro + rd * d);
      if (h < 0.1) return  d;
      d += h;
    }
    return 0.0;
  }
  
  vec3 norm(vec3 p) {
    float eps = .1;
    return normalize(vec3(
      map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
      map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
      map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
    ));
  } 

  float calSpc() {
    vec3 l1 = normalize(vec3(1, 1, 1));
    vec3 ro = vec3(-3, 20, -8);
    vec3 rc = vec3(0, 0, 0);
    vec3 ww = normalize(rc - ro);
    vec3 uu = normalize(cross(vec3(0,1,0), ww));
    vec3 vv = normalize(cross(rc - ro, uu));
    vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
    float d = intersect(ro, rd);
    vec3 p = ro + rd * d;
    vec3 n = norm(p);
    float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
    return spc;
  }

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;

  float spc = calSpc();
  gl_FragColor += spc * 0.4;
}
`,HA=`attribute vec4 a_Color;
attribute vec2 a_uv;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
varying vec2 v_uv;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  v_uv = a_uv;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,WA=function(e){(0,Ir.Z)(r,e);var i=jA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.speed,g=v===void 0?.5:v;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var x=this.layer.getEncodedData(),C=this.calDataFrame(this.cellLength,x,this.cellProperties),T=C.data,R=C.width,F=C.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:L.LUMINANCE,type:L.FLOAT,width:R,height:F}):this.createTexture2D({flipY:!0,data:[1],format:L.LUMINANCE,type:L.FLOAT,width:1,height:1})}return{u_texture:this.texture,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_speed:g,u_opacity:ha()(p)?p:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.loadTexture(),this.buildModels()}},{key:"buildModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v;return[this.layer.buildLayerModel({moduleName:"polygon_water",vertexShader:HA,fragmentShader:GA,triangulation:Jd,depth:{enable:!1},stencil:Ia(p,g)})]}},{key:"clearModels",value:function(){var a,s;(a=this.texture)===null||a===void 0||a.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var a=this.layer.getSource().extent,s=(0,yn.Z)(a,4),p=s[0],v=s[1],g=s[2],x=s[3],C=g-p,T=x-v;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:In.Attribute,descriptor:{name:"a_uv",buffer:{usage:L.STATIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(F,G,q,te,Se){var Ne=(0,yn.Z)(q,2),Ke=Ne[0],it=Ne[1];return[(Ke-p)/C,(it-v)/T]}}})}},{key:"loadTexture",value:function(){var a=this,s=this.layer.getLayerConfig(),p=s.waterTexture,v=this.rendererService.createTexture2D;this.texture=v({height:0,width:0});var g=new Image;g.crossOrigin="",p?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),g.src=p):g.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",g.onload=function(){a.texture=v({data:g,width:g.width,height:g.height,wrapS:L.MIRRORED_REPEAT,wrapT:L.MIRRORED_REPEAT,min:L.LINEAR,mag:L.LINEAR}),a.layerService.updateLayerRenderList(),a.layerService.renderLayers()}}}]),r}(bo),XA={fill:FA,line:oy,extrude:PA,text:wy,point_fill:cy,point_image:fy,point_normal:hy,point_extrude:uy,water:WA,ocean:ZA},YA=XA;function qA(e){var i=KA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function KA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var My=function(e){(0,Ir.Z)(r,e);var i=qA(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","PolygonLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new YA[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var a,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(a=s.scale)===null||a===void 0?void 0:a.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="water"?"water":p==="ocean"?"ocean":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var a=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,v=s.shape3d,g=this.iconService.getIconMap(),x=a.find(function(T){return T.hasOwnProperty("shape")});if(x){var C=x.shape;return C==="dot"?"point_normal":(p==null?void 0:p.indexOf(C))!==-1?"point_fill":(v==null?void 0:v.indexOf(C))!==-1?"point_extrude":g.hasOwnProperty(C)?"point_image":"text"}else return"fill"}}]),r}(nh);function $A(e){var i=QA();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function QA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JA=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,ew=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Py=function(e){(0,Ir.Z)(r,e);var i=$A(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"texture",void 0),(0,A.Z)((0,de.Z)(n),"colorTexture",void 0),n}return(0,It.Z)(r,[{key:"getUninforms",value:function(){var a=this.layer.getLayerConfig(),s=a.opacity,p=s===void 0?1:s,v=a.clampLow,g=v===void 0?!0:v,x=a.clampHigh,C=x===void 0?!0:x,T=a.noDataValue,R=T===void 0?-9999999:T,F=a.domain,G=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:G,u_clampLow:g,u_clampHigh:typeof C!="undefined"?C:g,u_noDataValue:R,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var a=this.layer.getLayerConfig(),s=a.mask,p=s===void 0?!1:s,v=a.maskInside,g=v===void 0?!0:v,x=this.layer.getSource(),C=this.rendererService.createTexture2D,T=x.data.dataArray[0];this.texture=C({data:T.data,width:T.width,height:T.height,format:L.LUMINANCE,type:L.FLOAT});var R=this.layer.getLayerConfig(),F=R.rampColors,G=hl(F);return this.colorTexture=C({data:G.data,width:G.width,height:G.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:ew,fragmentShader:JA,triangulation:Vg,primitive:L.TRIANGLES,depth:{enable:!1},blend:this.getBlend(),stencil:Ia(p,g)})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:In.Attribute,descriptor:{name:"a_Uv",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:2,update:function(s,p,v,g){return[v[3],v[4]]}}})}},{key:"updateColorTexure",value:function(){var a=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,v=hl(p);this.colorTexture=a({data:v.data,width:v.width,height:v.height,flipY:!1})}}]),r}(bo),tw={raster:Py,raster3d:Py},rw=tw;function nw(e){var i=iw();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function iw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aw=function(e){(0,Ir.Z)(r,e);var i=nw(r);function r(){var n;(0,dt.Z)(this,r);for(var a=arguments.length,s=new Array(a),p=0;p<a;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,A.Z)((0,de.Z)(n),"type","RasterLayer"),n}return(0,It.Z)(r,[{key:"buildModels",value:function(){var a=this.getModelType();this.layerModel=new rw[a](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var a=this.getModelType(),s={raster:{},raster3d:{}};return s[a]}},{key:"getModelType",value:function(){return"raster"}}]),r}(nh),Iy,Oy,Ry,Ly,ky,n0,Dy,Fy,By;function Ny(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ow(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ny(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ny(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var sw=(Iy=(0,Wr.b2)(),Oy=(0,Wr.f3)(Ht.IGlobalConfigService),Ry=(0,Wr.f3)(Ht.IMapService),Ly=(0,Wr.f3)(Ht.IFontService),Iy(ky=(n0=function(){function e(){(0,dt.Z)(this,e),Nn(this,"configService",Dy,this),Nn(this,"mapService",Fy,this),Nn(this,"fontService",By,this)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){a.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,a.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=v.filter(function(R){return R.needRemapping}),T=x;g!=null&&g.needRemapping&&g!==null&&g!==void 0&&g.scale&&(T=x.filter(function(R){return a.applyAttributeMapping(g,R,p)[0]})),C.length&&(g!=null&&g.needRemapping?(r.setEncodedData(a.mapping(v,T,void 0,p,r)),g.needRemapping=!1):r.setEncodedData(a.mapping(C,T,r.getEncodedData(),p,r)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var a=this,s=n.styleAttributeService,p=r.getBottomColor(),v=s.getLayerStyleAttributes()||[],g=s.getLayerStyleAttribute("filter"),x=r.getSource().data.dataArray,C=x;g!=null&&g.scale&&(C=x.filter(function(T){return a.applyAttributeMapping(g,T,p)[0]})),r.setEncodedData(this.mapping(v,C,void 0,p,r)),r.emit("dataUpdate",null)}},{key:"getArrowPoints",value:function(r,n){var a=[n[0]-r[0],n[1]-r[1]],s=Qo(a),p=[r[0]+s[0]*1e-4,r[1]+s[1]*1e-4];return p}},{key:"mapping",value:function(r,n,a,s,p){var v=this,g=p==null?void 0:p.getLayerConfig(),x=g.arrow,C=x===void 0?{enable:!1}:x,T=n.map(function(R,F){var G=a?a[F]:{},q=ow({id:R._id,coordinates:R.coordinates},G);if(r.filter(function(Ne){return Ne.scale!==void 0}).forEach(function(Ne){var Ke=v.applyAttributeMapping(Ne,R,s);Ne.needRemapping=!1,Ne.name==="color"&&(Ke=Ke.map(function(it){return bi(it)})),q[Ne.name]=Array.isArray(Ke)&&Ke.length===1?Ke[0]:Ke,Ne.name==="shape"&&(q.shape=v.fontService.getIconFontKey(q[Ne.name]))}),q.shape==="line"&&C.enable){var te=q.coordinates,Se=v.getArrowPoints(te[0],te[1]);q.coordinates.splice(1,0,Se,Se)}return q});return this.adjustData2Amap2Coordinates(T),this.adjustData2SimpleCoordinates(T),T}},{key:"adjustData2Amap2Coordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Ls["GAODE2.x"]&&(typeof r[0].coordinates[0]=="number"?r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Ls["GAODE2.x"],a.originCoordinates=X()(a.coordinates),a.coordinates=n.mapService.lngLatToCoord(a.coordinates)}):r.filter(function(a){return!a.originCoordinates}).map(function(a){a.version=Ls["GAODE2.x"],a.originCoordinates=X()(a.coordinates),a.coordinates=n.mapService.lngLatToCoords(a.coordinates)}))}},{key:"adjustData2SimpleCoordinates",value:function(r){var n=this;r.length>0&&this.mapService.version===Ls.SIMPLE&&r.map(function(a){a.simpleCoordinate||(a.coordinates=n.unProjectCoordinates(a.coordinates),a.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(r){var n=this;if(typeof r[0]=="number")return this.mapService.simpleMapCoord.unproject(r);if(r[0]&&r[0][0]instanceof Array){var a=[];return r.map(function(p){var v=[];p.map(function(g){v.push(n.mapService.simpleMapCoord.unproject(g))}),a.push(v)}),a}else{var s=[];return r.map(function(p){s.push(n.mapService.simpleMapCoord.unproject(p))}),s}}},{key:"applyAttributeMapping",value:function(r,n,a){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],v=[];p.forEach(function(x){var C,T=x.field;(n.hasOwnProperty(T)||((C=r.scale)===null||C===void 0?void 0:C.type)==="variable")&&v.push(n[T])});var g=r.mapping?r.mapping(v):[];return r.name==="color"&&!vu(g[0])?[a]:g}}]),e}(),Dy=si(n0.prototype,"configService",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=si(n0.prototype,"mapService",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=si(n0.prototype,"fontService",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n0))||ky),zy,Uy,uw=(zy=(0,Wr.b2)(),zy(Uy=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"mapService",void 0)}return(0,It.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Ht.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var a=r.getSource();if(!a){var s=r.sourceOption||{data:Xh,options:ch},p=s.data,v=s.options;r.setSource(new fh(p,v))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var a=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,a||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),a=n.cluster,s=n.clusterOptions,p=s.zoom,v=p===void 0?0:p,g=s.maxZoom,x=g===void 0?16:g,C=this.mapService.getZoom()-1,T=r.dataState.dataSourceNeedUpdate;return a&&(T||Math.abs(r.clusterZoom-C)>=1)?(v!==Math.floor(C)&&n.updateClusterData(Math.floor(C)),r.clusterZoom=C,!0):!1}}]),e}())||Uy);function Fv(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Zy(e){return e.length===1&&(e=lw(e)),{left:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)<0?n=s+1:a=s}return n},right:function(i,r,n,a){for(n==null&&(n=0),a==null&&(a=i.length);n<a;){var s=n+a>>>1;e(i[s],r)>0?a=s:n=s+1}return n}}}function lw(e){return function(i,r){return Fv(e(i),r)}}var jy=Zy(Fv),cw=jy.right,iP=jy.left,G0=cw;function fw(e,i){var r=e.length,n=-1,a,s,p;if(i==null){for(;++n<r;)if((a=e[n])!=null&&a>=a)for(s=p=a;++n<r;)(a=e[n])!=null&&(s>a&&(s=a),p<a&&(p=a))}else for(;++n<r;)if((a=i(e[n],n,e))!=null&&a>=a)for(s=p=a;++n<r;)(a=i(e[n],n,e))!=null&&(s>a&&(s=a),p<a&&(p=a));return[s,p]}var Vy=Array.prototype,aP=Vy.slice,oP=Vy.map,Bv=Math.sqrt(50),Nv=Math.sqrt(10),zv=Math.sqrt(2);function Gy(e,i,r){var n,a=-1,s,p,v;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(v=H0(e,i,r))===0||!isFinite(v))return[];if(v>0)for(e=Math.ceil(e/v),i=Math.floor(i/v),p=new Array(s=Math.ceil(i-e+1));++a<s;)p[a]=(e+a)*v;else for(e=Math.floor(e*v),i=Math.ceil(i*v),p=new Array(s=Math.ceil(e-i+1));++a<s;)p[a]=(e-a)/v;return n&&p.reverse(),p}function H0(e,i,r){var n=(i-e)/Math.max(0,r),a=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,a);return a>=0?(s>=Bv?10:s>=Nv?5:s>=zv?2:1)*Math.pow(10,a):-Math.pow(10,-a)/(s>=Bv?10:s>=Nv?5:s>=zv?2:1)}function Uv(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),a=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/a;return s>=Bv?a*=10:s>=Nv?a*=5:s>=zv&&(a*=2),i<e?-a:a}function sP(){var e=identity,i=extent,r=sturges;function n(a){var s,p=a.length,v,g=new Array(p);for(s=0;s<p;++s)g[s]=e(a[s],s,a);var x=i(g),C=x[0],T=x[1],R=r(g,C,T);Array.isArray(R)||(R=tickStep(C,T,R),R=range(Math.ceil(C/R)*R,T,R));for(var F=R.length;R[0]<=C;)R.shift(),--F;for(;R[F-1]>T;)R.pop(),--F;var G=new Array(F+1),q;for(s=0;s<=F;++s)q=G[s]=[],q.x0=s>0?R[s-1]:C,q.x1=s<F?R[s]:T;for(s=0;s<p;++s)v=g[s],C<=v&&v<=T&&G[bisect(R,v,0,F)].push(a[s]);return G}return n.value=function(a){return arguments.length?(e=typeof a=="function"?a:constant(a),n):e},n.domain=function(a){return arguments.length?(i=typeof a=="function"?a:constant([a[0],a[1]]),n):i},n.thresholds=function(a){return arguments.length?(r=typeof a=="function"?a:Array.isArray(a)?constant(slice.call(a)):constant(a),n):r},n}function uP(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function pw(e){return e===null?NaN:+e}function hw(e,i,r){if(r==null&&(r=pw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*i,s=Math.floor(a),p=+r(e[s],s,e),v=+r(e[s+1],s+1,e);return p+(v-p)*(a-s)}}var Rc="$";function W0(){}W0.prototype=Hy.prototype={constructor:W0,has:function(e){return Rc+e in this},get:function(e){return this[Rc+e]},set:function(e,i){return this[Rc+e]=i,this},remove:function(e){var i=Rc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===Rc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===Rc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===Rc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===Rc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===Rc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Rc)return!1;return!0},each:function(e){for(var i in this)i[0]===Rc&&e(this[i],i.slice(1),this)}};function Hy(e,i){var r=new W0;if(e instanceof W0)e.each(function(v,g){r.set(g,v)});else if(Array.isArray(e)){var n=-1,a=e.length,s;if(i==null)for(;++n<a;)r.set(n,e[n]);else for(;++n<a;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var Zv=Hy;function lP(){var e=[],i=[],r,n,a;function s(v,g,x,C){if(g>=e.length)return r!=null&&v.sort(r),n!=null?n(v):v;for(var T=-1,R=v.length,F=e[g++],G,q,te=map(),Se,Ne=x();++T<R;)(Se=te.get(G=F(q=v[T])+""))?Se.push(q):te.set(G,[q]);return te.each(function(Ke,it){C(Ne,it,s(Ke,g,x,C))}),Ne}function p(v,g){if(++g>e.length)return v;var x,C=i[g-1];return n!=null&&g>=e.length?x=v.entries():(x=[],v.each(function(T,R){x.push({key:R,values:p(T,g)})})),C!=null?x.sort(function(T,R){return C(T.key,R.key)}):x}return a={object:function(v){return s(v,0,dw,vw)},map:function(v){return s(v,0,Wy,Xy)},entries:function(v){return p(s(v,0,Wy,Xy),0)},key:function(v){return e.push(v),a},sortKeys:function(v){return i[e.length-1]=v,a},sortValues:function(v){return r=v,a},rollup:function(v){return n=v,a}}}function dw(){return{}}function vw(e,i,r){e[i]=r}function Wy(){return map()}function Xy(e,i,r){e.set(i,r)}function X0(){}var zh=Zv.prototype;X0.prototype=mw.prototype={constructor:X0,has:zh.has,add:function(e){return e+="",this[Rc+e]=e,this},remove:zh.remove,clear:zh.clear,values:zh.keys,size:zh.size,empty:zh.empty,each:zh.each};function mw(e,i){var r=new X0;if(e instanceof X0)e.each(function(s){r.add(s)});else if(e){var n=-1,a=e.length;if(i==null)for(;++n<a;)r.add(e[n]);else for(;++n<a;)r.add(i(e[n],n,e))}return r}var cP=null,Yy=Array.prototype,Y0=Yy.map,Uh=Yy.slice;function sh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function fP(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var qy={name:"implicit"};function q0(){var e=Zv(),i=[],r=[],n=qy;function a(s){var p=s+"",v=e.get(p);if(!v){if(n!==qy)return n;e.set(p,v=i.push(s))}return r[(v-1)%r.length]}return a.domain=function(s){if(!arguments.length)return i.slice();i=[],e=Zv();for(var p=-1,v=s.length,g,x;++p<v;)e.has(x=(g=s[p])+"")||e.set(x,i.push(g));return a},a.range=function(s){return arguments.length?(r=Uh.call(s),a):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.copy=function(){return q0(i,r).unknown(n)},sh.apply(a,arguments),a}function Ky(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],a,s,p=!1,v=0,g=0,x=.5;delete e.unknown;function C(){var T=i().length,R=n[1]<n[0],F=n[R-0],G=n[1-R];a=(G-F)/Math.max(1,T-v+g*2),p&&(a=Math.floor(a)),F+=(G-F-a*(T-v))*x,s=a*(1-v),p&&(F=Math.round(F),s=Math.round(s));var q=sequence(T).map(function(te){return F+a*te});return r(R?q.reverse():q)}return e.domain=function(T){return arguments.length?(i(T),C()):i()},e.range=function(T){return arguments.length?(n=[+T[0],+T[1]],C()):n.slice()},e.rangeRound=function(T){return n=[+T[0],+T[1]],p=!0,C()},e.bandwidth=function(){return s},e.step=function(){return a},e.round=function(T){return arguments.length?(p=!!T,C()):p},e.padding=function(T){return arguments.length?(v=Math.min(1,g=+T),C()):v},e.paddingInner=function(T){return arguments.length?(v=Math.min(1,T),C()):v},e.paddingOuter=function(T){return arguments.length?(g=+T,C()):g},e.align=function(T){return arguments.length?(x=Math.max(0,Math.min(1,T)),C()):x},e.copy=function(){return Ky(i(),n).round(p).paddingInner(v).paddingOuter(g).align(x)},initRange.apply(C(),arguments)}function $y(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return $y(i())},e}function pP(){return $y(Ky.apply(null,arguments).paddingInner(1))}var gw=U(26257),yw=U(73626);function _w(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function xw(e){return function(){return e}}function jv(e){return+e}var Qy=[0,1];function Lc(e){return e}function Vv(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:xw(isNaN(i)?NaN:.5)}function Jy(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(a){return Math.max(i,Math.min(r,a))}}function bw(e,i,r){var n=e[0],a=e[1],s=i[0],p=i[1];return a<n?(n=Vv(a,n),s=r(p,s)):(n=Vv(n,a),s=r(s,p)),function(v){return s(n(v))}}function Ew(e,i,r){var n=Math.min(e.length,i.length)-1,a=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)a[p]=Vv(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(v){var g=G0(e,v,1,n)-1;return s[g](a[g](v))}}function K0(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Gv(){var e=Qy,i=Qy,r=gw.Z,n,a,s,p=Lc,v,g,x;function C(){return v=Math.min(e.length,i.length)>2?Ew:bw,g=x=null,T}function T(R){return isNaN(R=+R)?s:(g||(g=v(e.map(n),i,r)))(n(p(R)))}return T.invert=function(R){return p(a((x||(x=v(i,e.map(n),yw.Z)))(R)))},T.domain=function(R){return arguments.length?(e=Y0.call(R,jv),p===Lc||(p=Jy(e)),C()):e.slice()},T.range=function(R){return arguments.length?(i=Uh.call(R),C()):i.slice()},T.rangeRound=function(R){return i=Uh.call(R),r=_w,C()},T.clamp=function(R){return arguments.length?(p=R?Jy(e):Lc,T):p!==Lc},T.interpolate=function(R){return arguments.length?(r=R,C()):r},T.unknown=function(R){return arguments.length?(s=R,T):s},function(R,F){return n=R,a=F,C()}}function e_(e,i){return Gv()(e,i)}var Sw=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $0(e){if(!(i=Sw.exec(e)))throw new Error("invalid format: "+e);var i;return new Hv({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}$0.prototype=Hv.prototype;function Hv(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Hv.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Cw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Q0(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function bd(e){return e=Q0(Math.abs(e)),e?e[1]:NaN}function Aw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(bd(i)/3)))*3-bd(Math.abs(e)))}function ww(e,i){return function(r,n){for(var a=r.length,s=[],p=0,v=e[0],g=0;a>0&&v>0&&(g+v+1>n&&(v=Math.max(1,n-g)),s.push(r.substring(a-=v,a+v)),!((g+=v+1)>n));)v=e[p=(p+1)%e.length];return s.reverse().join(i)}}function Tw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function Mw(e){e:for(var i=e.length,r=1,n=-1,a;r<i;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var t_;function Pw(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1],s=a-(t_=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Q0(e,Math.max(0,i+s-1))[0]}function r_(e,i){var r=Q0(e,i);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}var n_={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Cw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return r_(e*100,i)},r:r_,s:Pw,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function i_(e){return e}var a_=Array.prototype.map,o_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Iw(e){var i=e.grouping===void 0||e.thousands===void 0?i_:ww(a_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?i_:Tw(a_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",v=e.minus===void 0?"-":e.minus+"",g=e.nan===void 0?"NaN":e.nan+"";function x(T){T=$0(T);var R=T.fill,F=T.align,G=T.sign,q=T.symbol,te=T.zero,Se=T.width,Ne=T.comma,Ke=T.precision,it=T.trim,St=T.type;St==="n"?(Ne=!0,St="g"):n_[St]||(Ke===void 0&&(Ke=12),it=!0,St="g"),(te||R==="0"&&F==="=")&&(te=!0,R="0",F="=");var Tt=q==="$"?r:q==="#"&&/[boxX]/.test(St)?"0"+St.toLowerCase():"",$t=q==="$"?n:/[%p]/.test(St)?p:"",sr=n_[St],Pr=/[defgprs%]/.test(St);Ke=Ke===void 0?6:/[gprs]/.test(St)?Math.max(1,Math.min(21,Ke)):Math.max(0,Math.min(20,Ke));function $r(br){var mn=Tt,Mn=$t,Qn,Na,qo;if(St==="c")Mn=sr(br)+Mn,br="";else{br=+br;var ks=br<0||1/br<0;if(br=isNaN(br)?g:sr(Math.abs(br),Ke),it&&(br=Mw(br)),ks&&+br==0&&G!=="+"&&(ks=!1),mn=(ks?G==="("?G:v:G==="-"||G==="("?"":G)+mn,Mn=(St==="s"?o_[8+t_/3]:"")+Mn+(ks&&G==="("?")":""),Pr){for(Qn=-1,Na=br.length;++Qn<Na;)if(qo=br.charCodeAt(Qn),48>qo||qo>57){Mn=(qo===46?a+br.slice(Qn+1):br.slice(Qn))+Mn,br=br.slice(0,Qn);break}}}Ne&&!te&&(br=i(br,Infinity));var Ds=mn.length+br.length+Mn.length,Ws=Ds<Se?new Array(Se-Ds+1).join(R):"";switch(Ne&&te&&(br=i(Ws+br,Ws.length?Se-Mn.length:Infinity),Ws=""),F){case"<":br=mn+br+Mn+Ws;break;case"=":br=mn+Ws+br+Mn;break;case"^":br=Ws.slice(0,Ds=Ws.length>>1)+mn+br+Mn+Ws.slice(Ds);break;default:br=Ws+mn+br+Mn;break}return s(br)}return $r.toString=function(){return T+""},$r}function C(T,R){var F=x((T=$0(T),T.type="f",T)),G=Math.max(-8,Math.min(8,Math.floor(bd(R)/3)))*3,q=Math.pow(10,-G),te=o_[8+G/3];return function(Se){return F(q*Se)+te}}return{format:x,formatPrefix:C}}var J0,Wv,s_;Ow({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Ow(e){return J0=Iw(e),Wv=J0.format,s_=J0.formatPrefix,J0}function Rw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,bd(i)-bd(e))+1}function Lw(e){return Math.max(0,-bd(Math.abs(e)))}function kw(e,i,r,n){var a=Uv(e,i,r),s;switch(n=$0(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=Aw(a,p))&&(n.precision=s),s_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=Rw(a,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=Lw(a))&&(n.precision=s-(n.type==="%")*2);break}}return Wv(n)}function ev(e){var i=e.domain;return e.ticks=function(r){var n=i();return Gy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var a=i();return kw(a[0],a[a.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),a=0,s=n.length-1,p=n[a],v=n[s],g;return v<p&&(g=p,p=v,v=g,g=a,a=s,s=g),g=H0(p,v,r),g>0?(p=Math.floor(p/g)*g,v=Math.ceil(v/g)*g,g=H0(p,v,r)):g<0&&(p=Math.ceil(p*g)/g,v=Math.floor(v*g)/g,g=H0(p,v,r)),g>0?(n[a]=Math.floor(p/g)*g,n[s]=Math.ceil(v/g)*g,i(n)):g<0&&(n[a]=Math.ceil(p*g)/g,n[s]=Math.floor(v*g)/g,i(n)),e},e}function u_(){var e=e_(Lc,Lc);return e.copy=function(){return K0(e,u_())},sh.apply(e,arguments),ev(e)}function l_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Y0.call(n,jv),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return l_(e).unknown(i)},e=arguments.length?Y0.call(e,jv):[0,1],ev(r)}function c_(e,i){e=e.slice();var r=0,n=e.length-1,a=e[r],s=e[n],p;return s<a&&(p=r,r=n,n=p,p=a,a=s,s=p),e[r]=i.floor(a),e[n]=i.ceil(s),e}function f_(e){return Math.log(e)}function p_(e){return Math.exp(e)}function Dw(e){return-Math.log(-e)}function Fw(e){return-Math.exp(-e)}function Bw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Nw(e){return e===10?Bw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function zw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function h_(e){return function(i){return-e(-i)}}function Uw(e){var i=e(f_,p_),r=i.domain,n=10,a,s;function p(){return a=zw(n),s=Nw(n),r()[0]<0?(a=h_(a),s=h_(s),e(Dw,Fw)):e(f_,p_),i}return i.base=function(v){return arguments.length?(n=+v,p()):n},i.domain=function(v){return arguments.length?(r(v),p()):r()},i.ticks=function(v){var g=r(),x=g[0],C=g[g.length-1],T;(T=C<x)&&(R=x,x=C,C=R);var R=a(x),F=a(C),G,q,te,Se=v==null?10:+v,Ne=[];if(!(n%1)&&F-R<Se){if(R=Math.round(R)-1,F=Math.round(F)+1,x>0){for(;R<F;++R)for(q=1,G=s(R);q<n;++q)if(te=G*q,!(te<x)){if(te>C)break;Ne.push(te)}}else for(;R<F;++R)for(q=n-1,G=s(R);q>=1;--q)if(te=G*q,!(te<x)){if(te>C)break;Ne.push(te)}}else Ne=Gy(R,F,Math.min(F-R,Se)).map(s);return T?Ne.reverse():Ne},i.tickFormat=function(v,g){if(g==null&&(g=n===10?".0e":","),typeof g!="function"&&(g=Wv(g)),v===Infinity)return g;v==null&&(v=10);var x=Math.max(1,n*v/i.ticks().length);return function(C){var T=C/s(Math.round(a(C)));return T*n<n-.5&&(T*=n),T<=x?g(C):""}},i.nice=function(){return r(c_(r(),{floor:function(v){return s(Math.floor(a(v)))},ceil:function(v){return s(Math.ceil(a(v)))}}))},i}function d_(){var e=Uw(Gv()).domain([1,10]);return e.copy=function(){return K0(e,d_()).base(e.base())},sh.apply(e,arguments),e}function v_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function m_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function Zw(e){var i=1,r=e(v_(i),m_(i));return r.constant=function(n){return arguments.length?e(v_(i=+n),m_(i)):i},linearish(r)}function jw(){var e=Zw(transformer());return e.copy=function(){return copy(e,jw()).constant(e.constant())},initRange.apply(e,arguments)}function g_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Vw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Gw(e){return e<0?-e*e:e*e}function Hw(e){var i=e(Lc,Lc),r=1;function n(){return r===1?e(Lc,Lc):r===.5?e(Vw,Gw):e(g_(r),g_(1/r))}return i.exponent=function(a){return arguments.length?(r=+a,n()):r},ev(i)}function Xv(){var e=Hw(Gv());return e.copy=function(){return K0(e,Xv()).exponent(e.exponent())},sh.apply(e,arguments),e}function hP(){return Xv.apply(null,arguments).exponent(.5)}function y_(){var e=[],i=[],r=[],n;function a(){var p=0,v=Math.max(1,i.length);for(r=new Array(v-1);++p<v;)r[p-1]=hw(e,p/v);return s}function s(p){return isNaN(p=+p)?n:i[G0(r,p)]}return s.invertExtent=function(p){var v=i.indexOf(p);return v<0?[NaN,NaN]:[v>0?r[v-1]:e[0],v<r.length?r[v]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var v=0,g=p.length,x;v<g;++v)x=p[v],x!=null&&!isNaN(x=+x)&&e.push(x);return e.sort(Fv),a()},s.range=function(p){return arguments.length?(i=Uh.call(p),a()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return y_().domain(e).range(i).unknown(n)},sh.apply(s,arguments)}function __(){var e=0,i=1,r=1,n=[.5],a=[0,1],s;function p(g){return g<=g?a[G0(n,g,0,r)]:s}function v(){var g=-1;for(n=new Array(r);++g<r;)n[g]=((g+1)*i-(g-r)*e)/(r+1);return p}return p.domain=function(g){return arguments.length?(e=+g[0],i=+g[1],v()):[e,i]},p.range=function(g){return arguments.length?(r=(a=Uh.call(g)).length-1,v()):a.slice()},p.invertExtent=function(g){var x=a.indexOf(g);return x<0?[NaN,NaN]:x<1?[e,n[0]]:x>=r?[n[r-1],i]:[n[x-1],n[x]]},p.unknown=function(g){return arguments.length&&(s=g),p},p.thresholds=function(){return n.slice()},p.copy=function(){return __().domain([e,i]).range(a).unknown(s)},sh.apply(ev(p),arguments)}function x_(){var e=[.5],i=[0,1],r,n=1;function a(s){return s<=s?i[G0(e,s,0,n)]:r}return a.domain=function(s){return arguments.length?(e=Uh.call(s),n=Math.min(e.length,i.length-1),a):e.slice()},a.range=function(s){return arguments.length?(i=Uh.call(s),n=Math.min(e.length,i.length-1),a):i.slice()},a.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},a.unknown=function(s){return arguments.length?(r=s,a):r},a.copy=function(){return x_().domain(e).range(i).unknown(r)},sh.apply(a,arguments)}var Yv=new Date,qv=new Date;function il(e,i,r,n){function a(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return a.floor=function(s){return e(s=new Date(+s)),s},a.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},a.round=function(s){var p=a(s),v=a.ceil(s);return s-p<v-s?p:v},a.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},a.range=function(s,p,v){var g=[],x;if(s=a.ceil(s),v=v==null?1:Math.floor(v),!(s<p)||!(v>0))return g;do g.push(x=new Date(+s)),i(s,v),e(s);while(x<s&&s<p);return g},a.filter=function(s){return il(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,v){if(p>=p)if(v<0)for(;++v<=0;)for(;i(p,-1),!s(p););else for(;--v>=0;)for(;i(p,1),!s(p););})},r&&(a.count=function(s,p){return Yv.setTime(+s),qv.setTime(+p),e(Yv),e(qv),Math.floor(r(Yv,qv))},a.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?a.filter(n?function(p){return n(p)%s==0}:function(p){return a.count(0,p)%s==0}):a}),a}var Kv=il(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Kv.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var Ed=Kv,dP=Kv.range,b_=il(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Ww=b_,vP=b_.range,tv=1e3,i0=6e4,E_=36e5,S_=864e5,C_=6048e5;function Zh(e){return il(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*i0)/C_})}var $v=Zh(0),rv=Zh(1),Xw=Zh(2),Yw=Zh(3),Sd=Zh(4),qw=Zh(5),Kw=Zh(6),mP=$v.range,gP=rv.range,yP=Xw.range,_P=Yw.range,xP=Sd.range,bP=qw.range,EP=Kw.range,A_=il(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*i0)/S_},function(e){return e.getDate()-1}),Qv=A_,SP=A_.range,w_=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv-e.getMinutes()*i0)},function(e,i){e.setTime(+e+i*E_)},function(e,i){return(i-e)/E_},function(e){return e.getHours()}),$w=w_,CP=w_.range,T_=il(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*tv)},function(e,i){e.setTime(+e+i*i0)},function(e,i){return(i-e)/i0},function(e){return e.getMinutes()}),Qw=T_,AP=T_.range,M_=il(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*tv)},function(e,i){return(i-e)/tv},function(e){return e.getUTCSeconds()}),Jw=M_,wP=M_.range,nv=il(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});nv.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?il(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):nv};var eT=nv,TP=nv.range;function jh(e){return il(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/C_})}var P_=jh(0),iv=jh(1),tT=jh(2),rT=jh(3),Cd=jh(4),nT=jh(5),iT=jh(6),MP=P_.range,PP=iv.range,IP=tT.range,OP=rT.range,RP=Cd.range,LP=nT.range,kP=iT.range,I_=il(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/S_},function(e){return e.getUTCDate()-1}),O_=I_,DP=I_.range,Jv=il(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});Jv.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:il(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var a0=Jv,FP=Jv.range;function em(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function tm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function o0(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function aT(e){var i=e.dateTime,r=e.date,n=e.time,a=e.periods,s=e.days,p=e.shortDays,v=e.months,g=e.shortMonths,x=s0(a),C=u0(a),T=s0(s),R=u0(s),F=s0(p),G=u0(p),q=s0(v),te=u0(v),Se=s0(g),Ne=u0(g),Ke={a:ks,A:Ds,b:Ws,B:pf,c:null,d:B_,e:B_,f:MT,g:NT,G:UT,H:AT,I:wT,j:TT,L:N_,m:PT,M:IT,p:gv,q:C3,Q:G_,s:H_,S:OT,u:RT,U:LT,V:kT,w:DT,W:FT,x:null,X:null,y:BT,Y:zT,Z:ZT,"%":V_},it={a:A3,A:w3,b:T3,B:M3,c:null,d:U_,e:U_,f:HT,g:t5,G:n5,H:jT,I:VT,j:GT,L:Z_,m:WT,M:XT,p:P3,q:I3,Q:G_,s:H_,S:YT,u:qT,U:KT,V:$T,w:QT,W:JT,x:null,X:null,y:e5,Y:r5,Z:i5,"%":V_},St={a:$r,A:br,b:mn,B:Mn,c:Qn,d:D_,e:D_,f:bT,g:k_,G:L_,H:F_,I:F_,j:gT,L:xT,m:mT,M:yT,p:Pr,q:vT,Q:ST,s:CT,S:_T,u:cT,U:fT,V:pT,w:lT,W:hT,x:Na,X:qo,y:k_,Y:L_,Z:dT,"%":ET};Ke.x=Tt(r,Ke),Ke.X=Tt(n,Ke),Ke.c=Tt(i,Ke),it.x=Tt(r,it),it.X=Tt(n,it),it.c=Tt(i,it);function Tt(ui,Ra){return function(io){var gn=[],Al=-1,Uo=0,Jl=ui.length,ec,Gh,Rx;for(io instanceof Date||(io=new Date(+io));++Al<Jl;)ui.charCodeAt(Al)===37&&(gn.push(ui.slice(Uo,Al)),(Gh=R_[ec=ui.charAt(++Al)])!=null?ec=ui.charAt(++Al):Gh=ec==="e"?" ":"0",(Rx=Ra[ec])&&(ec=Rx(io,Gh)),gn.push(ec),Uo=Al+1);return gn.push(ui.slice(Uo,Al)),gn.join("")}}function $t(ui,Ra){return function(io){var gn=o0(1900,void 0,1),Al=sr(gn,ui,io+="",0),Uo,Jl;if(Al!=io.length)return null;if("Q"in gn)return new Date(gn.Q);if("s"in gn)return new Date(gn.s*1e3+("L"in gn?gn.L:0));if(Ra&&!("Z"in gn)&&(gn.Z=0),"p"in gn&&(gn.H=gn.H%12+gn.p*12),gn.m===void 0&&(gn.m="q"in gn?gn.q:0),"V"in gn){if(gn.V<1||gn.V>53)return null;"w"in gn||(gn.w=1),"Z"in gn?(Uo=tm(o0(gn.y,0,1)),Jl=Uo.getUTCDay(),Uo=Jl>4||Jl===0?iv.ceil(Uo):iv(Uo),Uo=O_.offset(Uo,(gn.V-1)*7),gn.y=Uo.getUTCFullYear(),gn.m=Uo.getUTCMonth(),gn.d=Uo.getUTCDate()+(gn.w+6)%7):(Uo=em(o0(gn.y,0,1)),Jl=Uo.getDay(),Uo=Jl>4||Jl===0?rv.ceil(Uo):rv(Uo),Uo=Qv.offset(Uo,(gn.V-1)*7),gn.y=Uo.getFullYear(),gn.m=Uo.getMonth(),gn.d=Uo.getDate()+(gn.w+6)%7)}else("W"in gn||"U"in gn)&&("w"in gn||(gn.w="u"in gn?gn.u%7:"W"in gn?1:0),Jl="Z"in gn?tm(o0(gn.y,0,1)).getUTCDay():em(o0(gn.y,0,1)).getDay(),gn.m=0,gn.d="W"in gn?(gn.w+6)%7+gn.W*7-(Jl+5)%7:gn.w+gn.U*7-(Jl+6)%7);return"Z"in gn?(gn.H+=gn.Z/100|0,gn.M+=gn.Z%100,tm(gn)):em(gn)}}function sr(ui,Ra,io,gn){for(var Al=0,Uo=Ra.length,Jl=io.length,ec,Gh;Al<Uo;){if(gn>=Jl)return-1;if(ec=Ra.charCodeAt(Al++),ec===37){if(ec=Ra.charAt(Al++),Gh=St[ec in R_?Ra.charAt(Al++):ec],!Gh||(gn=Gh(ui,io,gn))<0)return-1}else if(ec!=io.charCodeAt(gn++))return-1}return gn}function Pr(ui,Ra,io){var gn=x.exec(Ra.slice(io));return gn?(ui.p=C[gn[0].toLowerCase()],io+gn[0].length):-1}function $r(ui,Ra,io){var gn=F.exec(Ra.slice(io));return gn?(ui.w=G[gn[0].toLowerCase()],io+gn[0].length):-1}function br(ui,Ra,io){var gn=T.exec(Ra.slice(io));return gn?(ui.w=R[gn[0].toLowerCase()],io+gn[0].length):-1}function mn(ui,Ra,io){var gn=Se.exec(Ra.slice(io));return gn?(ui.m=Ne[gn[0].toLowerCase()],io+gn[0].length):-1}function Mn(ui,Ra,io){var gn=q.exec(Ra.slice(io));return gn?(ui.m=te[gn[0].toLowerCase()],io+gn[0].length):-1}function Qn(ui,Ra,io){return sr(ui,i,Ra,io)}function Na(ui,Ra,io){return sr(ui,r,Ra,io)}function qo(ui,Ra,io){return sr(ui,n,Ra,io)}function ks(ui){return p[ui.getDay()]}function Ds(ui){return s[ui.getDay()]}function Ws(ui){return g[ui.getMonth()]}function pf(ui){return v[ui.getMonth()]}function gv(ui){return a[+(ui.getHours()>=12)]}function C3(ui){return 1+~~(ui.getMonth()/3)}function A3(ui){return p[ui.getUTCDay()]}function w3(ui){return s[ui.getUTCDay()]}function T3(ui){return g[ui.getUTCMonth()]}function M3(ui){return v[ui.getUTCMonth()]}function P3(ui){return a[+(ui.getUTCHours()>=12)]}function I3(ui){return 1+~~(ui.getUTCMonth()/3)}return{format:function(ui){var Ra=Tt(ui+="",Ke);return Ra.toString=function(){return ui},Ra},parse:function(ui){var Ra=$t(ui+="",!1);return Ra.toString=function(){return ui},Ra},utcFormat:function(ui){var Ra=Tt(ui+="",it);return Ra.toString=function(){return ui},Ra},utcParse:function(ui){var Ra=$t(ui+="",!0);return Ra.toString=function(){return ui},Ra}}}var R_={"-":"",_:" ","0":"0"},yu=/^\s*\d+/,oT=/^%/,sT=/[\\^$*+?|[\]().{}]/g;function no(e,i,r){var n=e<0?"-":"",a=(n?-e:e)+"",s=a.length;return n+(s<r?new Array(r-s+1).join(i)+a:a)}function uT(e){return e.replace(sT,"\\$&")}function s0(e){return new RegExp("^(?:"+e.map(uT).join("|")+")","i")}function u0(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function lT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function cT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function fT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function pT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function hT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function L_(e,i,r){var n=yu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function k_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function dT(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function vT(e,i,r){var n=yu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function mT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function D_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function gT(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function F_(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function yT(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function _T(e,i,r){var n=yu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function xT(e,i,r){var n=yu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function bT(e,i,r){var n=yu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function ET(e,i,r){var n=oT.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function ST(e,i,r){var n=yu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function CT(e,i,r){var n=yu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function B_(e,i){return no(e.getDate(),i,2)}function AT(e,i){return no(e.getHours(),i,2)}function wT(e,i){return no(e.getHours()%12||12,i,2)}function TT(e,i){return no(1+Qv.count(Ed(e),e),i,3)}function N_(e,i){return no(e.getMilliseconds(),i,3)}function MT(e,i){return N_(e,i)+"000"}function PT(e,i){return no(e.getMonth()+1,i,2)}function IT(e,i){return no(e.getMinutes(),i,2)}function OT(e,i){return no(e.getSeconds(),i,2)}function RT(e){var i=e.getDay();return i===0?7:i}function LT(e,i){return no($v.count(Ed(e)-1,e),i,2)}function z_(e){var i=e.getDay();return i>=4||i===0?Sd(e):Sd.ceil(e)}function kT(e,i){return e=z_(e),no(Sd.count(Ed(e),e)+(Ed(e).getDay()===4),i,2)}function DT(e){return e.getDay()}function FT(e,i){return no(rv.count(Ed(e)-1,e),i,2)}function BT(e,i){return no(e.getFullYear()%100,i,2)}function NT(e,i){return e=z_(e),no(e.getFullYear()%100,i,2)}function zT(e,i){return no(e.getFullYear()%1e4,i,4)}function UT(e,i){var r=e.getDay();return e=r>=4||r===0?Sd(e):Sd.ceil(e),no(e.getFullYear()%1e4,i,4)}function ZT(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+no(i/60|0,"0",2)+no(i%60,"0",2)}function U_(e,i){return no(e.getUTCDate(),i,2)}function jT(e,i){return no(e.getUTCHours(),i,2)}function VT(e,i){return no(e.getUTCHours()%12||12,i,2)}function GT(e,i){return no(1+O_.count(a0(e),e),i,3)}function Z_(e,i){return no(e.getUTCMilliseconds(),i,3)}function HT(e,i){return Z_(e,i)+"000"}function WT(e,i){return no(e.getUTCMonth()+1,i,2)}function XT(e,i){return no(e.getUTCMinutes(),i,2)}function YT(e,i){return no(e.getUTCSeconds(),i,2)}function qT(e){var i=e.getUTCDay();return i===0?7:i}function KT(e,i){return no(P_.count(a0(e)-1,e),i,2)}function j_(e){var i=e.getUTCDay();return i>=4||i===0?Cd(e):Cd.ceil(e)}function $T(e,i){return e=j_(e),no(Cd.count(a0(e),e)+(a0(e).getUTCDay()===4),i,2)}function QT(e){return e.getUTCDay()}function JT(e,i){return no(iv.count(a0(e)-1,e),i,2)}function e5(e,i){return no(e.getUTCFullYear()%100,i,2)}function t5(e,i){return e=j_(e),no(e.getUTCFullYear()%100,i,2)}function r5(e,i){return no(e.getUTCFullYear()%1e4,i,4)}function n5(e,i){var r=e.getUTCDay();return e=r>=4||r===0?Cd(e):Cd.ceil(e),no(e.getUTCFullYear()%1e4,i,4)}function i5(){return"+0000"}function V_(){return"%"}function G_(e){return+e}function H_(e){return Math.floor(+e/1e3)}var Ad,W_,a5,o5,s5;u5({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function u5(e){return Ad=aT(e),W_=Ad.format,a5=Ad.parse,o5=Ad.utcFormat,s5=Ad.utcParse,Ad}var l0=1e3,c0=l0*60,f0=c0*60,p0=f0*24,l5=p0*7,X_=p0*30,rm=p0*365;function c5(e){return new Date(e)}function f5(e){return e instanceof Date?+e:+new Date(+e)}function Y_(e,i,r,n,a,s,p,v,g){var x=e_(Lc,Lc),C=x.invert,T=x.domain,R=g(".%L"),F=g(":%S"),G=g("%I:%M"),q=g("%I %p"),te=g("%a %d"),Se=g("%b %d"),Ne=g("%B"),Ke=g("%Y"),it=[[p,1,l0],[p,5,5*l0],[p,15,15*l0],[p,30,30*l0],[s,1,c0],[s,5,5*c0],[s,15,15*c0],[s,30,30*c0],[a,1,f0],[a,3,3*f0],[a,6,6*f0],[a,12,12*f0],[n,1,p0],[n,2,2*p0],[r,1,l5],[i,1,X_],[i,3,3*X_],[e,1,rm]];function St($t){return(p($t)<$t?R:s($t)<$t?F:a($t)<$t?G:n($t)<$t?q:i($t)<$t?r($t)<$t?te:Se:e($t)<$t?Ne:Ke)($t)}function Tt($t,sr,Pr,$r){if($t==null&&($t=10),typeof $t=="number"){var br=Math.abs(Pr-sr)/$t,mn=Zy(function(Mn){return Mn[2]}).right(it,br);mn===it.length?($r=Uv(sr/rm,Pr/rm,$t),$t=e):mn?(mn=it[br/it[mn-1][2]<it[mn][2]/br?mn-1:mn],$r=mn[1],$t=mn[0]):($r=Math.max(Uv(sr,Pr,$t),1),$t=v)}return $r==null?$t:$t.every($r)}return x.invert=function($t){return new Date(C($t))},x.domain=function($t){return arguments.length?T(Y0.call($t,f5)):T().map(c5)},x.ticks=function($t,sr){var Pr=T(),$r=Pr[0],br=Pr[Pr.length-1],mn=br<$r,Mn;return mn&&(Mn=$r,$r=br,br=Mn),Mn=Tt($t,$r,br,sr),Mn=Mn?Mn.range($r,br+1):[],mn?Mn.reverse():Mn},x.tickFormat=function($t,sr){return sr==null?St:g(sr)},x.nice=function($t,sr){var Pr=T();return($t=Tt($t,Pr[0],Pr[Pr.length-1],sr))?T(c_(Pr,$t)):x},x.copy=function(){return K0(x,Y_(e,i,r,n,a,s,p,v,g))},x}function p5(){return sh.apply(Y_(Ed,Ww,$v,Qv,$w,Qw,Jw,eT,W_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function BP(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function av(){var e=0,i=1,r,n,a,s,p=identity,v=!1,g;function x(C){return isNaN(C=+C)?g:p(a===0?.5:(C=(s(C)-r)*a,v?Math.max(0,Math.min(1,C)):C))}return x.domain=function(C){return arguments.length?(r=s(e=+C[0]),n=s(i=+C[1]),a=r===n?0:1/(n-r),x):[e,i]},x.clamp=function(C){return arguments.length?(v=!!C,x):v},x.interpolator=function(C){return arguments.length?(p=C,x):p},x.unknown=function(C){return arguments.length?(g=C,x):g},function(C){return s=C,r=C(e),n=C(i),a=r===n?0:1/(n-r),x}}function ov(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function h5(){var e=linearish(av()(identity));return e.copy=function(){return ov(e,h5())},initInterpolator.apply(e,arguments)}function d5(){var e=loggish(av()).domain([1,10]);return e.copy=function(){return ov(e,d5()).base(e.base())},initInterpolator.apply(e,arguments)}function v5(){var e=symlogish(av());return e.copy=function(){return ov(e,v5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function q_(){var e=powish(av());return e.copy=function(){return ov(e,q_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function NP(){return q_.apply(null,arguments).exponent(.5)}function m5(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var a=0,s=n.length,p;a<s;++a)p=n[a],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return m5(i).domain(e)},initInterpolator.apply(r,arguments)}function sv(){var e=0,i=.5,r=1,n,a,s,p,v,g=identity,x,C=!1,T;function R(F){return isNaN(F=+F)?T:(F=.5+((F=+x(F))-a)*(F<a?p:v),g(C?Math.max(0,Math.min(1,F)):F))}return R.domain=function(F){return arguments.length?(n=x(e=+F[0]),a=x(i=+F[1]),s=x(r=+F[2]),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),R):[e,i,r]},R.clamp=function(F){return arguments.length?(C=!!F,R):C},R.interpolator=function(F){return arguments.length?(g=F,R):g},R.unknown=function(F){return arguments.length?(T=F,R):T},function(F){return x=F,n=F(e),a=F(i),s=F(r),p=n===a?0:.5/(a-n),v=a===s?0:.5/(s-a),R}}function g5(){var e=linearish(sv()(identity));return e.copy=function(){return copy(e,g5())},initInterpolator.apply(e,arguments)}function y5(){var e=loggish(sv()).domain([.1,1,10]);return e.copy=function(){return copy(e,y5()).base(e.base())},initInterpolator.apply(e,arguments)}function _5(){var e=symlogish(sv());return e.copy=function(){return copy(e,_5()).constant(e.constant())},initInterpolator.apply(e,arguments)}function K_(){var e=powish(sv());return e.copy=function(){return copy(e,K_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function zP(){return K_.apply(null,arguments).exponent(.5)}var cf,$_,Q_,J_,nm,e1,x5=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,b5=(cf={},(0,A.Z)(cf,su.LINEAR,u_),(0,A.Z)(cf,su.POWER,Xv),(0,A.Z)(cf,su.LOG,d_),(0,A.Z)(cf,su.IDENTITY,l_),(0,A.Z)(cf,su.TIME,p5),(0,A.Z)(cf,su.QUANTILE,y_),(0,A.Z)(cf,su.QUANTIZE,__),(0,A.Z)(cf,su.THRESHOLD,x_),(0,A.Z)(cf,su.CAT,q0),cf),E5=($_=(0,Wr.b2)(),Q_=(0,Wr.f3)(Ht.IGlobalConfigService),$_(J_=(nm=function(){function e(){(0,dt.Z)(this,e),Nn(this,"configService",e1,this),(0,A.Z)(this,"scaleCache",{}),(0,A.Z)(this,"scaleOptions",{})}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;v.length!==0&&a.caculateScalesForAttributes(p||[],v)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),v=r.getSource().data.dataArray;return a.caculateScalesForAttributes(p||[],v),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){a.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var v=r.getSource().data.dataArray;if(v.length===0)return;var g=p.filter(function(x){return x.needRescale});g.length&&a.caculateScalesForAttributes(g,v)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var a=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,v=s.name;p.names=a.parseFields(s.scale.field||[]);var g=[];p.names.forEach(function(x){g.push(a.getOrCreateScale(x,s,n))}),g.some(function(x){return x.type===eh.VARIABLE})?(p.type=eh.VARIABLE,g.forEach(function(x){if(!p.callback){var C;if(p.values&&p.values!=="text"){var T;if(((T=x.option)===null||T===void 0?void 0:T.type)==="linear"&&p.values.length>2){var R=x.scale.ticks(p.values.length);v==="color"&&x.scale.domain(R)}x.scale.range(p.values)}else((C=x.option)===null||C===void 0?void 0:C.type)==="cat"&&x.scale.range(x.option.domain)}})):(p.type=eh.CONSTANT,p.defaultValues=g.map(function(x,C){return x.scale(p.names[C])})),p.scalers=g.map(function(x){return{field:x.field,func:x.scale,option:x.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,a){var s,p=[r,n.name].join("_"),v=(s=n.scale)===null||s===void 0?void 0:s.values,g=this.createScale(r,n.name,v,a);return g}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:w()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,a,s){var p,v,g=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],x={field:r,scale:void 0,type:eh.VARIABLE,option:g};if(!s||!s.length)return g&&g.type?x.scale=this.createDefaultScale(g):(x.scale=q0([r]),x.type=eh.CONSTANT),x;var C=(v=s.find(function(F){return!wi()(F[r])}))===null||v===void 0?void 0:v[r];if(this.isNumber(r)||wi()(C)&&!g)x.scale=q0([r]),x.type=eh.CONSTANT;else{var T=g&&g.type||this.getDefaultType(C);a==="text"&&(T=su.CAT);var R=this.createDefaultScaleConfig(T,r,s);Object.assign(R,g),x.scale=this.createDefaultScale(R),x.option=R}return x}},{key:"getDefaultType",value:function(r){var n=su.LINEAR;return typeof r=="string"&&(n=x5.test(r)?su.TIME:su.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,a){var s={type:r},p=(a==null?void 0:a.map(function(v){return v[n]}))||[];return r!==su.CAT&&r!==su.QUANTILE?s.domain=fw(p):r===su.CAT?s.domain=Co()(p):r===su.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,a=r.domain,s=b5[n]();return a&&s.domain(a),s}}]),e}(),e1=si(nm.prototype,"configService",[Q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm))||J_),t1,r1,n1,i1,uv,a1,o1;function s1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function S5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?s1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var C5=(t1=(0,Wr.b2)(),r1=(0,Wr.f3)(Ht.ICameraService),n1=(0,Wr.f3)(Ht.IRendererService),t1(i1=(uv=function(){function e(){(0,dt.Z)(this,e),Nn(this,"cameraService",a1,this),Nn(this,"rendererService",o1,this)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(S5({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),a1=si(uv.prototype,"cameraService",[r1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=si(uv.prototype,"rendererService",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uv))||i1),u1,l1,A5=(u1=(0,Wr.b2)(),u1(l1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||l1),c1,f1,w5=(c1=(0,Wr.b2)(),c1(f1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),a=n.autoFit,s=n.fitBoundsOptions;a&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||f1),p1,h1,T5=["type"];function d1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function h0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?d1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var v1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},M5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},P5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},I5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},UP=null;function O5(e){var i={u_DirectionalLights:new Array(3).fill(h0({},P5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(h0({},I5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[M5]),e.forEach(function(r,n){var a=r.type,s=a===void 0?"directional":a,p=(0,ro.Z)(r,T5),v=v1[s].lights,g=v1[s].num,x=i[g];i[v][x]=h0(h0({},i[v][x]),p),i[g]++}),i}var R5=(p1=(0,Wr.b2)(),p1(h1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),a=n.enableLighting;a&&r.models.forEach(function(s){return s.addUniforms(h0({},O5()))})})}}]),e}())||h1),m1,g1,y1,im,_1,L5=(m1=(0,Wr.b2)(),g1=(0,Wr.f3)(Ht.IGlobalConfigService),m1(y1=(im=function(){function e(){(0,dt.Z)(this,e),Nn(this,"configService",_1,this),(0,A.Z)(this,"enabled",void 0)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.rendererService,p=n.postProcessingPassFactory,v=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var g=r.getLayerConfig(),x=g.enableMultiPassRenderer,C=g.passes,T=C===void 0?[]:C;a.enabled=!!x&&r.getLayerConfig().enableMultiPassRenderer!==!1,a.enabled&&(r.multiPassRenderer=yg(r,T,p,v),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(a.enabled){var g=s.getViewportSize(),x=g.width,C=g.height;r.multiPassRenderer.resize(x,C)}})}}]),e}(),_1=si(im.prototype,"configService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im))||y1),x1,b1,lv={NONE:0,ENCODE:1,HIGHLIGHT:2},k5=(x1=(0,Wr.b2)(),x1(b1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=!0;s.registerStyleAttribute({name:"pickingColor",type:In.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:L.FLOAT},size:3,update:function(g,x){var C=g.id;return p?Is(C):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),v=p.enablePicking;v&&r.isVisible()&&r.models.forEach(function(g){return g.addUniforms({u_PickingStage:lv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.highlightColor,x=v.activeMix,C=x===void 0?0:x,T=typeof g=="string"?bi(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ns(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var v=r.getLayerConfig(),g=v.selectColor,x=v.selectMix,C=x===void 0?0:x,T=typeof g=="string"?bi(g):g||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Ns(new Uint8Array(p))}),r.models.forEach(function(R){return R.addUniforms({u_PickingStage:lv.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:T.map(function(F){return F*255}),u_activeMix:C,u_CurrentSelectedId:p,u_SelectColor:T.map(function(F){return F*255}),u_EnableSelect:1})})})}}]),e}())||b1),E1,S1,D5=(E1=(0,Wr.b2)(),E1(S1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){a.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:In.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:L.FLOAT},size:3,update:function(a,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:In.Attribute,descriptor:{name:"filter",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(a,s){var p=a.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:In.Attribute,descriptor:{name:"a_Color",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:4,update:function(a,s){var p=a.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:In.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:L.DYNAMIC_DRAW,data:[],type:L.FLOAT},size:1,update:function(a,s,p,v){return[s]}}})}}]),e}())||S1),C1,A1,w1,T1,M1,P1,wd,I1,O1,R1,L1,F5=(C1=(0,Wr.b2)(),A1=(0,Wr.f3)(Ht.ICameraService),w1=(0,Wr.f3)(Ht.ICoordinateSystemService),T1=(0,Wr.f3)(Ht.IRendererService),M1=(0,Wr.f3)(Ht.IMapService),C1(P1=(wd=function(){function e(){(0,dt.Z)(this,e),Nn(this,"cameraService",I1,this),Nn(this,"coordinateSystemService",O1,this),Nn(this,"rendererService",R1,this),Nn(this,"mapService",L1,this)}return(0,It.Z)(e,[{key:"apply",value:function(r){var n=this,a=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),a==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var v=n.rendererService.getViewportSize(),g=v.width,x=v.height;r.models.forEach(function(C){var T;C.addUniforms((T={},(0,A.Z)(T,Lh.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,A.Z)(T,Lh.ViewMatrix,n.cameraService.getViewMatrix()),(0,A.Z)(T,Lh.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,A.Z)(T,Lh.Zoom,n.cameraService.getZoom()),(0,A.Z)(T,Lh.ZoomScale,n.cameraService.getZoomScale()),(0,A.Z)(T,Lh.FocalDistance,n.cameraService.getFocalDistance()),(0,A.Z)(T,Lh.CameraPosition,n.cameraService.getCameraPosition()),(0,A.Z)(T,_c.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,A.Z)(T,_c.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,A.Z)(T,_c.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,A.Z)(T,_c.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,A.Z)(T,_c.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,A.Z)(T,_c.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,A.Z)(T,_c.Mvp,s),(0,A.Z)(T,"u_SceneCenterMKT",p),(0,A.Z)(T,"u_ViewportSize",[g,x]),(0,A.Z)(T,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,A.Z)(T,"u_DevicePixelRatio",ca.devicePixelRatio),(0,A.Z)(T,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,A.Z)(T,"u_shaderPick",Number(r.getShaderPickStat())),T))})})}}]),e}(),I1=si(wd.prototype,"cameraService",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O1=si(wd.prototype,"coordinateSystemService",[w1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R1=si(wd.prototype,"rendererService",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L1=si(wd.prototype,"mapService",[M1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||P1),k1,D1,B5=(k1=(0,Wr.b2)(),k1(D1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||D1),F1,B1,N5=(F1=(0,Wr.b2)(),F1(B1=function(){function e(){(0,dt.Z)(this,e)}return(0,It.Z)(e,[{key:"apply",value:function(r,n){var a=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){a.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||a.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],p=a.getLayerStyleAttribute("filter"),v=a.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(g){return g.needRegenerateVertices=!1});return}s.filter(function(g){return g.needRegenerateVertices}).forEach(function(g){a.updateAttributeByFeatureRange(g.name,r.getEncodedData(),g.featureRange.startIndex,g.featureRange.endIndex),g.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){a.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||B1);Ql.bind(Ht.ILayerPlugin).to(uw).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(D5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(E5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(sw).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(w5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(N5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(B5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(L5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(F5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(C5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(R5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(k5).inRequestScope(),Ql.bind(Ht.ILayerPlugin).to(A5).inRequestScope();var ZP="2.8.35";function N1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?N1(Object(r),!0).forEach(function(n){z5(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function z5(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function VP(e,i){return V5(e)||j5(e,i)||Z5(e,i)||U5()}function U5(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Z5(e,i){if(!!e){if(typeof e=="string")return z1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z1(e,i)}}function z1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function j5(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function V5(e){if(Array.isArray(e))return e}var GP=null,HP=null,U1,am,Z1;function j1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function V1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?j1(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var G5=(U1=Mv(Ht.IGlobalConfigService),am=function(){function e(i){(0,dt.Z)(this,e),Nn(this,"configService",Z1,this),(0,A.Z)(this,"config",void 0),this.config=i}return(0,It.Z)(e,[{key:"setContainer",value:function(r,n,a,s){r.bind(Ht.MapConfig).toConstantValue(V1(V1({},this.config),{},{id:n,canvas:a,hasBaseMap:s})),r.bind(Ht.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Z1=si(am.prototype,"configService",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am),H5=U(6158),d0=U.n(H5);function v0(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function cv(e,i){var r=ln([],i,e);return je(r,r,1/r[3]),r}function WP(e,i){var r=e%i;return r<0?i+r:r}function XP(e,i,r){return r*i+(1-r)*e}function Vh(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var ff=Math.PI,G1=ff/4,Sp=ff/180,H1=180/ff,om=512,sm=4003e4,W5=1.5;function W1(e){return Math.pow(2,e)}function X5(e){return Math.log2(e)}function fv(e,i){var r=(0,yn.Z)(e,2),n=r[0],a=r[1];Vh(Number.isFinite(n)&&Number.isFinite(i)),Vh(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude"),i*=om;var s=n*Sp,p=a*Sp,v=i*(s+ff)/(2*ff),g=i*(ff-Math.log(Math.tan(G1+p*.5)))/(2*ff);return[v,g]}function um(e,i){var r=(0,yn.Z)(e,2),n=r[0],a=r[1];i*=om;var s=n/i*(2*ff)-ff,p=2*(Math.atan(Math.exp(ff-a/i*(2*ff)))-G1);return[s*H1,p*H1]}function YP(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*Sp);return X5(sm*r)-9}function X1(e){var i=e.latitude,r=e.longitude,n=e.zoom,a=e.scale,s=e.highPrecision,p=s===void 0?!1:s;a=a!==void 0?a:W1(n),Vh(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(a));var v={},g=om*a,x=Math.cos(i*Sp),C=g/360,T=C/x,R=g/sm/x;if(v.pixelsPerMeter=[R,-R,R],v.metersPerPixel=[1/R,-1/R,1/R],v.pixelsPerDegree=[C,-T,R],v.degreesPerPixel=[1/C,-1/T,1/R],p){var F=Sp*Math.tan(i*Sp)/x,G=C*F/2,q=g/sm*F,te=q/T*R;v.pixelsPerDegree2=[0,-G,q],v.pixelsPerMeter2=[te,0,te]}return v}function qP(e,i){var r=_slicedToArray(e,3),n=r[0],a=r[1],s=r[2],p=_slicedToArray(i,3),v=p[0],g=p[1],x=p[2],C=1,T=X1({longitude:n,latitude:a,scale:C,highPrecision:!0}),R=T.pixelsPerMeter,F=T.pixelsPerMeter2,G=fv(e,C);G[0]+=v*(R[0]+F[0]*g),G[1]+=g*(R[1]+F[1]*g);var q=um(G,C),te=(s||0)+(x||0);return Number.isFinite(s)||Number.isFinite(x)?[q[0],q[1],te]:q}function Y5(e){var i=e.height,r=e.pitch,n=e.bearing,a=e.altitude,s=e.center,p=s===void 0?null:s,v=e.flipY,g=v===void 0?!1:v,x=v0();return up(x,x,[0,0,-a]),Hl(x,x,[1,1,1/i]),lp(x,x,-r*Sp),Ea(x,x,n*Sp),g&&Hl(x,x,[1,-1,1]),p&&up(x,x,qa.negate([],p)),x}function q5(e){var i=e.width,r=e.height,n=e.altitude,a=n===void 0?W5:n,s=e.pitch,p=s===void 0?0:s,v=e.nearZMultiplier,g=v===void 0?1:v,x=e.farZMultiplier,C=x===void 0?1:x,T=p*Sp,R=Math.atan(.5/a),F=Math.sin(R)*a/Math.sin(Math.PI/2-T-R),G=Math.cos(Math.PI/2-T)*F+a;return{fov:2*Math.atan(r/2/a),aspect:i/r,focalDistance:a,near:g,far:G*C}}function K5(e){var i=e.width,r=e.height,n=e.pitch,a=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,v=q5({width:i,height:r,altitude:a,pitch:n,nearZMultiplier:s,farZMultiplier:p}),g=v.fov,x=v.aspect,C=v.near,T=v.far,R=Tr([],g,x,C,T);return R}function $5(e,i){var r=(0,yn.Z)(e,3),n=r[0],a=r[1],s=r[2],p=s===void 0?0:s;return Vh(Number.isFinite(n)&&Number.isFinite(a)&&Number.isFinite(p)),cv(i,[n,a,p,1])}function Y1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,yn.Z)(e,3),a=n[0],s=n[1],p=n[2];if(Vh(Number.isFinite(a)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var v=cv(i,[a,s,p,1]);return v}var g=cv(i,[a,s,0,1]),x=cv(i,[a,s,1,1]),C=g[2],T=x[2],R=C===T?0:((r||0)-C)/(T-C);return Ei.t7([],g,x,R)}var q1=v0(),Q5=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,a=i.viewMatrix,s=a===void 0?q1:a,p=i.projectionMatrix,v=p===void 0?q1:p;(0,dt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=v;var g=v0();Sl(g,g,this.projectionMatrix),Sl(g,g,this.viewMatrix),this.viewProjectionMatrix=g;var x=v0();Hl(x,x,[this.width/2,-this.height/2,1]),up(x,x,[1,-1,0]),Sl(x,x,this.viewProjectionMatrix);var C=Np(v0(),x);if(!C)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=x,this.pixelUnprojectionMatrix=C,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,It.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&Vr(r.projectionMatrix,this.projectionMatrix)&&Vr(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=this.projectPosition(r),v=$5(p,this.pixelProjectionMatrix),g=(0,yn.Z)(v,2),x=g[0],C=g[1],T=s?C:this.height-C;return r.length===2?[x,T]:[x,T,v[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.topLeft,s=a===void 0?!0:a,p=n.targetZ,v=(0,yn.Z)(r,3),g=v[0],x=v[1],C=v[2],T=s?x:this.height-x,R=p&&p*this.pixelsPerMeter,F=Y1([g,T,C],this.pixelUnprojectionMatrix,R),G=this.unprojectPosition(F),q=(0,yn.Z)(G,3),te=q[0],Se=q[1],Ne=q[2];return Number.isFinite(C)?[te,Se,Ne]:Number.isFinite(p)?[te,Se,p]:[te,Se]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),a=(0,yn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)*this.pixelsPerMeter;return[s,p,v]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),a=(0,yn.Z)(n,2),s=a[0],p=a[1],v=(r[2]||0)/this.pixelsPerMeter;return[s,p,v]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function J5(e){var i=e.width,r=e.height,n=e.bounds,a=e.minExtent,s=a===void 0?0:a,p=e.maxZoom,v=p===void 0?24:p,g=e.padding,x=g===void 0?0:g,C=e.offset,T=C===void 0?[0,0]:C,R=(0,yn.Z)(n,2),F=(0,yn.Z)(R[0],2),G=F[0],q=F[1],te=(0,yn.Z)(R[1],2),Se=te[0],Ne=te[1];if(Number.isFinite(x)){var Ke=x;x={top:Ke,bottom:Ke,left:Ke,right:Ke}}else Vh(Number.isFinite(x.top)&&Number.isFinite(x.bottom)&&Number.isFinite(x.left)&&Number.isFinite(x.right));var it=new K1({width:i,height:r,longitude:0,latitude:0,zoom:0}),St=it.project([G,Ne]),Tt=it.project([Se,q]),$t=[Math.max(Math.abs(Tt[0]-St[0]),s),Math.max(Math.abs(Tt[1]-St[1]),s)],sr=[i-x.left-x.right-Math.abs(T[0])*2,r-x.top-x.bottom-Math.abs(T[1])*2];Vh(sr[0]>0&&sr[1]>0);var Pr=sr[0]/$t[0],$r=sr[1]/$t[1],br=(x.right-x.left)/2/Pr,mn=(x.bottom-x.top)/2/$r,Mn=[(Tt[0]+St[0])/2+br,(Tt[1]+St[1])/2+mn],Qn=it.unproject(Mn),Na=it.zoom+Math.log2(Math.abs(Math.min(Pr,$r)));return{longitude:Qn[0],latitude:Qn[1],zoom:Math.min(Na,v)}}var K1=function(e){(0,Ir.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=n.width,s=n.height,p=n.latitude,v=p===void 0?0:p,g=n.longitude,x=g===void 0?0:g,C=n.zoom,T=C===void 0?0:C,R=n.pitch,F=R===void 0?0:R,G=n.bearing,q=G===void 0?0:G,te=n.altitude,Se=te===void 0?1.5:te,Ne=n.nearZMultiplier,Ke=n.farZMultiplier;(0,dt.Z)(this,i),a=a||1,s=s||1;var it=W1(T);Se=Math.max(.75,Se);var St=fv([x,v],it);St[2]=0;var Tt=K5({width:a,height:s,pitch:F,bearing:q,altitude:Se,nearZMultiplier:Ne||1/s,farZMultiplier:Ke||1.01}),$t=Y5({height:s,center:St,pitch:F,bearing:q,altitude:Se,flipY:!0});return r=(0,on.Z)(this,(0,_t.Z)(i).call(this,{width:a,height:s,viewMatrix:$t,projectionMatrix:Tt})),r.latitude=v,r.longitude=x,r.zoom=T,r.pitch=F,r.bearing=q,r.altitude=Se,r.scale=it,r.center=St,r.pixelsPerMeter=X1((0,de.Z)((0,de.Z)(r))).pixelsPerMeter[2],Object.freeze((0,de.Z)((0,de.Z)(r))),r}return(0,It.Z)(i,[{key:"projectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return fv(n,a)}},{key:"unprojectFlat",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return um(n,a)}},{key:"getMapCenterByLngLatPosition",value:function(n){var a=n.lngLat,s=n.pos,p=Y1(s,this.pixelUnprojectionMatrix),v=fv(a,this.scale),g=Ei.IH([],v,Ei.tk([],p)),x=Ei.IH([],this.center,g);return um(x,this.scale)}},{key:"getLocationAtPoint",value:function(n){var a=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:a,pos:s})}},{key:"fitBounds",value:function(n){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,v=J5(Object.assign({width:s,height:p,bounds:n},a)),g=v.longitude,x=v.latitude,C=v.zoom;return new i({width:s,height:p,longitude:g,latitude:x,zoom:C})}}]),i}(Q5),eM=function(){function e(){(0,dt.Z)(this,e),(0,A.Z)(this,"viewport",void 0)}return(0,It.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,a=r.zoom,s=r.pitch,p=r.bearing,v=r.viewportHeight,g=r.viewportWidth;this.viewport=new K1({width:g,height:v,longitude:n&&n[0],latitude:n&&n[1],zoom:a,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),tM=function(){function e(i){(0,dt.Z)(this,e),(0,A.Z)(this,"size",1e4),this.size=i||1e4}return(0,It.Z)(e,[{key:"setSize",value:function(r){this.size=r}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(r){return(180+r)/360*this.size}},{key:"mercatorYfromLat",value:function(r){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(r){return r/this.size*360-180}},{key:"latFromMercatorY",value:function(r){var n=180-(1-r/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(r){var n=this.mercatorXfromLng(r[0]),a=this.mercatorYfromLat(r[1]);return[n,a]}},{key:"unproject",value:function(r){var n=this.lngFromMercatorX(r[0]),a=this.latFromMercatorY(r[1]);return[n,a]}}]),e}(),$1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},rM=["id","attributionControl","style","token","rotation","mapInstance"],Q1,J1,ex,tx,rx,nx,Td,ix,ax,ox,sx;function ux(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ux(Object(r),!0).forEach(function(n){(0,A.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ux(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}iM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=d0();var lx={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},aM=0,oM=12,cx="pk.eyJ1IjoiMTg5Njk5NDg2MTkiLCJhIjoiY2s5OXVzdHlzMDVneDNscDVjdzVmeXl0dyJ9.81SQ5qaJS0xExYLbDZAGpQ",sM=(Q1=(0,Wr.b2)(),J1=(0,Wr.f3)(Ht.MapConfig),ex=(0,Wr.f3)(Ht.IGlobalConfigService),tx=(0,Wr.f3)(Ht.ICoordinateSystemService),rx=(0,Wr.f3)(Ht.IEventEmitter),Q1(nx=(Td=function(){function e(){var i=this;(0,dt.Z)(this,e),(0,A.Z)(this,"version",Ls.MAPBOX),(0,A.Z)(this,"map",void 0),(0,A.Z)(this,"simpleMapCoord",new tM),(0,A.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Nn(this,"config",ix,this),Nn(this,"configService",ax,this),Nn(this,"coordinateSystemService",ox,this),Nn(this,"eventEmitter",sx,this),(0,A.Z)(this,"viewport",void 0),(0,A.Z)(this,"markerContainer",void 0),(0,A.Z)(this,"cameraChangedCallback",void 0),(0,A.Z)(this,"$mapContainer",void 0),(0,A.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,a=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[a,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?oM:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Yl.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,It.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=ja("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Xb.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(lx[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(lx[r]||r,n),this.eventEmitter.off(r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},a=this.lngLatToMercator(r,0),s=a.x,p=a.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var a=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=a.x,p=s===void 0?0:s,v=a.y,g=v===void 0?0:v,x=a.z,C=x===void 0?0:x;return{x:p,y:g,z:C}}},{key:"getModelMatrix",value:function(r,n,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},v=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),g=v.meterInMercatorCoordinateUnits(),x=Ki();return up(x,x,qa.fromValues(v.x-p.x,v.y-p.y,v.z||0-p.z)),Hl(x,x,qa.fromValues(g*s[0],-g*s[1],g*s[2])),lp(x,x,a[0]),nf(x,x,a[1]),Ea(x,x,a[2]),x}},{key:"init",value:function(){var i=(0,j.Z)(K().mark(function n(){var a,s,p,v,g,x,C,T,R,F,G,q,te;return K().wrap(function(Ne){for(;;)switch(Ne.prev=Ne.next){case 0:a=this.config,s=a.id,p=s===void 0?"map":s,v=a.attributionControl,g=v===void 0?!1:v,x=a.style,C=x===void 0?"light":x,T=a.token,R=T===void 0?cx:T,F=a.rotation,G=F===void 0?0:F,q=a.mapInstance,te=(0,ro.Z)(a,rM),this.viewport=new eM,!q&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),R===cx&&C!=="blank"&&!window.mapboxgl.accessToken&&!q&&console.warn(this.configService.getSceneWarninfo("MapToken")),!q&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=R),q?(this.map=q,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(p),this.map=new window.mapboxgl.Map(nM({container:this.$mapContainer,style:this.getMapStyle(C),attributionControl:g,bearing:G},te))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Ne.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,a=arguments.length,s=new Array(a>1?a-1:0),p=1;p<a;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var a=new(d0()).LngLat(r[0],r[1]),s=new(d0()).LngLat(n[0],n[1]),p=a.distanceTo(s),v=d0().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),g=d0().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),x=v.x,C=v.y,T=g.x,R=g.y,F=Math.sqrt(Math.pow(x-T,2)+Math.pow(C-R,2))*4194304*2;return F/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),a=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return a}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var a=document.createElement("div");return a.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,a.id="l7_mapbox_div"+aM++,n.appendChild(a),a}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:$1[r]?$1[r]:r}}]),e}(),ix=si(Td.prototype,"config",[J1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=si(Td.prototype,"configService",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=si(Td.prototype,"coordinateSystemService",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=si(Td.prototype,"eventEmitter",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td))||nx);function uM(e){var i=lM();return function(){var n=(0,_t.Z)(e),a;if(i){var s=(0,_t.Z)(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return(0,on.Z)(this,a)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function cM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var a=i.head||i.getElementsByTagName("head")[0];if(!a){a=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):i.documentElement.appendChild(a)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),a.appendChild(p),p}}cM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var fM=function(e){(0,Ir.Z)(r,e);var i=uM(r);function r(){return(0,dt.Z)(this,r),i.apply(this,arguments)}return(0,It.Z)(r,[{key:"getServiceConstructor",value:function(){return sM}}]),r}(G5);function fx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function px(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fx(Object(r),!0).forEach(function(n){pM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function pM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function hM(e,i){return gM(e)||mM(e,i)||vM(e,i)||dM()}function dM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vM(e,i){if(!!e){if(typeof e=="string")return hx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hx(e,i)}}function hx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function gM(e){if(Array.isArray(e))return e}var yM=re.memo(function(e){var i=e.style,r=e.className,n=e.map,a=e.option,s=e.onSceneLoaded,p=(0,re.createRef)(),v=(0,re.useState)(),g=hM(v,2),x=g[0],C=g[1];return(0,re.useEffect)(function(){var T=new SE(px(px({id:p.current},a),{},{map:new fM(n)}));return T.on("loaded",function(){C(T),s&&s(T)}),function(){T.destroy()}},[]),(0,re.useEffect)(function(){x&&n.style&&x.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,re.useEffect)(function(){x&&n.zoom&&x.setZoom(n.zoom)},[n.zoom]),(0,re.useEffect)(function(){x&&n.center&&x.setCenter(n.center)},[JSON.stringify(n.center)]),(0,re.useEffect)(function(){x&&n.pitch!==void 0&&x.setPitch(n.pitch||0)},[n.pitch]),(0,re.useEffect)(function(){x&&n.rotation&&x.setRotation(n.rotation)},[n.rotation]),re.createElement(m.Provider,{value:x},(0,re.createElement)("div",{ref:p,style:i,className:r},x&&e.children))}),_M=yM;function dx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function KP(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?dx(Object(r),!0).forEach(function(n){xM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function $P(e,i){return CM(e)||SM(e,i)||EM(e,i)||bM()}function bM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EM(e,i){if(!!e){if(typeof e=="string")return vx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return vx(e,i)}}function vx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function SM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function CM(e){if(Array.isArray(e))return e}var QP=null,JP=null;function mx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function e4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?mx(Object(r),!0).forEach(function(n){AM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function t4(e,i){return PM(e)||MM(e,i)||TM(e,i)||wM()}function wM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TM(e,i){if(!!e){if(typeof e=="string")return gx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gx(e,i)}}function gx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function MM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function PM(e){if(Array.isArray(e))return e}var r4=null,n4=null;function i4(e,i){return LM(e)||RM(e,i)||OM(e,i)||IM()}function IM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OM(e,i){if(!!e){if(typeof e=="string")return yx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yx(e,i)}}function yx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function RM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function LM(e){if(Array.isArray(e))return e}var a4=null,o4=null;function _x(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function s4(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?_x(Object(r),!0).forEach(function(n){kM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_x(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function u4(e,i){if(e==null)return{};var r=DM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function DM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var l4=null,xx=U(73935);function bx(e,i){return zM(e)||NM(e,i)||BM(e,i)||FM()}function FM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BM(e,i){if(!!e){if(typeof e=="string")return Ex(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ex(e,i)}}function Ex(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function NM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function zM(e){if(Array.isArray(e))return e}var Sx=re.useEffect,Cx=re.useState,UM=/\B([A-Z])/g,ZM=function(i){return i.replace(UM,"-$1").toLowerCase()};function c4(e){var i=e.className,r=e.style,n=e.children,a=e.position,s=Cx(),p=bx(s,2),v=p[0],g=p[1],x=useSceneValue(),C=Cx(function(){return document.createElement("div")}),T=bx(C,1),R=T[0];return Sx(function(){var F=new Control({position:a});return F.onAdd=function(){if(i&&(R.className=i),r){var G=Object.keys(r).map(function(q){return"".concat(ZM(q),":").concat(r[q])}).join(";");R.style.cssText=G}return R},F.onRemove=function(){},g(F),x.addControl(F),function(){x.removeControl(F)}},[]),Sx(function(){v&&v.setPosition(a||"bottomleft")},[a]),createPortal(n,R)}var Ax=(0,re.createContext)({});function f4(){return useContext(Ax)}var Zf=U(96486),p4=re.useEffect,jM=re.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Zf.isEqual),h4=re.useEffect,VM=re.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Zf.isEqual),d4=re.useEffect,GM=re.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Zf.isEqual),HM=re.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Zf.isEqual),WM=re.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Zf.isEqual),v4=re.useEffect,XM=re.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Zf.isEqual),YM=re.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Zf.isEqual),qM=re.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Zf.isEqual),KM=["data"];function $M(e,i){if(e==null)return{};var r=QM(e,i),n,a;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)n=s[a],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function QM(e,i){if(e==null)return{};var r={},n=Object.keys(e),a,s;for(s=0;s<n.length;s++)a=n[s],!(i.indexOf(a)>=0)&&(r[a]=e[a]);return r}var JM=re.memo(function(i){var r=i.layer,n=i.source,a=n.data,s=$M(n,KM);return r.inited?r.setData(a,s):r.source(a,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Zf.isEqual),m4=re.useEffect,e3=re.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Zf.isEqual);function t3(e,i){return a3(e)||i3(e,i)||n3(e,i)||r3()}function r3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function n3(e,i){if(!!e){if(typeof e=="string")return Tx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tx(e,i)}}function Tx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function i3(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],a=!0,s=!1,p,v;try{for(r=r.call(e);!(a=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));a=!0);}catch(g){s=!0,v=g}finally{try{!a&&r.return!=null&&r.return()}finally{if(s)throw v}}return n}}function a3(e){if(Array.isArray(e))return e}var m0=re.useEffect,o3=re.useState;function Mx(e,i){var r=i.source,n=i.color,a=i.shape,s=i.style,p=i.size,v=i.scale,g=i.active,x=i.select,C=i.filter,T=i.animate,R=i.options,F=i.onLayerLoaded,G=he(),q=o3(function(){var Ne;switch(e){case"polygonLayer":Ne=new My(R);break;case"lineLayer":Ne=new yC(R);break;case"pointLayer":Ne=new xA(R);break;case"heatmapLayer":Ne=new oS(R);break;case"rasterLayer":Ne=new aw(R);break;case"imageLayer":Ne=new mS(R);break;case"citybuildingLayer":Ne=new OE(R);break;default:Ne=new My(R)}return Ne.on("inited",function(){F&&F(Ne,G)}),Ne}),te=t3(q,1),Se=te[0];return m0(function(){return G.addLayer(Se),function(){G.removeLayer(Se)}},[]),m0(function(){Se.inited&&R&&Se.updateLayerConfig(R)},[R==null?void 0:R.minZoom,R==null?void 0:R.maxZoom,R==null?void 0:R.visible]),m0(function(){Se.inited&&(R==null?void 0:R.zIndex)&&Se.setIndex(R.zIndex)},[R==null?void 0:R.zIndex]),m0(function(){Se.inited&&(R==null?void 0:R.blend)&&Se.setBlend(R.blend)},[R==null?void 0:R.blend]),m0(function(){G.render()}),re.createElement(Ax.Provider,{value:Se},re.createElement(JM,{layer:Se,source:r}),v&&re.createElement(WM,{layer:Se,scale:v}),n&&re.createElement(GM,{layer:Se,color:n}),p&&re.createElement(qM,{layer:Se,size:p}),a&&re.createElement(YM,{layer:Se,shape:a}),s&&re.createElement(e3,{layer:Se,style:s}),g&&re.createElement(jM,{layer:Se,active:g}),x&&re.createElement(XM,{layer:Se,select:x}),C&&re.createElement(HM,{layer:Se,filter:C}),T&&re.createElement(VM,{layer:Se,animate:T}),i.children)}var g4=null,y4=null,s3=re.memo(function(i){return Mx("pointLayer",i)}),u3=re.memo(function(i){return Mx("heatmapLayer",i)}),_4=null,x4=null,b4=null,E4=re.useEffect,S4=null,C4=null;function pv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?pv=function(r){return typeof r}:pv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},pv(e)}function Px(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function hv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Px(Object(r),!0).forEach(function(n){l3(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Px(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function l3(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function c3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ix(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function f3(e,i,r){return i&&Ix(e.prototype,i),r&&Ix(e,r),e}function p3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&lm(e,i)}function lm(e,i){return lm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},lm(e,i)}function h3(e){var i=m3();return function(){var n=dv(e),a;if(i){var s=dv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return d3(this,a)}}function d3(e,i){if(i&&(pv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return v3(e)}function v3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function dv(e){return dv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},dv(e)}var A4=function(e){p3(r,e);var i=h3(r);function r(n){var a;return c3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.popup=void 0,a.el=document.createElement("div"),a}return f3(r,[{key:"componentDidMount",value:function(){var a,s=this.props,p=s.lnglat,v=s.children,g=s.option,x=s.lngLat,C=new dg(hv(hv({},g),{},{stopPropagation:(a=this.props.option)===null||a===void 0?void 0:a.stopPropagation}));p&&C.setLnglat(p),x&&C.setLnglat(x),v&&C.setDOMContent(this.el),this.popup=C,this.scene.addPopup(C)}},{key:"componentDidUpdate",value:function(a){var s,p,v,g,x,C,T=Array.isArray(a.lnglat)?a.lnglat:[a==null||(s=a.lnglat)===null||s===void 0?void 0:s.lng,a==null||(p=a.lnglat)===null||p===void 0?void 0:p.lat],R=Array.isArray(this.props.lnglat)?this.props.lnglat:[(v=this.props)===null||v===void 0||(g=v.lnglat)===null||g===void 0?void 0:g.lng,(x=this.props)===null||x===void 0||(C=x.lnglat)===null||C===void 0?void 0:C.lat],F=T.toString()!==R.toString();if(F){var G;this.popup.remove(),this.popup=new dg(hv(hv({},this.props.option),{},{stopPropagation:(G=this.props.option)===null||G===void 0?void 0:G.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var a=this;return re.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,xx.createPortal)(a.props.children,a.el)})}}]),r}(re.PureComponent);function vv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vv=function(r){return typeof r}:vv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},vv(e)}function g3(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ox(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y3(e,i,r){return i&&Ox(e.prototype,i),r&&Ox(e,r),e}function _3(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&cm(e,i)}function cm(e,i){return cm=Object.setPrototypeOf||function(n,a){return n.__proto__=a,n},cm(e,i)}function x3(e){var i=S3();return function(){var n=mv(e),a;if(i){var s=mv(this).constructor;a=Reflect.construct(n,arguments,s)}else a=n.apply(this,arguments);return b3(this,a)}}function b3(e,i){if(i&&(vv(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return E3(e)}function E3(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function mv(e){return mv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},mv(e)}var w4=function(e){_3(r,e);var i=x3(r);function r(n){var a;return g3(this,r),a=i.call(this,n),a.el=void 0,a.scene=void 0,a.marker=void 0,a.el=document.createElement("div"),a}return y3(r,[{key:"componentDidMount",value:function(){var a=this.props,s=a.lnglat,p=a.children,v=a.option,g=a.onMarkerLoaded,x=new lg(v);s&&x.setLnglat(s),p&&x.setElement(this.el),this.marker=x,g&&g(x),this.scene.addMarker(x)}},{key:"componentDidUpdate",value:function(a){var s,p=(a==null?void 0:a.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var a=this;return re.createElement(m.Consumer,{},function(s){return s&&(a.scene=s),(0,xx.createPortal)(a.props.children,a.el)})}}]),r}(re.PureComponent),T4=re.useEffect,M4=null,P4=null,I4=re.useEffect,O4=null},66213:function(Mt,Q,U){"use strict";U.d(Q,{Z:function(){return m}});var ie=U(77608);function re(he,V){for(;!Object.prototype.hasOwnProperty.call(he,V)&&(he=(0,ie.Z)(he),he!==null););return he}function m(){return typeof Reflect!="undefined"&&Reflect.get?m=Reflect.get:m=function(V,ue,ce){var Le=re(V,ue);if(!!Le){var ee=Object.getOwnPropertyDescriptor(Le,ue);return ee.get?ee.get.call(arguments.length<3?V:ce):ee.value}},m.apply(this,arguments)}},31795:function(Mt,Q,U){var ie=U(75752);Mt.exports.geometry=re,Mt.exports.ring=he;function re(ue){var ce=0,Le;switch(ue.type){case"Polygon":return m(ue.coordinates);case"MultiPolygon":for(Le=0;Le<ue.coordinates.length;Le++)ce+=m(ue.coordinates[Le]);return ce;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Le=0;Le<ue.geometries.length;Le++)ce+=re(ue.geometries[Le]);return ce}}function m(ue){var ce=0;if(ue&&ue.length>0){ce+=Math.abs(he(ue[0]));for(var Le=1;Le<ue.length;Le++)ce-=Math.abs(he(ue[Le]))}return ce}function he(ue){var ce,Le,ee,Xe,Je,Ze,gt,tr=0,yt=ue.length;if(yt>2){for(gt=0;gt<yt;gt++)gt===yt-2?(Xe=yt-2,Je=yt-1,Ze=0):gt===yt-1?(Xe=yt-1,Je=0,Ze=1):(Xe=gt,Je=gt+1,Ze=gt+2),ce=ue[Xe],Le=ue[Je],ee=ue[Ze],tr+=(V(ee[0])-V(ce[0]))*Math.sin(V(Le[1]));tr=tr*ie.RADIUS*ie.RADIUS/2}return tr}function V(ue){return ue*Math.PI/180}},38163:function(Mt,Q,U){var ie=U(31795);Mt.exports=re;function re(Le,ee){switch(Le&&Le.type||null){case"FeatureCollection":return Le.features=Le.features.map(m(re,ee)),Le;case"GeometryCollection":return Le.geometries=Le.geometries.map(m(re,ee)),Le;case"Feature":return Le.geometry=re(Le.geometry,ee),Le;case"Polygon":case"MultiPolygon":return he(Le,ee);default:return Le}}function m(Le,ee){return function(Xe){return Le(Xe,ee)}}function he(Le,ee){return Le.type==="Polygon"?Le.coordinates=V(Le.coordinates,ee):Le.type==="MultiPolygon"&&(Le.coordinates=Le.coordinates.map(m(V,ee))),Le}function V(Le,ee){ee=!!ee,Le[0]=ue(Le[0],ee);for(var Xe=1;Xe<Le.length;Xe++)Le[Xe]=ue(Le[Xe],!ee);return Le}function ue(Le,ee){return ce(Le)===ee?Le:Le.reverse()}function ce(Le){return ie.ring(Le)>=0}},53645:function(){},9187:function(Mt){"use strict";Mt.exports=Q,Mt.exports.default=Q;function Q(A,Ae,De){De=De||2;var At=Ae&&Ae.length,mt=At?Ae[0]*De:A.length,Ft=U(A,0,mt,De,!0),Yt=[];if(!Ft||Ft.next===Ft.prev)return Yt;var Sr,qn,hn,fi,Gn,ni,pi;if(At&&(Ft=ce(A,Ae,Ft,De)),A.length>80*De){Sr=hn=A[0],qn=fi=A[1];for(var Wn=De;Wn<mt;Wn+=De)Gn=A[Wn],ni=A[Wn+1],Gn<Sr&&(Sr=Gn),ni<qn&&(qn=ni),Gn>hn&&(hn=Gn),ni>fi&&(fi=ni);pi=Math.max(hn-Sr,fi-qn),pi=pi!==0?1/pi:0}return re(Ft,Yt,De,Sr,qn,pi),Yt}function U(A,Ae,De,At,mt){var Ft,Yt;if(mt===Kr(A,Ae,De,At)>0)for(Ft=Ae;Ft<De;Ft+=At)Yt=Kt(Ft,A[Ft],A[Ft+1],Yt);else for(Ft=De-At;Ft>=Ae;Ft-=At)Yt=Kt(Ft,A[Ft],A[Ft+1],Yt);return Yt&&nt(Yt,Yt.next)&&(xr(Yt),Yt=Yt.next),Yt}function ie(A,Ae){if(!A)return A;Ae||(Ae=A);var De=A,At;do if(At=!1,!De.steiner&&(nt(De,De.next)||at(De.prev,De,De.next)===0)){if(xr(De),De=Ae=De.prev,De===De.next)break;At=!0}else De=De.next;while(At||De!==Ae);return Ae}function re(A,Ae,De,At,mt,Ft,Yt){if(!!A){!Yt&&Ft&&Ze(A,At,mt,Ft);for(var Sr=A,qn,hn;A.prev!==A.next;){if(qn=A.prev,hn=A.next,Ft?he(A,At,mt,Ft):m(A)){Ae.push(qn.i/De),Ae.push(A.i/De),Ae.push(hn.i/De),xr(A),A=hn.next,Sr=hn.next;continue}if(A=hn,A===Sr){Yt?Yt===1?(A=V(ie(A),Ae,De),re(A,Ae,De,At,mt,Ft,2)):Yt===2&&ue(A,Ae,De,At,mt,Ft):re(ie(A),Ae,De,At,mt,Ft,1);break}}}}function m(A){var Ae=A.prev,De=A,At=A.next;if(at(Ae,De,At)>=0)return!1;for(var mt=A.next.next;mt!==A.prev;){if(Wt(Ae.x,Ae.y,De.x,De.y,At.x,At.y,mt.x,mt.y)&&at(mt.prev,mt,mt.next)>=0)return!1;mt=mt.next}return!0}function he(A,Ae,De,At){var mt=A.prev,Ft=A,Yt=A.next;if(at(mt,Ft,Yt)>=0)return!1;for(var Sr=mt.x<Ft.x?mt.x<Yt.x?mt.x:Yt.x:Ft.x<Yt.x?Ft.x:Yt.x,qn=mt.y<Ft.y?mt.y<Yt.y?mt.y:Yt.y:Ft.y<Yt.y?Ft.y:Yt.y,hn=mt.x>Ft.x?mt.x>Yt.x?mt.x:Yt.x:Ft.x>Yt.x?Ft.x:Yt.x,fi=mt.y>Ft.y?mt.y>Yt.y?mt.y:Yt.y:Ft.y>Yt.y?Ft.y:Yt.y,Gn=tr(Sr,qn,Ae,De,At),ni=tr(hn,fi,Ae,De,At),pi=A.prevZ,Wn=A.nextZ;pi&&pi.z>=Gn&&Wn&&Wn.z<=ni;){if(pi!==A.prev&&pi!==A.next&&Wt(mt.x,mt.y,Ft.x,Ft.y,Yt.x,Yt.y,pi.x,pi.y)&&at(pi.prev,pi,pi.next)>=0||(pi=pi.prevZ,Wn!==A.prev&&Wn!==A.next&&Wt(mt.x,mt.y,Ft.x,Ft.y,Yt.x,Yt.y,Wn.x,Wn.y)&&at(Wn.prev,Wn,Wn.next)>=0))return!1;Wn=Wn.nextZ}for(;pi&&pi.z>=Gn;){if(pi!==A.prev&&pi!==A.next&&Wt(mt.x,mt.y,Ft.x,Ft.y,Yt.x,Yt.y,pi.x,pi.y)&&at(pi.prev,pi,pi.next)>=0)return!1;pi=pi.prevZ}for(;Wn&&Wn.z<=ni;){if(Wn!==A.prev&&Wn!==A.next&&Wt(mt.x,mt.y,Ft.x,Ft.y,Yt.x,Yt.y,Wn.x,Wn.y)&&at(Wn.prev,Wn,Wn.next)>=0)return!1;Wn=Wn.nextZ}return!0}function V(A,Ae,De){var At=A;do{var mt=At.prev,Ft=At.next.next;!nt(mt,Ft)&&Zt(mt,At,At.next,Ft)&&Qe(mt,Ft)&&Qe(Ft,mt)&&(Ae.push(mt.i/De),Ae.push(At.i/De),Ae.push(Ft.i/De),xr(At),xr(At.next),At=A=Ft),At=At.next}while(At!==A);return ie(At)}function ue(A,Ae,De,At,mt,Ft){var Yt=A;do{for(var Sr=Yt.next.next;Sr!==Yt.prev;){if(Yt.i!==Sr.i&&bt(Yt,Sr)){var qn=$e(Yt,Sr);Yt=ie(Yt,Yt.next),qn=ie(qn,qn.next),re(Yt,Ae,De,At,mt,Ft),re(qn,Ae,De,At,mt,Ft);return}Sr=Sr.next}Yt=Yt.next}while(Yt!==A)}function ce(A,Ae,De,At){var mt=[],Ft,Yt,Sr,qn,hn;for(Ft=0,Yt=Ae.length;Ft<Yt;Ft++)Sr=Ae[Ft]*At,qn=Ft<Yt-1?Ae[Ft+1]*At:A.length,hn=U(A,Sr,qn,At,!1),hn===hn.next&&(hn.steiner=!0),mt.push(yt(hn));for(mt.sort(Le),Ft=0;Ft<mt.length;Ft++)De=ee(mt[Ft],De),De=ie(De,De.next);return De}function Le(A,Ae){return A.x-Ae.x}function ee(A,Ae){var De=Xe(A,Ae);if(!De)return Ae;var At=$e(De,A),mt=ie(De,De.next);return ie(At,At.next),Ae===De?mt:Ae}function Xe(A,Ae){var De=Ae,At=A.x,mt=A.y,Ft=-Infinity,Yt;do{if(mt<=De.y&&mt>=De.next.y&&De.next.y!==De.y){var Sr=De.x+(mt-De.y)*(De.next.x-De.x)/(De.next.y-De.y);if(Sr<=At&&Sr>Ft){if(Ft=Sr,Sr===At){if(mt===De.y)return De;if(mt===De.next.y)return De.next}Yt=De.x<De.next.x?De:De.next}}De=De.next}while(De!==Ae);if(!Yt)return null;if(At===Ft)return Yt;var qn=Yt,hn=Yt.x,fi=Yt.y,Gn=Infinity,ni;De=Yt;do At>=De.x&&De.x>=hn&&At!==De.x&&Wt(mt<fi?At:Ft,mt,hn,fi,mt<fi?Ft:At,mt,De.x,De.y)&&(ni=Math.abs(mt-De.y)/(At-De.x),Qe(De,A)&&(ni<Gn||ni===Gn&&(De.x>Yt.x||De.x===Yt.x&&Je(Yt,De)))&&(Yt=De,Gn=ni)),De=De.next;while(De!==qn);return Yt}function Je(A,Ae){return at(A.prev,A,Ae.prev)<0&&at(Ae.next,A,A.next)<0}function Ze(A,Ae,De,At){var mt=A;do mt.z===null&&(mt.z=tr(mt.x,mt.y,Ae,De,At)),mt.prevZ=mt.prev,mt.nextZ=mt.next,mt=mt.next;while(mt!==A);mt.prevZ.nextZ=null,mt.prevZ=null,gt(mt)}function gt(A){var Ae,De,At,mt,Ft,Yt,Sr,qn,hn=1;do{for(De=A,A=null,Ft=null,Yt=0;De;){for(Yt++,At=De,Sr=0,Ae=0;Ae<hn&&(Sr++,At=At.nextZ,!!At);Ae++);for(qn=hn;Sr>0||qn>0&&At;)Sr!==0&&(qn===0||!At||De.z<=At.z)?(mt=De,De=De.nextZ,Sr--):(mt=At,At=At.nextZ,qn--),Ft?Ft.nextZ=mt:A=mt,mt.prevZ=Ft,Ft=mt;De=At}Ft.nextZ=null,hn*=2}while(Yt>1);return A}function tr(A,Ae,De,At,mt){return A=32767*(A-De)*mt,Ae=32767*(Ae-At)*mt,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,Ae=(Ae|Ae<<8)&16711935,Ae=(Ae|Ae<<4)&252645135,Ae=(Ae|Ae<<2)&858993459,Ae=(Ae|Ae<<1)&1431655765,A|Ae<<1}function yt(A){var Ae=A,De=A;do(Ae.x<De.x||Ae.x===De.x&&Ae.y<De.y)&&(De=Ae),Ae=Ae.next;while(Ae!==A);return De}function Wt(A,Ae,De,At,mt,Ft,Yt,Sr){return(mt-Yt)*(Ae-Sr)-(A-Yt)*(Ft-Sr)>=0&&(A-Yt)*(At-Sr)-(De-Yt)*(Ae-Sr)>=0&&(De-Yt)*(Ft-Sr)-(mt-Yt)*(At-Sr)>=0}function bt(A,Ae){return A.next.i!==Ae.i&&A.prev.i!==Ae.i&&!ut(A,Ae)&&(Qe(A,Ae)&&Qe(Ae,A)&&Ct(A,Ae)&&(at(A.prev,A,Ae.prev)||at(A,Ae.prev,Ae))||nt(A,Ae)&&at(A.prev,A,A.next)>0&&at(Ae.prev,Ae,Ae.next)>0)}function at(A,Ae,De){return(Ae.y-A.y)*(De.x-Ae.x)-(Ae.x-A.x)*(De.y-Ae.y)}function nt(A,Ae){return A.x===Ae.x&&A.y===Ae.y}function Zt(A,Ae,De,At){var mt=qt(at(A,Ae,De)),Ft=qt(at(A,Ae,At)),Yt=qt(at(De,At,A)),Sr=qt(at(De,At,Ae));return!!(mt!==Ft&&Yt!==Sr||mt===0&&Y(A,De,Ae)||Ft===0&&Y(A,At,Ae)||Yt===0&&Y(De,A,At)||Sr===0&&Y(De,Ae,At))}function Y(A,Ae,De){return Ae.x<=Math.max(A.x,De.x)&&Ae.x>=Math.min(A.x,De.x)&&Ae.y<=Math.max(A.y,De.y)&&Ae.y>=Math.min(A.y,De.y)}function qt(A){return A>0?1:A<0?-1:0}function ut(A,Ae){var De=A;do{if(De.i!==A.i&&De.next.i!==A.i&&De.i!==Ae.i&&De.next.i!==Ae.i&&Zt(De,De.next,A,Ae))return!0;De=De.next}while(De!==A);return!1}function Qe(A,Ae){return at(A.prev,A,A.next)<0?at(A,Ae,A.next)>=0&&at(A,A.prev,Ae)>=0:at(A,Ae,A.prev)<0||at(A,A.next,Ae)<0}function Ct(A,Ae){var De=A,At=!1,mt=(A.x+Ae.x)/2,Ft=(A.y+Ae.y)/2;do De.y>Ft!=De.next.y>Ft&&De.next.y!==De.y&&mt<(De.next.x-De.x)*(Ft-De.y)/(De.next.y-De.y)+De.x&&(At=!At),De=De.next;while(De!==A);return At}function $e(A,Ae){var De=new kr(A.i,A.x,A.y),At=new kr(Ae.i,Ae.x,Ae.y),mt=A.next,Ft=Ae.prev;return A.next=Ae,Ae.prev=A,De.next=mt,mt.prev=De,At.next=De,De.prev=At,Ft.next=At,At.prev=Ft,At}function Kt(A,Ae,De,At){var mt=new kr(A,Ae,De);return At?(mt.next=At.next,mt.prev=At,At.next.prev=mt,At.next=mt):(mt.prev=mt,mt.next=mt),mt}function xr(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function kr(A,Ae,De){this.i=A,this.x=Ae,this.y=De,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}Q.deviation=function(A,Ae,De,At){var mt=Ae&&Ae.length,Ft=mt?Ae[0]*De:A.length,Yt=Math.abs(Kr(A,0,Ft,De));if(mt)for(var Sr=0,qn=Ae.length;Sr<qn;Sr++){var hn=Ae[Sr]*De,fi=Sr<qn-1?Ae[Sr+1]*De:A.length;Yt-=Math.abs(Kr(A,hn,fi,De))}var Gn=0;for(Sr=0;Sr<At.length;Sr+=3){var ni=At[Sr]*De,pi=At[Sr+1]*De,Wn=At[Sr+2]*De;Gn+=Math.abs((A[ni]-A[Wn])*(A[pi+1]-A[ni+1])-(A[ni]-A[pi])*(A[Wn+1]-A[ni+1]))}return Yt===0&&Gn===0?0:Math.abs((Gn-Yt)/Yt)};function Kr(A,Ae,De,At){for(var mt=0,Ft=Ae,Yt=De-At;Ft<De;Ft+=At)mt+=(A[Yt]-A[Ft])*(A[Ft+1]+A[Yt+1]),Yt=Ft;return mt}Q.flatten=function(A){for(var Ae=A[0][0].length,De={vertices:[],holes:[],dimensions:Ae},At=0,mt=0;mt<A.length;mt++){for(var Ft=0;Ft<A[mt].length;Ft++)for(var Yt=0;Yt<Ae;Yt++)De.vertices.push(A[mt][Ft][Yt]);mt>0&&(At+=A[mt-1].length,De.holes.push(At))}return De}},67709:function(Mt){function Q(ie){var re=ie.target||ie.srcElement;re.__resizeRAF__&&cancelAnimationFrame(re.__resizeRAF__),re.__resizeRAF__=requestAnimationFrame(function(){var m=re.__resizeTrigger__,he=m&&m.__resizeListeners__;he&&he.forEach(function(V){V.call(m,ie)})})}var U=function(re,m){var he=this,V=he.document,ue,ce=V.attachEvent;typeof navigator!="undefined"&&(ue=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Le(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",Q)}if(!re.__resizeListeners__)if(re.__resizeListeners__=[],ce)re.__resizeTrigger__=re,re.attachEvent("onresize",Q);else{getComputedStyle(re).position==="static"&&(re.style.position="relative");var ee=re.__resizeTrigger__=V.createElement("object");ee.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ee.setAttribute("class","resize-sensor"),ee.setAttribute("tabindex","-1"),ee.setAttribute("title",""),ee.__resizeElement__=re,ee.onload=Le,ee.type="text/html",ue&&re.appendChild(ee),ee.data="about:blank",ue||re.appendChild(ee)}re.__resizeListeners__.push(m)};Mt.exports=typeof window=="undefined"?U:U.bind(window),Mt.exports.unbind=function(ie,re){var m=document.attachEvent,he=ie.__resizeListeners__||[];if(re){var V=he.indexOf(re);V!==-1&&he.splice(V,1)}else he=ie.__resizeListeners__=[];if(!he.length){if(m)ie.detachEvent("onresize",Q);else if(ie.__resizeTrigger__){var ue=ie.__resizeTrigger__.contentDocument,ce=ue&&ue.defaultView;ce&&(ce.removeEventListener("resize",Q),delete ce.__resizeTrigger__),ie.__resizeTrigger__=!ie.removeChild(ie.__resizeTrigger__)}delete ie.__resizeListeners__}}},26729:function(Mt){"use strict";var Q=Object.prototype.hasOwnProperty,U="~";function ie(){}Object.create&&(ie.prototype=Object.create(null),new ie().__proto__||(U=!1));function re(ue,ce,Le){this.fn=ue,this.context=ce,this.once=Le||!1}function m(ue,ce,Le,ee,Xe){if(typeof Le!="function")throw new TypeError("The listener must be a function");var Je=new re(Le,ee||ue,Xe),Ze=U?U+ce:ce;return ue._events[Ze]?ue._events[Ze].fn?ue._events[Ze]=[ue._events[Ze],Je]:ue._events[Ze].push(Je):(ue._events[Ze]=Je,ue._eventsCount++),ue}function he(ue,ce){--ue._eventsCount==0?ue._events=new ie:delete ue._events[ce]}function V(){this._events=new ie,this._eventsCount=0}V.prototype.eventNames=function(){var ce=[],Le,ee;if(this._eventsCount===0)return ce;for(ee in Le=this._events)Q.call(Le,ee)&&ce.push(U?ee.slice(1):ee);return Object.getOwnPropertySymbols?ce.concat(Object.getOwnPropertySymbols(Le)):ce},V.prototype.listeners=function(ce){var Le=U?U+ce:ce,ee=this._events[Le];if(!ee)return[];if(ee.fn)return[ee.fn];for(var Xe=0,Je=ee.length,Ze=new Array(Je);Xe<Je;Xe++)Ze[Xe]=ee[Xe].fn;return Ze},V.prototype.listenerCount=function(ce){var Le=U?U+ce:ce,ee=this._events[Le];return ee?ee.fn?1:ee.length:0},V.prototype.emit=function(ce,Le,ee,Xe,Je,Ze){var gt=U?U+ce:ce;if(!this._events[gt])return!1;var tr=this._events[gt],yt=arguments.length,Wt,bt;if(tr.fn){switch(tr.once&&this.removeListener(ce,tr.fn,void 0,!0),yt){case 1:return tr.fn.call(tr.context),!0;case 2:return tr.fn.call(tr.context,Le),!0;case 3:return tr.fn.call(tr.context,Le,ee),!0;case 4:return tr.fn.call(tr.context,Le,ee,Xe),!0;case 5:return tr.fn.call(tr.context,Le,ee,Xe,Je),!0;case 6:return tr.fn.call(tr.context,Le,ee,Xe,Je,Ze),!0}for(bt=1,Wt=new Array(yt-1);bt<yt;bt++)Wt[bt-1]=arguments[bt];tr.fn.apply(tr.context,Wt)}else{var at=tr.length,nt;for(bt=0;bt<at;bt++)switch(tr[bt].once&&this.removeListener(ce,tr[bt].fn,void 0,!0),yt){case 1:tr[bt].fn.call(tr[bt].context);break;case 2:tr[bt].fn.call(tr[bt].context,Le);break;case 3:tr[bt].fn.call(tr[bt].context,Le,ee);break;case 4:tr[bt].fn.call(tr[bt].context,Le,ee,Xe);break;default:if(!Wt)for(nt=1,Wt=new Array(yt-1);nt<yt;nt++)Wt[nt-1]=arguments[nt];tr[bt].fn.apply(tr[bt].context,Wt)}}return!0},V.prototype.on=function(ce,Le,ee){return m(this,ce,Le,ee,!1)},V.prototype.once=function(ce,Le,ee){return m(this,ce,Le,ee,!0)},V.prototype.removeListener=function(ce,Le,ee,Xe){var Je=U?U+ce:ce;if(!this._events[Je])return this;if(!Le)return he(this,Je),this;var Ze=this._events[Je];if(Ze.fn)Ze.fn===Le&&(!Xe||Ze.once)&&(!ee||Ze.context===ee)&&he(this,Je);else{for(var gt=0,tr=[],yt=Ze.length;gt<yt;gt++)(Ze[gt].fn!==Le||Xe&&!Ze[gt].once||ee&&Ze[gt].context!==ee)&&tr.push(Ze[gt]);tr.length?this._events[Je]=tr.length===1?tr[0]:tr:he(this,Je)}return this},V.prototype.removeAllListeners=function(ce){var Le;return ce?(Le=U?U+ce:ce,this._events[Le]&&he(this,Le)):(this._events=new ie,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=U,V.EventEmitter=V,Mt.exports=V},7375:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0});var U=Symbol.for("INJECTION");function ie(ue,ce,Le,ee){function Xe(){return ee&&!Reflect.hasMetadata(U,this,ce)&&Reflect.defineMetadata(U,Le(),this,ce),Reflect.hasMetadata(U,this,ce)?Reflect.getMetadata(U,this,ce):Le()}function Je(Ze){Reflect.defineMetadata(U,Ze,this,ce)}Object.defineProperty(ue,ce,{configurable:!0,enumerable:!0,get:Xe,set:Je})}function re(ue,ce){return function(Le){return function(ee,Xe){var Je=function(){return ue.get(Le)};ie(ee,Xe,Je,ce)}}}Q.makePropertyInjectDecorator=re;function m(ue,ce){return function(Le,ee){return function(Xe,Je){var Ze=function(){return ue.getNamed(Le,ee)};ie(Xe,Je,Ze,ce)}}}Q.makePropertyInjectNamedDecorator=m;function he(ue,ce){return function(Le,ee,Xe){return function(Je,Ze){var gt=function(){return ue.getTagged(Le,ee,Xe)};ie(Je,Ze,gt,ce)}}}Q.makePropertyInjectTaggedDecorator=he;function V(ue,ce){return function(Le){return function(ee,Xe){var Je=function(){return ue.getAll(Le)};ie(ee,Xe,Je,ce)}}}Q.makePropertyMultiInjectDecorator=V},84879:function(Mt,Q,U){"use strict";var ie;ie={value:!0};var re=U(7375);function m(he,V){V===void 0&&(V=!0);var ue=re.makePropertyInjectDecorator(he,V),ce=re.makePropertyInjectNamedDecorator(he,V),Le=re.makePropertyInjectTaggedDecorator(he,V),ee=re.makePropertyMultiInjectDecorator(he,V);return{lazyInject:ue,lazyInjectNamed:ce,lazyInjectTagged:Le,lazyMultiInject:ee}}Q.Z=m},99934:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagProperty=Q.tagParameter=Q.decorate=void 0;var ie=U(16674),re=U(6867);function m(ee,Xe,Je,Ze){var gt=re.TAGGED;V(gt,ee,Xe,Ze,Je)}Q.tagParameter=m;function he(ee,Xe,Je){var Ze=re.TAGGED_PROP;V(Ze,ee.constructor,Xe,Je)}Q.tagProperty=he;function V(ee,Xe,Je,Ze,gt){var tr={},yt=typeof gt=="number",Wt=gt!==void 0&&yt?gt.toString():Je;if(yt&&Je!==void 0)throw new Error(ie.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ee,Xe)&&(tr=Reflect.getMetadata(ee,Xe));var bt=tr[Wt];if(!Array.isArray(bt))bt=[];else for(var at=0,nt=bt;at<nt.length;at++){var Zt=nt[at];if(Zt.key===Ze.key)throw new Error(ie.DUPLICATED_METADATA+" "+Zt.key.toString())}bt.push(Ze),tr[Wt]=bt,Reflect.defineMetadata(ee,tr,Xe)}function ue(ee,Xe){Reflect.decorate(ee,Xe)}function ce(ee,Xe){return function(Je,Ze){Xe(Je,Ze,ee)}}function Le(ee,Xe,Je){typeof Je=="number"?ue([ce(Je,ee)],Xe):typeof Je=="string"?Reflect.decorate([ee],Xe,Je):ue([ee],Xe)}Q.decorate=Le},5744:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.inject=Q.LazyServiceIdentifer=void 0;var ie=U(16674),re=U(6867),m=U(47738),he=U(99934),V=function(){function ce(Le){this._cb=Le}return ce.prototype.unwrap=function(){return this._cb()},ce}();Q.LazyServiceIdentifer=V;function ue(ce){return function(Le,ee,Xe){if(ce===void 0)throw new Error(ie.UNDEFINED_INJECT_ANNOTATION(Le.name));var Je=new m.Metadata(re.INJECT_TAG,ce);typeof Xe=="number"?he.tagParameter(Le,ee,Xe,Je):he.tagProperty(Le,ee,Je)}}Q.inject=ue},64315:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.injectable=void 0;var ie=U(16674),re=U(6867);function m(){return function(he){if(Reflect.hasOwnMetadata(re.PARAM_TYPES,he))throw new Error(ie.DUPLICATED_INJECTABLE_DECORATOR);var V=Reflect.getMetadata(re.DESIGN_PARAM_TYPES,he)||[];return Reflect.defineMetadata(re.PARAM_TYPES,V,he),he}}Q.injectable=m},71693:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiInject=void 0;var ie=U(6867),re=U(47738),m=U(99934);function he(V){return function(ue,ce,Le){var ee=new re.Metadata(ie.MULTI_INJECT_TAG,V);typeof Le=="number"?m.tagParameter(ue,ce,Le,ee):m.tagProperty(ue,ce,ee)}}Q.multiInject=he},38085:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.named=void 0;var ie=U(6867),re=U(47738),m=U(99934);function he(V){return function(ue,ce,Le){var ee=new re.Metadata(ie.NAMED_TAG,V);typeof Le=="number"?m.tagParameter(ue,ce,Le,ee):m.tagProperty(ue,ce,ee)}}Q.named=he},6515:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.optional=void 0;var ie=U(6867),re=U(47738),m=U(99934);function he(){return function(V,ue,ce){var Le=new re.Metadata(ie.OPTIONAL_TAG,!0);typeof ce=="number"?m.tagParameter(V,ue,ce,Le):m.tagProperty(V,ue,Le)}}Q.optional=he},7014:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.postConstruct=void 0;var ie=U(16674),re=U(6867),m=U(47738);function he(){return function(V,ue,ce){var Le=new m.Metadata(re.POST_CONSTRUCT,ue);if(Reflect.hasOwnMetadata(re.POST_CONSTRUCT,V.constructor))throw new Error(ie.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(re.POST_CONSTRUCT,Le,V.constructor)}}Q.postConstruct=he},32052:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.tagged=void 0;var ie=U(47738),re=U(99934);function m(he,V){return function(ue,ce,Le){var ee=new ie.Metadata(he,V);typeof Le=="number"?re.tagParameter(ue,ce,Le,ee):re.tagProperty(ue,ce,ee)}}Q.tagged=m},55638:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.targetName=void 0;var ie=U(6867),re=U(47738),m=U(99934);function he(V){return function(ue,ce,Le){var ee=new re.Metadata(ie.NAME_TAG,V);m.tagParameter(ue,ce,Le,ee)}}Q.targetName=he},86757:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.unmanaged=void 0;var ie=U(6867),re=U(47738),m=U(99934);function he(){return function(V,ue,ce){var Le=new re.Metadata(ie.UNMANAGED_TAG,!0);m.tagParameter(V,ue,ce,Le)}}Q.unmanaged=he},44290:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Binding=void 0;var ie=U(28421),re=U(37791),m=function(){function he(V,ue){this.id=re.id(),this.activated=!1,this.serviceIdentifier=V,this.scope=ue,this.type=ie.BindingTypeEnum.Invalid,this.constraint=function(ce){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return he.prototype.clone=function(){var V=new he(this.serviceIdentifier,this.scope);return V.activated=V.scope===ie.BindingScopeEnum.Singleton?this.activated:!1,V.implementationType=this.implementationType,V.dynamicValue=this.dynamicValue,V.scope=this.scope,V.type=this.type,V.factory=this.factory,V.provider=this.provider,V.constraint=this.constraint,V.onActivation=this.onActivation,V.cache=this.cache,V},he}();Q.Binding=m},23184:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingCount=void 0;var U={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};Q.BindingCount=U},16674:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.STACK_OVERFLOW=Q.CIRCULAR_DEPENDENCY_IN_FACTORY=Q.POST_CONSTRUCT_ERROR=Q.MULTIPLE_POST_CONSTRUCT_METHODS=Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=Q.ARGUMENTS_LENGTH_MISMATCH=Q.INVALID_DECORATOR_OPERATION=Q.INVALID_TO_SELF_VALUE=Q.INVALID_FUNCTION_BINDING=Q.INVALID_MIDDLEWARE_RETURN=Q.NO_MORE_SNAPSHOTS_AVAILABLE=Q.INVALID_BINDING_TYPE=Q.NOT_IMPLEMENTED=Q.CIRCULAR_DEPENDENCY=Q.UNDEFINED_INJECT_ANNOTATION=Q.MISSING_INJECT_ANNOTATION=Q.MISSING_INJECTABLE_ANNOTATION=Q.NOT_REGISTERED=Q.CANNOT_UNBIND=Q.AMBIGUOUS_MATCH=Q.KEY_NOT_FOUND=Q.NULL_ARGUMENT=Q.DUPLICATED_METADATA=Q.DUPLICATED_INJECTABLE_DECORATOR=void 0,Q.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",Q.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",Q.NULL_ARGUMENT="NULL argument",Q.KEY_NOT_FOUND="Key Not Found",Q.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",Q.CANNOT_UNBIND="Could not unbind serviceIdentifier:",Q.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",Q.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",Q.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var U=function(he){return"@inject called with undefined this could mean that the class "+he+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};Q.UNDEFINED_INJECT_ANNOTATION=U,Q.CIRCULAR_DEPENDENCY="Circular dependency found:",Q.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",Q.INVALID_BINDING_TYPE="Invalid binding type:",Q.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",Q.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",Q.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",Q.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",Q.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ie=function(){for(var he=[],V=0;V<arguments.length;V++)he[V]=arguments[V];return"The number of constructor arguments in the derived class "+(he[0]+" must be >= than the number of constructor arguments of its base class.")};Q.ARGUMENTS_LENGTH_MISMATCH=ie,Q.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",Q.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",Q.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",Q.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",Q.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var re=function(){for(var he=[],V=0;V<arguments.length;V++)he[V]=arguments[V];return"@postConstruct error in class "+he[0]+": "+he[1]};Q.POST_CONSTRUCT_ERROR=re;var m=function(){for(var he=[],V=0;V<arguments.length;V++)he[V]=arguments[V];return"It looks like there is a circular dependency "+("in one of the '"+he[0]+"' bindings. Please investigate bindings with")+("service identifier '"+he[1]+"'.")};Q.CIRCULAR_DEPENDENCY_IN_FACTORY=m,Q.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.TargetTypeEnum=Q.BindingTypeEnum=Q.BindingScopeEnum=void 0;var U={Request:"Request",Singleton:"Singleton",Transient:"Transient"};Q.BindingScopeEnum=U;var ie={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};Q.BindingTypeEnum=ie;var re={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};Q.TargetTypeEnum=re},6867:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.NON_CUSTOM_TAG_KEYS=Q.POST_CONSTRUCT=Q.DESIGN_PARAM_TYPES=Q.PARAM_TYPES=Q.TAGGED_PROP=Q.TAGGED=Q.MULTI_INJECT_TAG=Q.INJECT_TAG=Q.OPTIONAL_TAG=Q.UNMANAGED_TAG=Q.NAME_TAG=Q.NAMED_TAG=void 0,Q.NAMED_TAG="named",Q.NAME_TAG="name",Q.UNMANAGED_TAG="unmanaged",Q.OPTIONAL_TAG="optional",Q.INJECT_TAG="inject",Q.MULTI_INJECT_TAG="multi_inject",Q.TAGGED="inversify:tagged",Q.TAGGED_PROP="inversify:tagged_props",Q.PARAM_TYPES="inversify:paramtypes",Q.DESIGN_PARAM_TYPES="design:paramtypes",Q.POST_CONSTRUCT="post_construct";function U(){return[Q.INJECT_TAG,Q.MULTI_INJECT_TAG,Q.NAME_TAG,Q.UNMANAGED_TAG,Q.NAMED_TAG,Q.OPTIONAL_TAG]}Q.NON_CUSTOM_TAG_KEYS=U()},51389:function(Mt,Q,U){"use strict";var ie=this&&this.__awaiter||function(bt,at,nt,Zt){function Y(qt){return qt instanceof nt?qt:new nt(function(ut){ut(qt)})}return new(nt||(nt=Promise))(function(qt,ut){function Qe(Kt){try{$e(Zt.next(Kt))}catch(xr){ut(xr)}}function Ct(Kt){try{$e(Zt.throw(Kt))}catch(xr){ut(xr)}}function $e(Kt){Kt.done?qt(Kt.value):Y(Kt.value).then(Qe,Ct)}$e((Zt=Zt.apply(bt,at||[])).next())})},re=this&&this.__generator||function(bt,at){var nt={label:0,sent:function(){if(qt[0]&1)throw qt[1];return qt[1]},trys:[],ops:[]},Zt,Y,qt,ut;return ut={next:Qe(0),throw:Qe(1),return:Qe(2)},typeof Symbol=="function"&&(ut[Symbol.iterator]=function(){return this}),ut;function Qe($e){return function(Kt){return Ct([$e,Kt])}}function Ct($e){if(Zt)throw new TypeError("Generator is already executing.");for(;nt;)try{if(Zt=1,Y&&(qt=$e[0]&2?Y.return:$e[0]?Y.throw||((qt=Y.return)&&qt.call(Y),0):Y.next)&&!(qt=qt.call(Y,$e[1])).done)return qt;switch(Y=0,qt&&($e=[$e[0]&2,qt.value]),$e[0]){case 0:case 1:qt=$e;break;case 4:return nt.label++,{value:$e[1],done:!1};case 5:nt.label++,Y=$e[1],$e=[0];continue;case 7:$e=nt.ops.pop(),nt.trys.pop();continue;default:if(qt=nt.trys,!(qt=qt.length>0&&qt[qt.length-1])&&($e[0]===6||$e[0]===2)){nt=0;continue}if($e[0]===3&&(!qt||$e[1]>qt[0]&&$e[1]<qt[3])){nt.label=$e[1];break}if($e[0]===6&&nt.label<qt[1]){nt.label=qt[1],qt=$e;break}if(qt&&nt.label<qt[2]){nt.label=qt[2],nt.ops.push($e);break}qt[2]&&nt.ops.pop(),nt.trys.pop();continue}$e=at.call(bt,nt)}catch(Kt){$e=[6,Kt],Y=0}finally{Zt=qt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},m=this&&this.__spreadArray||function(bt,at){for(var nt=0,Zt=at.length,Y=bt.length;nt<Zt;nt++,Y++)bt[Y]=at[nt];return bt};Object.defineProperty(Q,"__esModule",{value:!0}),Q.Container=void 0;var he=U(44290),V=U(16674),ue=U(28421),ce=U(6867),Le=U(51377),ee=U(86311),Xe=U(31927),Je=U(15451),Ze=U(37791),gt=U(55800),tr=U(85700),yt=U(80175),Wt=function(){function bt(at){this._appliedMiddleware=[];var nt=at||{};if(typeof nt!="object")throw new Error(""+V.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(nt.defaultScope===void 0)nt.defaultScope=ue.BindingScopeEnum.Transient;else if(nt.defaultScope!==ue.BindingScopeEnum.Singleton&&nt.defaultScope!==ue.BindingScopeEnum.Transient&&nt.defaultScope!==ue.BindingScopeEnum.Request)throw new Error(""+V.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(nt.autoBindInjectable===void 0)nt.autoBindInjectable=!1;else if(typeof nt.autoBindInjectable!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(nt.skipBaseClassChecks===void 0)nt.skipBaseClassChecks=!1;else if(typeof nt.skipBaseClassChecks!="boolean")throw new Error(""+V.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:nt.autoBindInjectable,defaultScope:nt.defaultScope,skipBaseClassChecks:nt.skipBaseClassChecks},this.id=Ze.id(),this._bindingDictionary=new yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Le.MetadataReader}return bt.merge=function(at,nt){for(var Zt=[],Y=2;Y<arguments.length;Y++)Zt[Y-2]=arguments[Y];var qt=new bt,ut=m([at,nt],Zt).map(function($e){return ee.getBindingDictionary($e)}),Qe=ee.getBindingDictionary(qt);function Ct($e,Kt){$e.traverse(function(xr,kr){kr.forEach(function(Kr){Kt.add(Kr.serviceIdentifier,Kr.clone())})})}return ut.forEach(function($e){Ct($e,Qe)}),qt},bt.prototype.load=function(){for(var at=[],nt=0;nt<arguments.length;nt++)at[nt]=arguments[nt];for(var Zt=this._getContainerModuleHelpersFactory(),Y=0,qt=at;Y<qt.length;Y++){var ut=qt[Y],Qe=Zt(ut.id);ut.registry(Qe.bindFunction,Qe.unbindFunction,Qe.isboundFunction,Qe.rebindFunction)}},bt.prototype.loadAsync=function(){for(var at=[],nt=0;nt<arguments.length;nt++)at[nt]=arguments[nt];return ie(this,void 0,void 0,function(){var Zt,Y,qt,ut,Qe;return re(this,function(Ct){switch(Ct.label){case 0:Zt=this._getContainerModuleHelpersFactory(),Y=0,qt=at,Ct.label=1;case 1:return Y<qt.length?(ut=qt[Y],Qe=Zt(ut.id),[4,ut.registry(Qe.bindFunction,Qe.unbindFunction,Qe.isboundFunction,Qe.rebindFunction)]):[3,4];case 2:Ct.sent(),Ct.label=3;case 3:return Y++,[3,1];case 4:return[2]}})})},bt.prototype.unload=function(){for(var at=this,nt=[],Zt=0;Zt<arguments.length;Zt++)nt[Zt]=arguments[Zt];var Y=function(qt){return function(ut){return ut.moduleId===qt}};nt.forEach(function(qt){var ut=Y(qt.id);at._bindingDictionary.removeByCondition(ut)})},bt.prototype.bind=function(at){var nt=this.options.defaultScope||ue.BindingScopeEnum.Transient,Zt=new he.Binding(at,nt);return this._bindingDictionary.add(at,Zt),new Je.BindingToSyntax(Zt)},bt.prototype.rebind=function(at){return this.unbind(at),this.bind(at)},bt.prototype.unbind=function(at){try{this._bindingDictionary.remove(at)}catch(nt){throw new Error(V.CANNOT_UNBIND+" "+gt.getServiceIdentifierAsString(at))}},bt.prototype.unbindAll=function(){this._bindingDictionary=new yt.Lookup},bt.prototype.isBound=function(at){var nt=this._bindingDictionary.hasKey(at);return!nt&&this.parent&&(nt=this.parent.isBound(at)),nt},bt.prototype.isBoundNamed=function(at,nt){return this.isBoundTagged(at,ce.NAMED_TAG,nt)},bt.prototype.isBoundTagged=function(at,nt,Zt){var Y=!1;if(this._bindingDictionary.hasKey(at)){var qt=this._bindingDictionary.get(at),ut=ee.createMockRequest(this,at,nt,Zt);Y=qt.some(function(Qe){return Qe.constraint(ut)})}return!Y&&this.parent&&(Y=this.parent.isBoundTagged(at,nt,Zt)),Y},bt.prototype.snapshot=function(){this._snapshots.push(tr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},bt.prototype.restore=function(){var at=this._snapshots.pop();if(at===void 0)throw new Error(V.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=at.bindings,this._middleware=at.middleware},bt.prototype.createChild=function(at){var nt=new bt(at||this.options);return nt.parent=this,nt},bt.prototype.applyMiddleware=function(){for(var at=[],nt=0;nt<arguments.length;nt++)at[nt]=arguments[nt];this._appliedMiddleware=this._appliedMiddleware.concat(at);var Zt=this._middleware?this._middleware:this._planAndResolve();this._middleware=at.reduce(function(Y,qt){return qt(Y)},Zt)},bt.prototype.applyCustomMetadataReader=function(at){this._metadataReader=at},bt.prototype.get=function(at){return this._get(!1,!1,ue.TargetTypeEnum.Variable,at)},bt.prototype.getTagged=function(at,nt,Zt){return this._get(!1,!1,ue.TargetTypeEnum.Variable,at,nt,Zt)},bt.prototype.getNamed=function(at,nt){return this.getTagged(at,ce.NAMED_TAG,nt)},bt.prototype.getAll=function(at){return this._get(!0,!0,ue.TargetTypeEnum.Variable,at)},bt.prototype.getAllTagged=function(at,nt,Zt){return this._get(!1,!0,ue.TargetTypeEnum.Variable,at,nt,Zt)},bt.prototype.getAllNamed=function(at,nt){return this.getAllTagged(at,ce.NAMED_TAG,nt)},bt.prototype.resolve=function(at){var nt=this.createChild();return nt.bind(at).toSelf(),this._appliedMiddleware.forEach(function(Zt){nt.applyMiddleware(Zt)}),nt.get(at)},bt.prototype._getContainerModuleHelpersFactory=function(){var at=this,nt=function(Qe,Ct){Qe._binding.moduleId=Ct},Zt=function(Qe){return function(Ct){var $e=at.bind.bind(at),Kt=$e(Ct);return nt(Kt,Qe),Kt}},Y=function(Qe){return function(Ct){var $e=at.unbind.bind(at);$e(Ct)}},qt=function(Qe){return function(Ct){var $e=at.isBound.bind(at);return $e(Ct)}},ut=function(Qe){return function(Ct){var $e=at.rebind.bind(at),Kt=$e(Ct);return nt(Kt,Qe),Kt}};return function(Qe){return{bindFunction:Zt(Qe),isboundFunction:qt(Qe),rebindFunction:ut(Qe),unbindFunction:Y(Qe)}}},bt.prototype._get=function(at,nt,Zt,Y,qt,ut){var Qe=null,Ct={avoidConstraints:at,contextInterceptor:function($e){return $e},isMultiInject:nt,key:qt,serviceIdentifier:Y,targetType:Zt,value:ut};if(this._middleware){if(Qe=this._middleware(Ct),Qe==null)throw new Error(V.INVALID_MIDDLEWARE_RETURN)}else Qe=this._planAndResolve()(Ct);return Qe},bt.prototype._planAndResolve=function(){var at=this;return function(nt){var Zt=ee.plan(at._metadataReader,at,nt.isMultiInject,nt.targetType,nt.serviceIdentifier,nt.key,nt.value,nt.avoidConstraints);Zt=nt.contextInterceptor(Zt);var Y=Xe.resolve(Zt);return Y}},bt}();Q.Container=Wt},33244:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.AsyncContainerModule=Q.ContainerModule=void 0;var ie=U(37791),re=function(){function he(V){this.id=ie.id(),this.registry=V}return he}();Q.ContainerModule=re;var m=function(){function he(V){this.id=ie.id(),this.registry=V}return he}();Q.AsyncContainerModule=m},85700:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.ContainerSnapshot=void 0;var U=function(){function ie(){}return ie.of=function(re,m){var he=new ie;return he.bindings=re,he.middleware=m,he},ie}();Q.ContainerSnapshot=U},80175:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Lookup=void 0;var ie=U(16674),re=function(){function m(){this._map=new Map}return m.prototype.getMap=function(){return this._map},m.prototype.add=function(he,V){if(he==null)throw new Error(ie.NULL_ARGUMENT);if(V==null)throw new Error(ie.NULL_ARGUMENT);var ue=this._map.get(he);ue!==void 0?(ue.push(V),this._map.set(he,ue)):this._map.set(he,[V])},m.prototype.get=function(he){if(he==null)throw new Error(ie.NULL_ARGUMENT);var V=this._map.get(he);if(V!==void 0)return V;throw new Error(ie.KEY_NOT_FOUND)},m.prototype.remove=function(he){if(he==null)throw new Error(ie.NULL_ARGUMENT);if(!this._map.delete(he))throw new Error(ie.KEY_NOT_FOUND)},m.prototype.removeByCondition=function(he){var V=this;this._map.forEach(function(ue,ce){var Le=ue.filter(function(ee){return!he(ee)});Le.length>0?V._map.set(ce,Le):V._map.delete(ce)})},m.prototype.hasKey=function(he){if(he==null)throw new Error(ie.NULL_ARGUMENT);return this._map.has(he)},m.prototype.clone=function(){var he=new m;return this._map.forEach(function(V,ue){V.forEach(function(ce){return he.add(ue,ce.clone())})}),he},m.prototype.traverse=function(he){this._map.forEach(function(V,ue){he(ue,V)})},m}();Q.Lookup=re},86700:function(Mt,Q,U){"use strict";var ie;ie={value:!0},ie=ie=ie=ie=ie=ie=Q.GW=ie=ie=Q.zY=ie=ie=ie=ie=ie=Q.f3=ie=ie=Q.b2=ie=ie=ie=ie=ie=Q.W2=ie=void 0;var re=U(6867);ie=re;var m=U(51389);Object.defineProperty(Q,"W2",{enumerable:!0,get:function(){return m.Container}});var he=U(28421);ie={enumerable:!0,get:function(){return he.BindingScopeEnum}},ie={enumerable:!0,get:function(){return he.BindingTypeEnum}},ie={enumerable:!0,get:function(){return he.TargetTypeEnum}};var V=U(33244);ie={enumerable:!0,get:function(){return V.AsyncContainerModule}},ie={enumerable:!0,get:function(){return V.ContainerModule}};var ue=U(64315);Object.defineProperty(Q,"b2",{enumerable:!0,get:function(){return ue.injectable}});var ce=U(32052);ie={enumerable:!0,get:function(){return ce.tagged}};var Le=U(38085);ie={enumerable:!0,get:function(){return Le.named}};var ee=U(5744);Object.defineProperty(Q,"f3",{enumerable:!0,get:function(){return ee.inject}}),ie={enumerable:!0,get:function(){return ee.LazyServiceIdentifer}};var Xe=U(6515);ie={enumerable:!0,get:function(){return Xe.optional}};var Je=U(86757);ie={enumerable:!0,get:function(){return Je.unmanaged}};var Ze=U(71693);ie={enumerable:!0,get:function(){return Ze.multiInject}};var gt=U(55638);ie={enumerable:!0,get:function(){return gt.targetName}};var tr=U(7014);Object.defineProperty(Q,"zY",{enumerable:!0,get:function(){return tr.postConstruct}});var yt=U(51377);ie={enumerable:!0,get:function(){return yt.MetadataReader}};var Wt=U(37791);ie={enumerable:!0,get:function(){return Wt.id}};var bt=U(99934);Object.defineProperty(Q,"GW",{enumerable:!0,get:function(){return bt.decorate}});var at=U(80758);ie={enumerable:!0,get:function(){return at.traverseAncerstors}},ie={enumerable:!0,get:function(){return at.taggedConstraint}},ie={enumerable:!0,get:function(){return at.namedConstraint}},ie={enumerable:!0,get:function(){return at.typeConstraint}};var nt=U(55800);ie={enumerable:!0,get:function(){return nt.getServiceIdentifierAsString}};var Zt=U(70600);ie={enumerable:!0,get:function(){return Zt.multiBindToService}}},95228:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Context=void 0;var ie=U(37791),re=function(){function m(he){this.id=ie.id(),this.container=he}return m.prototype.addPlan=function(he){this.plan=he},m.prototype.setCurrentRequest=function(he){this.currentRequest=he},m}();Q.Context=re},47738:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Metadata=void 0;var ie=U(6867),re=function(){function m(he,V){this.key=he,this.value=V}return m.prototype.toString=function(){return this.key===ie.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},m}();Q.Metadata=re},51377:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.MetadataReader=void 0;var ie=U(6867),re=function(){function m(){}return m.prototype.getConstructorMetadata=function(he){var V=Reflect.getMetadata(ie.PARAM_TYPES,he),ue=Reflect.getMetadata(ie.TAGGED,he);return{compilerGeneratedMetadata:V,userGeneratedMetadata:ue||{}}},m.prototype.getPropertiesMetadata=function(he){var V=Reflect.getMetadata(ie.TAGGED_PROP,he)||[];return V},m}();Q.MetadataReader=re},55314:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Plan=void 0;var U=function(){function ie(re,m){this.parentContext=re,this.rootRequest=m}return ie}();Q.Plan=U},86311:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.getBindingDictionary=Q.createMockRequest=Q.plan=void 0;var ie=U(23184),re=U(16674),m=U(28421),he=U(6867),V=U(85265),ue=U(55800),ce=U(95228),Le=U(47738),ee=U(55314),Xe=U(6e3),Je=U(6748),Ze=U(18924);function gt(Y){return Y._bindingDictionary}Q.getBindingDictionary=gt;function tr(Y,qt,ut,Qe,Ct,$e){var Kt=Y?he.MULTI_INJECT_TAG:he.INJECT_TAG,xr=new Le.Metadata(Kt,ut),kr=new Ze.Target(qt,Qe,ut,xr);if(Ct!==void 0){var Kr=new Le.Metadata(Ct,$e);kr.metadata.push(Kr)}return kr}function yt(Y,qt,ut,Qe,Ct){var $e=at(ut.container,Ct.serviceIdentifier),Kt=[];return $e.length===ie.BindingCount.NoBindingsAvailable&&ut.container.options.autoBindInjectable&&typeof Ct.serviceIdentifier=="function"&&Y.getConstructorMetadata(Ct.serviceIdentifier).compilerGeneratedMetadata&&(ut.container.bind(Ct.serviceIdentifier).toSelf(),$e=at(ut.container,Ct.serviceIdentifier)),qt?Kt=$e:Kt=$e.filter(function(xr){var kr=new Je.Request(xr.serviceIdentifier,ut,Qe,xr,Ct);return xr.constraint(kr)}),Wt(Ct.serviceIdentifier,Kt,Ct,ut.container),Kt}function Wt(Y,qt,ut,Qe){switch(qt.length){case ie.BindingCount.NoBindingsAvailable:if(ut.isOptional())return qt;var Ct=ue.getServiceIdentifierAsString(Y),$e=re.NOT_REGISTERED;throw $e+=ue.listMetadataForTarget(Ct,ut),$e+=ue.listRegisteredBindingsForServiceIdentifier(Qe,Ct,at),new Error($e);case ie.BindingCount.OnlyOneBindingAvailable:if(!ut.isArray())return qt;case ie.BindingCount.MultipleBindingsAvailable:default:if(ut.isArray())return qt;var Ct=ue.getServiceIdentifierAsString(Y),$e=re.AMBIGUOUS_MATCH+" "+Ct;throw $e+=ue.listRegisteredBindingsForServiceIdentifier(Qe,Ct,at),new Error($e)}}function bt(Y,qt,ut,Qe,Ct,$e){var Kt,xr;if(Ct===null){Kt=yt(Y,qt,Qe,null,$e),xr=new Je.Request(ut,Qe,null,Kt,$e);var kr=new ee.Plan(Qe,xr);Qe.addPlan(kr)}else Kt=yt(Y,qt,Qe,Ct,$e),xr=Ct.addChildRequest($e.serviceIdentifier,Kt,$e);Kt.forEach(function(Kr){var A=null;if($e.isArray())A=xr.addChildRequest(Kr.serviceIdentifier,Kr,$e);else{if(Kr.cache)return;A=xr}if(Kr.type===m.BindingTypeEnum.Instance&&Kr.implementationType!==null){var Ae=Xe.getDependencies(Y,Kr.implementationType);if(!Qe.container.options.skipBaseClassChecks){var De=Xe.getBaseClassDependencyCount(Y,Kr.implementationType);if(Ae.length<De){var At=re.ARGUMENTS_LENGTH_MISMATCH(Xe.getFunctionName(Kr.implementationType));throw new Error(At)}}Ae.forEach(function(mt){bt(Y,!1,mt.serviceIdentifier,Qe,A,mt)})}})}function at(Y,qt){var ut=[],Qe=gt(Y);return Qe.hasKey(qt)?ut=Qe.get(qt):Y.parent!==null&&(ut=at(Y.parent,qt)),ut}function nt(Y,qt,ut,Qe,Ct,$e,Kt,xr){xr===void 0&&(xr=!1);var kr=new ce.Context(qt),Kr=tr(ut,Qe,Ct,"",$e,Kt);try{return bt(Y,xr,Ct,kr,null,Kr),kr}catch(A){throw V.isStackOverflowExeption(A)&&kr.plan&&ue.circularDependencyToException(kr.plan.rootRequest),A}}Q.plan=nt;function Zt(Y,qt,ut,Qe){var Ct=new Ze.Target(m.TargetTypeEnum.Variable,"",qt,new Le.Metadata(ut,Qe)),$e=new ce.Context(Y),Kt=new Je.Request(qt,$e,null,[],Ct);return Kt}Q.createMockRequest=Zt},88460:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.QueryableString=void 0;var U=function(){function ie(re){this.str=re}return ie.prototype.startsWith=function(re){return this.str.indexOf(re)===0},ie.prototype.endsWith=function(re){var m="",he=re.split("").reverse().join("");return m=this.str.split("").reverse().join(""),this.startsWith.call({str:m},he)},ie.prototype.contains=function(re){return this.str.indexOf(re)!==-1},ie.prototype.equals=function(re){return this.str===re},ie.prototype.value=function(){return this.str},ie}();Q.QueryableString=U},6e3:function(Mt,Q,U){"use strict";var ie=this&&this.__spreadArray||function(yt,Wt){for(var bt=0,at=Wt.length,nt=yt.length;bt<at;bt++,nt++)yt[nt]=Wt[bt];return yt};Object.defineProperty(Q,"__esModule",{value:!0}),Q.getFunctionName=Q.getBaseClassDependencyCount=Q.getDependencies=void 0;var re=U(5744),m=U(16674),he=U(28421),V=U(6867),ue=U(55800);Object.defineProperty(Q,"getFunctionName",{enumerable:!0,get:function(){return ue.getFunctionName}});var ce=U(18924);function Le(yt,Wt){var bt=ue.getFunctionName(Wt),at=ee(yt,bt,Wt,!1);return at}Q.getDependencies=Le;function ee(yt,Wt,bt,at){var nt=yt.getConstructorMetadata(bt),Zt=nt.compilerGeneratedMetadata;if(Zt===void 0){var Y=m.MISSING_INJECTABLE_ANNOTATION+" "+Wt+".";throw new Error(Y)}var qt=nt.userGeneratedMetadata,ut=Object.keys(qt),Qe=bt.length===0&&ut.length>0,Ct=ut.length>bt.length,$e=Qe||Ct?ut.length:bt.length,Kt=Je(at,Wt,Zt,qt,$e),xr=Ze(yt,bt),kr=ie(ie([],Kt),xr);return kr}function Xe(yt,Wt,bt,at,nt){var Zt=nt[yt.toString()]||[],Y=tr(Zt),qt=Y.unmanaged!==!0,ut=at[yt],Qe=Y.inject||Y.multiInject;if(ut=Qe||ut,ut instanceof re.LazyServiceIdentifer&&(ut=ut.unwrap()),qt){var Ct=ut===Object,$e=ut===Function,Kt=ut===void 0,xr=Ct||$e||Kt;if(!Wt&&xr){var kr=m.MISSING_INJECT_ANNOTATION+" argument "+yt+" in class "+bt+".";throw new Error(kr)}var Kr=new ce.Target(he.TargetTypeEnum.ConstructorArgument,Y.targetName,ut);return Kr.metadata=Zt,Kr}return null}function Je(yt,Wt,bt,at,nt){for(var Zt=[],Y=0;Y<nt;Y++){var qt=Y,ut=Xe(qt,yt,Wt,bt,at);ut!==null&&Zt.push(ut)}return Zt}function Ze(yt,Wt){for(var bt=yt.getPropertiesMetadata(Wt),at=[],nt=Object.keys(bt),Zt=0,Y=nt;Zt<Y.length;Zt++){var qt=Y[Zt],ut=bt[qt],Qe=tr(bt[qt]),Ct=Qe.targetName||qt,$e=Qe.inject||Qe.multiInject,Kt=new ce.Target(he.TargetTypeEnum.ClassProperty,Ct,$e);Kt.metadata=ut,at.push(Kt)}var xr=Object.getPrototypeOf(Wt.prototype).constructor;if(xr!==Object){var kr=Ze(yt,xr);at=ie(ie([],at),kr)}return at}function gt(yt,Wt){var bt=Object.getPrototypeOf(Wt.prototype).constructor;if(bt!==Object){var at=ue.getFunctionName(bt),nt=ee(yt,at,bt,!0),Zt=nt.map(function(ut){return ut.metadata.filter(function(Qe){return Qe.key===V.UNMANAGED_TAG})}),Y=[].concat.apply([],Zt).length,qt=nt.length-Y;return qt>0?qt:gt(yt,bt)}else return 0}Q.getBaseClassDependencyCount=gt;function tr(yt){var Wt={};return yt.forEach(function(bt){Wt[bt.key.toString()]=bt.value}),{inject:Wt[V.INJECT_TAG],multiInject:Wt[V.MULTI_INJECT_TAG],targetName:Wt[V.NAME_TAG],unmanaged:Wt[V.UNMANAGED_TAG]}}},6748:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Request=void 0;var ie=U(37791),re=function(){function m(he,V,ue,ce,Le){this.id=ie.id(),this.serviceIdentifier=he,this.parentContext=V,this.parentRequest=ue,this.target=Le,this.childRequests=[],this.bindings=Array.isArray(ce)?ce:[ce],this.requestScope=ue===null?new Map:null}return m.prototype.addChildRequest=function(he,V,ue){var ce=new m(he,this.parentContext,this,V,ue);return this.childRequests.push(ce),ce},m}();Q.Request=re},18924:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.Target=void 0;var ie=U(6867),re=U(37791),m=U(47738),he=U(88460),V=function(){function ue(ce,Le,ee,Xe){this.id=re.id(),this.type=ce,this.serviceIdentifier=ee,this.name=new he.QueryableString(Le||""),this.metadata=new Array;var Je=null;typeof Xe=="string"?Je=new m.Metadata(ie.NAMED_TAG,Xe):Xe instanceof m.Metadata&&(Je=Xe),Je!==null&&this.metadata.push(Je)}return ue.prototype.hasTag=function(ce){for(var Le=0,ee=this.metadata;Le<ee.length;Le++){var Xe=ee[Le];if(Xe.key===ce)return!0}return!1},ue.prototype.isArray=function(){return this.hasTag(ie.MULTI_INJECT_TAG)},ue.prototype.matchesArray=function(ce){return this.matchesTag(ie.MULTI_INJECT_TAG)(ce)},ue.prototype.isNamed=function(){return this.hasTag(ie.NAMED_TAG)},ue.prototype.isTagged=function(){return this.metadata.some(function(ce){return ie.NON_CUSTOM_TAG_KEYS.every(function(Le){return ce.key!==Le})})},ue.prototype.isOptional=function(){return this.matchesTag(ie.OPTIONAL_TAG)(!0)},ue.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ce){return ce.key===ie.NAMED_TAG})[0]:null},ue.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ce){return ie.NON_CUSTOM_TAG_KEYS.every(function(Le){return ce.key!==Le})}):null},ue.prototype.matchesNamedTag=function(ce){return this.matchesTag(ie.NAMED_TAG)(ce)},ue.prototype.matchesTag=function(ce){var Le=this;return function(ee){for(var Xe=0,Je=Le.metadata;Xe<Je.length;Xe++){var Ze=Je[Xe];if(Ze.key===ce&&Ze.value===ee)return!0}return!1}},ue}();Q.Target=V},52279:function(Mt,Q,U){"use strict";var ie=this&&this.__spreadArray||function(ee,Xe){for(var Je=0,Ze=Xe.length,gt=ee.length;Je<Ze;Je++,gt++)ee[gt]=Xe[Je];return ee};Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolveInstance=void 0;var re=U(16674),m=U(28421),he=U(6867);function V(ee,Xe,Je){var Ze=Xe.filter(function(tr){return tr.target!==null&&tr.target.type===m.TargetTypeEnum.ClassProperty}),gt=Ze.map(Je);return Ze.forEach(function(tr,yt){var Wt="";Wt=tr.target.name.value();var bt=gt[yt];ee[Wt]=bt}),ee}function ue(ee,Xe){return new(ee.bind.apply(ee,ie([void 0],Xe)))}function ce(ee,Xe){if(Reflect.hasMetadata(he.POST_CONSTRUCT,ee)){var Je=Reflect.getMetadata(he.POST_CONSTRUCT,ee);try{Xe[Je.value]()}catch(Ze){throw new Error(re.POST_CONSTRUCT_ERROR(ee.name,Ze.message))}}}function Le(ee,Xe,Je){var Ze=null;if(Xe.length>0){var gt=Xe.filter(function(yt){return yt.target!==null&&yt.target.type===m.TargetTypeEnum.ConstructorArgument}),tr=gt.map(Je);Ze=ue(ee,tr),Ze=V(Ze,Xe,Je)}else Ze=new ee;return ce(ee,Ze),Ze}Q.resolveInstance=Le},31927:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.resolve=void 0;var ie=U(16674),re=U(28421),m=U(85265),he=U(55800),V=U(52279),ue=function(ee,Xe,Je){try{return Je()}catch(Ze){throw m.isStackOverflowExeption(Ze)?new Error(ie.CIRCULAR_DEPENDENCY_IN_FACTORY(ee,Xe.toString())):Ze}},ce=function(ee){return function(Xe){Xe.parentContext.setCurrentRequest(Xe);var Je=Xe.bindings,Ze=Xe.childRequests,gt=Xe.target&&Xe.target.isArray(),tr=!Xe.parentRequest||!Xe.parentRequest.target||!Xe.target||!Xe.parentRequest.target.matchesArray(Xe.target.serviceIdentifier);if(gt&&tr)return Ze.map(function(Zt){var Y=ce(ee);return Y(Zt)});var yt=null;if(Xe.target.isOptional()&&Je.length===0)return;var Wt=Je[0],bt=Wt.scope===re.BindingScopeEnum.Singleton,at=Wt.scope===re.BindingScopeEnum.Request;if(bt&&Wt.activated)return Wt.cache;if(at&&ee!==null&&ee.has(Wt.id))return ee.get(Wt.id);if(Wt.type===re.BindingTypeEnum.ConstantValue)yt=Wt.cache,Wt.activated=!0;else if(Wt.type===re.BindingTypeEnum.Function)yt=Wt.cache,Wt.activated=!0;else if(Wt.type===re.BindingTypeEnum.Constructor)yt=Wt.implementationType;else if(Wt.type===re.BindingTypeEnum.DynamicValue&&Wt.dynamicValue!==null)yt=ue("toDynamicValue",Wt.serviceIdentifier,function(){return Wt.dynamicValue(Xe.parentContext)});else if(Wt.type===re.BindingTypeEnum.Factory&&Wt.factory!==null)yt=ue("toFactory",Wt.serviceIdentifier,function(){return Wt.factory(Xe.parentContext)});else if(Wt.type===re.BindingTypeEnum.Provider&&Wt.provider!==null)yt=ue("toProvider",Wt.serviceIdentifier,function(){return Wt.provider(Xe.parentContext)});else if(Wt.type===re.BindingTypeEnum.Instance&&Wt.implementationType!==null)yt=V.resolveInstance(Wt.implementationType,Ze,ce(ee));else{var nt=he.getServiceIdentifierAsString(Xe.serviceIdentifier);throw new Error(ie.INVALID_BINDING_TYPE+" "+nt)}return typeof Wt.onActivation=="function"&&(yt=Wt.onActivation(Xe.parentContext,yt)),bt&&(Wt.cache=yt,Wt.activated=!0),at&&ee!==null&&!ee.has(Wt.id)&&ee.set(Wt.id,yt),yt}};function Le(ee){var Xe=ce(ee.plan.rootRequest.requestScope);return Xe(ee.plan.rootRequest)}Q.resolve=Le},83366:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInSyntax=void 0;var ie=U(28421),re=U(71325),m=function(){function he(V){this._binding=V}return he.prototype.inRequestScope=function(){return this._binding.scope=ie.BindingScopeEnum.Request,new re.BindingWhenOnSyntax(this._binding)},he.prototype.inSingletonScope=function(){return this._binding.scope=ie.BindingScopeEnum.Singleton,new re.BindingWhenOnSyntax(this._binding)},he.prototype.inTransientScope=function(){return this._binding.scope=ie.BindingScopeEnum.Transient,new re.BindingWhenOnSyntax(this._binding)},he}();Q.BindingInSyntax=m},74889:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingInWhenOnSyntax=void 0;var ie=U(83366),re=U(51811),m=U(98370),he=function(){function V(ue){this._binding=ue,this._bindingWhenSyntax=new m.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new re.BindingOnSyntax(this._binding),this._bindingInSyntax=new ie.BindingInSyntax(ue)}return V.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},V.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},V.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},V.prototype.when=function(ue){return this._bindingWhenSyntax.when(ue)},V.prototype.whenTargetNamed=function(ue){return this._bindingWhenSyntax.whenTargetNamed(ue)},V.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},V.prototype.whenTargetTagged=function(ue,ce){return this._bindingWhenSyntax.whenTargetTagged(ue,ce)},V.prototype.whenInjectedInto=function(ue){return this._bindingWhenSyntax.whenInjectedInto(ue)},V.prototype.whenParentNamed=function(ue){return this._bindingWhenSyntax.whenParentNamed(ue)},V.prototype.whenParentTagged=function(ue,ce){return this._bindingWhenSyntax.whenParentTagged(ue,ce)},V.prototype.whenAnyAncestorIs=function(ue){return this._bindingWhenSyntax.whenAnyAncestorIs(ue)},V.prototype.whenNoAncestorIs=function(ue){return this._bindingWhenSyntax.whenNoAncestorIs(ue)},V.prototype.whenAnyAncestorNamed=function(ue){return this._bindingWhenSyntax.whenAnyAncestorNamed(ue)},V.prototype.whenAnyAncestorTagged=function(ue,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(ue,ce)},V.prototype.whenNoAncestorNamed=function(ue){return this._bindingWhenSyntax.whenNoAncestorNamed(ue)},V.prototype.whenNoAncestorTagged=function(ue,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(ue,ce)},V.prototype.whenAnyAncestorMatches=function(ue){return this._bindingWhenSyntax.whenAnyAncestorMatches(ue)},V.prototype.whenNoAncestorMatches=function(ue){return this._bindingWhenSyntax.whenNoAncestorMatches(ue)},V.prototype.onActivation=function(ue){return this._bindingOnSyntax.onActivation(ue)},V}();Q.BindingInWhenOnSyntax=he},51811:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingOnSyntax=void 0;var ie=U(98370),re=function(){function m(he){this._binding=he}return m.prototype.onActivation=function(he){return this._binding.onActivation=he,new ie.BindingWhenSyntax(this._binding)},m}();Q.BindingOnSyntax=re},15451:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingToSyntax=void 0;var ie=U(16674),re=U(28421),m=U(74889),he=U(71325),V=function(){function ue(ce){this._binding=ce}return ue.prototype.to=function(ce){return this._binding.type=re.BindingTypeEnum.Instance,this._binding.implementationType=ce,new m.BindingInWhenOnSyntax(this._binding)},ue.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ie.INVALID_TO_SELF_VALUE);var ce=this._binding.serviceIdentifier;return this.to(ce)},ue.prototype.toConstantValue=function(ce){return this._binding.type=re.BindingTypeEnum.ConstantValue,this._binding.cache=ce,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=re.BindingScopeEnum.Singleton,new he.BindingWhenOnSyntax(this._binding)},ue.prototype.toDynamicValue=function(ce){return this._binding.type=re.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ce,this._binding.implementationType=null,new m.BindingInWhenOnSyntax(this._binding)},ue.prototype.toConstructor=function(ce){return this._binding.type=re.BindingTypeEnum.Constructor,this._binding.implementationType=ce,this._binding.scope=re.BindingScopeEnum.Singleton,new he.BindingWhenOnSyntax(this._binding)},ue.prototype.toFactory=function(ce){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=ce,this._binding.scope=re.BindingScopeEnum.Singleton,new he.BindingWhenOnSyntax(this._binding)},ue.prototype.toFunction=function(ce){if(typeof ce!="function")throw new Error(ie.INVALID_FUNCTION_BINDING);var Le=this.toConstantValue(ce);return this._binding.type=re.BindingTypeEnum.Function,this._binding.scope=re.BindingScopeEnum.Singleton,Le},ue.prototype.toAutoFactory=function(ce){return this._binding.type=re.BindingTypeEnum.Factory,this._binding.factory=function(Le){var ee=function(){return Le.container.get(ce)};return ee},this._binding.scope=re.BindingScopeEnum.Singleton,new he.BindingWhenOnSyntax(this._binding)},ue.prototype.toProvider=function(ce){return this._binding.type=re.BindingTypeEnum.Provider,this._binding.provider=ce,this._binding.scope=re.BindingScopeEnum.Singleton,new he.BindingWhenOnSyntax(this._binding)},ue.prototype.toService=function(ce){this.toDynamicValue(function(Le){return Le.container.get(ce)})},ue}();Q.BindingToSyntax=V},71325:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenOnSyntax=void 0;var ie=U(51811),re=U(98370),m=function(){function he(V){this._binding=V,this._bindingWhenSyntax=new re.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ie.BindingOnSyntax(this._binding)}return he.prototype.when=function(V){return this._bindingWhenSyntax.when(V)},he.prototype.whenTargetNamed=function(V){return this._bindingWhenSyntax.whenTargetNamed(V)},he.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},he.prototype.whenTargetTagged=function(V,ue){return this._bindingWhenSyntax.whenTargetTagged(V,ue)},he.prototype.whenInjectedInto=function(V){return this._bindingWhenSyntax.whenInjectedInto(V)},he.prototype.whenParentNamed=function(V){return this._bindingWhenSyntax.whenParentNamed(V)},he.prototype.whenParentTagged=function(V,ue){return this._bindingWhenSyntax.whenParentTagged(V,ue)},he.prototype.whenAnyAncestorIs=function(V){return this._bindingWhenSyntax.whenAnyAncestorIs(V)},he.prototype.whenNoAncestorIs=function(V){return this._bindingWhenSyntax.whenNoAncestorIs(V)},he.prototype.whenAnyAncestorNamed=function(V){return this._bindingWhenSyntax.whenAnyAncestorNamed(V)},he.prototype.whenAnyAncestorTagged=function(V,ue){return this._bindingWhenSyntax.whenAnyAncestorTagged(V,ue)},he.prototype.whenNoAncestorNamed=function(V){return this._bindingWhenSyntax.whenNoAncestorNamed(V)},he.prototype.whenNoAncestorTagged=function(V,ue){return this._bindingWhenSyntax.whenNoAncestorTagged(V,ue)},he.prototype.whenAnyAncestorMatches=function(V){return this._bindingWhenSyntax.whenAnyAncestorMatches(V)},he.prototype.whenNoAncestorMatches=function(V){return this._bindingWhenSyntax.whenNoAncestorMatches(V)},he.prototype.onActivation=function(V){return this._bindingOnSyntax.onActivation(V)},he}();Q.BindingWhenOnSyntax=m},98370:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.BindingWhenSyntax=void 0;var ie=U(51811),re=U(80758),m=function(){function he(V){this._binding=V}return he.prototype.when=function(V){return this._binding.constraint=V,new ie.BindingOnSyntax(this._binding)},he.prototype.whenTargetNamed=function(V){return this._binding.constraint=re.namedConstraint(V),new ie.BindingOnSyntax(this._binding)},he.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(V){var ue=V.target!==null&&!V.target.isNamed()&&!V.target.isTagged();return ue},new ie.BindingOnSyntax(this._binding)},he.prototype.whenTargetTagged=function(V,ue){return this._binding.constraint=re.taggedConstraint(V)(ue),new ie.BindingOnSyntax(this._binding)},he.prototype.whenInjectedInto=function(V){return this._binding.constraint=function(ue){return re.typeConstraint(V)(ue.parentRequest)},new ie.BindingOnSyntax(this._binding)},he.prototype.whenParentNamed=function(V){return this._binding.constraint=function(ue){return re.namedConstraint(V)(ue.parentRequest)},new ie.BindingOnSyntax(this._binding)},he.prototype.whenParentTagged=function(V,ue){return this._binding.constraint=function(ce){return re.taggedConstraint(V)(ue)(ce.parentRequest)},new ie.BindingOnSyntax(this._binding)},he.prototype.whenAnyAncestorIs=function(V){return this._binding.constraint=function(ue){return re.traverseAncerstors(ue,re.typeConstraint(V))},new ie.BindingOnSyntax(this._binding)},he.prototype.whenNoAncestorIs=function(V){return this._binding.constraint=function(ue){return!re.traverseAncerstors(ue,re.typeConstraint(V))},new ie.BindingOnSyntax(this._binding)},he.prototype.whenAnyAncestorNamed=function(V){return this._binding.constraint=function(ue){return re.traverseAncerstors(ue,re.namedConstraint(V))},new ie.BindingOnSyntax(this._binding)},he.prototype.whenNoAncestorNamed=function(V){return this._binding.constraint=function(ue){return!re.traverseAncerstors(ue,re.namedConstraint(V))},new ie.BindingOnSyntax(this._binding)},he.prototype.whenAnyAncestorTagged=function(V,ue){return this._binding.constraint=function(ce){return re.traverseAncerstors(ce,re.taggedConstraint(V)(ue))},new ie.BindingOnSyntax(this._binding)},he.prototype.whenNoAncestorTagged=function(V,ue){return this._binding.constraint=function(ce){return!re.traverseAncerstors(ce,re.taggedConstraint(V)(ue))},new ie.BindingOnSyntax(this._binding)},he.prototype.whenAnyAncestorMatches=function(V){return this._binding.constraint=function(ue){return re.traverseAncerstors(ue,V)},new ie.BindingOnSyntax(this._binding)},he.prototype.whenNoAncestorMatches=function(V){return this._binding.constraint=function(ue){return!re.traverseAncerstors(ue,V)},new ie.BindingOnSyntax(this._binding)},he}();Q.BindingWhenSyntax=m},80758:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.typeConstraint=Q.namedConstraint=Q.taggedConstraint=Q.traverseAncerstors=void 0;var ie=U(6867),re=U(47738),m=function(ce,Le){var ee=ce.parentRequest;return ee!==null?Le(ee)?!0:m(ee,Le):!1};Q.traverseAncerstors=m;var he=function(ce){return function(Le){var ee=function(Xe){return Xe!==null&&Xe.target!==null&&Xe.target.matchesTag(ce)(Le)};return ee.metaData=new re.Metadata(ce,Le),ee}};Q.taggedConstraint=he;var V=he(ie.NAMED_TAG);Q.namedConstraint=V;var ue=function(ce){return function(Le){var ee=null;if(Le!==null)if(ee=Le.bindings[0],typeof ce=="string"){var Xe=ee.serviceIdentifier;return Xe===ce}else{var Je=Le.bindings[0].implementationType;return ce===Je}return!1}};Q.typeConstraint=ue},70600:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.multiBindToService=void 0;var U=function(ie){return function(re){return function(){for(var m=[],he=0;he<arguments.length;he++)m[he]=arguments[he];return m.forEach(function(V){return ie.bind(V).toService(re)})}}};Q.multiBindToService=U},85265:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.isStackOverflowExeption=void 0;var ie=U(16674);function re(m){return m instanceof RangeError||m.message===ie.STACK_OVERFLOW}Q.isStackOverflowExeption=re},37791:function(Mt,Q){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.id=void 0;var U=0;function ie(){return U++}Q.id=ie},55800:function(Mt,Q,U){"use strict";Object.defineProperty(Q,"__esModule",{value:!0}),Q.circularDependencyToException=Q.listMetadataForTarget=Q.listRegisteredBindingsForServiceIdentifier=Q.getServiceIdentifierAsString=Q.getFunctionName=void 0;var ie=U(16674);function re(ee){if(typeof ee=="function"){var Xe=ee;return Xe.name}else{if(typeof ee=="symbol")return ee.toString();var Xe=ee;return Xe}}Q.getServiceIdentifierAsString=re;function m(ee,Xe,Je){var Ze="",gt=Je(ee,Xe);return gt.length!==0&&(Ze=`
Registered bindings:`,gt.forEach(function(tr){var yt="Object";tr.implementationType!==null&&(yt=Le(tr.implementationType)),Ze=Ze+`
 `+yt,tr.constraint.metaData&&(Ze=Ze+" - "+tr.constraint.metaData)})),Ze}Q.listRegisteredBindingsForServiceIdentifier=m;function he(ee,Xe){return ee.parentRequest===null?!1:ee.parentRequest.serviceIdentifier===Xe?!0:he(ee.parentRequest,Xe)}function V(ee){function Xe(Ze,gt){gt===void 0&&(gt=[]);var tr=re(Ze.serviceIdentifier);return gt.push(tr),Ze.parentRequest!==null?Xe(Ze.parentRequest,gt):gt}var Je=Xe(ee);return Je.reverse().join(" --> ")}function ue(ee){ee.childRequests.forEach(function(Xe){if(he(Xe,Xe.serviceIdentifier)){var Je=V(Xe);throw new Error(ie.CIRCULAR_DEPENDENCY+" "+Je)}else ue(Xe)})}Q.circularDependencyToException=ue;function ce(ee,Xe){if(Xe.isTagged()||Xe.isNamed()){var Je="",Ze=Xe.getNamedTag(),gt=Xe.getCustomTags();return Ze!==null&&(Je+=Ze.toString()+`
`),gt!==null&&gt.forEach(function(tr){Je+=tr.toString()+`
`})," "+ee+`
 `+ee+" - "+Je}else return" "+ee}Q.listMetadataForTarget=ce;function Le(ee){if(ee.name)return ee.name;var Xe=ee.toString(),Je=Xe.match(/^function\s*([^\s(]+)/);return Je?Je[1]:"Anonymous function: "+Xe}Q.getFunctionName=Le},31745:function(Mt){"use strict";Mt.exports=U,Mt.exports.default=U;var Q=1e20;function U(V,ue,ce,Le,ee,Xe){this.fontSize=V||24,this.buffer=ue===void 0?3:ue,this.cutoff=Le||.25,this.fontFamily=ee||"sans-serif",this.fontWeight=Xe||"normal",this.radius=ce||8;var Je=this.size=this.fontSize+this.buffer*2,Ze=Je+this.buffer*2,gt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;gt?this.canvas=my.createOffscreenCanvas(Je,Je,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Je),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Ze*Ze),this.gridInner=new Float64Array(Ze*Ze),this.f=new Float64Array(Ze),this.z=new Float64Array(Ze+1),this.v=new Uint16Array(Ze),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,gt?this.middle=Math.round(Je/2*1):this.middle=Math.round(Je/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ie(V,ue,ce,Le,ee,Xe,Je){Xe.fill(Q,0,ue*ce),Je.fill(0,0,ue*ce);for(var Ze=(ue-Le)/2,gt=0;gt<ee;gt++)for(var tr=0;tr<Le;tr++){var yt=(gt+Ze)*ue+tr+Ze,Wt=V.data[4*(gt*Le+tr)+3]/255;if(Wt===1)Xe[yt]=0,Je[yt]=Q;else if(Wt===0)Xe[yt]=Q,Je[yt]=0;else{var bt=Math.max(0,.5-Wt),at=Math.max(0,Wt-.5);Xe[yt]=bt*bt,Je[yt]=at*at}}}function re(V,ue,ce,Le,ee,Xe,Je){for(var Ze=0;Ze<ue*ce;Ze++){var gt=Math.sqrt(Le[Ze])-Math.sqrt(ee[Ze]);V[Ze]=Math.round(255-255*(gt/Xe+Je))}}U.prototype._draw=function(V,ue){var ce=this.ctx.measureText(V),Le=ce.width,ee=2*this.buffer,Xe,Je,Ze,gt,tr,yt,Wt,bt;ue&&this.useMetrics?(tr=Math.floor(ce.actualBoundingBoxAscent),bt=this.buffer+Math.ceil(ce.actualBoundingBoxAscent),yt=this.buffer,Wt=this.buffer,Je=Math.min(this.size,Math.ceil(ce.actualBoundingBoxRight-ce.actualBoundingBoxLeft)),gt=Math.min(this.size-yt,Math.ceil(ce.actualBoundingBoxAscent+ce.actualBoundingBoxDescent)),Xe=Je+ee,Ze=gt+ee,this.ctx.textBaseline="alphabetic"):(Xe=Je=this.size,Ze=gt=this.size,tr=19*this.fontSize/24,yt=Wt=0,bt=this.middle,this.ctx.textBaseline="middle");var at;Je&&gt&&(this.ctx.clearRect(Wt,yt,Je,gt),this.ctx.fillText(V,this.buffer,bt),at=this.ctx.getImageData(Wt,yt,Je,gt));var nt=new Uint8ClampedArray(Xe*Ze);return ie(at,Xe,Ze,Je,gt,this.gridOuter,this.gridInner),m(this.gridOuter,Xe,Ze,this.f,this.v,this.z),m(this.gridInner,Xe,Ze,this.f,this.v,this.z),re(nt,Xe,Ze,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:nt,metrics:{width:Je,height:gt,sdfWidth:Xe,sdfHeight:Ze,top:tr,left:0,advance:Le}}},U.prototype.draw=function(V){return this._draw(V,!1).data},U.prototype.drawWithMetrics=function(V){return this._draw(V,!0)};function m(V,ue,ce,Le,ee,Xe){for(var Je=0;Je<ue;Je++)he(V,Je,ue,ce,Le,ee,Xe);for(var Ze=0;Ze<ce;Ze++)he(V,Ze*ue,1,ue,Le,ee,Xe)}function he(V,ue,ce,Le,ee,Xe,Je){var Ze,gt,tr,yt;for(Xe[0]=0,Je[0]=-Q,Je[1]=Q,Ze=0;Ze<Le;Ze++)ee[Ze]=V[ue+Ze*ce];for(Ze=1,gt=0,tr=0;Ze<Le;Ze++){do yt=Xe[gt],tr=(ee[Ze]-ee[yt]+Ze*Ze-yt*yt)/(Ze-yt)/2;while(tr<=Je[gt]&&--gt>-1);gt++,Xe[gt]=Ze,Je[gt]=tr,Je[gt+1]=Q}for(Ze=0,gt=0;Ze<Le;Ze++){for(;Je[gt+1]<Ze;)gt++;yt=Xe[gt],V[ue+Ze*ce]=ee[yt]+(Ze-yt)*(Ze-yt)}}},18857:function(Mt,Q,U){"use strict";U.r(Q),U.d(Q,{Function:function(){return Ys},Interpreter:function(){return xa},default:function(){return al},evaluate:function(){return Wu},vm:function(){return ie}});var ie={};U.r(ie),U.d(ie,{Script:function(){return tc},compileFunction:function(){return hf},createContext:function(){return is},runInContext:function(){return Tl},runInNewContext:function(){return Xs}});var re={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},m="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",he={5:m,"5module":m+" export import",6:m+" const class extends export import super"},V=/^in(stanceof)?$/,ue="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",ce="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Le=new RegExp("["+ue+"]"),ee=new RegExp("["+ue+ce+"]");ue=ce=null;var Xe=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Je=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Ze(_,M){for(var B=65536,O=0;O<M.length;O+=2){if(B+=M[O],B>_)return!1;if(B+=M[O+1],B>=_)return!0}}function gt(_,M){return _<65?_===36:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&Le.test(String.fromCharCode(_)):M===!1?!1:Ze(_,Xe)}function tr(_,M){return _<48?_===36:_<58?!0:_<65?!1:_<91?!0:_<97?_===95:_<123?!0:_<=65535?_>=170&&ee.test(String.fromCharCode(_)):M===!1?!1:Ze(_,Xe)||Ze(_,Je)}var yt=function(M,B){B===void 0&&(B={}),this.label=M,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function Wt(_,M){return new yt(_,{beforeExpr:!0,binop:M})}var bt={beforeExpr:!0},at={startsExpr:!0},nt={};function Zt(_,M){return M===void 0&&(M={}),M.keyword=_,nt[_]=new yt(_,M)}var Y={num:new yt("num",at),regexp:new yt("regexp",at),string:new yt("string",at),name:new yt("name",at),eof:new yt("eof"),bracketL:new yt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new yt("]"),braceL:new yt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new yt("}"),parenL:new yt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new yt(")"),comma:new yt(",",bt),semi:new yt(";",bt),colon:new yt(":",bt),dot:new yt("."),question:new yt("?",bt),questionDot:new yt("?."),arrow:new yt("=>",bt),template:new yt("template"),invalidTemplate:new yt("invalidTemplate"),ellipsis:new yt("...",bt),backQuote:new yt("`",at),dollarBraceL:new yt("${",{beforeExpr:!0,startsExpr:!0}),eq:new yt("=",{beforeExpr:!0,isAssign:!0}),assign:new yt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new yt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new yt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Wt("||",1),logicalAND:Wt("&&",2),bitwiseOR:Wt("|",3),bitwiseXOR:Wt("^",4),bitwiseAND:Wt("&",5),equality:Wt("==/!=/===/!==",6),relational:Wt("</>/<=/>=",7),bitShift:Wt("<</>>/>>>",8),plusMin:new yt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Wt("%",10),star:Wt("*",10),slash:Wt("/",10),starstar:new yt("**",{beforeExpr:!0}),coalesce:Wt("??",1),_break:Zt("break"),_case:Zt("case",bt),_catch:Zt("catch"),_continue:Zt("continue"),_debugger:Zt("debugger"),_default:Zt("default",bt),_do:Zt("do",{isLoop:!0,beforeExpr:!0}),_else:Zt("else",bt),_finally:Zt("finally"),_for:Zt("for",{isLoop:!0}),_function:Zt("function",at),_if:Zt("if"),_return:Zt("return",bt),_switch:Zt("switch"),_throw:Zt("throw",bt),_try:Zt("try"),_var:Zt("var"),_const:Zt("const"),_while:Zt("while",{isLoop:!0}),_with:Zt("with"),_new:Zt("new",{beforeExpr:!0,startsExpr:!0}),_this:Zt("this",at),_super:Zt("super",at),_class:Zt("class",at),_extends:Zt("extends",bt),_export:Zt("export"),_import:Zt("import",at),_null:Zt("null",at),_true:Zt("true",at),_false:Zt("false",at),_in:Zt("in",{beforeExpr:!0,binop:7}),_instanceof:Zt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Zt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Zt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Zt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},qt=/\r\n?|\n|\u2028|\u2029/,ut=new RegExp(qt.source,"g");function Qe(_,M){return _===10||_===13||!M&&(_===8232||_===8233)}var Ct=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Kt=Object.prototype,xr=Kt.hasOwnProperty,kr=Kt.toString;function Kr(_,M){return xr.call(_,M)}var A=Array.isArray||function(_){return kr.call(_)==="[object Array]"};function Ae(_){return new RegExp("^(?:"+_.replace(/ /g,"|")+")$")}var De=function(M,B){this.line=M,this.column=B};De.prototype.offset=function(M){return new De(this.line,this.column+M)};var At=function(M,B,O){this.start=B,this.end=O,M.sourceFile!==null&&(this.source=M.sourceFile)};function mt(_,M){for(var B=1,O=0;;){ut.lastIndex=O;var $=ut.exec(_);if($&&$.index<M)++B,O=$.index+$[0].length;else return new De(B,M-O)}}var Ft={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Yt(_){var M={};for(var B in Ft)M[B]=_&&Kr(_,B)?_[B]:Ft[B];if(M.ecmaVersion>=2015&&(M.ecmaVersion-=2009),M.allowReserved==null&&(M.allowReserved=M.ecmaVersion<5),A(M.onToken)){var O=M.onToken;M.onToken=function($){return O.push($)}}return A(M.onComment)&&(M.onComment=Sr(M,M.onComment)),M}function Sr(_,M){return function(B,O,$,xe,We,ft){var pt={type:B?"Block":"Line",value:O,start:$,end:xe};_.locations&&(pt.loc=new At(this,We,ft)),_.ranges&&(pt.range=[$,xe]),M.push(pt)}}var qn=1,hn=2,fi=qn|hn,Gn=4,ni=8,pi=16,Wn=32,hi=64,ua=128;function Gi(_,M){return hn|(_?Gn:0)|(M?ni:0)}var Di=0,$i=1,la=2,Mi=3,ma=4,Xn=5,Si=function(M,B,O){this.options=M=Yt(M),this.sourceFile=M.sourceFile,this.keywords=Ae(he[M.ecmaVersion>=6?6:M.sourceType==="module"?"5module":5]);var $="";if(M.allowReserved!==!0){for(var xe=M.ecmaVersion;!($=re[xe]);xe--);M.sourceType==="module"&&($+=" await")}this.reservedWords=Ae($);var We=($?$+" ":"")+re.strict;this.reservedWordsStrict=Ae(We),this.reservedWordsStrictBind=Ae(We+" "+re.strictBind),this.input=String(B),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(qt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=Y.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=M.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&M.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(qn),this.regexpState=null},Zi={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Si.prototype.parse=function(){var M=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(M)},Zi.inFunction.get=function(){return(this.currentVarScope().flags&hn)>0},Zi.inGenerator.get=function(){return(this.currentVarScope().flags&ni)>0},Zi.inAsync.get=function(){return(this.currentVarScope().flags&Gn)>0},Zi.allowSuper.get=function(){return(this.currentThisScope().flags&hi)>0},Zi.allowDirectSuper.get=function(){return(this.currentThisScope().flags&ua)>0},Zi.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Si.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&hn)>0},Si.extend=function(){for(var M=[],B=arguments.length;B--;)M[B]=arguments[B];for(var O=this,$=0;$<M.length;$++)O=M[$](O);return O},Si.parse=function(M,B){return new this(B,M).parse()},Si.parseExpressionAt=function(M,B,O){var $=new this(O,M,B);return $.nextToken(),$.parseExpression()},Si.tokenizer=function(M,B){return new this(B,M)},Object.defineProperties(Si.prototype,Zi);var Qi=Si.prototype,ko=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;Qi.strictDirective=function(_){for(;;){$e.lastIndex=_,_+=$e.exec(this.input)[0].length;var M=ko.exec(this.input.slice(_));if(!M)return!1;if((M[1]||M[2])==="use strict"){$e.lastIndex=_+M[0].length;var B=$e.exec(this.input),O=B.index+B[0].length,$=this.input.charAt(O);return $===";"||$==="}"||qt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test($)||$==="!"&&this.input.charAt(O+1)==="=")}_+=M[0].length,$e.lastIndex=_,_+=$e.exec(this.input)[0].length,this.input[_]===";"&&_++}},Qi.eat=function(_){return this.type===_?(this.next(),!0):!1},Qi.isContextual=function(_){return this.type===Y.name&&this.value===_&&!this.containsEsc},Qi.eatContextual=function(_){return this.isContextual(_)?(this.next(),!0):!1},Qi.expectContextual=function(_){this.eatContextual(_)||this.unexpected()},Qi.canInsertSemicolon=function(){return this.type===Y.eof||this.type===Y.braceR||qt.test(this.input.slice(this.lastTokEnd,this.start))},Qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},Qi.semicolon=function(){!this.eat(Y.semi)&&!this.insertSemicolon()&&this.unexpected()},Qi.afterTrailingComma=function(_,M){if(this.type===_)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),M||this.next(),!0},Qi.expect=function(_){this.eat(_)||this.unexpected()},Qi.unexpected=function(_){this.raise(_!=null?_:this.start,"Unexpected token")};function me(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}Qi.checkPatternErrors=function(_,M){if(!!_){_.trailingComma>-1&&this.raiseRecoverable(_.trailingComma,"Comma is not permitted after the rest element");var B=M?_.parenthesizedAssign:_.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},Qi.checkExpressionErrors=function(_,M){if(!_)return!1;var B=_.shorthandAssign,O=_.doubleProto;if(!M)return B>=0||O>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},Qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},Qi.isSimpleAssignTarget=function(_){return _.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(_.expression):_.type==="Identifier"||_.type==="MemberExpression"};var kn=Si.prototype;kn.parseTopLevel=function(_){var M={};for(_.body||(_.body=[]);this.type!==Y.eof;){var B=this.parseStatement(null,!0,M);_.body.push(B)}if(this.inModule)for(var O=0,$=Object.keys(this.undefinedExports);O<$.length;O+=1){var xe=$[O];this.raiseRecoverable(this.undefinedExports[xe].start,"Export '"+xe+"' is not defined")}return this.adaptDirectivePrologue(_.body),this.next(),_.sourceType=this.options.sourceType,this.finishNode(_,"Program")};var Ha={kind:"loop"},ns={kind:"switch"};kn.isLet=function(_){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var M=$e.exec(this.input),B=this.pos+M[0].length,O=this.input.charCodeAt(B);if(O===91)return!0;if(_)return!1;if(O===123)return!0;if(gt(O,!0)){for(var $=B+1;tr(this.input.charCodeAt($),!0);)++$;var xe=this.input.slice(B,$);if(!V.test(xe))return!0}return!1},kn.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var _=$e.exec(this.input),M=this.pos+_[0].length;return!qt.test(this.input.slice(this.pos,M))&&this.input.slice(M,M+8)==="function"&&(M+8===this.input.length||!tr(this.input.charAt(M+8)))},kn.parseStatement=function(_,M,B){var O=this.type,$=this.startNode(),xe;switch(this.isLet(_)&&(O=Y._var,xe="let"),O){case Y._break:case Y._continue:return this.parseBreakContinueStatement($,O.keyword);case Y._debugger:return this.parseDebuggerStatement($);case Y._do:return this.parseDoStatement($);case Y._for:return this.parseForStatement($);case Y._function:return _&&(this.strict||_!=="if"&&_!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement($,!1,!_);case Y._class:return _&&this.unexpected(),this.parseClass($,!0);case Y._if:return this.parseIfStatement($);case Y._return:return this.parseReturnStatement($);case Y._switch:return this.parseSwitchStatement($);case Y._throw:return this.parseThrowStatement($);case Y._try:return this.parseTryStatement($);case Y._const:case Y._var:return xe=xe||this.value,_&&xe!=="var"&&this.unexpected(),this.parseVarStatement($,xe);case Y._while:return this.parseWhileStatement($);case Y._with:return this.parseWithStatement($);case Y.braceL:return this.parseBlock(!0,$);case Y.semi:return this.parseEmptyStatement($);case Y._export:case Y._import:if(this.options.ecmaVersion>10&&O===Y._import){$e.lastIndex=this.pos;var We=$e.exec(this.input),ft=this.pos+We[0].length,pt=this.input.charCodeAt(ft);if(pt===40||pt===46)return this.parseExpressionStatement($,this.parseExpression())}return this.options.allowImportExportEverywhere||(M||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===Y._import?this.parseImport($):this.parseExport($,B);default:if(this.isAsyncFunction())return _&&this.unexpected(),this.next(),this.parseFunctionStatement($,!0,!_);var ar=this.value,ur=this.parseExpression();return O===Y.name&&ur.type==="Identifier"&&this.eat(Y.colon)?this.parseLabeledStatement($,ar,ur,_):this.parseExpressionStatement($,ur)}},kn.parseBreakContinueStatement=function(_,M){var B=M==="break";this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.label=null:this.type!==Y.name?this.unexpected():(_.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var $=this.labels[O];if((_.label==null||$.name===_.label.name)&&($.kind!=null&&(B||$.kind==="loop")||_.label&&B))break}return O===this.labels.length&&this.raise(_.start,"Unsyntactic "+M),this.finishNode(_,B?"BreakStatement":"ContinueStatement")},kn.parseDebuggerStatement=function(_){return this.next(),this.semicolon(),this.finishNode(_,"DebuggerStatement")},kn.parseDoStatement=function(_){return this.next(),this.labels.push(Ha),_.body=this.parseStatement("do"),this.labels.pop(),this.expect(Y._while),_.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(Y.semi):this.semicolon(),this.finishNode(_,"DoWhileStatement")},kn.parseForStatement=function(_){this.next();var M=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ha),this.enterScope(0),this.expect(Y.parenL),this.type===Y.semi)return M>-1&&this.unexpected(M),this.parseFor(_,null);var B=this.isLet();if(this.type===Y._var||this.type===Y._const||B){var O=this.startNode(),$=B?"let":this.value;return this.next(),this.parseVar(O,!0,$),this.finishNode(O,"VariableDeclaration"),(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.parseForIn(_,O)):(M>-1&&this.unexpected(M),this.parseFor(_,O))}var xe=new me,We=this.parseExpression(!0,xe);return this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===Y._in?M>-1&&this.unexpected(M):_.await=M>-1),this.toAssignable(We,!1,xe),this.checkLVal(We),this.parseForIn(_,We)):(this.checkExpressionErrors(xe,!0),M>-1&&this.unexpected(M),this.parseFor(_,We))},kn.parseFunctionStatement=function(_,M,B){return this.next(),this.parseFunction(_,rr|(B?0:Cr),!1,M)},kn.parseIfStatement=function(_){return this.next(),_.test=this.parseParenExpression(),_.consequent=this.parseStatement("if"),_.alternate=this.eat(Y._else)?this.parseStatement("if"):null,this.finishNode(_,"IfStatement")},kn.parseReturnStatement=function(_){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(Y.semi)||this.insertSemicolon()?_.argument=null:(_.argument=this.parseExpression(),this.semicolon()),this.finishNode(_,"ReturnStatement")},kn.parseSwitchStatement=function(_){this.next(),_.discriminant=this.parseParenExpression(),_.cases=[],this.expect(Y.braceL),this.labels.push(ns),this.enterScope(0);for(var M,B=!1;this.type!==Y.braceR;)if(this.type===Y._case||this.type===Y._default){var O=this.type===Y._case;M&&this.finishNode(M,"SwitchCase"),_.cases.push(M=this.startNode()),M.consequent=[],this.next(),O?M.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,M.test=null),this.expect(Y.colon)}else M||this.unexpected(),M.consequent.push(this.parseStatement(null));return this.exitScope(),M&&this.finishNode(M,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(_,"SwitchStatement")},kn.parseThrowStatement=function(_){return this.next(),qt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),_.argument=this.parseExpression(),this.semicolon(),this.finishNode(_,"ThrowStatement")};var Bt=[];kn.parseTryStatement=function(_){if(this.next(),_.block=this.parseBlock(),_.handler=null,this.type===Y._catch){var M=this.startNode();if(this.next(),this.eat(Y.parenL)){M.param=this.parseBindingAtom();var B=M.param.type==="Identifier";this.enterScope(B?Wn:0),this.checkLVal(M.param,B?ma:la),this.expect(Y.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),M.param=null,this.enterScope(0);M.body=this.parseBlock(!1),this.exitScope(),_.handler=this.finishNode(M,"CatchClause")}return _.finalizer=this.eat(Y._finally)?this.parseBlock():null,!_.handler&&!_.finalizer&&this.raise(_.start,"Missing catch or finally clause"),this.finishNode(_,"TryStatement")},kn.parseVarStatement=function(_,M){return this.next(),this.parseVar(_,!1,M),this.semicolon(),this.finishNode(_,"VariableDeclaration")},kn.parseWhileStatement=function(_){return this.next(),_.test=this.parseParenExpression(),this.labels.push(Ha),_.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(_,"WhileStatement")},kn.parseWithStatement=function(_){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),_.object=this.parseParenExpression(),_.body=this.parseStatement("with"),this.finishNode(_,"WithStatement")},kn.parseEmptyStatement=function(_){return this.next(),this.finishNode(_,"EmptyStatement")},kn.parseLabeledStatement=function(_,M,B,O){for(var $=0,xe=this.labels;$<xe.length;$+=1){var We=xe[$];We.name===M&&this.raise(B.start,"Label '"+M+"' is already declared")}for(var ft=this.type.isLoop?"loop":this.type===Y._switch?"switch":null,pt=this.labels.length-1;pt>=0;pt--){var ar=this.labels[pt];if(ar.statementStart===_.start)ar.statementStart=this.start,ar.kind=ft;else break}return this.labels.push({name:M,kind:ft,statementStart:this.start}),_.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),_.label=B,this.finishNode(_,"LabeledStatement")},kn.parseExpressionStatement=function(_,M){return _.expression=M,this.semicolon(),this.finishNode(_,"ExpressionStatement")},kn.parseBlock=function(_,M,B){for(_===void 0&&(_=!0),M===void 0&&(M=this.startNode()),M.body=[],this.expect(Y.braceL),_&&this.enterScope(0);this.type!==Y.braceR;){var O=this.parseStatement(null);M.body.push(O)}return B&&(this.strict=!1),this.next(),_&&this.exitScope(),this.finishNode(M,"BlockStatement")},kn.parseFor=function(_,M){return _.init=M,this.expect(Y.semi),_.test=this.type===Y.semi?null:this.parseExpression(),this.expect(Y.semi),_.update=this.type===Y.parenR?null:this.parseExpression(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,"ForStatement")},kn.parseForIn=function(_,M){var B=this.type===Y._in;return this.next(),M.type==="VariableDeclaration"&&M.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||M.kind!=="var"||M.declarations[0].id.type!=="Identifier")?this.raise(M.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):M.type==="AssignmentPattern"&&this.raise(M.start,"Invalid left-hand side in for-loop"),_.left=M,_.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(Y.parenR),_.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(_,B?"ForInStatement":"ForOfStatement")},kn.parseVar=function(_,M,B){for(_.declarations=[],_.kind=B;;){var O=this.startNode();if(this.parseVarId(O,B),this.eat(Y.eq)?O.init=this.parseMaybeAssign(M):B==="const"&&!(this.type===Y._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(M&&(this.type===Y._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,_.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(Y.comma))break}return _},kn.parseVarId=function(_,M){_.id=this.parseBindingAtom(),this.checkLVal(_.id,M==="var"?$i:la,!1)};var rr=1,Cr=2,Qr=4;kn.parseFunction=function(_,M,B,O){this.initFunction(_),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===Y.star&&M&Cr&&this.unexpected(),_.generator=this.eat(Y.star)),this.options.ecmaVersion>=8&&(_.async=!!O),M&rr&&(_.id=M&Qr&&this.type!==Y.name?null:this.parseIdent(),_.id&&!(M&Cr)&&this.checkLVal(_.id,this.strict||_.generator||_.async?this.treatFunctionsAsVar?$i:la:Mi));var $=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(_.async,_.generator)),M&rr||(_.id=this.type===Y.name?this.parseIdent():null),this.parseFunctionParams(_),this.parseFunctionBody(_,B,!1),this.yieldPos=$,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(_,M&rr?"FunctionDeclaration":"FunctionExpression")},kn.parseFunctionParams=function(_){this.expect(Y.parenL),_.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},kn.parseClass=function(_,M){this.next();var B=this.strict;this.strict=!0,this.parseClassId(_,M),this.parseClassSuper(_);var O=this.startNode(),$=!1;for(O.body=[],this.expect(Y.braceL);this.type!==Y.braceR;){var xe=this.parseClassElement(_.superClass!==null);xe&&(O.body.push(xe),xe.type==="MethodDefinition"&&xe.kind==="constructor"&&($&&this.raise(xe.start,"Duplicate constructor in the same class"),$=!0))}return this.strict=B,this.next(),_.body=this.finishNode(O,"ClassBody"),this.finishNode(_,M?"ClassDeclaration":"ClassExpression")},kn.parseClassElement=function(_){var M=this;if(this.eat(Y.semi))return null;var B=this.startNode(),O=function(pt,ar){ar===void 0&&(ar=!1);var ur=M.start,Tn=M.startLoc;return M.eatContextual(pt)?M.type!==Y.parenL&&(!ar||!M.canInsertSemicolon())?!0:(B.key&&M.unexpected(),B.computed=!1,B.key=M.startNodeAt(ur,Tn),B.key.name=pt,M.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=O("static");var $=this.eat(Y.star),xe=!1;$||(this.options.ecmaVersion>=8&&O("async",!0)?(xe=!0,$=this.options.ecmaVersion>=9&&this.eat(Y.star)):O("get")?B.kind="get":O("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var We=B.key,ft=!1;return!B.computed&&!B.static&&(We.type==="Identifier"&&We.name==="constructor"||We.type==="Literal"&&We.value==="constructor")?(B.kind!=="method"&&this.raise(We.start,"Constructor can't have get/set modifier"),$&&this.raise(We.start,"Constructor can't be a generator"),xe&&this.raise(We.start,"Constructor can't be an async method"),B.kind="constructor",ft=_):B.static&&We.type==="Identifier"&&We.name==="prototype"&&this.raise(We.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,$,xe,ft),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},kn.parseClassMethod=function(_,M,B,O){return _.value=this.parseMethod(M,B,O),this.finishNode(_,"MethodDefinition")},kn.parseClassId=function(_,M){this.type===Y.name?(_.id=this.parseIdent(),M&&this.checkLVal(_.id,la,!1)):(M===!0&&this.unexpected(),_.id=null)},kn.parseClassSuper=function(_){_.superClass=this.eat(Y._extends)?this.parseExprSubscripts():null},kn.parseExport=function(_,M){if(this.next(),this.eat(Y.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(_.exported=this.parseIdent(!0),this.checkExport(M,_.exported.name,this.lastTokStart)):_.exported=null),this.expectContextual("from"),this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom(),this.semicolon(),this.finishNode(_,"ExportAllDeclaration");if(this.eat(Y._default)){this.checkExport(M,"default",this.lastTokStart);var B;if(this.type===Y._function||(B=this.isAsyncFunction())){var O=this.startNode();this.next(),B&&this.next(),_.declaration=this.parseFunction(O,rr|Qr,!1,B)}else if(this.type===Y._class){var $=this.startNode();_.declaration=this.parseClass($,"nullableID")}else _.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(_,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())_.declaration=this.parseStatement(null),_.declaration.type==="VariableDeclaration"?this.checkVariableExport(M,_.declaration.declarations):this.checkExport(M,_.declaration.id.name,_.declaration.id.start),_.specifiers=[],_.source=null;else{if(_.declaration=null,_.specifiers=this.parseExportSpecifiers(M),this.eatContextual("from"))this.type!==Y.string&&this.unexpected(),_.source=this.parseExprAtom();else{for(var xe=0,We=_.specifiers;xe<We.length;xe+=1){var ft=We[xe];this.checkUnreserved(ft.local),this.checkLocalExport(ft.local)}_.source=null}this.semicolon()}return this.finishNode(_,"ExportNamedDeclaration")},kn.checkExport=function(_,M,B){!_||(Kr(_,M)&&this.raiseRecoverable(B,"Duplicate export '"+M+"'"),_[M]=!0)},kn.checkPatternExport=function(_,M){var B=M.type;if(B==="Identifier")this.checkExport(_,M.name,M.start);else if(B==="ObjectPattern")for(var O=0,$=M.properties;O<$.length;O+=1){var xe=$[O];this.checkPatternExport(_,xe)}else if(B==="ArrayPattern")for(var We=0,ft=M.elements;We<ft.length;We+=1){var pt=ft[We];pt&&this.checkPatternExport(_,pt)}else B==="Property"?this.checkPatternExport(_,M.value):B==="AssignmentPattern"?this.checkPatternExport(_,M.left):B==="RestElement"?this.checkPatternExport(_,M.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(_,M.expression)},kn.checkVariableExport=function(_,M){if(!!_)for(var B=0,O=M;B<O.length;B+=1){var $=O[B];this.checkPatternExport(_,$.id)}},kn.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},kn.parseExportSpecifiers=function(_){var M=[],B=!0;for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(B)B=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(_,O.exported.name,O.exported.start),M.push(this.finishNode(O,"ExportSpecifier"))}return M},kn.parseImport=function(_){return this.next(),this.type===Y.string?(_.specifiers=Bt,_.source=this.parseExprAtom()):(_.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),_.source=this.type===Y.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(_,"ImportDeclaration")},kn.parseImportSpecifiers=function(){var _=[],M=!0;if(this.type===Y.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,la),_.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(Y.comma))return _}if(this.type===Y.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,la),_.push(this.finishNode(O,"ImportNamespaceSpecifier")),_}for(this.expect(Y.braceL);!this.eat(Y.braceR);){if(M)M=!1;else if(this.expect(Y.comma),this.afterTrailingComma(Y.braceR))break;var $=this.startNode();$.imported=this.parseIdent(!0),this.eatContextual("as")?$.local=this.parseIdent():(this.checkUnreserved($.imported),$.local=$.imported),this.checkLVal($.local,la),_.push(this.finishNode($,"ImportSpecifier"))}return _},kn.adaptDirectivePrologue=function(_){for(var M=0;M<_.length&&this.isDirectiveCandidate(_[M]);++M)_[M].directive=_[M].expression.raw.slice(1,-1)},kn.isDirectiveCandidate=function(_){return _.type==="ExpressionStatement"&&_.expression.type==="Literal"&&typeof _.expression.value=="string"&&(this.input[_.start]==='"'||this.input[_.start]==="'")};var Sn=Si.prototype;Sn.toAssignable=function(_,M,B){if(this.options.ecmaVersion>=6&&_)switch(_.type){case"Identifier":this.inAsync&&_.name==="await"&&this.raise(_.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":_.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var O=0,$=_.properties;O<$.length;O+=1){var xe=$[O];this.toAssignable(xe,M),xe.type==="RestElement"&&(xe.argument.type==="ArrayPattern"||xe.argument.type==="ObjectPattern")&&this.raise(xe.argument.start,"Unexpected token")}break;case"Property":_.kind!=="init"&&this.raise(_.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(_.value,M);break;case"ArrayExpression":_.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(_.elements,M);break;case"SpreadElement":_.type="RestElement",this.toAssignable(_.argument,M),_.argument.type==="AssignmentPattern"&&this.raise(_.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":_.operator!=="="&&this.raise(_.left.end,"Only '=' operator can be used for specifying default value."),_.type="AssignmentPattern",delete _.operator,this.toAssignable(_.left,M);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(_.expression,M,B);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!M)break;default:this.raise(_.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return _},Sn.toAssignableList=function(_,M){for(var B=_.length,O=0;O<B;O++){var $=_[O];$&&this.toAssignable($,M)}if(B){var xe=_[B-1];this.options.ecmaVersion===6&&M&&xe&&xe.type==="RestElement"&&xe.argument.type!=="Identifier"&&this.unexpected(xe.argument.start)}return _},Sn.parseSpread=function(_){var M=this.startNode();return this.next(),M.argument=this.parseMaybeAssign(!1,_),this.finishNode(M,"SpreadElement")},Sn.parseRestBinding=function(){var _=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==Y.name&&this.unexpected(),_.argument=this.parseBindingAtom(),this.finishNode(_,"RestElement")},Sn.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case Y.bracketL:var _=this.startNode();return this.next(),_.elements=this.parseBindingList(Y.bracketR,!0,!0),this.finishNode(_,"ArrayPattern");case Y.braceL:return this.parseObj(!0)}return this.parseIdent()},Sn.parseBindingList=function(_,M,B){for(var O=[],$=!0;!this.eat(_);)if($?$=!1:this.expect(Y.comma),M&&this.type===Y.comma)O.push(null);else{if(B&&this.afterTrailingComma(_))break;if(this.type===Y.ellipsis){var xe=this.parseRestBinding();this.parseBindingListItem(xe),O.push(xe),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(_);break}else{var We=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(We),O.push(We)}}return O},Sn.parseBindingListItem=function(_){return _},Sn.parseMaybeDefault=function(_,M,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(Y.eq))return B;var O=this.startNodeAt(_,M);return O.left=B,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},Sn.checkLVal=function(_,M,B){switch(M===void 0&&(M=Di),_.type){case"Identifier":M===la&&_.name==="let"&&this.raiseRecoverable(_.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(_.name)&&this.raiseRecoverable(_.start,(M?"Binding ":"Assigning to ")+_.name+" in strict mode"),B&&(Kr(B,_.name)&&this.raiseRecoverable(_.start,"Argument name clash"),B[_.name]=!0),M!==Di&&M!==Xn&&this.declareName(_.name,M,_.start);break;case"ChainExpression":this.raiseRecoverable(_.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":M&&this.raiseRecoverable(_.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,$=_.properties;O<$.length;O+=1){var xe=$[O];this.checkLVal(xe,M,B)}break;case"Property":this.checkLVal(_.value,M,B);break;case"ArrayPattern":for(var We=0,ft=_.elements;We<ft.length;We+=1){var pt=ft[We];pt&&this.checkLVal(pt,M,B)}break;case"AssignmentPattern":this.checkLVal(_.left,M,B);break;case"RestElement":this.checkLVal(_.argument,M,B);break;case"ParenthesizedExpression":this.checkLVal(_.expression,M,B);break;default:this.raise(_.start,(M?"Binding":"Assigning to")+" rvalue")}};var Fn=Si.prototype;Fn.checkPropClash=function(_,M,B){if(!(this.options.ecmaVersion>=9&&_.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(_.computed||_.method||_.shorthand))){var O=_.key,$;switch(O.type){case"Identifier":$=O.name;break;case"Literal":$=String(O.value);break;default:return}var xe=_.kind;if(this.options.ecmaVersion>=6){$==="__proto__"&&xe==="init"&&(M.proto&&(B?B.doubleProto<0&&(B.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),M.proto=!0);return}$="$"+$;var We=M[$];if(We){var ft;xe==="init"?ft=this.strict&&We.init||We.get||We.set:ft=We.init||We[xe],ft&&this.raiseRecoverable(O.start,"Redefinition of property")}else We=M[$]={init:!1,get:!1,set:!1};We[xe]=!0}},Fn.parseExpression=function(_,M){var B=this.start,O=this.startLoc,$=this.parseMaybeAssign(_,M);if(this.type===Y.comma){var xe=this.startNodeAt(B,O);for(xe.expressions=[$];this.eat(Y.comma);)xe.expressions.push(this.parseMaybeAssign(_,M));return this.finishNode(xe,"SequenceExpression")}return $},Fn.parseMaybeAssign=function(_,M,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(_);this.exprAllowed=!1}var O=!1,$=-1,xe=-1;M?($=M.parenthesizedAssign,xe=M.trailingComma,M.parenthesizedAssign=M.trailingComma=-1):(M=new me,O=!0);var We=this.start,ft=this.startLoc;(this.type===Y.parenL||this.type===Y.name)&&(this.potentialArrowAt=this.start);var pt=this.parseMaybeConditional(_,M);if(B&&(pt=B.call(this,pt,We,ft)),this.type.isAssign){var ar=this.startNodeAt(We,ft);return ar.operator=this.value,ar.left=this.type===Y.eq?this.toAssignable(pt,!1,M):pt,O||(M.parenthesizedAssign=M.trailingComma=M.doubleProto=-1),M.shorthandAssign>=ar.left.start&&(M.shorthandAssign=-1),this.checkLVal(pt),this.next(),ar.right=this.parseMaybeAssign(_),this.finishNode(ar,"AssignmentExpression")}else O&&this.checkExpressionErrors(M,!0);return $>-1&&(M.parenthesizedAssign=$),xe>-1&&(M.trailingComma=xe),pt},Fn.parseMaybeConditional=function(_,M){var B=this.start,O=this.startLoc,$=this.parseExprOps(_,M);if(this.checkExpressionErrors(M))return $;if(this.eat(Y.question)){var xe=this.startNodeAt(B,O);return xe.test=$,xe.consequent=this.parseMaybeAssign(),this.expect(Y.colon),xe.alternate=this.parseMaybeAssign(_),this.finishNode(xe,"ConditionalExpression")}return $},Fn.parseExprOps=function(_,M){var B=this.start,O=this.startLoc,$=this.parseMaybeUnary(M,!1);return this.checkExpressionErrors(M)||$.start===B&&$.type==="ArrowFunctionExpression"?$:this.parseExprOp($,B,O,-1,_)},Fn.parseExprOp=function(_,M,B,O,$){var xe=this.type.binop;if(xe!=null&&(!$||this.type!==Y._in)&&xe>O){var We=this.type===Y.logicalOR||this.type===Y.logicalAND,ft=this.type===Y.coalesce;ft&&(xe=Y.logicalAND.binop);var pt=this.value;this.next();var ar=this.start,ur=this.startLoc,Tn=this.parseExprOp(this.parseMaybeUnary(null,!1),ar,ur,xe,$),ii=this.buildBinary(M,B,_,Tn,pt,We||ft);return(We&&this.type===Y.coalesce||ft&&(this.type===Y.logicalOR||this.type===Y.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(ii,M,B,O,$)}return _},Fn.buildBinary=function(_,M,B,O,$,xe){var We=this.startNodeAt(_,M);return We.left=B,We.operator=$,We.right=O,this.finishNode(We,xe?"LogicalExpression":"BinaryExpression")},Fn.parseMaybeUnary=function(_,M){var B=this.start,O=this.startLoc,$;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))$=this.parseAwait(),M=!0;else if(this.type.prefix){var xe=this.startNode(),We=this.type===Y.incDec;xe.operator=this.value,xe.prefix=!0,this.next(),xe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(_,!0),We?this.checkLVal(xe.argument):this.strict&&xe.operator==="delete"&&xe.argument.type==="Identifier"?this.raiseRecoverable(xe.start,"Deleting local variable in strict mode"):M=!0,$=this.finishNode(xe,We?"UpdateExpression":"UnaryExpression")}else{if($=this.parseExprSubscripts(_),this.checkExpressionErrors(_))return $;for(;this.type.postfix&&!this.canInsertSemicolon();){var ft=this.startNodeAt(B,O);ft.operator=this.value,ft.prefix=!1,ft.argument=$,this.checkLVal($),this.next(),$=this.finishNode(ft,"UpdateExpression")}}return!M&&this.eat(Y.starstar)?this.buildBinary(B,O,$,this.parseMaybeUnary(null,!1),"**",!1):$},Fn.parseExprSubscripts=function(_){var M=this.start,B=this.startLoc,O=this.parseExprAtom(_);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var $=this.parseSubscripts(O,M,B);return _&&$.type==="MemberExpression"&&(_.parenthesizedAssign>=$.start&&(_.parenthesizedAssign=-1),_.parenthesizedBind>=$.start&&(_.parenthesizedBind=-1)),$},Fn.parseSubscripts=function(_,M,B,O){for(var $=this.options.ecmaVersion>=8&&_.type==="Identifier"&&_.name==="async"&&this.lastTokEnd===_.end&&!this.canInsertSemicolon()&&_.end-_.start==5&&this.potentialArrowAt===_.start,xe=!1;;){var We=this.parseSubscript(_,M,B,O,$,xe);if(We.optional&&(xe=!0),We===_||We.type==="ArrowFunctionExpression"){if(xe){var ft=this.startNodeAt(M,B);ft.expression=We,We=this.finishNode(ft,"ChainExpression")}return We}_=We}},Fn.parseSubscript=function(_,M,B,O,$,xe){var We=this.options.ecmaVersion>=11,ft=We&&this.eat(Y.questionDot);O&&ft&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var pt=this.eat(Y.bracketL);if(pt||ft&&this.type!==Y.parenL&&this.type!==Y.backQuote||this.eat(Y.dot)){var ar=this.startNodeAt(M,B);ar.object=_,ar.property=pt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),ar.computed=!!pt,pt&&this.expect(Y.bracketR),We&&(ar.optional=ft),_=this.finishNode(ar,"MemberExpression")}else if(!O&&this.eat(Y.parenL)){var ur=new me,Tn=this.yieldPos,ii=this.awaitPos,Rn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Yi=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1,ur);if($&&!ft&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(ur,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=Tn,this.awaitPos=ii,this.awaitIdentPos=Rn,this.parseArrowExpression(this.startNodeAt(M,B),Yi,!0);this.checkExpressionErrors(ur,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ii||this.awaitPos,this.awaitIdentPos=Rn||this.awaitIdentPos;var da=this.startNodeAt(M,B);da.callee=_,da.arguments=Yi,We&&(da.optional=ft),_=this.finishNode(da,"CallExpression")}else if(this.type===Y.backQuote){(ft||xe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ca=this.startNodeAt(M,B);Ca.tag=_,Ca.quasi=this.parseTemplate({isTagged:!0}),_=this.finishNode(Ca,"TaggedTemplateExpression")}return _},Fn.parseExprAtom=function(_){this.type===Y.slash&&this.readRegexp();var M,B=this.potentialArrowAt===this.start;switch(this.type){case Y._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),M=this.startNode(),this.next(),this.type===Y.parenL&&!this.allowDirectSuper&&this.raise(M.start,"super() call outside constructor of a subclass"),this.type!==Y.dot&&this.type!==Y.bracketL&&this.type!==Y.parenL&&this.unexpected(),this.finishNode(M,"Super");case Y._this:return M=this.startNode(),this.next(),this.finishNode(M,"ThisExpression");case Y.name:var O=this.start,$=this.startLoc,xe=this.containsEsc,We=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!xe&&We.name==="async"&&!this.canInsertSemicolon()&&this.eat(Y._function))return this.parseFunction(this.startNodeAt(O,$),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(Y.arrow))return this.parseArrowExpression(this.startNodeAt(O,$),[We],!1);if(this.options.ecmaVersion>=8&&We.name==="async"&&this.type===Y.name&&!xe)return We=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(Y.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,$),[We],!0)}return We;case Y.regexp:var ft=this.value;return M=this.parseLiteral(ft.value),M.regex={pattern:ft.pattern,flags:ft.flags},M;case Y.num:case Y.string:return this.parseLiteral(this.value);case Y._null:case Y._true:case Y._false:return M=this.startNode(),M.value=this.type===Y._null?null:this.type===Y._true,M.raw=this.type.keyword,this.next(),this.finishNode(M,"Literal");case Y.parenL:var pt=this.start,ar=this.parseParenAndDistinguishExpression(B);return _&&(_.parenthesizedAssign<0&&!this.isSimpleAssignTarget(ar)&&(_.parenthesizedAssign=pt),_.parenthesizedBind<0&&(_.parenthesizedBind=pt)),ar;case Y.bracketL:return M=this.startNode(),this.next(),M.elements=this.parseExprList(Y.bracketR,!0,!0,_),this.finishNode(M,"ArrayExpression");case Y.braceL:return this.parseObj(!1,_);case Y._function:return M=this.startNode(),this.next(),this.parseFunction(M,0);case Y._class:return this.parseClass(this.startNode(),!1);case Y._new:return this.parseNew();case Y.backQuote:return this.parseTemplate();case Y._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Fn.parseExprImport=function(){var _=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var M=this.parseIdent(!0);switch(this.type){case Y.parenL:return this.parseDynamicImport(_);case Y.dot:return _.meta=M,this.parseImportMeta(_);default:this.unexpected()}},Fn.parseDynamicImport=function(_){if(this.next(),_.source=this.parseMaybeAssign(),!this.eat(Y.parenR)){var M=this.start;this.eat(Y.comma)&&this.eat(Y.parenR)?this.raiseRecoverable(M,"Trailing comma is not allowed in import()"):this.unexpected(M)}return this.finishNode(_,"ImportExpression")},Fn.parseImportMeta=function(_){this.next();var M=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="meta"&&this.raiseRecoverable(_.property.start,"The only valid meta property for import is 'import.meta'"),M&&this.raiseRecoverable(_.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(_.start,"Cannot use 'import.meta' outside a module"),this.finishNode(_,"MetaProperty")},Fn.parseLiteral=function(_){var M=this.startNode();return M.value=_,M.raw=this.input.slice(this.start,this.end),M.raw.charCodeAt(M.raw.length-1)===110&&(M.bigint=M.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(M,"Literal")},Fn.parseParenExpression=function(){this.expect(Y.parenL);var _=this.parseExpression();return this.expect(Y.parenR),_},Fn.parseParenAndDistinguishExpression=function(_){var M=this.start,B=this.startLoc,O,$=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var xe=this.start,We=this.startLoc,ft=[],pt=!0,ar=!1,ur=new me,Tn=this.yieldPos,ii=this.awaitPos,Rn;for(this.yieldPos=0,this.awaitPos=0;this.type!==Y.parenR;)if(pt?pt=!1:this.expect(Y.comma),$&&this.afterTrailingComma(Y.parenR,!0)){ar=!0;break}else if(this.type===Y.ellipsis){Rn=this.start,ft.push(this.parseParenItem(this.parseRestBinding())),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ft.push(this.parseMaybeAssign(!1,ur,this.parseParenItem));var Yi=this.start,da=this.startLoc;if(this.expect(Y.parenR),_&&!this.canInsertSemicolon()&&this.eat(Y.arrow))return this.checkPatternErrors(ur,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=Tn,this.awaitPos=ii,this.parseParenArrowList(M,B,ft);(!ft.length||ar)&&this.unexpected(this.lastTokStart),Rn&&this.unexpected(Rn),this.checkExpressionErrors(ur,!0),this.yieldPos=Tn||this.yieldPos,this.awaitPos=ii||this.awaitPos,ft.length>1?(O=this.startNodeAt(xe,We),O.expressions=ft,this.finishNodeAt(O,"SequenceExpression",Yi,da)):O=ft[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Ca=this.startNodeAt(M,B);return Ca.expression=O,this.finishNode(Ca,"ParenthesizedExpression")}else return O},Fn.parseParenItem=function(_){return _},Fn.parseParenArrowList=function(_,M,B){return this.parseArrowExpression(this.startNodeAt(_,M),B)};var di=[];Fn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var _=this.startNode(),M=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(Y.dot)){_.meta=M;var B=this.containsEsc;return _.property=this.parseIdent(!0),_.property.name!=="target"&&this.raiseRecoverable(_.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(_.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(_.start,"'new.target' can only be used in functions"),this.finishNode(_,"MetaProperty")}var O=this.start,$=this.startLoc,xe=this.type===Y._import;return _.callee=this.parseSubscripts(this.parseExprAtom(),O,$,!0),xe&&_.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(Y.parenL)?_.arguments=this.parseExprList(Y.parenR,this.options.ecmaVersion>=8,!1):_.arguments=di,this.finishNode(_,"NewExpression")},Fn.parseTemplateElement=function(_){var M=_.isTagged,B=this.startNode();return this.type===Y.invalidTemplate?(M||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===Y.backQuote,this.finishNode(B,"TemplateElement")},Fn.parseTemplate=function(_){_===void 0&&(_={});var M=_.isTagged;M===void 0&&(M=!1);var B=this.startNode();this.next(),B.expressions=[];var O=this.parseTemplateElement({isTagged:M});for(B.quasis=[O];!O.tail;)this.type===Y.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(Y.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(Y.braceR),B.quasis.push(O=this.parseTemplateElement({isTagged:M}));return this.next(),this.finishNode(B,"TemplateLiteral")},Fn.isAsyncProp=function(_){return!_.computed&&_.key.type==="Identifier"&&_.key.name==="async"&&(this.type===Y.name||this.type===Y.num||this.type===Y.string||this.type===Y.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===Y.star)&&!qt.test(this.input.slice(this.lastTokEnd,this.start))},Fn.parseObj=function(_,M){var B=this.startNode(),O=!0,$={};for(B.properties=[],this.next();!this.eat(Y.braceR);){if(O)O=!1;else if(this.expect(Y.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(Y.braceR))break;var xe=this.parseProperty(_,M);_||this.checkPropClash(xe,$,M),B.properties.push(xe)}return this.finishNode(B,_?"ObjectPattern":"ObjectExpression")},Fn.parseProperty=function(_,M){var B=this.startNode(),O,$,xe,We;if(this.options.ecmaVersion>=9&&this.eat(Y.ellipsis))return _?(B.argument=this.parseIdent(!1),this.type===Y.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===Y.parenL&&M&&(M.parenthesizedAssign<0&&(M.parenthesizedAssign=this.start),M.parenthesizedBind<0&&(M.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,M),this.type===Y.comma&&M&&M.trailingComma<0&&(M.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(_||M)&&(xe=this.start,We=this.startLoc),_||(O=this.eat(Y.star)));var ft=this.containsEsc;return this.parsePropertyName(B),!_&&!ft&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(B)?($=!0,O=this.options.ecmaVersion>=9&&this.eat(Y.star),this.parsePropertyName(B,M)):$=!1,this.parsePropertyValue(B,_,O,$,xe,We,M,ft),this.finishNode(B,"Property")},Fn.parsePropertyValue=function(_,M,B,O,$,xe,We,ft){if((B||O)&&this.type===Y.colon&&this.unexpected(),this.eat(Y.colon))_.value=M?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,We),_.kind="init";else if(this.options.ecmaVersion>=6&&this.type===Y.parenL)M&&this.unexpected(),_.kind="init",_.method=!0,_.value=this.parseMethod(B,O);else if(!M&&!ft&&this.options.ecmaVersion>=5&&!_.computed&&_.key.type==="Identifier"&&(_.key.name==="get"||_.key.name==="set")&&this.type!==Y.comma&&this.type!==Y.braceR&&this.type!==Y.eq){(B||O)&&this.unexpected(),_.kind=_.key.name,this.parsePropertyName(_),_.value=this.parseMethod(!1);var pt=_.kind==="get"?0:1;if(_.value.params.length!==pt){var ar=_.value.start;_.kind==="get"?this.raiseRecoverable(ar,"getter should have no params"):this.raiseRecoverable(ar,"setter should have exactly one param")}else _.kind==="set"&&_.value.params[0].type==="RestElement"&&this.raiseRecoverable(_.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!_.computed&&_.key.type==="Identifier"?((B||O)&&this.unexpected(),this.checkUnreserved(_.key),_.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=$),_.kind="init",M?_.value=this.parseMaybeDefault($,xe,_.key):this.type===Y.eq&&We?(We.shorthandAssign<0&&(We.shorthandAssign=this.start),_.value=this.parseMaybeDefault($,xe,_.key)):_.value=_.key,_.shorthand=!0):this.unexpected()},Fn.parsePropertyName=function(_){if(this.options.ecmaVersion>=6){if(this.eat(Y.bracketL))return _.computed=!0,_.key=this.parseMaybeAssign(),this.expect(Y.bracketR),_.key;_.computed=!1}return _.key=this.type===Y.num||this.type===Y.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Fn.initFunction=function(_){_.id=null,this.options.ecmaVersion>=6&&(_.generator=_.expression=!1),this.options.ecmaVersion>=8&&(_.async=!1)},Fn.parseMethod=function(_,M,B){var O=this.startNode(),$=this.yieldPos,xe=this.awaitPos,We=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=_),this.options.ecmaVersion>=8&&(O.async=!!M),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Gi(M,O.generator)|hi|(B?ua:0)),this.expect(Y.parenL),O.params=this.parseBindingList(Y.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=$,this.awaitPos=xe,this.awaitIdentPos=We,this.finishNode(O,"FunctionExpression")},Fn.parseArrowExpression=function(_,M,B){var O=this.yieldPos,$=this.awaitPos,xe=this.awaitIdentPos;return this.enterScope(Gi(B,!1)|pi),this.initFunction(_),this.options.ecmaVersion>=8&&(_.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,_.params=this.toAssignableList(M,!0),this.parseFunctionBody(_,!0,!1),this.yieldPos=O,this.awaitPos=$,this.awaitIdentPos=xe,this.finishNode(_,"ArrowFunctionExpression")},Fn.parseFunctionBody=function(_,M,B){var O=M&&this.type!==Y.braceL,$=this.strict,xe=!1;if(O)_.body=this.parseMaybeAssign(),_.expression=!0,this.checkParams(_,!1);else{var We=this.options.ecmaVersion>=7&&!this.isSimpleParamList(_.params);(!$||We)&&(xe=this.strictDirective(this.end),xe&&We&&this.raiseRecoverable(_.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ft=this.labels;this.labels=[],xe&&(this.strict=!0),this.checkParams(_,!$&&!xe&&!M&&!B&&this.isSimpleParamList(_.params)),this.strict&&_.id&&this.checkLVal(_.id,Xn),_.body=this.parseBlock(!1,void 0,xe&&!$),_.expression=!1,this.adaptDirectivePrologue(_.body.body),this.labels=ft}this.exitScope()},Fn.isSimpleParamList=function(_){for(var M=0,B=_;M<B.length;M+=1){var O=B[M];if(O.type!=="Identifier")return!1}return!0},Fn.checkParams=function(_,M){for(var B={},O=0,$=_.params;O<$.length;O+=1){var xe=$[O];this.checkLVal(xe,$i,M?null:B)}},Fn.parseExprList=function(_,M,B,O){for(var $=[],xe=!0;!this.eat(_);){if(xe)xe=!1;else if(this.expect(Y.comma),M&&this.afterTrailingComma(_))break;var We=void 0;B&&this.type===Y.comma?We=null:this.type===Y.ellipsis?(We=this.parseSpread(O),O&&this.type===Y.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):We=this.parseMaybeAssign(!1,O),$.push(We)}return $},Fn.checkUnreserved=function(_){var M=_.start,B=_.end,O=_.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(M,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(M,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(M,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(M,B).indexOf("\\")!==-1)){var $=this.strict?this.reservedWordsStrict:this.reservedWords;$.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(M,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(M,"The keyword '"+O+"' is reserved"))}},Fn.parseIdent=function(_,M){var B=this.startNode();return this.type===Y.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!_),this.finishNode(B,"Identifier"),_||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},Fn.parseYield=function(_){this.yieldPos||(this.yieldPos=this.start);var M=this.startNode();return this.next(),this.type===Y.semi||this.canInsertSemicolon()||this.type!==Y.star&&!this.type.startsExpr?(M.delegate=!1,M.argument=null):(M.delegate=this.eat(Y.star),M.argument=this.parseMaybeAssign(_)),this.finishNode(M,"YieldExpression")},Fn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var _=this.startNode();return this.next(),_.argument=this.parseMaybeUnary(null,!1),this.finishNode(_,"AwaitExpression")};var Kn=Si.prototype;Kn.raise=function(_,M){var B=mt(this.input,_);M+=" ("+B.line+":"+B.column+")";var O=new SyntaxError(M);throw O.pos=_,O.loc=B,O.raisedAt=this.pos,O},Kn.raiseRecoverable=Kn.raise,Kn.curPosition=function(){if(this.options.locations)return new De(this.curLine,this.pos-this.lineStart)};var an=Si.prototype,Fi=function(M){this.flags=M,this.var=[],this.lexical=[],this.functions=[]};an.enterScope=function(_){this.scopeStack.push(new Fi(_))},an.exitScope=function(){this.scopeStack.pop()},an.treatFunctionsAsVarInScope=function(_){return _.flags&hn||!this.inModule&&_.flags&qn},an.declareName=function(_,M,B){var O=!1;if(M===la){var $=this.currentScope();O=$.lexical.indexOf(_)>-1||$.functions.indexOf(_)>-1||$.var.indexOf(_)>-1,$.lexical.push(_),this.inModule&&$.flags&qn&&delete this.undefinedExports[_]}else if(M===ma){var xe=this.currentScope();xe.lexical.push(_)}else if(M===Mi){var We=this.currentScope();this.treatFunctionsAsVar?O=We.lexical.indexOf(_)>-1:O=We.lexical.indexOf(_)>-1||We.var.indexOf(_)>-1,We.functions.push(_)}else for(var ft=this.scopeStack.length-1;ft>=0;--ft){var pt=this.scopeStack[ft];if(pt.lexical.indexOf(_)>-1&&!(pt.flags&Wn&&pt.lexical[0]===_)||!this.treatFunctionsAsVarInScope(pt)&&pt.functions.indexOf(_)>-1){O=!0;break}if(pt.var.push(_),this.inModule&&pt.flags&qn&&delete this.undefinedExports[_],pt.flags&fi)break}O&&this.raiseRecoverable(B,"Identifier '"+_+"' has already been declared")},an.checkLocalExport=function(_){this.scopeStack[0].lexical.indexOf(_.name)===-1&&this.scopeStack[0].var.indexOf(_.name)===-1&&(this.undefinedExports[_.name]=_)},an.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},an.currentVarScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&fi)return M}},an.currentThisScope=function(){for(var _=this.scopeStack.length-1;;_--){var M=this.scopeStack[_];if(M.flags&fi&&!(M.flags&pi))return M}};var Li=function(M,B,O){this.type="",this.start=B,this.end=0,M.options.locations&&(this.loc=new At(M,O)),M.options.directSourceFile&&(this.sourceFile=M.options.directSourceFile),M.options.ranges&&(this.range=[B,0])},ao=Si.prototype;ao.startNode=function(){return new Li(this,this.start,this.startLoc)},ao.startNodeAt=function(_,M){return new Li(this,_,M)};function vs(_,M,B,O){return _.type=M,_.end=B,this.options.locations&&(_.loc.end=O),this.options.ranges&&(_.range[1]=B),_}ao.finishNode=function(_,M){return vs.call(this,_,M,this.lastTokEnd,this.lastTokEndLoc)},ao.finishNodeAt=function(_,M,B,O){return vs.call(this,_,M,B,O)};var Zo=function(M,B,O,$,xe){this.token=M,this.isExpr=!!B,this.preserveSpace=!!O,this.override=$,this.generator=!!xe},za={b_stat:new Zo("{",!1),b_expr:new Zo("{",!0),b_tmpl:new Zo("${",!1),p_stat:new Zo("(",!1),p_expr:new Zo("(",!0),q_tmpl:new Zo("`",!0,!0,function(_){return _.tryReadTemplateToken()}),f_stat:new Zo("function",!1),f_expr:new Zo("function",!0),f_expr_gen:new Zo("function",!0,!1,null,!0),f_gen:new Zo("function",!1,!1,null,!0)},ba=Si.prototype;ba.initialContext=function(){return[za.b_stat]},ba.braceIsBlock=function(_){var M=this.curContext();return M===za.f_expr||M===za.f_stat?!0:_===Y.colon&&(M===za.b_stat||M===za.b_expr)?!M.isExpr:_===Y._return||_===Y.name&&this.exprAllowed?qt.test(this.input.slice(this.lastTokEnd,this.start)):_===Y._else||_===Y.semi||_===Y.eof||_===Y.parenR||_===Y.arrow?!0:_===Y.braceL?M===za.b_stat:_===Y._var||_===Y._const||_===Y.name?!1:!this.exprAllowed},ba.inGeneratorContext=function(){for(var _=this.context.length-1;_>=1;_--){var M=this.context[_];if(M.token==="function")return M.generator}return!1},ba.updateContext=function(_){var M,B=this.type;B.keyword&&_===Y.dot?this.exprAllowed=!1:(M=B.updateContext)?M.call(this,_):this.exprAllowed=B.beforeExpr},Y.parenR.updateContext=Y.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var _=this.context.pop();_===za.b_stat&&this.curContext().token==="function"&&(_=this.context.pop()),this.exprAllowed=!_.isExpr},Y.braceL.updateContext=function(_){this.context.push(this.braceIsBlock(_)?za.b_stat:za.b_expr),this.exprAllowed=!0},Y.dollarBraceL.updateContext=function(){this.context.push(za.b_tmpl),this.exprAllowed=!0},Y.parenL.updateContext=function(_){var M=_===Y._if||_===Y._for||_===Y._with||_===Y._while;this.context.push(M?za.p_stat:za.p_expr),this.exprAllowed=!0},Y.incDec.updateContext=function(){},Y._function.updateContext=Y._class.updateContext=function(_){_.beforeExpr&&_!==Y.semi&&_!==Y._else&&!(_===Y._return&&qt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((_===Y.colon||_===Y.braceL)&&this.curContext()===za.b_stat)?this.context.push(za.f_expr):this.context.push(za.f_stat),this.exprAllowed=!1},Y.backQuote.updateContext=function(){this.curContext()===za.q_tmpl?this.context.pop():this.context.push(za.q_tmpl),this.exprAllowed=!1},Y.star.updateContext=function(_){if(_===Y._function){var M=this.context.length-1;this.context[M]===za.f_expr?this.context[M]=za.f_expr_gen:this.context[M]=za.f_gen}this.exprAllowed=!0},Y.name.updateContext=function(_){var M=!1;this.options.ecmaVersion>=6&&_!==Y.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(M=!0),this.exprAllowed=M};var H="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",J=H+" Extended_Pictographic",ae=J,ye={9:H,10:J,11:ae},Pe="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",He="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",tt=He+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",fe=tt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",ke={9:He,10:tt,11:fe},ht={};function pr(_){var M=ht[_]={binary:Ae(ye[_]+" "+Pe),nonBinary:{General_Category:Ae(Pe),Script:Ae(ke[_])}};M.nonBinary.Script_Extensions=M.nonBinary.Script,M.nonBinary.gc=M.nonBinary.General_Category,M.nonBinary.sc=M.nonBinary.Script,M.nonBinary.scx=M.nonBinary.Script_Extensions}pr(9),pr(10),pr(11);var kt=Si.prototype,Nt=function(M){this.parser=M,this.validFlags="gim"+(M.options.ecmaVersion>=6?"uy":"")+(M.options.ecmaVersion>=9?"s":""),this.unicodeProperties=ht[M.options.ecmaVersion>=11?11:M.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Nt.prototype.reset=function(M,B,O){var $=O.indexOf("u")!==-1;this.start=M|0,this.source=B+"",this.flags=O,this.switchU=$&&this.parser.options.ecmaVersion>=6,this.switchN=$&&this.parser.options.ecmaVersion>=9},Nt.prototype.raise=function(M){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+M)},Nt.prototype.at=function(M,B){B===void 0&&(B=!1);var O=this.source,$=O.length;if(M>=$)return-1;var xe=O.charCodeAt(M);if(!(B||this.switchU)||xe<=55295||xe>=57344||M+1>=$)return xe;var We=O.charCodeAt(M+1);return We>=56320&&We<=57343?(xe<<10)+We-56613888:xe},Nt.prototype.nextIndex=function(M,B){B===void 0&&(B=!1);var O=this.source,$=O.length;if(M>=$)return $;var xe=O.charCodeAt(M),We;return!(B||this.switchU)||xe<=55295||xe>=57344||M+1>=$||(We=O.charCodeAt(M+1))<56320||We>57343?M+1:M+2},Nt.prototype.current=function(M){return M===void 0&&(M=!1),this.at(this.pos,M)},Nt.prototype.lookahead=function(M){return M===void 0&&(M=!1),this.at(this.nextIndex(this.pos,M),M)},Nt.prototype.advance=function(M){M===void 0&&(M=!1),this.pos=this.nextIndex(this.pos,M)},Nt.prototype.eat=function(M,B){return B===void 0&&(B=!1),this.current(B)===M?(this.advance(B),!0):!1};function hr(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}kt.validateRegExpFlags=function(_){for(var M=_.validFlags,B=_.flags,O=0;O<B.length;O++){var $=B.charAt(O);M.indexOf($)===-1&&this.raise(_.start,"Invalid regular expression flag"),B.indexOf($,O+1)>-1&&this.raise(_.start,"Duplicate regular expression flag")}},kt.validateRegExpPattern=function(_){this.regexp_pattern(_),!_.switchN&&this.options.ecmaVersion>=9&&_.groupNames.length>0&&(_.switchN=!0,this.regexp_pattern(_))},kt.regexp_pattern=function(_){_.pos=0,_.lastIntValue=0,_.lastStringValue="",_.lastAssertionIsQuantifiable=!1,_.numCapturingParens=0,_.maxBackReference=0,_.groupNames.length=0,_.backReferenceNames.length=0,this.regexp_disjunction(_),_.pos!==_.source.length&&(_.eat(41)&&_.raise("Unmatched ')'"),(_.eat(93)||_.eat(125))&&_.raise("Lone quantifier brackets")),_.maxBackReference>_.numCapturingParens&&_.raise("Invalid escape");for(var M=0,B=_.backReferenceNames;M<B.length;M+=1){var O=B[M];_.groupNames.indexOf(O)===-1&&_.raise("Invalid named capture referenced")}},kt.regexp_disjunction=function(_){for(this.regexp_alternative(_);_.eat(124);)this.regexp_alternative(_);this.regexp_eatQuantifier(_,!0)&&_.raise("Nothing to repeat"),_.eat(123)&&_.raise("Lone quantifier brackets")},kt.regexp_alternative=function(_){for(;_.pos<_.source.length&&this.regexp_eatTerm(_););},kt.regexp_eatTerm=function(_){return this.regexp_eatAssertion(_)?(_.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(_)&&_.switchU&&_.raise("Invalid quantifier"),!0):(_.switchU?this.regexp_eatAtom(_):this.regexp_eatExtendedAtom(_))?(this.regexp_eatQuantifier(_),!0):!1},kt.regexp_eatAssertion=function(_){var M=_.pos;if(_.lastAssertionIsQuantifiable=!1,_.eat(94)||_.eat(36))return!0;if(_.eat(92)){if(_.eat(66)||_.eat(98))return!0;_.pos=M}if(_.eat(40)&&_.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=_.eat(60)),_.eat(61)||_.eat(33))return this.regexp_disjunction(_),_.eat(41)||_.raise("Unterminated group"),_.lastAssertionIsQuantifiable=!B,!0}return _.pos=M,!1},kt.regexp_eatQuantifier=function(_,M){return M===void 0&&(M=!1),this.regexp_eatQuantifierPrefix(_,M)?(_.eat(63),!0):!1},kt.regexp_eatQuantifierPrefix=function(_,M){return _.eat(42)||_.eat(43)||_.eat(63)||this.regexp_eatBracedQuantifier(_,M)},kt.regexp_eatBracedQuantifier=function(_,M){var B=_.pos;if(_.eat(123)){var O=0,$=-1;if(this.regexp_eatDecimalDigits(_)&&(O=_.lastIntValue,_.eat(44)&&this.regexp_eatDecimalDigits(_)&&($=_.lastIntValue),_.eat(125)))return $!==-1&&$<O&&!M&&_.raise("numbers out of order in {} quantifier"),!0;_.switchU&&!M&&_.raise("Incomplete quantifier"),_.pos=B}return!1},kt.regexp_eatAtom=function(_){return this.regexp_eatPatternCharacters(_)||_.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)},kt.regexp_eatReverseSolidusAtomEscape=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatAtomEscape(_))return!0;_.pos=M}return!1},kt.regexp_eatUncapturingGroup=function(_){var M=_.pos;if(_.eat(40)){if(_.eat(63)&&_.eat(58)){if(this.regexp_disjunction(_),_.eat(41))return!0;_.raise("Unterminated group")}_.pos=M}return!1},kt.regexp_eatCapturingGroup=function(_){if(_.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(_):_.current()===63&&_.raise("Invalid group"),this.regexp_disjunction(_),_.eat(41))return _.numCapturingParens+=1,!0;_.raise("Unterminated group")}return!1},kt.regexp_eatExtendedAtom=function(_){return _.eat(46)||this.regexp_eatReverseSolidusAtomEscape(_)||this.regexp_eatCharacterClass(_)||this.regexp_eatUncapturingGroup(_)||this.regexp_eatCapturingGroup(_)||this.regexp_eatInvalidBracedQuantifier(_)||this.regexp_eatExtendedPatternCharacter(_)},kt.regexp_eatInvalidBracedQuantifier=function(_){return this.regexp_eatBracedQuantifier(_,!0)&&_.raise("Nothing to repeat"),!1},kt.regexp_eatSyntaxCharacter=function(_){var M=_.current();return _n(M)?(_.lastIntValue=M,_.advance(),!0):!1};function _n(_){return _===36||_>=40&&_<=43||_===46||_===63||_>=91&&_<=94||_>=123&&_<=125}kt.regexp_eatPatternCharacters=function(_){for(var M=_.pos,B=0;(B=_.current())!==-1&&!_n(B);)_.advance();return _.pos!==M},kt.regexp_eatExtendedPatternCharacter=function(_){var M=_.current();return M!==-1&&M!==36&&!(M>=40&&M<=43)&&M!==46&&M!==63&&M!==91&&M!==94&&M!==124?(_.advance(),!0):!1},kt.regexp_groupSpecifier=function(_){if(_.eat(63)){if(this.regexp_eatGroupName(_)){_.groupNames.indexOf(_.lastStringValue)!==-1&&_.raise("Duplicate capture group name"),_.groupNames.push(_.lastStringValue);return}_.raise("Invalid group")}},kt.regexp_eatGroupName=function(_){if(_.lastStringValue="",_.eat(60)){if(this.regexp_eatRegExpIdentifierName(_)&&_.eat(62))return!0;_.raise("Invalid capture group name")}return!1},kt.regexp_eatRegExpIdentifierName=function(_){if(_.lastStringValue="",this.regexp_eatRegExpIdentifierStart(_)){for(_.lastStringValue+=hr(_.lastIntValue);this.regexp_eatRegExpIdentifierPart(_);)_.lastStringValue+=hr(_.lastIntValue);return!0}return!1},kt.regexp_eatRegExpIdentifierStart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,O=_.current(B);return _.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(O=_.lastIntValue),fn(O)?(_.lastIntValue=O,!0):(_.pos=M,!1)};function fn(_){return gt(_,!0)||_===36||_===95}kt.regexp_eatRegExpIdentifierPart=function(_){var M=_.pos,B=this.options.ecmaVersion>=11,O=_.current(B);return _.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(_,B)&&(O=_.lastIntValue),Pt(O)?(_.lastIntValue=O,!0):(_.pos=M,!1)};function Pt(_){return tr(_,!0)||_===36||_===95||_===8204||_===8205}kt.regexp_eatAtomEscape=function(_){return this.regexp_eatBackReference(_)||this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)||_.switchN&&this.regexp_eatKGroupName(_)?!0:(_.switchU&&(_.current()===99&&_.raise("Invalid unicode escape"),_.raise("Invalid escape")),!1)},kt.regexp_eatBackReference=function(_){var M=_.pos;if(this.regexp_eatDecimalEscape(_)){var B=_.lastIntValue;if(_.switchU)return B>_.maxBackReference&&(_.maxBackReference=B),!0;if(B<=_.numCapturingParens)return!0;_.pos=M}return!1},kt.regexp_eatKGroupName=function(_){if(_.eat(107)){if(this.regexp_eatGroupName(_))return _.backReferenceNames.push(_.lastStringValue),!0;_.raise("Invalid named reference")}return!1},kt.regexp_eatCharacterEscape=function(_){return this.regexp_eatControlEscape(_)||this.regexp_eatCControlLetter(_)||this.regexp_eatZero(_)||this.regexp_eatHexEscapeSequence(_)||this.regexp_eatRegExpUnicodeEscapeSequence(_,!1)||!_.switchU&&this.regexp_eatLegacyOctalEscapeSequence(_)||this.regexp_eatIdentityEscape(_)},kt.regexp_eatCControlLetter=function(_){var M=_.pos;if(_.eat(99)){if(this.regexp_eatControlLetter(_))return!0;_.pos=M}return!1},kt.regexp_eatZero=function(_){return _.current()===48&&!yn(_.lookahead())?(_.lastIntValue=0,_.advance(),!0):!1},kt.regexp_eatControlEscape=function(_){var M=_.current();return M===116?(_.lastIntValue=9,_.advance(),!0):M===110?(_.lastIntValue=10,_.advance(),!0):M===118?(_.lastIntValue=11,_.advance(),!0):M===102?(_.lastIntValue=12,_.advance(),!0):M===114?(_.lastIntValue=13,_.advance(),!0):!1},kt.regexp_eatControlLetter=function(_){var M=_.current();return Jr(M)?(_.lastIntValue=M%32,_.advance(),!0):!1};function Jr(_){return _>=65&&_<=90||_>=97&&_<=122}kt.regexp_eatRegExpUnicodeEscapeSequence=function(_,M){M===void 0&&(M=!1);var B=_.pos,O=M||_.switchU;if(_.eat(117)){if(this.regexp_eatFixedHexDigits(_,4)){var $=_.lastIntValue;if(O&&$>=55296&&$<=56319){var xe=_.pos;if(_.eat(92)&&_.eat(117)&&this.regexp_eatFixedHexDigits(_,4)){var We=_.lastIntValue;if(We>=56320&&We<=57343)return _.lastIntValue=($-55296)*1024+(We-56320)+65536,!0}_.pos=xe,_.lastIntValue=$}return!0}if(O&&_.eat(123)&&this.regexp_eatHexDigits(_)&&_.eat(125)&&Br(_.lastIntValue))return!0;O&&_.raise("Invalid unicode escape"),_.pos=B}return!1};function Br(_){return _>=0&&_<=1114111}kt.regexp_eatIdentityEscape=function(_){if(_.switchU)return this.regexp_eatSyntaxCharacter(_)?!0:_.eat(47)?(_.lastIntValue=47,!0):!1;var M=_.current();return M!==99&&(!_.switchN||M!==107)?(_.lastIntValue=M,_.advance(),!0):!1},kt.regexp_eatDecimalEscape=function(_){_.lastIntValue=0;var M=_.current();if(M>=49&&M<=57){do _.lastIntValue=10*_.lastIntValue+(M-48),_.advance();while((M=_.current())>=48&&M<=57);return!0}return!1},kt.regexp_eatCharacterClassEscape=function(_){var M=_.current();if(Hr(M))return _.lastIntValue=-1,_.advance(),!0;if(_.switchU&&this.options.ecmaVersion>=9&&(M===80||M===112)){if(_.lastIntValue=-1,_.advance(),_.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(_)&&_.eat(125))return!0;_.raise("Invalid property name")}return!1};function Hr(_){return _===100||_===68||_===115||_===83||_===119||_===87}kt.regexp_eatUnicodePropertyValueExpression=function(_){var M=_.pos;if(this.regexp_eatUnicodePropertyName(_)&&_.eat(61)){var B=_.lastStringValue;if(this.regexp_eatUnicodePropertyValue(_)){var O=_.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(_,B,O),!0}}if(_.pos=M,this.regexp_eatLoneUnicodePropertyNameOrValue(_)){var $=_.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(_,$),!0}return!1},kt.regexp_validateUnicodePropertyNameAndValue=function(_,M,B){Kr(_.unicodeProperties.nonBinary,M)||_.raise("Invalid property name"),_.unicodeProperties.nonBinary[M].test(B)||_.raise("Invalid property value")},kt.regexp_validateUnicodePropertyNameOrValue=function(_,M){_.unicodeProperties.binary.test(M)||_.raise("Invalid property name")},kt.regexp_eatUnicodePropertyName=function(_){var M=0;for(_.lastStringValue="";gi(M=_.current());)_.lastStringValue+=hr(M),_.advance();return _.lastStringValue!==""};function gi(_){return Jr(_)||_===95}kt.regexp_eatUnicodePropertyValue=function(_){var M=0;for(_.lastStringValue="";en(M=_.current());)_.lastStringValue+=hr(M),_.advance();return _.lastStringValue!==""};function en(_){return gi(_)||yn(_)}kt.regexp_eatLoneUnicodePropertyNameOrValue=function(_){return this.regexp_eatUnicodePropertyValue(_)},kt.regexp_eatCharacterClass=function(_){if(_.eat(91)){if(_.eat(94),this.regexp_classRanges(_),_.eat(93))return!0;_.raise("Unterminated character class")}return!1},kt.regexp_classRanges=function(_){for(;this.regexp_eatClassAtom(_);){var M=_.lastIntValue;if(_.eat(45)&&this.regexp_eatClassAtom(_)){var B=_.lastIntValue;_.switchU&&(M===-1||B===-1)&&_.raise("Invalid character class"),M!==-1&&B!==-1&&M>B&&_.raise("Range out of order in character class")}}},kt.regexp_eatClassAtom=function(_){var M=_.pos;if(_.eat(92)){if(this.regexp_eatClassEscape(_))return!0;if(_.switchU){var B=_.current();(B===99||Pi(B))&&_.raise("Invalid class escape"),_.raise("Invalid escape")}_.pos=M}var O=_.current();return O!==93?(_.lastIntValue=O,_.advance(),!0):!1},kt.regexp_eatClassEscape=function(_){var M=_.pos;if(_.eat(98))return _.lastIntValue=8,!0;if(_.switchU&&_.eat(45))return _.lastIntValue=45,!0;if(!_.switchU&&_.eat(99)){if(this.regexp_eatClassControlLetter(_))return!0;_.pos=M}return this.regexp_eatCharacterClassEscape(_)||this.regexp_eatCharacterEscape(_)},kt.regexp_eatClassControlLetter=function(_){var M=_.current();return yn(M)||M===95?(_.lastIntValue=M%32,_.advance(),!0):!1},kt.regexp_eatHexEscapeSequence=function(_){var M=_.pos;if(_.eat(120)){if(this.regexp_eatFixedHexDigits(_,2))return!0;_.switchU&&_.raise("Invalid escape"),_.pos=M}return!1},kt.regexp_eatDecimalDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;yn(B=_.current());)_.lastIntValue=10*_.lastIntValue+(B-48),_.advance();return _.pos!==M};function yn(_){return _>=48&&_<=57}kt.regexp_eatHexDigits=function(_){var M=_.pos,B=0;for(_.lastIntValue=0;Xi(B=_.current());)_.lastIntValue=16*_.lastIntValue+vi(B),_.advance();return _.pos!==M};function Xi(_){return _>=48&&_<=57||_>=65&&_<=70||_>=97&&_<=102}function vi(_){return _>=65&&_<=70?10+(_-65):_>=97&&_<=102?10+(_-97):_-48}kt.regexp_eatLegacyOctalEscapeSequence=function(_){if(this.regexp_eatOctalDigit(_)){var M=_.lastIntValue;if(this.regexp_eatOctalDigit(_)){var B=_.lastIntValue;M<=3&&this.regexp_eatOctalDigit(_)?_.lastIntValue=M*64+B*8+_.lastIntValue:_.lastIntValue=M*8+B}else _.lastIntValue=M;return!0}return!1},kt.regexp_eatOctalDigit=function(_){var M=_.current();return Pi(M)?(_.lastIntValue=M-48,_.advance(),!0):(_.lastIntValue=0,!1)};function Pi(_){return _>=48&&_<=55}kt.regexp_eatFixedHexDigits=function(_,M){var B=_.pos;_.lastIntValue=0;for(var O=0;O<M;++O){var $=_.current();if(!Xi($))return _.pos=B,!1;_.lastIntValue=16*_.lastIntValue+vi($),_.advance()}return!0};var xi=function(M){this.type=M.type,this.value=M.value,this.start=M.start,this.end=M.end,M.options.locations&&(this.loc=new At(M,M.startLoc,M.endLoc)),M.options.ranges&&(this.range=[M.start,M.end])},dt=Si.prototype;dt.next=function(_){!_&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new xi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},dt.getToken=function(){return this.next(),new xi(this)},typeof Symbol!="undefined"&&(dt[Symbol.iterator]=function(){var _=this;return{next:function(){var M=_.getToken();return{done:M.type===Y.eof,value:M}}}}),dt.curContext=function(){return this.context[this.context.length-1]},dt.nextToken=function(){var _=this.curContext();if((!_||!_.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(Y.eof);if(_.override)return _.override(this);this.readToken(this.fullCharCodeAtPos())},dt.readToken=function(_){return gt(_,this.options.ecmaVersion>=6)||_===92?this.readWord():this.getTokenFromCode(_)},dt.fullCharCodeAtPos=function(){var _=this.input.charCodeAt(this.pos);if(_<=55295||_>=57344)return _;var M=this.input.charCodeAt(this.pos+1);return(_<<10)+M-56613888},dt.skipBlockComment=function(){var _=this.options.onComment&&this.curPosition(),M=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){ut.lastIndex=M;for(var O;(O=ut.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(M+2,B),M,this.pos,_,this.curPosition())},dt.skipLineComment=function(_){for(var M=this.pos,B=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=_);this.pos<this.input.length&&!Qe(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(M+_,this.pos),M,this.pos,B,this.curPosition())},dt.skipSpace=function(){e:for(;this.pos<this.input.length;){var _=this.input.charCodeAt(this.pos);switch(_){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(_>8&&_<14||_>=5760&&Ct.test(String.fromCharCode(_)))++this.pos;else break e}}},dt.finishToken=function(_,M){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=_,this.value=M,this.updateContext(B)},dt.readToken_dot=function(){var _=this.input.charCodeAt(this.pos+1);if(_>=48&&_<=57)return this.readNumber(!0);var M=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&_===46&&M===46?(this.pos+=3,this.finishToken(Y.ellipsis)):(++this.pos,this.finishToken(Y.dot))},dt.readToken_slash=function(){var _=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):_===61?this.finishOp(Y.assign,2):this.finishOp(Y.slash,1)},dt.readToken_mult_modulo_exp=function(_){var M=this.input.charCodeAt(this.pos+1),B=1,O=_===42?Y.star:Y.modulo;return this.options.ecmaVersion>=7&&_===42&&M===42&&(++B,O=Y.starstar,M=this.input.charCodeAt(this.pos+2)),M===61?this.finishOp(Y.assign,B+1):this.finishOp(O,B)},dt.readToken_pipe_amp=function(_){var M=this.input.charCodeAt(this.pos+1);if(M===_){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(Y.assign,3)}return this.finishOp(_===124?Y.logicalOR:Y.logicalAND,2)}return M===61?this.finishOp(Y.assign,2):this.finishOp(_===124?Y.bitwiseOR:Y.bitwiseAND,1)},dt.readToken_caret=function(){var _=this.input.charCodeAt(this.pos+1);return _===61?this.finishOp(Y.assign,2):this.finishOp(Y.bitwiseXOR,1)},dt.readToken_plus_min=function(_){var M=this.input.charCodeAt(this.pos+1);return M===_?M===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||qt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(Y.incDec,2):M===61?this.finishOp(Y.assign,2):this.finishOp(Y.plusMin,1)},dt.readToken_lt_gt=function(_){var M=this.input.charCodeAt(this.pos+1),B=1;return M===_?(B=_===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(Y.assign,B+1):this.finishOp(Y.bitShift,B)):M===33&&_===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(M===61&&(B=2),this.finishOp(Y.relational,B))},dt.readToken_eq_excl=function(_){var M=this.input.charCodeAt(this.pos+1);return M===61?this.finishOp(Y.equality,this.input.charCodeAt(this.pos+2)===61?3:2):_===61&&M===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(Y.arrow)):this.finishOp(_===61?Y.eq:Y.prefix,1)},dt.readToken_question=function(){var _=this.options.ecmaVersion;if(_>=11){var M=this.input.charCodeAt(this.pos+1);if(M===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(Y.questionDot,2)}if(M===63){if(_>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(Y.assign,3)}return this.finishOp(Y.coalesce,2)}}return this.finishOp(Y.question,1)},dt.getTokenFromCode=function(_){switch(_){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(Y.parenL);case 41:return++this.pos,this.finishToken(Y.parenR);case 59:return++this.pos,this.finishToken(Y.semi);case 44:return++this.pos,this.finishToken(Y.comma);case 91:return++this.pos,this.finishToken(Y.bracketL);case 93:return++this.pos,this.finishToken(Y.bracketR);case 123:return++this.pos,this.finishToken(Y.braceL);case 125:return++this.pos,this.finishToken(Y.braceR);case 58:return++this.pos,this.finishToken(Y.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(Y.backQuote);case 48:var M=this.input.charCodeAt(this.pos+1);if(M===120||M===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(M===111||M===79)return this.readRadixNumber(8);if(M===98||M===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(_);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(_);case 124:case 38:return this.readToken_pipe_amp(_);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(_);case 60:case 62:return this.readToken_lt_gt(_);case 61:case 33:return this.readToken_eq_excl(_);case 63:return this.readToken_question();case 126:return this.finishOp(Y.prefix,1)}this.raise(this.pos,"Unexpected character '"+Ci(_)+"'")},dt.finishOp=function(_,M){var B=this.input.slice(this.pos,this.pos+M);return this.pos+=M,this.finishToken(_,B)},dt.readRegexp=function(){for(var _,M,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(qt.test(O)&&this.raise(B,"Unterminated regular expression"),_)_=!1;else{if(O==="[")M=!0;else if(O==="]"&&M)M=!1;else if(O==="/"&&!M)break;_=O==="\\"}++this.pos}var $=this.input.slice(B,this.pos);++this.pos;var xe=this.pos,We=this.readWord1();this.containsEsc&&this.unexpected(xe);var ft=this.regexpState||(this.regexpState=new Nt(this));ft.reset(B,$,We),this.validateRegExpFlags(ft),this.validateRegExpPattern(ft);var pt=null;try{pt=new RegExp($,We)}catch(ar){}return this.finishToken(Y.regexp,{pattern:$,flags:We,value:pt})},dt.readInt=function(_,M,B){for(var O=this.options.ecmaVersion>=12&&M===void 0,$=B&&this.input.charCodeAt(this.pos)===48,xe=this.pos,We=0,ft=0,pt=0,ar=M==null?Infinity:M;pt<ar;++pt,++this.pos){var ur=this.input.charCodeAt(this.pos),Tn=void 0;if(O&&ur===95){$&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ft===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),pt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ft=ur;continue}if(ur>=97?Tn=ur-97+10:ur>=65?Tn=ur-65+10:ur>=48&&ur<=57?Tn=ur-48:Tn=Infinity,Tn>=_)break;ft=ur,We=We*_+Tn}return O&&ft===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===xe||M!=null&&this.pos-xe!==M?null:We};function It(_,M){return M?parseInt(_,8):parseFloat(_.replace(/_/g,""))}function Ta(_){return typeof BigInt!="function"?null:BigInt(_.replace(/_/g,""))}dt.readRadixNumber=function(_){var M=this.pos;this.pos+=2;var B=this.readInt(_);return B==null&&this.raise(this.start+2,"Expected number in radix "+_),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=Ta(this.input.slice(M,this.pos)),++this.pos):gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,B)},dt.readNumber=function(_){var M=this.pos;!_&&this.readInt(10,void 0,!0)===null&&this.raise(M,"Invalid number");var B=this.pos-M>=2&&this.input.charCodeAt(M)===48;B&&this.strict&&this.raise(M,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!B&&!_&&this.options.ecmaVersion>=11&&O===110){var $=Ta(this.input.slice(M,this.pos));return++this.pos,gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(Y.num,$)}B&&/[89]/.test(this.input.slice(M,this.pos))&&(B=!1),O===46&&!B&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!B&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(M,"Invalid number")),gt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var xe=It(this.input.slice(M,this.pos),B);return this.finishToken(Y.num,xe)},dt.readCodePoint=function(){var _=this.input.charCodeAt(this.pos),M;if(_===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;M=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,M>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else M=this.readHexChar(4);return M};function Ci(_){return _<=65535?String.fromCharCode(_):(_-=65536,String.fromCharCode((_>>10)+55296,(_&1023)+56320))}dt.readString=function(_){for(var M="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===_)break;O===92?(M+=this.input.slice(B,this.pos),M+=this.readEscapedChar(!1),B=this.pos):(Qe(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return M+=this.input.slice(B,this.pos++),this.finishToken(Y.string,M)};var Ii={};dt.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(_){if(_===Ii)this.readInvalidTemplateToken();else throw _}this.inTemplateElement=!1},dt.invalidStringToken=function(_,M){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ii;this.raise(_,M)},dt.readTmplToken=function(){for(var _="",M=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===Y.template||this.type===Y.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(Y.dollarBraceL)):(++this.pos,this.finishToken(Y.backQuote)):(_+=this.input.slice(M,this.pos),this.finishToken(Y.template,_));if(B===92)_+=this.input.slice(M,this.pos),_+=this.readEscapedChar(!0),M=this.pos;else if(Qe(B)){switch(_+=this.input.slice(M,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:_+=`
`;break;default:_+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),M=this.pos}else++this.pos}},dt.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(Y.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},dt.readEscapedChar=function(_){var M=this.input.charCodeAt(++this.pos);switch(++this.pos,M){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return Ci(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(_){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(M>=48&&M<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],$=parseInt(O,8);return $>255&&(O=O.slice(0,-1),$=parseInt(O,8)),this.pos+=O.length-1,M=this.input.charCodeAt(this.pos),(O!=="0"||M===56||M===57)&&(this.strict||_)&&this.invalidStringToken(this.pos-1-O.length,_?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode($)}return Qe(M)?"":String.fromCharCode(M)}},dt.readHexChar=function(_){var M=this.pos,B=this.readInt(16,_);return B===null&&this.invalidStringToken(M,"Bad character escape sequence"),B},dt.readWord1=function(){this.containsEsc=!1;for(var _="",M=!0,B=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var $=this.fullCharCodeAtPos();if(tr($,O))this.pos+=$<=65535?1:2;else if($===92){this.containsEsc=!0,_+=this.input.slice(B,this.pos);var xe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var We=this.readCodePoint();(M?gt:tr)(We,O)||this.invalidStringToken(xe,"Invalid Unicode escape"),_+=Ci(We),B=this.pos}else break;M=!1}return _+this.input.slice(B,this.pos)},dt.readWord=function(){var _=this.readWord1(),M=Y.name;return this.keywords.test(_)&&(M=nt[_]),this.finishToken(M,_)};var ji="7.4.1";Si.acorn={Parser:Si,version:ji,defaultOptions:Ft,Position:De,SourceLocation:At,getLineInfo:mt,Node:Li,TokenType:yt,tokTypes:Y,keywordTypes:nt,TokContext:Zo,tokContexts:za,isIdentifierChar:tr,isIdentifierStart:gt,Token:xi,isNewLine:Qe,lineBreak:qt,lineBreakG:ut,nonASCIIwhitespace:Ct};function Ir(_,M){return Si.parse(_,M)}function on(_,M,B){return Si.parseExpressionAt(_,M,B)}function _t(_,M){return Si.tokenizer(_,M)}function na(_,M){_.prototype=Object.create(M.prototype),_.prototype.constructor=_,_.__proto__=M}function de(_){var M=typeof Map=="function"?new Map:void 0;return de=function(O){if(O===null||!_u(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof M!="undefined"){if(M.has(O))return M.get(O);M.set(O,$)}function $(){return ra(O,arguments,Ma(this).constructor)}return $.prototype=Object.create(O.prototype,{constructor:{value:$,enumerable:!1,writable:!0,configurable:!0}}),Ua($,O)},de(_)}function Ko(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function ra(_,M,B){return Ko()?ra=Reflect.construct:ra=function($,xe,We){var ft=[null];ft.push.apply(ft,xe);var pt=Function.bind.apply($,ft),ar=new pt;return We&&Ua(ar,We.prototype),ar},ra.apply(null,arguments)}function _u(_){return Function.toString.call(_).indexOf("[native code]")!==-1}function Ua(_,M){return Ua=Object.setPrototypeOf||function(O,$){return O.__proto__=$,O},Ua(_,M)}function Ma(_){return Ma=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},Ma(_)}var Ka=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(de(Error)),ia=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(de(SyntaxError)),Ao=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(de(ReferenceError)),jo=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(de(TypeError)),Cu=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ka),vo=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(ia),Do=function(_){na(M,_);function M(){return _.apply(this,arguments)||this}return M}(Ao),aa={UnknownError:[3001,"%0",Cu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Cu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Do],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Do],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Do],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Do],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Do],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Do],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Do],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Do],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Do],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Do],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ao],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ao],IsNotConstructor:[2003,"%0 is not a constructor",jo]};function $a(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(_){return!1}}function Fo(_,M,B){return $a()?Fo=Reflect.construct:Fo=function($,xe,We){var ft=[null];ft.push.apply(ft,xe);var pt=Function.bind.apply($,ft),ar=new pt;return We&&Qa(ar,We.prototype),ar},Fo.apply(null,arguments)}function Qa(_,M){return Qa=Object.setPrototypeOf||function(O,$){return O.__proto__=$,O},Qa(_,M)}var ws="0.0.3";function wl(_,M){Object.defineProperty(_,"name",{value:M,writable:!1,enumerable:!1,configurable:!0})}var ms=Object.prototype.hasOwnProperty,ne=Symbol("Break"),be=Symbol("Continue"),Ye=Symbol("DefaultCase"),Rt=Symbol("EmptyStatementReturn"),Or=Symbol("WithScopeName"),Pn=Symbol("SuperScopeName"),Oi=Symbol("RootScopeName"),oo=Symbol("GlobalScopeName");function La(_){return typeof _=="function"}var Za=function(){function _(B){this.interpreter=B}var M=_.prototype;return M.generator=function(){var O=this.interpreter;function $(){return this.getCurrentScope()}function xe(){return this.getGlobalScope()}function We(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:$.bind(O),getGlobalScope:xe.bind(O),getCurrentContext:We.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},_}();function Vo(_,M,B){if(B===void 0&&(B=!0),!(_ instanceof Za))throw new Error("Illegal call");if(typeof M!="string")return M;if(!!M){var O=_.generator(),$=O.getOptions(),xe={timeout:$.timeout,_initEnv:function(){B||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},We=B?O.getGlobalScope():O.getCurrentScope(),ft=new xa(We,xe);return ft.evaluate(M)}}Object.defineProperty(Vo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function gs(_){if(!(_ instanceof Za))throw new Error("Illegal call");for(var M=_.generator(),B=arguments.length,O=new Array(B>1?B-1:0),$=1;$<B;$++)O[$-1]=arguments[$];var xe=O.pop(),We=new xa(M.getGlobalScope(),M.getOptions()),ft=`
		    (function anonymous(`+O.join(",")+`){
		        `+xe+`
		    });
		    `;return We.evaluate(ft)}Object.defineProperty(gs,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var lo=function(M){this.value=M},wo=function(M){this.value=M},ys=function(M){this.value=M},Ts=function(M,B,O){B===void 0&&(B=null),this.name=O,this.parent=B,this.data=M,this.labelStack=[]};function Fs(){}function uu(_,M){return _===void 0&&(_=null),new Ts(Object.create(null),_,M)}function _s(_){return Object.create(_)}var ga={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Vo,Function:gs};typeof JSON!="undefined"&&(ga.JSON=JSON),typeof Promise!="undefined"&&(ga.Promise=Promise),typeof Set!="undefined"&&(ga.Set=Set),typeof Map!="undefined"&&(ga.Map=Map),typeof Symbol!="undefined"&&(ga.Symbol=Symbol),typeof Proxy!="undefined"&&(ga.Proxy=Proxy),typeof WeakMap!="undefined"&&(ga.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(ga.WeakSet=WeakSet),typeof Reflect!="undefined"&&(ga.Reflect=Reflect);var xa=function(){function _(B,O){B===void 0&&(B=_.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||_.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?_.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var M=_.prototype;return M.initEnvironment=function(O){var $;if(O instanceof Ts)$=O;else{var xe=null,We=this.createSuperScope(O);this.options.rootContext&&(xe=new Ts(_s(this.options.rootContext),We,Oi)),$=new Ts(O,xe||We,oo)}this.globalScope=$,this.currentScope=this.globalScope,this.globalContext=$.data,this.currentContext=$.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ft=this.options._initEnv;ft&&ft.call(this)},M.getExecStartTime=function(){return this.execStartTime},M.getExecutionTime=function(){return this.execEndTime-this.execStartTime},M.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},M.getOptions=function(){return this.options},M.getGlobalScope=function(){return this.globalScope},M.getCurrentScope=function(){return this.currentScope},M.getCurrentContext=function(){return this.currentContext},M.isInterruptThrow=function(O){return O instanceof Cu||O instanceof Do||O instanceof vo},M.createSuperScope=function(O){var $=Object.assign({},ga),xe=Object.keys($);return xe.forEach(function(We){We in O&&delete $[We]}),new Ts($,null,Pn)},M.setCurrentContext=function(O){this.currentContext=O},M.setCurrentScope=function(O){this.currentScope=O},M.evaluate=function(O){O===void 0&&(O="");var $;if(!!O)return $=Ir(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||_.ecmaVersion}),this.evaluateNode($,O)},M.appendCode=function(O){return this.evaluate(O)},M.evaluateNode=function(O,$){var xe=this;$===void 0&&($=""),this.value=void 0,this.source=$,this.sourceList.push($),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var We=this.getCurrentScope(),ft=this.getCurrentContext(),pt=We.labelStack.concat([]),ar=this.callStack.concat([]),ur=function(){xe.setCurrentScope(We),xe.setCurrentContext(ft),We.labelStack=pt,xe.callStack=ar};try{var Tn=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),Tn()}catch(ii){throw ii}finally{ur(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},M.createErrorMessage=function(O,$,xe){var We=O[1].replace("%0",String($));return xe!==null&&(We+=this.getNodePosition(xe||this.lastExecNode)),We},M.createError=function(O,$){return new $(O)},M.createThrowError=function(O,$){return this.createError(O,$)},M.createInternalThrowError=function(O,$,xe){return this.createError(this.createErrorMessage(O,$,xe),O[2])},M.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,$=Date.now();return $-this.execStartTime>O},M.getNodePosition=function(O){if(O){var $="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+$:""}return""},M.createClosure=function(O){var $=this,xe;switch(O.type){case"BinaryExpression":xe=this.binaryExpressionHandler(O);break;case"LogicalExpression":xe=this.logicalExpressionHandler(O);break;case"UnaryExpression":xe=this.unaryExpressionHandler(O);break;case"UpdateExpression":xe=this.updateExpressionHandler(O);break;case"ObjectExpression":xe=this.objectExpressionHandler(O);break;case"ArrayExpression":xe=this.arrayExpressionHandler(O);break;case"CallExpression":xe=this.callExpressionHandler(O);break;case"NewExpression":xe=this.newExpressionHandler(O);break;case"MemberExpression":xe=this.memberExpressionHandler(O);break;case"ThisExpression":xe=this.thisExpressionHandler(O);break;case"SequenceExpression":xe=this.sequenceExpressionHandler(O);break;case"Literal":xe=this.literalHandler(O);break;case"Identifier":xe=this.identifierHandler(O);break;case"AssignmentExpression":xe=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":xe=this.functionDeclarationHandler(O);break;case"VariableDeclaration":xe=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":xe=this.programHandler(O);break;case"ExpressionStatement":xe=this.expressionStatementHandler(O);break;case"EmptyStatement":xe=this.emptyStatementHandler(O);break;case"ReturnStatement":xe=this.returnStatementHandler(O);break;case"FunctionExpression":xe=this.functionExpressionHandler(O);break;case"IfStatement":xe=this.ifStatementHandler(O);break;case"ConditionalExpression":xe=this.conditionalExpressionHandler(O);break;case"ForStatement":xe=this.forStatementHandler(O);break;case"WhileStatement":xe=this.whileStatementHandler(O);break;case"DoWhileStatement":xe=this.doWhileStatementHandler(O);break;case"ForInStatement":xe=this.forInStatementHandler(O);break;case"WithStatement":xe=this.withStatementHandler(O);break;case"ThrowStatement":xe=this.throwStatementHandler(O);break;case"TryStatement":xe=this.tryStatementHandler(O);break;case"ContinueStatement":xe=this.continueStatementHandler(O);break;case"BreakStatement":xe=this.breakStatementHandler(O);break;case"SwitchStatement":xe=this.switchStatementHandler(O);break;case"LabeledStatement":xe=this.labeledStatementHandler(O);break;case"DebuggerStatement":xe=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(aa.NodeTypeSyntaxError,O.type,O)}return function(){var We=$.options.timeout;if(We&&We>0&&$.checkTimeout())throw $.createInternalThrowError(aa.ExecutionTimeOutError,We,null);return $.lastExecNode=O,xe.apply(void 0,arguments)}},M.binaryExpressionHandler=function(O){var $=this,xe=this.createClosure(O.left),We=this.createClosure(O.right);return function(){var ft=xe(),pt=We();switch(O.operator){case"==":return ft==pt;case"!=":return ft!=pt;case"===":return ft===pt;case"!==":return ft!==pt;case"<":return ft<pt;case"<=":return ft<=pt;case">":return ft>pt;case">=":return ft>=pt;case"<<":return ft<<pt;case">>":return ft>>pt;case">>>":return ft>>>pt;case"+":return ft+pt;case"-":return ft-pt;case"*":return ft*pt;case"**":return Math.pow(ft,pt);case"/":return ft/pt;case"%":return ft%pt;case"|":return ft|pt;case"^":return ft^pt;case"&":return ft&pt;case"in":return ft in pt;case"instanceof":return ft instanceof pt;default:throw $.createInternalThrowError(aa.BinaryOperatorSyntaxError,O.operator,O)}}},M.logicalExpressionHandler=function(O){var $=this,xe=this.createClosure(O.left),We=this.createClosure(O.right);return function(){switch(O.operator){case"||":return xe()||We();case"&&":return xe()&&We();default:throw $.createInternalThrowError(aa.LogicalOperatorSyntaxError,O.operator,O)}}},M.unaryExpressionHandler=function(O){var $=this;switch(O.operator){case"delete":var xe=this.createObjectGetter(O.argument),We=this.createNameGetter(O.argument);return function(){var ur=xe(),Tn=We();return delete ur[Tn]};default:var ft;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var pt=this.createObjectGetter(O.argument),ar=this.createNameGetter(O.argument);ft=function(){return pt()[ar()]}}else ft=this.createClosure(O.argument);return function(){var ur=ft();switch(O.operator){case"-":return-ur;case"+":return+ur;case"!":return!ur;case"~":return~ur;case"void":return;case"typeof":return typeof ur;default:throw $.createInternalThrowError(aa.UnaryOperatorSyntaxError,O.operator,O)}}}},M.updateExpressionHandler=function(O){var $=this,xe=this.createObjectGetter(O.argument),We=this.createNameGetter(O.argument);return function(){var ft=xe(),pt=We();switch($.assertVariable(ft,pt,O),O.operator){case"++":return O.prefix?++ft[pt]:ft[pt]++;case"--":return O.prefix?--ft[pt]:ft[pt]--;default:throw $.createInternalThrowError(aa.UpdateOperatorSyntaxError,O.operator,O)}}},M.objectExpressionHandler=function(O){var $=this,xe=[];function We(pt){return pt.type==="Identifier"?pt.name:pt.type==="Literal"?pt.value:this.throwError(aa.ObjectStructureSyntaxError,pt.type,pt)}var ft=Object.create(null);return O.properties.forEach(function(pt){var ar=pt.kind,ur=We(pt.key);(!ft[ur]||ar==="init")&&(ft[ur]={}),ft[ur][ar]=$.createClosure(pt.value),xe.push({key:ur,property:pt})}),function(){for(var pt={},ar=xe.length,ur=0;ur<ar;ur++){var Tn=xe[ur],ii=Tn.key,Rn=ft[ii],Yi=Rn.init?Rn.init():void 0,da=Rn.get?Rn.get():function(){},Ca=Rn.set?Rn.set():function(Xu){};if("set"in Rn||"get"in Rn){var Hi={configurable:!0,enumerable:!0,get:da,set:Ca};Object.defineProperty(pt,ii,Hi)}else{var xs=Tn.property,lu=xs.kind;xs.key.type==="Identifier"&&xs.value.type==="FunctionExpression"&&lu==="init"&&!xs.value.id&&wl(Yi,xs.key.name),pt[ii]=Yi}}return pt}},M.arrayExpressionHandler=function(O){var $=this,xe=O.elements.map(function(We){return We&&$.createClosure(We)});return function(){for(var We=xe.length,ft=Array(We),pt=0;pt<We;pt++){var ar=xe[pt];ar&&(ft[pt]=ar())}return ft}},M.safeObjectGet=function(O,$,xe){return O[$]},M.createCallFunctionGetter=function(O){var $=this;switch(O.type){case"MemberExpression":var xe=this.createClosure(O.object),We=this.createMemberKeyGetter(O),ft=this.source;return function(){var ar=xe(),ur=We(),Tn=$.safeObjectGet(ar,ur,O);if(!Tn||!La(Tn)){var ii=ft.slice(O.start,O.end);throw $.createInternalThrowError(aa.FunctionUndefinedReferenceError,ii,O)}return Tn.__IS_EVAL_FUNC?function(Rn){return Tn(new Za($),Rn,!0)}:Tn.__IS_FUNCTION_FUNC?function(){for(var Rn=arguments.length,Yi=new Array(Rn),da=0;da<Rn;da++)Yi[da]=arguments[da];return Tn.apply(void 0,[new Za($)].concat(Yi))}:Tn.bind(ar)};default:var pt=this.createClosure(O);return function(){var ar="";O.type==="Identifier"&&(ar=O.name);var ur=pt();if(!ur||!La(ur))throw $.createInternalThrowError(aa.FunctionUndefinedReferenceError,ar,O);if(O.type==="Identifier"&&ur.__IS_EVAL_FUNC&&ar==="eval")return function(Rn){var Yi=$.getScopeFromName(ar,$.getCurrentScope()),da=Yi.name===Pn||Yi.name===oo||Yi.name===Oi;return ur(new Za($),Rn,!da)};if(ur.__IS_EVAL_FUNC)return function(Rn){return ur(new Za($),Rn,!0)};if(ur.__IS_FUNCTION_FUNC)return function(){for(var Rn=arguments.length,Yi=new Array(Rn),da=0;da<Rn;da++)Yi[da]=arguments[da];return ur.apply(void 0,[new Za($)].concat(Yi))};var Tn=$.options.globalContextInFunction;if(O.type==="Identifier"){var ii=$.getIdentifierScope(O);ii.name===Or&&(Tn=ii.data)}return ur.bind(Tn)}}},M.callExpressionHandler=function(O){var $=this,xe=this.createCallFunctionGetter(O.callee),We=O.arguments.map(function(ft){return $.createClosure(ft)});return function(){return xe().apply(void 0,We.map(function(ft){return ft()}))}},M.functionExpressionHandler=function(O){var $=this,xe=this,We=this.source,ft=this.collectDeclVars,pt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ar=O.id?O.id.name:"",ur=O.params.length,Tn=O.params.map(function(da){return $.createParamNameGetter(da)}),ii=this.createClosure(O.body),Rn=this.collectDeclVars,Yi=this.collectDeclFuncs;return this.collectDeclVars=ft,this.collectDeclFuncs=pt,function(){var da=xe.getCurrentScope(),Ca=function Hi(){for(var xs=arguments.length,lu=new Array(xs),Xu=0;Xu<xs;Xu++)lu[Xu]=arguments[Xu];xe.callStack.push(""+ar);var df=xe.getCurrentScope(),ol=uu(da,"FunctionScope("+ar+")");xe.setCurrentScope(ol),xe.addDeclarationsToScope(Rn,Yi,ol),ar&&(ol.data[ar]=Hi),ol.data.arguments=arguments,Tn.forEach(function(wu,Tu){ol.data[wu()]=lu[Tu]});var kc=xe.getCurrentContext();xe.setCurrentContext(this);var Au=ii();if(xe.setCurrentContext(kc),xe.setCurrentScope(df),xe.callStack.pop(),Au instanceof lo)return Au.value};return wl(Ca,ar),Object.defineProperty(Ca,"length",{value:ur,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ca,"toString",{value:function(){return We.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ca,"valueOf",{value:function(){return We.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Ca}},M.newExpressionHandler=function(O){var $=this,xe=this.source,We=this.createClosure(O.callee),ft=O.arguments.map(function(pt){return $.createClosure(pt)});return function(){var pt=We();if(!La(pt)||pt.__IS_EVAL_FUNC){var ar=O.callee,ur=xe.slice(ar.start,ar.end);throw $.createInternalThrowError(aa.IsNotConstructor,ur,O)}return pt.__IS_FUNCTION_FUNC?pt.apply(void 0,[new Za($)].concat(ft.map(function(Tn){return Tn()}))):Fo(pt,ft.map(function(Tn){return Tn()}))}},M.memberExpressionHandler=function(O){var $=this.createClosure(O.object),xe=this.createMemberKeyGetter(O);return function(){var We=$(),ft=xe();return We[ft]}},M.thisExpressionHandler=function(O){var $=this;return function(){return $.getCurrentContext()}},M.sequenceExpressionHandler=function(O){var $=this,xe=O.expressions.map(function(We){return $.createClosure(We)});return function(){for(var We,ft=xe.length,pt=0;pt<ft;pt++){var ar=xe[pt];We=ar()}return We}},M.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},M.identifierHandler=function(O){var $=this;return function(){var xe=$.getCurrentScope(),We=$.getScopeDataFromName(O.name,xe);return $.assertVariable(We,O.name,O),We[O.name]}},M.getIdentifierScope=function(O){var $=this.getCurrentScope(),xe=this.getScopeFromName(O.name,$);return xe},M.assignmentExpressionHandler=function(O){var $=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var xe=this.createObjectGetter(O.left),We=this.createNameGetter(O.left),ft=this.createClosure(O.right);return function(){var pt=xe(),ar=We(),ur=ft();switch(O.operator!=="="&&$.assertVariable(pt,ar,O),O.operator){case"=":return pt[ar]=ur;case"+=":return pt[ar]+=ur;case"-=":return pt[ar]-=ur;case"*=":return pt[ar]*=ur;case"**=":return pt[ar]=Math.pow(pt[ar],ur);case"/=":return pt[ar]/=ur;case"%=":return pt[ar]%=ur;case"<<=":return pt[ar]<<=ur;case">>=":return pt[ar]>>=ur;case">>>=":return pt[ar]>>>=ur;case"&=":return pt[ar]&=ur;case"^=":return pt[ar]^=ur;case"|=":return pt[ar]|=ur;default:throw $.createInternalThrowError(aa.AssignmentExpressionSyntaxError,O.type,O)}}},M.functionDeclarationHandler=function(O){if(O.id){var $=this.functionExpressionHandler(O);Object.defineProperty($,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,$)}return function(){return Rt}},M.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(aa.VariableTypeSyntaxError,O.type,O)},M.variableDeclarationHandler=function(O){for(var $=this,xe,We=[],ft=0;ft<O.declarations.length;ft++){var pt=O.declarations[ft];this.varDeclaration(this.getVariableName(pt.id)),pt.init&&We.push({type:"AssignmentExpression",operator:"=",left:pt.id,right:pt.init})}return We.length&&(xe=this.createClosure({type:"BlockStatement",body:We})),function(){if(xe){var ar=$.isVarDeclMode;$.isVarDeclMode=!0,xe(),$.isVarDeclMode=ar}return Rt}},M.assertVariable=function(O,$,xe){if(O===this.globalScope.data&&!($ in O))throw this.createInternalThrowError(aa.VariableUndefinedReferenceError,$,xe)},M.programHandler=function(O){var $=this,xe=O.body.map(function(We){return $.createClosure(We)});return function(){for(var We=Rt,ft=0;ft<xe.length;ft++){var pt=xe[ft],ar=$.setValue(pt());if(ar!==Rt&&(We=ar,We instanceof lo||We instanceof wo||We instanceof ys||We===ne||We===be))break}return We}},M.expressionStatementHandler=function(O){return this.createClosure(O.expression)},M.emptyStatementHandler=function(O){return function(){return Rt}},M.returnStatementHandler=function(O){var $=O.argument?this.createClosure(O.argument):Fs;return function(){return new lo($())}},M.ifStatementHandler=function(O){var $=this.createClosure(O.test),xe=this.createClosure(O.consequent),We=O.alternate?this.createClosure(O.alternate):function(){return Rt};return function(){return $()?xe():We()}},M.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},M.forStatementHandler=function(O){var $=this,xe=Fs,We=O.test?this.createClosure(O.test):function(){return!0},ft=Fs,pt=this.createClosure(O.body);return O.type==="ForStatement"&&(xe=O.init?this.createClosure(O.init):xe,ft=O.update?this.createClosure(O.update):Fs),function(ar){var ur,Tn=Rt,ii=O.type==="DoWhileStatement";for(ar&&ar.type==="LabeledStatement"&&(ur=ar.label.name),xe();ii||We();ft()){ii=!1;var Rn=$.setValue(pt());if(!(Rn===Rt||Rn===be)){if(Rn===ne)break;if(Tn=Rn,Tn instanceof ys&&Tn.value===ur){Tn=Rt;continue}if(Tn instanceof lo||Tn instanceof wo||Tn instanceof ys)break}}return Tn}},M.whileStatementHandler=function(O){return this.forStatementHandler(O)},M.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},M.forInStatementHandler=function(O){var $=this,xe=O.left,We=this.createClosure(O.right),ft=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),xe=O.left.declarations[0].id),function(pt){var ar,ur=Rt,Tn;pt&&pt.type==="LabeledStatement"&&(ar=pt.label.name);var ii=We();for(Tn in ii){$.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:xe,right:{type:"Literal",value:Tn}})();var Rn=$.setValue(ft());if(!(Rn===Rt||Rn===be)){if(Rn===ne)break;if(ur=Rn,ur instanceof ys&&ur.value===ar){ur=Rt;continue}if(ur instanceof lo||ur instanceof wo||ur instanceof ys)break}}return ur}},M.withStatementHandler=function(O){var $=this,xe=this.createClosure(O.object),We=this.createClosure(O.body);return function(){var ft=xe(),pt=$.getCurrentScope(),ar=new Ts(ft,pt,Or);$.setCurrentScope(ar);var ur=$.setValue(We());return $.setCurrentScope(pt),ur}},M.throwStatementHandler=function(O){var $=this,xe=this.createClosure(O.argument);return function(){throw $.setValue(void 0),xe()}},M.tryStatementHandler=function(O){var $=this,xe=this.createClosure(O.block),We=O.handler?this.catchClauseHandler(O.handler):null,ft=O.finalizer?this.createClosure(O.finalizer):null;return function(){var pt=$.getCurrentScope(),ar=$.getCurrentContext(),ur=pt.labelStack.concat([]),Tn=$.callStack.concat([]),ii=Rt,Rn,Yi,da=function(){$.setCurrentScope(pt),$.setCurrentContext(ar),pt.labelStack=ur,$.callStack=Tn};try{ii=$.setValue(xe()),ii instanceof lo&&(Rn=ii)}catch(Ca){if(da(),$.isInterruptThrow(Ca))throw Ca;if(We)try{ii=$.setValue(We(Ca)),ii instanceof lo&&(Rn=ii)}catch(Hi){if(da(),$.isInterruptThrow(Hi))throw Hi;Yi=Hi}}if(ft)try{ii=ft(),ii instanceof lo&&(Rn=ii)}catch(Ca){if(da(),$.isInterruptThrow(Ca))throw Ca;Yi=Ca}if(Yi)throw Yi;return Rn||ii}},M.catchClauseHandler=function(O){var $=this,xe=this.createParamNameGetter(O.param),We=this.createClosure(O.body);return function(ft){var pt,ar=$.getCurrentScope(),ur=ar.data,Tn=xe(),ii=ms.call(ur,Tn),Rn=ur[Tn];return ur[Tn]=ft,pt=We(),ii?ur[Tn]=Rn:delete ur[Tn],pt}},M.continueStatementHandler=function(O){return function(){return O.label?new ys(O.label.name):be}},M.breakStatementHandler=function(O){return function(){return O.label?new wo(O.label.name):ne}},M.switchStatementHandler=function(O){var $=this,xe=this.createClosure(O.discriminant),We=O.cases.map(function(ft){return $.switchCaseHandler(ft)});return function(){for(var ft=xe(),pt=!1,ar,ur,Tn,ii=0;ii<We.length;ii++){var Rn=We[ii](),Yi=Rn.testClosure();if(Yi===Ye){Tn=Rn;continue}if(pt||Yi===ft){if(pt=!0,ur=$.setValue(Rn.bodyClosure()),ur===Rt)continue;if(ur===ne||(ar=ur,ar instanceof lo||ar instanceof wo||ar instanceof ys||ar===be))break}}if(!pt&&Tn){ur=$.setValue(Tn.bodyClosure());var da=ur===Rt||ur===ne||ur===be;da||(ar=ur)}return ar}},M.switchCaseHandler=function(O){var $=O.test?this.createClosure(O.test):function(){return Ye},xe=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:$,bodyClosure:xe}}},M.labeledStatementHandler=function(O){var $=this,xe=O.label.name,We=this.createClosure(O.body);return function(){var ft,pt=$.getCurrentScope();return pt.labelStack.push(xe),ft=We(O),ft instanceof wo&&ft.value===xe&&(ft=Rt),pt.labelStack.pop(),ft}},M.debuggerStatementHandler=function(O){return function(){debugger;return Rt}},M.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(aa.ParamTypeSyntaxError,O.type,O)},M.createObjectKeyGetter=function(O){var $;return O.type==="Identifier"?$=function(){return O.name}:$=this.createClosure(O),function(){return $()}},M.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},M.createObjectGetter=function(O){var $=this;switch(O.type){case"Identifier":return function(){return $.getScopeDataFromName(O.name,$.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},M.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(aa.AssignmentTypeSyntaxError,O.type,O)}},M.varDeclaration=function(O){var $=this.collectDeclVars;$[O]=void 0},M.funcDeclaration=function(O,$){var xe=this.collectDeclFuncs;xe[O]=$},M.addDeclarationsToScope=function(O,$,xe){var We=xe.data;for(var ft in $){var pt=$[ft];We[ft]=pt&&pt()}for(var ar in O)ar in We||(We[ar]=void 0)},M.getScopeValue=function(O,$){var xe=this.getScopeFromName(O,$);return xe.data[O]},M.getScopeDataFromName=function(O,$){return this.getScopeFromName(O,$).data},M.getScopeFromName=function(O,$){var xe=$;do if(O in xe.data)return xe;while(xe=xe.parent);return this.globalScope},M.setValue=function(O){var $=this.callStack.length;return this.isVarDeclMode||$||O===Rt||O===ne||O===be||O instanceof wo||O instanceof ys||(this.value=O instanceof lo?O.value:O),O},M.getValue=function(){return this.value},_}();xa.version=ws,xa.eval=Vo,xa.Function=gs,xa.ecmaVersion=5,xa.globalContextInFunction=void 0,xa.global=Object.create(null);function is(_){return _===void 0&&(_=Object.create(null)),_}function hf(_,M,B){M===void 0&&(M=[]),B===void 0&&(B={});var O=B.parsingContext,$=B.timeout===void 0?0:B.timeout,xe=`
    (function anonymous(`+M.join(",")+`){
         `+_+`
    });
    `,We=new xa(O,{ecmaVersion:B.ecmaVersion,timeout:$,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return We.evaluate(xe)}function Tl(_,M,B){var O=new xa(M,B);return O.evaluate(_)}var Xs=Tl,tc=function(){function _(B){this._code=B}var M=_.prototype;return M.runInContext=function(O){return Tl(this._code,O)},M.runInNewContext=function(O){return Tl(this._code,O)},_}(),Wu=function(_,M,B){return Tl(_,M,B)};function Ys(){for(var _=arguments.length,M=new Array(_),B=0;B<_;B++)M[B]=arguments[B];var O=M.pop();return hf(O||"",M)}var al=Wu},20396:function(Mt,Q,U){var ie;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(re,m,he,V){"use strict";var ue=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ce=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Le=ue||ce,ee=["","webkit","Moz","MS","ms","o"],Xe=Le?"":m.createElement("div"),Je="function",Ze=Math.round,gt=Math.abs,tr=Date.now;function yt(ne,be,Ye){return setTimeout(ut(ne,Ye),be)}function Wt(ne,be,Ye){return Array.isArray(ne)?(bt(ne,Ye[be],Ye),!0):!1}function bt(ne,be,Ye){var Rt;if(!!ne)if(ne.forEach)ne.forEach(be,Ye);else if(ne.length!==V)for(Rt=0;Rt<ne.length;)be.call(Ye,ne[Rt],Rt,ne),Rt++;else for(Rt in ne)ne.hasOwnProperty(Rt)&&be.call(Ye,ne[Rt],Rt,ne)}function at(ne,be,Ye){var Rt="DEPRECATED METHOD: "+be+`
`+Ye+` AT 
`;return function(){var Or=new Error("get-stack-trace"),Pn=Or&&Or.stack?Or.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Oi=re.console&&(re.console.warn||re.console.log);return Oi&&Oi.call(re.console,Rt,Pn),ne.apply(this,arguments)}}var nt;typeof Object.assign!="function"?nt=function(be){if(be===V||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Ye=Object(be),Rt=1;Rt<arguments.length;Rt++){var Or=arguments[Rt];if(Or!==V&&Or!==null)for(var Pn in Or)Or.hasOwnProperty(Pn)&&(Ye[Pn]=Or[Pn])}return Ye}:nt=Object.assign;var Zt=at(function(be,Ye,Rt){for(var Or=Object.keys(Ye),Pn=0;Pn<Or.length;)(!Rt||Rt&&be[Or[Pn]]===V)&&(be[Or[Pn]]=Ye[Or[Pn]]),Pn++;return be},"extend","Use `assign`."),Y=at(function(be,Ye){return Zt(be,Ye,!0)},"merge","Use `assign`.");function qt(ne,be,Ye){var Rt=be.prototype,Or;Or=ne.prototype=Object.create(Rt),Or.constructor=ne,Or._super=Rt,Ye&&nt(Or,Ye)}function ut(ne,be){return function(){return ne.apply(be,arguments)}}function Qe(ne,be){return typeof ne==Je?ne.apply(be&&be[0]||V,be):ne}function Ct(ne,be){return ne===V?be:ne}function $e(ne,be,Ye){bt(Kr(be),function(Rt){ne.addEventListener(Rt,Ye,!1)})}function Kt(ne,be,Ye){bt(Kr(be),function(Rt){ne.removeEventListener(Rt,Ye,!1)})}function xr(ne,be){for(;ne;){if(ne==be)return!0;ne=ne.parentNode}return!1}function kr(ne,be){return ne.indexOf(be)>-1}function Kr(ne){return ne.trim().split(/\s+/g)}function A(ne,be,Ye){if(ne.indexOf&&!Ye)return ne.indexOf(be);for(var Rt=0;Rt<ne.length;){if(Ye&&ne[Rt][Ye]==be||!Ye&&ne[Rt]===be)return Rt;Rt++}return-1}function Ae(ne){return Array.prototype.slice.call(ne,0)}function De(ne,be,Ye){for(var Rt=[],Or=[],Pn=0;Pn<ne.length;){var Oi=be?ne[Pn][be]:ne[Pn];A(Or,Oi)<0&&Rt.push(ne[Pn]),Or[Pn]=Oi,Pn++}return Ye&&(be?Rt=Rt.sort(function(La,Za){return La[be]>Za[be]}):Rt=Rt.sort()),Rt}function At(ne,be){for(var Ye,Rt,Or=be[0].toUpperCase()+be.slice(1),Pn=0;Pn<ee.length;){if(Ye=ee[Pn],Rt=Ye?Ye+Or:be,Rt in ne)return Rt;Pn++}return V}var mt=1;function Ft(){return mt++}function Yt(ne){var be=ne.ownerDocument||ne;return be.defaultView||be.parentWindow||re}var Sr=/mobile|tablet|ip(ad|hone|od)|android/i,qn="ontouchstart"in re,hn=At(re,"PointerEvent")!==V,fi=qn&&Sr.test(navigator.userAgent),Gn="touch",ni="pen",pi="mouse",Wn="kinect",hi=25,ua=1,Gi=2,Di=4,$i=8,la=1,Mi=2,ma=4,Xn=8,Si=16,Zi=Mi|ma,Qi=Xn|Si,ko=Zi|Qi,me=["x","y"],kn=["clientX","clientY"];function Ha(ne,be){var Ye=this;this.manager=ne,this.callback=be,this.element=ne.element,this.target=ne.options.inputTarget,this.domHandler=function(Rt){Qe(ne.options.enable,[ne])&&Ye.handler(Rt)},this.init()}Ha.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(Yt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&Kt(this.element,this.evEl,this.domHandler),this.evTarget&&Kt(this.target,this.evTarget,this.domHandler),this.evWin&&Kt(Yt(this.element),this.evWin,this.domHandler)}};function ns(ne){var be,Ye=ne.options.inputClass;return Ye?be=Ye:hn?be=Pe:fi?be=Nt:qn?be=Pt:be=ba,new be(ne,Bt)}function Bt(ne,be,Ye){var Rt=Ye.pointers.length,Or=Ye.changedPointers.length,Pn=be&ua&&Rt-Or==0,Oi=be&(Di|$i)&&Rt-Or==0;Ye.isFirst=!!Pn,Ye.isFinal=!!Oi,Pn&&(ne.session={}),Ye.eventType=be,rr(ne,Ye),ne.emit("hammer.input",Ye),ne.recognize(Ye),ne.session.prevInput=Ye}function rr(ne,be){var Ye=ne.session,Rt=be.pointers,Or=Rt.length;Ye.firstInput||(Ye.firstInput=Sn(be)),Or>1&&!Ye.firstMultiple?Ye.firstMultiple=Sn(be):Or===1&&(Ye.firstMultiple=!1);var Pn=Ye.firstInput,Oi=Ye.firstMultiple,oo=Oi?Oi.center:Pn.center,La=be.center=Fn(Rt);be.timeStamp=tr(),be.deltaTime=be.timeStamp-Pn.timeStamp,be.angle=Fi(oo,La),be.distance=an(oo,La),Cr(Ye,be),be.offsetDirection=Kn(be.deltaX,be.deltaY);var Za=di(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=Za.x,be.overallVelocityY=Za.y,be.overallVelocity=gt(Za.x)>gt(Za.y)?Za.x:Za.y,be.scale=Oi?ao(Oi.pointers,Rt):1,be.rotation=Oi?Li(Oi.pointers,Rt):0,be.maxPointers=Ye.prevInput?be.pointers.length>Ye.prevInput.maxPointers?be.pointers.length:Ye.prevInput.maxPointers:be.pointers.length,Qr(Ye,be);var Vo=ne.element;xr(be.srcEvent.target,Vo)&&(Vo=be.srcEvent.target),be.target=Vo}function Cr(ne,be){var Ye=be.center,Rt=ne.offsetDelta||{},Or=ne.prevDelta||{},Pn=ne.prevInput||{};(be.eventType===ua||Pn.eventType===Di)&&(Or=ne.prevDelta={x:Pn.deltaX||0,y:Pn.deltaY||0},Rt=ne.offsetDelta={x:Ye.x,y:Ye.y}),be.deltaX=Or.x+(Ye.x-Rt.x),be.deltaY=Or.y+(Ye.y-Rt.y)}function Qr(ne,be){var Ye=ne.lastInterval||be,Rt=be.timeStamp-Ye.timeStamp,Or,Pn,Oi,oo;if(be.eventType!=$i&&(Rt>hi||Ye.velocity===V)){var La=be.deltaX-Ye.deltaX,Za=be.deltaY-Ye.deltaY,Vo=di(Rt,La,Za);Pn=Vo.x,Oi=Vo.y,Or=gt(Vo.x)>gt(Vo.y)?Vo.x:Vo.y,oo=Kn(La,Za),ne.lastInterval=be}else Or=Ye.velocity,Pn=Ye.velocityX,Oi=Ye.velocityY,oo=Ye.direction;be.velocity=Or,be.velocityX=Pn,be.velocityY=Oi,be.direction=oo}function Sn(ne){for(var be=[],Ye=0;Ye<ne.pointers.length;)be[Ye]={clientX:Ze(ne.pointers[Ye].clientX),clientY:Ze(ne.pointers[Ye].clientY)},Ye++;return{timeStamp:tr(),pointers:be,center:Fn(be),deltaX:ne.deltaX,deltaY:ne.deltaY}}function Fn(ne){var be=ne.length;if(be===1)return{x:Ze(ne[0].clientX),y:Ze(ne[0].clientY)};for(var Ye=0,Rt=0,Or=0;Or<be;)Ye+=ne[Or].clientX,Rt+=ne[Or].clientY,Or++;return{x:Ze(Ye/be),y:Ze(Rt/be)}}function di(ne,be,Ye){return{x:be/ne||0,y:Ye/ne||0}}function Kn(ne,be){return ne===be?la:gt(ne)>=gt(be)?ne<0?Mi:ma:be<0?Xn:Si}function an(ne,be,Ye){Ye||(Ye=me);var Rt=be[Ye[0]]-ne[Ye[0]],Or=be[Ye[1]]-ne[Ye[1]];return Math.sqrt(Rt*Rt+Or*Or)}function Fi(ne,be,Ye){Ye||(Ye=me);var Rt=be[Ye[0]]-ne[Ye[0]],Or=be[Ye[1]]-ne[Ye[1]];return Math.atan2(Or,Rt)*180/Math.PI}function Li(ne,be){return Fi(be[1],be[0],kn)+Fi(ne[1],ne[0],kn)}function ao(ne,be){return an(be[0],be[1],kn)/an(ne[0],ne[1],kn)}var vs={mousedown:ua,mousemove:Gi,mouseup:Di},Zo="mousedown",za="mousemove mouseup";function ba(){this.evEl=Zo,this.evWin=za,this.pressed=!1,Ha.apply(this,arguments)}qt(ba,Ha,{handler:function(be){var Ye=vs[be.type];Ye&ua&&be.button===0&&(this.pressed=!0),Ye&Gi&&be.which!==1&&(Ye=Di),!!this.pressed&&(Ye&Di&&(this.pressed=!1),this.callback(this.manager,Ye,{pointers:[be],changedPointers:[be],pointerType:pi,srcEvent:be}))}});var H={pointerdown:ua,pointermove:Gi,pointerup:Di,pointercancel:$i,pointerout:$i},J={2:Gn,3:ni,4:pi,5:Wn},ae="pointerdown",ye="pointermove pointerup pointercancel";!Le&&re.MSPointerEvent&&!re.PointerEvent&&(ae="MSPointerDown",ye="MSPointerMove MSPointerUp MSPointerCancel");function Pe(){this.evEl=ae,this.evWin=ye,Ha.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}qt(Pe,Ha,{handler:function(be){var Ye=this.store,Rt=!1,Or=be.type.toLowerCase().replace("ms",""),Pn=H[Or],Oi=J[be.pointerType]||be.pointerType,oo=Oi==Gn,La=A(Ye,be.pointerId,"pointerId");Pn&ua&&(be.button===0||oo)?La<0&&(Ye.push(be),La=Ye.length-1):Pn&(Di|$i)&&(Rt=!0),!(La<0)&&(Ye[La]=be,this.callback(this.manager,Pn,{pointers:Ye,changedPointers:[be],pointerType:Oi,srcEvent:be}),Rt&&Ye.splice(La,1))}});var He={touchstart:ua,touchmove:Gi,touchend:Di,touchcancel:$i},tt="touchstart",fe="touchstart touchmove touchend touchcancel";function ke(){this.evTarget=tt,this.evWin=fe,this.started=!1,Ha.apply(this,arguments)}qt(ke,Ha,{handler:function(be){var Ye=He[be.type];if(Ye===ua&&(this.started=!0),!!this.started){var Rt=ht.call(this,be,Ye);Ye&(Di|$i)&&Rt[0].length-Rt[1].length==0&&(this.started=!1),this.callback(this.manager,Ye,{pointers:Rt[0],changedPointers:Rt[1],pointerType:Gn,srcEvent:be})}}});function ht(ne,be){var Ye=Ae(ne.touches),Rt=Ae(ne.changedTouches);return be&(Di|$i)&&(Ye=De(Ye.concat(Rt),"identifier",!0)),[Ye,Rt]}var pr={touchstart:ua,touchmove:Gi,touchend:Di,touchcancel:$i},kt="touchstart touchmove touchend touchcancel";function Nt(){this.evTarget=kt,this.targetIds={},Ha.apply(this,arguments)}qt(Nt,Ha,{handler:function(be){var Ye=pr[be.type],Rt=hr.call(this,be,Ye);!Rt||this.callback(this.manager,Ye,{pointers:Rt[0],changedPointers:Rt[1],pointerType:Gn,srcEvent:be})}});function hr(ne,be){var Ye=Ae(ne.touches),Rt=this.targetIds;if(be&(ua|Gi)&&Ye.length===1)return Rt[Ye[0].identifier]=!0,[Ye,Ye];var Or,Pn,Oi=Ae(ne.changedTouches),oo=[],La=this.target;if(Pn=Ye.filter(function(Za){return xr(Za.target,La)}),be===ua)for(Or=0;Or<Pn.length;)Rt[Pn[Or].identifier]=!0,Or++;for(Or=0;Or<Oi.length;)Rt[Oi[Or].identifier]&&oo.push(Oi[Or]),be&(Di|$i)&&delete Rt[Oi[Or].identifier],Or++;if(!!oo.length)return[De(Pn.concat(oo),"identifier",!0),oo]}var _n=2500,fn=25;function Pt(){Ha.apply(this,arguments);var ne=ut(this.handler,this);this.touch=new Nt(this.manager,ne),this.mouse=new ba(this.manager,ne),this.primaryTouch=null,this.lastTouches=[]}qt(Pt,Ha,{handler:function(be,Ye,Rt){var Or=Rt.pointerType==Gn,Pn=Rt.pointerType==pi;if(!(Pn&&Rt.sourceCapabilities&&Rt.sourceCapabilities.firesTouchEvents)){if(Or)Jr.call(this,Ye,Rt);else if(Pn&&Hr.call(this,Rt))return;this.callback(be,Ye,Rt)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Jr(ne,be){ne&ua?(this.primaryTouch=be.changedPointers[0].identifier,Br.call(this,be)):ne&(Di|$i)&&Br.call(this,be)}function Br(ne){var be=ne.changedPointers[0];if(be.identifier===this.primaryTouch){var Ye={x:be.clientX,y:be.clientY};this.lastTouches.push(Ye);var Rt=this.lastTouches,Or=function(){var Pn=Rt.indexOf(Ye);Pn>-1&&Rt.splice(Pn,1)};setTimeout(Or,_n)}}function Hr(ne){for(var be=ne.srcEvent.clientX,Ye=ne.srcEvent.clientY,Rt=0;Rt<this.lastTouches.length;Rt++){var Or=this.lastTouches[Rt],Pn=Math.abs(be-Or.x),Oi=Math.abs(Ye-Or.y);if(Pn<=fn&&Oi<=fn)return!0}return!1}var gi=Le?V:At(Xe.style,"touchAction"),en=gi!==V,yn="compute",Xi="auto",vi="manipulation",Pi="none",xi="pan-x",dt="pan-y",It=Ii();function Ta(ne,be){this.manager=ne,this.set(be)}Ta.prototype={set:function(ne){ne==yn&&(ne=this.compute()),en&&this.manager.element.style&&It[ne]&&(this.manager.element.style[gi]=ne),this.actions=ne.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ne=[];return bt(this.manager.recognizers,function(be){Qe(be.options.enable,[be])&&(ne=ne.concat(be.getTouchAction()))}),Ci(ne.join(" "))},preventDefaults:function(ne){var be=ne.srcEvent,Ye=ne.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Rt=this.actions,Or=kr(Rt,Pi)&&!It[Pi],Pn=kr(Rt,dt)&&!It[dt],Oi=kr(Rt,xi)&&!It[xi];if(Or){var oo=ne.pointers.length===1,La=ne.distance<2,Za=ne.deltaTime<250;if(oo&&La&&Za)return}if(!(Oi&&Pn)&&(Or||Pn&&Ye&Zi||Oi&&Ye&Qi))return this.preventSrc(be)},preventSrc:function(ne){this.manager.session.prevented=!0,ne.preventDefault()}};function Ci(ne){if(kr(ne,Pi))return Pi;var be=kr(ne,xi),Ye=kr(ne,dt);return be&&Ye?Pi:be||Ye?be?xi:dt:kr(ne,vi)?vi:Xi}function Ii(){if(!en)return!1;var ne={};if(Le)return ne;var be=re.CSS&&re.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Ye){ne[Ye]=be?re.CSS.supports("touch-action",Ye):!0}),ne}var ji=1,Ir=2,on=4,_t=8,na=_t,de=16,Ko=32;function ra(ne){this.options=nt({},this.defaults,ne||{}),this.id=Ft(),this.manager=null,this.options.enable=Ct(this.options.enable,!0),this.state=ji,this.simultaneous={},this.requireFail=[]}ra.prototype={defaults:{},set:function(ne){return nt(this.options,ne),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ne){if(Wt(ne,"recognizeWith",this))return this;var be=this.simultaneous;return ne=Ma(ne,this),be[ne.id]||(be[ne.id]=ne,ne.recognizeWith(this)),this},dropRecognizeWith:function(ne){return Wt(ne,"dropRecognizeWith",this)?this:(ne=Ma(ne,this),delete this.simultaneous[ne.id],this)},requireFailure:function(ne){if(Wt(ne,"requireFailure",this))return this;var be=this.requireFail;return ne=Ma(ne,this),A(be,ne)===-1&&(be.push(ne),ne.requireFailure(this)),this},dropRequireFailure:function(ne){if(Wt(ne,"dropRequireFailure",this))return this;ne=Ma(ne,this);var be=A(this.requireFail,ne);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ne){return!!this.simultaneous[ne.id]},emit:function(ne){var be=this,Ye=this.state;function Rt(Or){be.manager.emit(Or,ne)}Ye<_t&&Rt(be.options.event+_u(Ye)),Rt(be.options.event),ne.additionalEvent&&Rt(ne.additionalEvent),Ye>=_t&&Rt(be.options.event+_u(Ye))},tryEmit:function(ne){if(this.canEmit())return this.emit(ne);this.state=Ko},canEmit:function(){for(var ne=0;ne<this.requireFail.length;){if(!(this.requireFail[ne].state&(Ko|ji)))return!1;ne++}return!0},recognize:function(ne){var be=nt({},ne);if(!Qe(this.options.enable,[this,be])){this.reset(),this.state=Ko;return}this.state&(na|de|Ko)&&(this.state=ji),this.state=this.process(be),this.state&(Ir|on|_t|de)&&this.tryEmit(be)},process:function(ne){},getTouchAction:function(){},reset:function(){}};function _u(ne){return ne&de?"cancel":ne&_t?"end":ne&on?"move":ne&Ir?"start":""}function Ua(ne){return ne==Si?"down":ne==Xn?"up":ne==Mi?"left":ne==ma?"right":""}function Ma(ne,be){var Ye=be.manager;return Ye?Ye.get(ne):ne}function Ka(){ra.apply(this,arguments)}qt(Ka,ra,{defaults:{pointers:1},attrTest:function(ne){var be=this.options.pointers;return be===0||ne.pointers.length===be},process:function(ne){var be=this.state,Ye=ne.eventType,Rt=be&(Ir|on),Or=this.attrTest(ne);return Rt&&(Ye&$i||!Or)?be|de:Rt||Or?Ye&Di?be|_t:be&Ir?be|on:Ir:Ko}});function ia(){Ka.apply(this,arguments),this.pX=null,this.pY=null}qt(ia,Ka,{defaults:{event:"pan",threshold:10,pointers:1,direction:ko},getTouchAction:function(){var ne=this.options.direction,be=[];return ne&Zi&&be.push(dt),ne&Qi&&be.push(xi),be},directionTest:function(ne){var be=this.options,Ye=!0,Rt=ne.distance,Or=ne.direction,Pn=ne.deltaX,Oi=ne.deltaY;return Or&be.direction||(be.direction&Zi?(Or=Pn===0?la:Pn<0?Mi:ma,Ye=Pn!=this.pX,Rt=Math.abs(ne.deltaX)):(Or=Oi===0?la:Oi<0?Xn:Si,Ye=Oi!=this.pY,Rt=Math.abs(ne.deltaY))),ne.direction=Or,Ye&&Rt>be.threshold&&Or&be.direction},attrTest:function(ne){return Ka.prototype.attrTest.call(this,ne)&&(this.state&Ir||!(this.state&Ir)&&this.directionTest(ne))},emit:function(ne){this.pX=ne.deltaX,this.pY=ne.deltaY;var be=Ua(ne.direction);be&&(ne.additionalEvent=this.options.event+be),this._super.emit.call(this,ne)}});function Ao(){Ka.apply(this,arguments)}qt(Ao,Ka,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ne){return this._super.attrTest.call(this,ne)&&(Math.abs(ne.scale-1)>this.options.threshold||this.state&Ir)},emit:function(ne){if(ne.scale!==1){var be=ne.scale<1?"in":"out";ne.additionalEvent=this.options.event+be}this._super.emit.call(this,ne)}});function jo(){ra.apply(this,arguments),this._timer=null,this._input=null}qt(jo,ra,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Xi]},process:function(ne){var be=this.options,Ye=ne.pointers.length===be.pointers,Rt=ne.distance<be.threshold,Or=ne.deltaTime>be.time;if(this._input=ne,!Rt||!Ye||ne.eventType&(Di|$i)&&!Or)this.reset();else if(ne.eventType&ua)this.reset(),this._timer=yt(function(){this.state=na,this.tryEmit()},be.time,this);else if(ne.eventType&Di)return na;return Ko},reset:function(){clearTimeout(this._timer)},emit:function(ne){this.state===na&&(ne&&ne.eventType&Di?this.manager.emit(this.options.event+"up",ne):(this._input.timeStamp=tr(),this.manager.emit(this.options.event,this._input)))}});function Cu(){Ka.apply(this,arguments)}qt(Cu,Ka,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ne){return this._super.attrTest.call(this,ne)&&(Math.abs(ne.rotation)>this.options.threshold||this.state&Ir)}});function vo(){Ka.apply(this,arguments)}qt(vo,Ka,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Zi|Qi,pointers:1},getTouchAction:function(){return ia.prototype.getTouchAction.call(this)},attrTest:function(ne){var be=this.options.direction,Ye;return be&(Zi|Qi)?Ye=ne.overallVelocity:be&Zi?Ye=ne.overallVelocityX:be&Qi&&(Ye=ne.overallVelocityY),this._super.attrTest.call(this,ne)&&be&ne.offsetDirection&&ne.distance>this.options.threshold&&ne.maxPointers==this.options.pointers&&gt(Ye)>this.options.velocity&&ne.eventType&Di},emit:function(ne){var be=Ua(ne.offsetDirection);be&&this.manager.emit(this.options.event+be,ne),this.manager.emit(this.options.event,ne)}});function Do(){ra.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}qt(Do,ra,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[vi]},process:function(ne){var be=this.options,Ye=ne.pointers.length===be.pointers,Rt=ne.distance<be.threshold,Or=ne.deltaTime<be.time;if(this.reset(),ne.eventType&ua&&this.count===0)return this.failTimeout();if(Rt&&Or&&Ye){if(ne.eventType!=Di)return this.failTimeout();var Pn=this.pTime?ne.timeStamp-this.pTime<be.interval:!0,Oi=!this.pCenter||an(this.pCenter,ne.center)<be.posThreshold;this.pTime=ne.timeStamp,this.pCenter=ne.center,!Oi||!Pn?this.count=1:this.count+=1,this._input=ne;var oo=this.count%be.taps;if(oo===0)return this.hasRequireFailures()?(this._timer=yt(function(){this.state=na,this.tryEmit()},be.interval,this),Ir):na}return Ko},failTimeout:function(){return this._timer=yt(function(){this.state=Ko},this.options.interval,this),Ko},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==na&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function aa(ne,be){return be=be||{},be.recognizers=Ct(be.recognizers,aa.defaults.preset),new Qa(ne,be)}aa.VERSION="2.0.7",aa.defaults={domEvents:!1,touchAction:yn,enable:!0,inputTarget:null,inputClass:null,preset:[[Cu,{enable:!1}],[Ao,{enable:!1},["rotate"]],[vo,{direction:Zi}],[ia,{direction:Zi},["swipe"]],[Do],[Do,{event:"doubletap",taps:2},["tap"]],[jo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var $a=1,Fo=2;function Qa(ne,be){this.options=nt({},aa.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||ne,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ne,this.input=ns(this),this.touchAction=new Ta(this,this.options.touchAction),ws(this,!0),bt(this.options.recognizers,function(Ye){var Rt=this.add(new Ye[0](Ye[1]));Ye[2]&&Rt.recognizeWith(Ye[2]),Ye[3]&&Rt.requireFailure(Ye[3])},this)}Qa.prototype={set:function(ne){return nt(this.options,ne),ne.touchAction&&this.touchAction.update(),ne.inputTarget&&(this.input.destroy(),this.input.target=ne.inputTarget,this.input.init()),this},stop:function(ne){this.session.stopped=ne?Fo:$a},recognize:function(ne){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(ne);var Ye,Rt=this.recognizers,Or=be.curRecognizer;(!Or||Or&&Or.state&na)&&(Or=be.curRecognizer=null);for(var Pn=0;Pn<Rt.length;)Ye=Rt[Pn],be.stopped!==Fo&&(!Or||Ye==Or||Ye.canRecognizeWith(Or))?Ye.recognize(ne):Ye.reset(),!Or&&Ye.state&(Ir|on|_t)&&(Or=be.curRecognizer=Ye),Pn++}},get:function(ne){if(ne instanceof ra)return ne;for(var be=this.recognizers,Ye=0;Ye<be.length;Ye++)if(be[Ye].options.event==ne)return be[Ye];return null},add:function(ne){if(Wt(ne,"add",this))return this;var be=this.get(ne.options.event);return be&&this.remove(be),this.recognizers.push(ne),ne.manager=this,this.touchAction.update(),ne},remove:function(ne){if(Wt(ne,"remove",this))return this;if(ne=this.get(ne),ne){var be=this.recognizers,Ye=A(be,ne);Ye!==-1&&(be.splice(Ye,1),this.touchAction.update())}return this},on:function(ne,be){if(ne!==V&&be!==V){var Ye=this.handlers;return bt(Kr(ne),function(Rt){Ye[Rt]=Ye[Rt]||[],Ye[Rt].push(be)}),this}},off:function(ne,be){if(ne!==V){var Ye=this.handlers;return bt(Kr(ne),function(Rt){be?Ye[Rt]&&Ye[Rt].splice(A(Ye[Rt],be),1):delete Ye[Rt]}),this}},emit:function(ne,be){this.options.domEvents&&wl(ne,be);var Ye=this.handlers[ne]&&this.handlers[ne].slice();if(!(!Ye||!Ye.length)){be.type=ne,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Rt=0;Rt<Ye.length;)Ye[Rt](be),Rt++}},destroy:function(){this.element&&ws(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ws(ne,be){var Ye=ne.element;if(!!Ye.style){var Rt;bt(ne.options.cssProps,function(Or,Pn){Rt=At(Ye.style,Pn),be?(ne.oldCssProps[Rt]=Ye.style[Rt],Ye.style[Rt]=Or):Ye.style[Rt]=ne.oldCssProps[Rt]||""}),be||(ne.oldCssProps={})}}function wl(ne,be){if(!Le){var Ye=m.createEvent("Event");Ye.initEvent(ne,!0,!0),Ye.gesture=be,be.target.dispatchEvent(Ye)}}if(!Le){nt(aa,{INPUT_START:ua,INPUT_MOVE:Gi,INPUT_END:Di,INPUT_CANCEL:$i,STATE_POSSIBLE:ji,STATE_BEGAN:Ir,STATE_CHANGED:on,STATE_ENDED:_t,STATE_RECOGNIZED:na,STATE_CANCELLED:de,STATE_FAILED:Ko,DIRECTION_NONE:la,DIRECTION_LEFT:Mi,DIRECTION_RIGHT:ma,DIRECTION_UP:Xn,DIRECTION_DOWN:Si,DIRECTION_HORIZONTAL:Zi,DIRECTION_VERTICAL:Qi,DIRECTION_ALL:ko,Manager:Qa,Input:Ha,TouchAction:Ta,TouchInput:Nt,MouseInput:ba,PointerEventInput:Pe,TouchMouseInput:Pt,SingleTouchInput:ke,Recognizer:ra,AttrRecognizer:Ka,Tap:Do,Pan:ia,Swipe:vo,Pinch:Ao,Rotate:Cu,Press:jo,on:$e,off:Kt,each:bt,merge:Y,extend:Zt,assign:nt,inherit:qt,bindFn:ut,prefixed:At});var ms=typeof window!="undefined"?window:typeof self!="undefined"?self:{};ms.Hammer=aa,ie=function(){return aa}.call(Q,U,Q,Mt),ie!==V&&(Mt.exports=ie)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Mt,Q,U){(function(ie,re){Mt.exports=re(U(18857))})(this,function(ie){"use strict";var re=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},m=function(N,ge){for(var Be=Object.keys(ge),Dt=0;Dt<Be.length;++Dt)N[Be[Dt]]=ge[Be[Dt]];return N},he=`
`;function V(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function ue(N){var ge=new Error("(regl) "+N);throw console.error(ge),ge}function ce(N,ge){N||ue(ge)}function Le(N){return N?": "+N:""}function ee(N,ge,Be){N in ge||ue("unknown parameter ("+N+")"+Le(Be)+". possible values: "+Object.keys(ge).join())}function Xe(N,ge){re(N)||ue("invalid parameter type"+Le(ge)+". must be a typed array")}function Je(N,ge){switch(ge){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function Ze(N,ge,Be){Je(N,ge)||ue("invalid parameter type"+Le(Be)+". expected "+ge+", got "+typeof N)}function gt(N,ge){N>=0&&(N|0)===N||ue("invalid parameter type, ("+N+")"+Le(ge)+". must be a nonnegative integer")}function tr(N,ge,Be){ge.indexOf(N)<0&&ue("invalid value"+Le(Be)+". must be one of: "+ge)}var yt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Wt(N){Object.keys(N).forEach(function(ge){yt.indexOf(ge)<0&&ue('invalid regl constructor argument "'+ge+'". must be one of '+yt)})}function bt(N,ge){for(N=N+"";N.length<ge;)N=" "+N;return N}function at(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function nt(N,ge){this.number=N,this.line=ge,this.errors=[]}function Zt(N,ge,Be){this.file=N,this.line=ge,this.message=Be}function Y(){var N=new Error,ge=(N.stack||N).toString(),Be=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ge);if(Be)return Be[1];var Dt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ge);return Dt?Dt[1]:"unknown"}function qt(){var N=new Error,ge=(N.stack||N).toString(),Be=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ge);if(Be)return Be[1];var Dt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ge);return Dt?Dt[1]:"unknown"}function ut(N,ge){var Be=N.split(`
`),Dt=1,ir=0,Lt={unknown:new at,0:new at};Lt.unknown.name=Lt[0].name=ge||Y(),Lt.unknown.lines.push(new nt(0,""));for(var Jt=0;Jt<Be.length;++Jt){var cr=Be[Jt],vr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(cr);if(vr)switch(vr[1]){case"line":var yr=/(\d+)(\s+\d+)?/.exec(vr[2]);yr&&(Dt=yr[1]|0,yr[2]&&(ir=yr[2]|0,ir in Lt||(Lt[ir]=new at)));break;case"define":var wr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(vr[2]);wr&&(Lt[ir].name=wr[1]?V(wr[2]):wr[2]);break}Lt[ir].lines.push(new nt(Dt++,cr))}return Object.keys(Lt).forEach(function(Tr){var jr=Lt[Tr];jr.lines.forEach(function(mr){jr.index[mr.number]=mr})}),Lt}function Qe(N){var ge=[];return N.split(`
`).forEach(function(Be){if(!(Be.length<5)){var Dt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Be);Dt?ge.push(new Zt(Dt[1]|0,Dt[2]|0,Dt[3].trim())):Be.length>0&&ge.push(new Zt("unknown",0,Be))}}),ge}function Ct(N,ge){ge.forEach(function(Be){var Dt=N[Be.file];if(Dt){var ir=Dt.index[Be.line];if(ir){ir.errors.push(Be),Dt.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Be)})}function $e(N,ge,Be,Dt,ir){if(!N.getShaderParameter(ge,N.COMPILE_STATUS)){var Lt=N.getShaderInfoLog(ge),Jt=Dt===N.FRAGMENT_SHADER?"fragment":"vertex";De(Be,"string",Jt+" shader source must be a string",ir);var cr=ut(Be,ir),vr=Qe(Lt);Ct(cr,vr),Object.keys(cr).forEach(function(yr){var wr=cr[yr];if(!wr.hasErrors)return;var Tr=[""],jr=[""];function mr(Ar,st){Tr.push(Ar),jr.push(st||"")}mr("file number "+yr+": "+wr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),wr.lines.forEach(function(Ar){if(Ar.errors.length>0){mr(bt(Ar.number,4)+"|  ","background-color:yellow; font-weight:bold"),mr(Ar.line+he,"color:red; background-color:yellow; font-weight:bold");var st=0;Ar.errors.forEach(function(Vt){var _r=Vt.message,Nr=/^\s*'(.*)'\s*:\s*(.*)$/.exec(_r);if(Nr){var lr=Nr[1];switch(_r=Nr[2],lr){case"assign":lr="=";break}st=Math.max(Ar.line.indexOf(lr,st),0)}else st=0;mr(bt("| ",6)),mr(bt("^^^",st+3)+he,"font-weight:bold"),mr(bt("| ",6)),mr(_r+he,"font-weight:bold")}),mr(bt("| ",6)+he)}else mr(bt(Ar.number,4)+"|  "),mr(Ar.line+he,"color:red")}),typeof document!="undefined"&&!window.chrome?(jr[0]=Tr.join("%c"),console.log.apply(console,jr)):console.log(Tr.join(""))}),ce.raise("Error compiling "+Jt+" shader, "+cr[0].name)}}function Kt(N,ge,Be,Dt,ir){if(!N.getProgramParameter(ge,N.LINK_STATUS)){var Lt=N.getProgramInfoLog(ge),Jt=ut(Be,ir),cr=ut(Dt,ir),vr='Error linking program with vertex shader, "'+cr[0].name+'", and fragment shader "'+Jt[0].name+'"';typeof document!="undefined"?console.log("%c"+vr+he+"%c"+Lt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(vr+he+Lt),ce.raise(vr)}}function xr(N){N._commandRef=Y()}function kr(N,ge,Be,Dt){xr(N);function ir(vr){return vr?Dt.id(vr):0}N._fragId=ir(N.static.frag),N._vertId=ir(N.static.vert);function Lt(vr,yr){Object.keys(yr).forEach(function(wr){vr[Dt.id(wr)]=!0})}var Jt=N._uniformSet={};Lt(Jt,ge.static),Lt(Jt,ge.dynamic);var cr=N._attributeSet={};Lt(cr,Be.static),Lt(cr,Be.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function Kr(N,ge){var Be=qt();ue(N+" in command "+(ge||Y())+(Be==="unknown"?"":" called from "+Be))}function A(N,ge,Be){N||Kr(ge,Be||Y())}function Ae(N,ge,Be,Dt){N in ge||Kr("unknown parameter ("+N+")"+Le(Be)+". possible values: "+Object.keys(ge).join(),Dt||Y())}function De(N,ge,Be,Dt){Je(N,ge)||Kr("invalid parameter type"+Le(Be)+". expected "+ge+", got "+typeof N,Dt||Y())}function At(N){N()}function mt(N,ge,Be){N.texture?tr(N.texture._texture.internalformat,ge,"unsupported texture format for attachment"):tr(N.renderbuffer._renderbuffer.format,Be,"unsupported renderbuffer format for attachment")}var Ft=33071,Yt=9728,Sr=9984,qn=9985,hn=9986,fi=9987,Gn=5120,ni=5121,pi=5122,Wn=5123,hi=5124,ua=5125,Gi=5126,Di=32819,$i=32820,la=33635,Mi=34042,ma=36193,Xn={};Xn[Gn]=Xn[ni]=1,Xn[pi]=Xn[Wn]=Xn[ma]=Xn[la]=Xn[Di]=Xn[$i]=2,Xn[hi]=Xn[ua]=Xn[Gi]=Xn[Mi]=4;function Si(N,ge){return N===$i||N===Di||N===la?2:N===Mi?4:Xn[N]*ge}function Zi(N){return!(N&N-1)&&!!N}function Qi(N,ge,Be){var Dt,ir=ge.width,Lt=ge.height,Jt=ge.channels;ce(ir>0&&ir<=Be.maxTextureSize&&Lt>0&&Lt<=Be.maxTextureSize,"invalid texture shape"),(N.wrapS!==Ft||N.wrapT!==Ft)&&ce(Zi(ir)&&Zi(Lt),"incompatible wrap mode for texture, both width and height must be power of 2"),ge.mipmask===1?ir!==1&&Lt!==1&&ce(N.minFilter!==Sr&&N.minFilter!==hn&&N.minFilter!==qn&&N.minFilter!==fi,"min filter requires mipmap"):(ce(Zi(ir)&&Zi(Lt),"texture must be a square power of 2 to support mipmapping"),ce(ge.mipmask===(ir<<1)-1,"missing or incomplete mipmap data")),ge.type===Gi&&(Be.extensions.indexOf("oes_texture_float_linear")<0&&ce(N.minFilter===Yt&&N.magFilter===Yt,"filter not supported, must enable oes_texture_float_linear"),ce(!N.genMipmaps,"mipmap generation not supported with float textures"));var cr=ge.images;for(Dt=0;Dt<16;++Dt)if(cr[Dt]){var vr=ir>>Dt,yr=Lt>>Dt;ce(ge.mipmask&1<<Dt,"missing mipmap data");var wr=cr[Dt];if(ce(wr.width===vr&&wr.height===yr,"invalid shape for mip images"),ce(wr.format===ge.format&&wr.internalformat===ge.internalformat&&wr.type===ge.type,"incompatible type for mip image"),!wr.compressed)if(wr.data){var Tr=Math.ceil(Si(wr.type,Jt)*vr/wr.unpackAlignment)*wr.unpackAlignment;ce(wr.data.byteLength===Tr*yr,"invalid data for image, buffer size is inconsistent with image format")}else wr.element||wr.copy}else N.genMipmaps||ce((ge.mipmask&1<<Dt)==0,"extra mipmap data");ge.compressed&&ce(!N.genMipmaps,"mipmap generation for compressed images not supported")}function ko(N,ge,Be,Dt){var ir=N.width,Lt=N.height,Jt=N.channels;ce(ir>0&&ir<=Dt.maxTextureSize&&Lt>0&&Lt<=Dt.maxTextureSize,"invalid texture shape"),ce(ir===Lt,"cube map must be square"),ce(ge.wrapS===Ft&&ge.wrapT===Ft,"wrap mode not supported by cube map");for(var cr=0;cr<Be.length;++cr){var vr=Be[cr];ce(vr.width===ir&&vr.height===Lt,"inconsistent cube map face shape"),ge.genMipmaps&&(ce(!vr.compressed,"can not generate mipmap for compressed textures"),ce(vr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var yr=vr.images,wr=0;wr<16;++wr){var Tr=yr[wr];if(Tr){var jr=ir>>wr,mr=Lt>>wr;ce(vr.mipmask&1<<wr,"missing mipmap data"),ce(Tr.width===jr&&Tr.height===mr,"invalid shape for mip images"),ce(Tr.format===N.format&&Tr.internalformat===N.internalformat&&Tr.type===N.type,"incompatible type for mip image"),Tr.compressed||(Tr.data?ce(Tr.data.byteLength===jr*mr*Math.max(Si(Tr.type,Jt),Tr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Tr.element||Tr.copy)}}}}var me=m(ce,{optional:At,raise:ue,commandRaise:Kr,command:A,parameter:ee,commandParameter:Ae,constructor:Wt,type:Ze,commandType:De,isTypedArray:Xe,nni:gt,oneOf:tr,shaderError:$e,linkError:Kt,callSite:qt,saveCommandRef:xr,saveDrawInfo:kr,framebufferFormat:mt,guessCommand:Y,texture2D:Qi,textureCube:ko}),kn=0,Ha=0,ns=5,Bt=6;function rr(N,ge){this.id=kn++,this.type=N,this.data=ge}function Cr(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Qr(N){if(N.length===0)return[];var ge=N.charAt(0),Be=N.charAt(N.length-1);if(N.length>1&&ge===Be&&(ge==='"'||ge==="'"))return['"'+Cr(N.substr(1,N.length-2))+'"'];var Dt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(Dt)return Qr(N.substr(0,Dt.index)).concat(Qr(Dt[1])).concat(Qr(N.substr(Dt.index+Dt[0].length)));var ir=N.split(".");if(ir.length===1)return['"'+Cr(N)+'"'];for(var Lt=[],Jt=0;Jt<ir.length;++Jt)Lt=Lt.concat(Qr(ir[Jt]));return Lt}function Sn(N){return"["+Qr(N).join("][")+"]"}function Fn(N,ge){return new rr(N,Sn(ge+""))}function di(N){return typeof N=="function"&&!N._reglType||N instanceof rr}function Kn(N,ge){if(typeof N=="function")return new rr(Ha,N);if(typeof N=="number"||typeof N=="boolean")return new rr(ns,N);if(Array.isArray(N))return new rr(Bt,N.map(function(Be,Dt){return Kn(Be,ge+"["+Dt+"]")}));if(N instanceof rr)return N;me(!1,"invalid option type in uniform "+ge)}var an={DynamicVariable:rr,define:Fn,isDynamic:di,unbox:Kn,accessor:Sn},Fi={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Li=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,ao=Li?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function vs(){var N={"":0},ge=[""];return{id:function(Be){var Dt=N[Be];return Dt||(Dt=N[Be]=ge.length,ge.push(Be),Dt)},str:function(Be){return ge[Be]}}}function Zo(N,ge,Be){var Dt=document.createElement("canvas");m(Dt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(Dt),N===document.body&&(Dt.style.position="absolute",m(N.style,{margin:0,padding:0}));function ir(){var cr=window.innerWidth,vr=window.innerHeight;if(N!==document.body){var yr=Dt.getBoundingClientRect();cr=yr.right-yr.left,vr=yr.bottom-yr.top}Dt.width=Be*cr,Dt.height=Be*vr}var Lt;N!==document.body&&typeof ResizeObserver=="function"?(Lt=new ResizeObserver(function(){setTimeout(ir)}),Lt.observe(N)):window.addEventListener("resize",ir,!1);function Jt(){Lt?Lt.disconnect():window.removeEventListener("resize",ir),N.removeChild(Dt)}return ir(),{canvas:Dt,onDestroy:Jt}}function za(N,ge){function Be(Dt){try{return N.getContext(Dt,ge)}catch(ir){return null}}return Be("webgl")||Be("experimental-webgl")||Be("webgl-experimental")}function ba(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function H(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function J(N){return typeof N=="string"?N.split():(me(Array.isArray(N),"invalid extension array"),N)}function ae(N){return typeof N=="string"?(me(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function ye(N){var ge=N||{},Be,Dt,ir,Lt,Jt={},cr=[],vr=[],yr=typeof window=="undefined"?1:window.devicePixelRatio,wr=!1,Tr=function(Ar){Ar&&me.raise(Ar)},jr=function(){};if(typeof ge=="string"?(me(typeof document!="undefined","selector queries only supported in DOM environments"),Be=document.querySelector(ge),me(Be,"invalid query string for element")):typeof ge=="object"?ba(ge)?Be=ge:H(ge)?(Lt=ge,ir=Lt.canvas):(me.constructor(ge),"gl"in ge?Lt=ge.gl:"canvas"in ge?ir=ae(ge.canvas):"container"in ge&&(Dt=ae(ge.container)),"attributes"in ge&&(Jt=ge.attributes,me.type(Jt,"object","invalid context attributes")),"extensions"in ge&&(cr=J(ge.extensions)),"optionalExtensions"in ge&&(vr=J(ge.optionalExtensions)),"onDone"in ge&&(me.type(ge.onDone,"function","invalid or missing onDone callback"),Tr=ge.onDone),"profile"in ge&&(wr=!!ge.profile),"pixelRatio"in ge&&(yr=+ge.pixelRatio,me(yr>0,"invalid pixel ratio"))):me.raise("invalid arguments to regl"),Be&&(Be.nodeName.toLowerCase()==="canvas"?ir=Be:Dt=Be),!Lt){if(!ir){me(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var mr=Zo(Dt||document.body,Tr,yr);if(!mr)return null;ir=mr.canvas,jr=mr.onDestroy}Jt.premultipliedAlpha===void 0&&(Jt.premultipliedAlpha=!0),Lt=za(ir,Jt)}return Lt?{gl:Lt,canvas:ir,container:Dt,extensions:cr,optionalExtensions:vr,pixelRatio:yr,profile:wr,onDone:Tr,onDestroy:jr}:(jr(),Tr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Pe(N,ge){var Be={};function Dt(cr){me.type(cr,"string","extension name must be string");var vr=cr.toLowerCase(),yr;try{yr=Be[vr]=ir(cr)}catch(wr){}return!!yr}function ir(cr){return N.getExtension(cr)?N.getExtension(cr):N.getExtension(cr.toLowerCase())?N.getExtension(cr.toLowerCase()):null}for(var Lt=0;Lt<ge.extensions.length;++Lt){var Jt=ge.extensions[Lt];if(!Dt(Jt))return ge.onDestroy(),ge.onDone('"'+Jt+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ge.optionalExtensions.forEach(Dt),{extensions:Be,restore:function(){Object.keys(Be).forEach(function(cr){if(Be[cr]&&!Dt(cr))throw new Error("(regl): error restoring extension "+cr)})}}}function He(N,ge){for(var Be=Array(N),Dt=0;Dt<N;++Dt)Be[Dt]=ge(Dt);return Be}var tt=5120,fe=5121,ke=5122,ht=5123,pr=5124,kt=5125,Nt=5126;function hr(N){for(var ge=16;ge<=1<<28;ge*=16)if(N<=ge)return ge;return 0}function _n(N){var ge,Be;return ge=(N>65535)<<4,N>>>=ge,Be=(N>255)<<3,N>>>=Be,ge|=Be,Be=(N>15)<<2,N>>>=Be,ge|=Be,Be=(N>3)<<1,N>>>=Be,ge|=Be,ge|N>>1}function fn(){var N=He(8,function(){return[]});function ge(Lt){var Jt=hr(Lt),cr=N[_n(Jt)>>2];return cr.length>0?cr.pop():new ArrayBuffer(Jt)}function Be(Lt){N[_n(Lt.byteLength)>>2].push(Lt)}function Dt(Lt,Jt){var cr=null;switch(Lt){case tt:cr=new Int8Array(ge(Jt),0,Jt);break;case fe:cr=new Uint8Array(ge(Jt),0,Jt);break;case ke:cr=new Int16Array(ge(2*Jt),0,Jt);break;case ht:cr=new Uint16Array(ge(2*Jt),0,Jt);break;case pr:cr=new Int32Array(ge(4*Jt),0,Jt);break;case kt:cr=new Uint32Array(ge(4*Jt),0,Jt);break;case Nt:cr=new Float32Array(ge(4*Jt),0,Jt);break;default:return null}return cr.length!==Jt?cr.subarray(0,Jt):cr}function ir(Lt){Be(Lt.buffer)}return{alloc:ge,free:Be,allocType:Dt,freeType:ir}}var Pt=fn();Pt.zero=fn();var Jr=3408,Br=3410,Hr=3411,gi=3412,en=3413,yn=3414,Xi=3415,vi=33901,Pi=33902,xi=3379,dt=3386,It=34921,Ta=36347,Ci=36348,Ii=35661,ji=35660,Ir=34930,on=36349,_t=34076,na=34024,de=7936,Ko=7937,ra=7938,_u=35724,Ua=34047,Ma=36063,Ka=34852,ia=3553,Ao=34067,jo=34069,Cu=33984,vo=6408,Do=5126,aa=5121,$a=36160,Fo=36053,Qa=36064,ws=16384,wl=function(N,ge){var Be=1;ge.ext_texture_filter_anisotropic&&(Be=N.getParameter(Ua));var Dt=1,ir=1;ge.webgl_draw_buffers&&(Dt=N.getParameter(Ka),ir=N.getParameter(Ma));var Lt=!!ge.oes_texture_float;if(Lt){var Jt=N.createTexture();N.bindTexture(ia,Jt),N.texImage2D(ia,0,vo,1,1,0,vo,Do,null);var cr=N.createFramebuffer();if(N.bindFramebuffer($a,cr),N.framebufferTexture2D($a,Qa,ia,Jt,0),N.bindTexture(ia,null),N.checkFramebufferStatus($a)!==Fo)Lt=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(ws);var vr=Pt.allocType(Do,4);N.readPixels(0,0,1,1,vo,Do,vr),N.getError()?Lt=!1:(N.deleteFramebuffer(cr),N.deleteTexture(Jt),Lt=vr[0]===1),Pt.freeType(vr)}}var yr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),wr=!0;if(!yr){var Tr=N.createTexture(),jr=Pt.allocType(aa,36);N.activeTexture(Cu),N.bindTexture(Ao,Tr),N.texImage2D(jo,0,vo,3,3,0,vo,aa,jr),Pt.freeType(jr),N.bindTexture(Ao,null),N.deleteTexture(Tr),wr=!N.getError()}return{colorBits:[N.getParameter(Br),N.getParameter(Hr),N.getParameter(gi),N.getParameter(en)],depthBits:N.getParameter(yn),stencilBits:N.getParameter(Xi),subpixelBits:N.getParameter(Jr),extensions:Object.keys(ge).filter(function(mr){return!!ge[mr]}),maxAnisotropic:Be,maxDrawbuffers:Dt,maxColorAttachments:ir,pointSizeDims:N.getParameter(vi),lineWidthDims:N.getParameter(Pi),maxViewportDims:N.getParameter(dt),maxCombinedTextureUnits:N.getParameter(Ii),maxCubeMapSize:N.getParameter(_t),maxRenderbufferSize:N.getParameter(na),maxTextureUnits:N.getParameter(Ir),maxTextureSize:N.getParameter(xi),maxAttributes:N.getParameter(It),maxVertexUniforms:N.getParameter(Ta),maxVertexTextureUnits:N.getParameter(ji),maxVaryingVectors:N.getParameter(Ci),maxFragmentUniforms:N.getParameter(on),glsl:N.getParameter(_u),renderer:N.getParameter(Ko),vendor:N.getParameter(de),version:N.getParameter(ra),readFloat:Lt,npotTextureCube:wr}};function ms(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||re(N.data))}var ne=function(N){return Object.keys(N).map(function(ge){return N[ge]})},be={shape:oo,flatten:Oi};function Ye(N,ge,Be){for(var Dt=0;Dt<ge;++Dt)Be[Dt]=N[Dt]}function Rt(N,ge,Be,Dt){for(var ir=0,Lt=0;Lt<ge;++Lt)for(var Jt=N[Lt],cr=0;cr<Be;++cr)Dt[ir++]=Jt[cr]}function Or(N,ge,Be,Dt,ir,Lt){for(var Jt=Lt,cr=0;cr<ge;++cr)for(var vr=N[cr],yr=0;yr<Be;++yr)for(var wr=vr[yr],Tr=0;Tr<Dt;++Tr)ir[Jt++]=wr[Tr]}function Pn(N,ge,Be,Dt,ir){for(var Lt=1,Jt=Be+1;Jt<ge.length;++Jt)Lt*=ge[Jt];var cr=ge[Be];if(ge.length-Be==4){var vr=ge[Be+1],yr=ge[Be+2],wr=ge[Be+3];for(Jt=0;Jt<cr;++Jt)Or(N[Jt],vr,yr,wr,Dt,ir),ir+=Lt}else for(Jt=0;Jt<cr;++Jt)Pn(N[Jt],ge,Be+1,Dt,ir),ir+=Lt}function Oi(N,ge,Be,Dt){var ir=1;if(ge.length)for(var Lt=0;Lt<ge.length;++Lt)ir*=ge[Lt];else ir=0;var Jt=Dt||Pt.allocType(Be,ir);switch(ge.length){case 0:break;case 1:Ye(N,ge[0],Jt);break;case 2:Rt(N,ge[0],ge[1],Jt);break;case 3:Or(N,ge[0],ge[1],ge[2],Jt,0);break;default:Pn(N,ge,0,Jt,0)}return Jt}function oo(N){for(var ge=[],Be=N;Be.length;Be=Be[0])ge.push(Be.length);return ge}var La={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Za=5120,Vo=5122,gs=5124,lo=5121,wo=5123,ys=5125,Ts=5126,Fs=5126,uu={int8:Za,int16:Vo,int32:gs,uint8:lo,uint16:wo,uint32:ys,float:Ts,float32:Fs},_s=35048,ga=35040,xa={dynamic:_s,stream:ga,static:35044},is=be.flatten,hf=be.shape,Tl=35044,Xs=35040,tc=5121,Wu=5126,Ys=[];Ys[5120]=1,Ys[5122]=2,Ys[5124]=4,Ys[5121]=1,Ys[5123]=2,Ys[5125]=4,Ys[5126]=4;function al(N){return La[Object.prototype.toString.call(N)]|0}function _(N,ge){for(var Be=0;Be<ge.length;++Be)N[Be]=ge[Be]}function M(N,ge,Be,Dt,ir,Lt,Jt){for(var cr=0,vr=0;vr<Be;++vr)for(var yr=0;yr<Dt;++yr)N[cr++]=ge[ir*vr+Lt*yr+Jt]}function B(N,ge,Be,Dt){var ir=0,Lt={};function Jt(st){this.id=ir++,this.buffer=N.createBuffer(),this.type=st,this.usage=Tl,this.byteLength=0,this.dimension=1,this.dtype=tc,this.persistentData=null,Be.profile&&(this.stats={size:0})}Jt.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},Jt.prototype.destroy=function(){jr(this)};var cr=[];function vr(st,Vt){var _r=cr.pop();return _r||(_r=new Jt(st)),_r.bind(),Tr(_r,Vt,Xs,0,1,!1),_r}function yr(st){cr.push(st)}function wr(st,Vt,_r){st.byteLength=Vt.byteLength,N.bufferData(st.type,Vt,_r)}function Tr(st,Vt,_r,Nr,lr,Rr){var qr;if(st.usage=_r,Array.isArray(Vt)){if(st.dtype=Nr||Wu,Vt.length>0){var Bn;if(Array.isArray(Vt[0])){qr=hf(Vt);for(var er=1,nr=1;nr<qr.length;++nr)er*=qr[nr];st.dimension=er,Bn=is(Vt,qr,st.dtype),wr(st,Bn,_r),Rr?st.persistentData=Bn:Pt.freeType(Bn)}else if(typeof Vt[0]=="number"){st.dimension=lr;var xn=Pt.allocType(st.dtype,Vt.length);_(xn,Vt),wr(st,xn,_r),Rr?st.persistentData=xn:Pt.freeType(xn)}else re(Vt[0])?(st.dimension=Vt[0].length,st.dtype=Nr||al(Vt[0])||Wu,Bn=is(Vt,[Vt.length,Vt[0].length],st.dtype),wr(st,Bn,_r),Rr?st.persistentData=Bn:Pt.freeType(Bn)):me.raise("invalid buffer data")}}else if(re(Vt))st.dtype=Nr||al(Vt),st.dimension=lr,wr(st,Vt,_r),Rr&&(st.persistentData=new Uint8Array(new Uint8Array(Vt.buffer)));else if(ms(Vt)){qr=Vt.shape;var Vr=Vt.stride,Er=Vt.offset,Xr=0,Yr=0,yi=0,oi=0;qr.length===1?(Xr=qr[0],Yr=1,yi=Vr[0],oi=0):qr.length===2?(Xr=qr[0],Yr=qr[1],yi=Vr[0],oi=Vr[1]):me.raise("invalid shape"),st.dtype=Nr||al(Vt.data)||Wu,st.dimension=Yr;var Gr=Pt.allocType(st.dtype,Xr*Yr);M(Gr,Vt.data,Xr,Yr,yi,oi,Er),wr(st,Gr,_r),Rr?st.persistentData=Gr:Pt.freeType(Gr)}else Vt instanceof ArrayBuffer?(st.dtype=tc,st.dimension=lr,wr(st,Vt,_r),Rr&&(st.persistentData=new Uint8Array(new Uint8Array(Vt)))):me.raise("invalid buffer data")}function jr(st){ge.bufferCount--,Dt(st);var Vt=st.buffer;me(Vt,"buffer must not be deleted already"),N.deleteBuffer(Vt),st.buffer=null,delete Lt[st.id]}function mr(st,Vt,_r,Nr){ge.bufferCount++;var lr=new Jt(Vt);Lt[lr.id]=lr;function Rr(er){var nr=Tl,xn=null,Vr=0,Er=0,Xr=1;return Array.isArray(er)||re(er)||ms(er)||er instanceof ArrayBuffer?xn=er:typeof er=="number"?Vr=er|0:er&&(me.type(er,"object","buffer arguments must be an object, a number or an array"),"data"in er&&(me(xn===null||Array.isArray(xn)||re(xn)||ms(xn),"invalid data for buffer"),xn=er.data),"usage"in er&&(me.parameter(er.usage,xa,"invalid buffer usage"),nr=xa[er.usage]),"type"in er&&(me.parameter(er.type,uu,"invalid buffer type"),Er=uu[er.type]),"dimension"in er&&(me.type(er.dimension,"number","invalid dimension"),Xr=er.dimension|0),"length"in er&&(me.nni(Vr,"buffer length must be a nonnegative integer"),Vr=er.length|0)),lr.bind(),xn?Tr(lr,xn,nr,Er,Xr,Nr):(Vr&&N.bufferData(lr.type,Vr,nr),lr.dtype=Er||tc,lr.usage=nr,lr.dimension=Xr,lr.byteLength=Vr),Be.profile&&(lr.stats.size=lr.byteLength*Ys[lr.dtype]),Rr}function qr(er,nr){me(nr+er.byteLength<=lr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+er.byteLength+" starting from offset "+nr+" to a buffer of size "+lr.byteLength),N.bufferSubData(lr.type,nr,er)}function Bn(er,nr){var xn=(nr||0)|0,Vr;if(lr.bind(),re(er)||er instanceof ArrayBuffer)qr(er,xn);else if(Array.isArray(er)){if(er.length>0)if(typeof er[0]=="number"){var Er=Pt.allocType(lr.dtype,er.length);_(Er,er),qr(Er,xn),Pt.freeType(Er)}else if(Array.isArray(er[0])||re(er[0])){Vr=hf(er);var Xr=is(er,Vr,lr.dtype);qr(Xr,xn),Pt.freeType(Xr)}else me.raise("invalid buffer data")}else if(ms(er)){Vr=er.shape;var Yr=er.stride,yi=0,oi=0,Gr=0,rn=0;Vr.length===1?(yi=Vr[0],oi=1,Gr=Yr[0],rn=0):Vr.length===2?(yi=Vr[0],oi=Vr[1],Gr=Yr[0],rn=Yr[1]):me.raise("invalid shape");var Jn=Array.isArray(er.data)?lr.dtype:al(er.data),ci=Pt.allocType(Jn,yi*oi);M(ci,er.data,yi,oi,Gr,rn,er.offset),qr(ci,xn),Pt.freeType(ci)}else me.raise("invalid data for buffer subdata");return Rr}return _r||Rr(st),Rr._reglType="buffer",Rr._buffer=lr,Rr.subdata=Bn,Be.profile&&(Rr.stats=lr.stats),Rr.destroy=function(){jr(lr)},Rr}function Ar(){ne(Lt).forEach(function(st){st.buffer=N.createBuffer(),N.bindBuffer(st.type,st.buffer),N.bufferData(st.type,st.persistentData||st.byteLength,st.usage)})}return Be.profile&&(ge.getTotalBufferSize=function(){var st=0;return Object.keys(Lt).forEach(function(Vt){st+=Lt[Vt].stats.size}),st}),{create:mr,createStream:vr,destroyStream:yr,clear:function(){ne(Lt).forEach(jr),cr.forEach(jr)},getBuffer:function(st){return st&&st._buffer instanceof Jt?st._buffer:null},restore:Ar,_initBuffer:Tr}}var O=0,$=0,xe=1,We=1,ft=4,pt=4,ar={points:O,point:$,lines:xe,line:We,triangles:ft,triangle:pt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ur=0,Tn=1,ii=4,Rn=5120,Yi=5121,da=5122,Ca=5123,Hi=5124,xs=5125,lu=34963,Xu=35040,df=35044;function ol(N,ge,Be,Dt){var ir={},Lt=0,Jt={uint8:Yi,uint16:Ca};ge.oes_element_index_uint&&(Jt.uint32=xs);function cr(Ar){this.id=Lt++,ir[this.id]=this,this.buffer=Ar,this.primType=ii,this.vertCount=0,this.type=0}cr.prototype.bind=function(){this.buffer.bind()};var vr=[];function yr(Ar){var st=vr.pop();return st||(st=new cr(Be.create(null,lu,!0,!1)._buffer)),Tr(st,Ar,Xu,-1,-1,0,0),st}function wr(Ar){vr.push(Ar)}function Tr(Ar,st,Vt,_r,Nr,lr,Rr){Ar.buffer.bind();var qr;if(st){var Bn=Rr;!Rr&&(!re(st)||ms(st)&&!re(st.data))&&(Bn=ge.oes_element_index_uint?xs:Ca),Be._initBuffer(Ar.buffer,st,Vt,Bn,3)}else N.bufferData(lu,lr,Vt),Ar.buffer.dtype=qr||Yi,Ar.buffer.usage=Vt,Ar.buffer.dimension=3,Ar.buffer.byteLength=lr;if(qr=Rr,!Rr){switch(Ar.buffer.dtype){case Yi:case Rn:qr=Yi;break;case Ca:case da:qr=Ca;break;case xs:case Hi:qr=xs;break;default:me.raise("unsupported type for element array")}Ar.buffer.dtype=qr}Ar.type=qr,me(qr!==xs||!!ge.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var er=Nr;er<0&&(er=Ar.buffer.byteLength,qr===Ca?er>>=1:qr===xs&&(er>>=2)),Ar.vertCount=er;var nr=_r;if(_r<0){nr=ii;var xn=Ar.buffer.dimension;xn===1&&(nr=ur),xn===2&&(nr=Tn),xn===3&&(nr=ii)}Ar.primType=nr}function jr(Ar){Dt.elementsCount--,me(Ar.buffer!==null,"must not double destroy elements"),delete ir[Ar.id],Ar.buffer.destroy(),Ar.buffer=null}function mr(Ar,st){var Vt=Be.create(null,lu,!0),_r=new cr(Vt._buffer);Dt.elementsCount++;function Nr(lr){if(!lr)Vt(),_r.primType=ii,_r.vertCount=0,_r.type=Yi;else if(typeof lr=="number")Vt(lr),_r.primType=ii,_r.vertCount=lr|0,_r.type=Yi;else{var Rr=null,qr=df,Bn=-1,er=-1,nr=0,xn=0;Array.isArray(lr)||re(lr)||ms(lr)?Rr=lr:(me.type(lr,"object","invalid arguments for elements"),"data"in lr&&(Rr=lr.data,me(Array.isArray(Rr)||re(Rr)||ms(Rr),"invalid data for element buffer")),"usage"in lr&&(me.parameter(lr.usage,xa,"invalid element buffer usage"),qr=xa[lr.usage]),"primitive"in lr&&(me.parameter(lr.primitive,ar,"invalid element buffer primitive"),Bn=ar[lr.primitive]),"count"in lr&&(me(typeof lr.count=="number"&&lr.count>=0,"invalid vertex count for elements"),er=lr.count|0),"type"in lr&&(me.parameter(lr.type,Jt,"invalid buffer type"),xn=Jt[lr.type]),"length"in lr?nr=lr.length|0:(nr=er,xn===Ca||xn===da?nr*=2:(xn===xs||xn===Hi)&&(nr*=4))),Tr(_r,Rr,qr,Bn,er,nr,xn)}return Nr}return Nr(Ar),Nr._reglType="elements",Nr._elements=_r,Nr.subdata=function(lr,Rr){return Vt.subdata(lr,Rr),Nr},Nr.destroy=function(){jr(_r)},Nr}return{create:mr,createStream:yr,destroyStream:wr,getElements:function(Ar){return typeof Ar=="function"&&Ar._elements instanceof cr?Ar._elements:null},clear:function(){ne(ir).forEach(jr)}}}var kc=new Float32Array(1),Au=new Uint32Array(kc.buffer),wu=5123;function Tu(N){for(var ge=Pt.allocType(wu,N.length),Be=0;Be<N.length;++Be)if(isNaN(N[Be]))ge[Be]=65535;else if(N[Be]===Infinity)ge[Be]=31744;else if(N[Be]===-Infinity)ge[Be]=64512;else{kc[0]=N[Be];var Dt=Au[0],ir=Dt>>>31<<15,Lt=(Dt<<1>>>24)-127,Jt=Dt>>13&(1<<10)-1;if(Lt<-24)ge[Be]=ir;else if(Lt<-14){var cr=-14-Lt;ge[Be]=ir+(Jt+(1<<10)>>cr)}else Lt>15?ge[Be]=ir+31744:ge[Be]=ir+(Lt+15<<10)+Jt}return ge}function co(N){return Array.isArray(N)||re(N)}var jf=function(N){return!(N&N-1)&&!!N},Vf=34467,$o=3553,Dc=34067,Mu=34069,cu=6408,vf=6406,Ml=6407,Ni=6409,Pl=6410,Cp=32854,sl=32855,Fc=36194,Gf=32819,Ap=32820,Hf=33635,Bc=34042,rc=6402,nc=34041,Il=35904,ul=35906,Ol=36193,Yu=33776,qs=33777,mf=33778,gf=33779,Wf=35986,fu=35987,ic=34798,Nc=35840,yf=35841,Rl=35842,uh=35843,_f=36196,Ll=5121,xf=5123,bf=5125,kl=5126,zc=10242,wp=10243,Tp=10497,ac=33071,Mp=33648,Dl=10240,Ji=10241,oc=9728,ca=9729,Pu=9984,qi=9985,Pa=9986,bs=9987,Uc=33170,qu=4352,ja=4353,sc=4354,Fl=34046,Ku=3317,Zc=37440,Iu=37441,mo=37443,Bl=37444,uc=33984,go=[Pu,Pa,qi,bs],dn=[0,Ni,Pl,Ml,cu],fo={};fo[Ni]=fo[vf]=fo[rc]=1,fo[nc]=fo[Pl]=2,fo[Ml]=fo[Il]=3,fo[cu]=fo[ul]=4;function $u(N){return"[object "+N+"]"}var ka=$u("HTMLCanvasElement"),Ks=$u("OffscreenCanvas"),Ms=$u("CanvasRenderingContext2D"),Ef=$u("ImageBitmap"),Zr=$u("HTMLImageElement"),lc=$u("HTMLVideoElement"),Sf=Object.keys(La).concat([ka,Ks,Ms,Ef,Zr,lc]),ll=[];ll[Ll]=1,ll[kl]=4,ll[Ol]=2,ll[xf]=2,ll[bf]=4;var Aa=[];Aa[Cp]=2,Aa[sl]=2,Aa[Fc]=2,Aa[nc]=4,Aa[Yu]=.5,Aa[qs]=.5,Aa[mf]=1,Aa[gf]=1,Aa[Wf]=.5,Aa[fu]=1,Aa[ic]=1,Aa[Nc]=.5,Aa[yf]=.25,Aa[Rl]=.5,Aa[uh]=.25,Aa[_f]=.5;function Es(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function Cf(N){if(!Array.isArray(N))return!1;var ge=N.length;return!(ge===0||!co(N[0]))}function Ou(N){return Object.prototype.toString.call(N)}function Bs(N){return Ou(N)===ka}function Ru(N){return Ou(N)===Ks}function Xf(N){return Ou(N)===Ms}function cl(N){return Ou(N)===Ef}function Yf(N){return Ou(N)===Zr}function Af(N){return Ou(N)===lc}function pu(N){var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ge&&N&&N.getContext)}function Ps(N){var ge=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return!!(ge&&N&&"src"in N&&"crossOrigin"in N)}function Ti(N){if(!N)return!1;if(pu(N)||Ps(N))return!0;var ge=Ou(N);return Sf.indexOf(ge)>=0?!0:Es(N)||Cf(N)||ms(N)}function Lu(N){return La[Object.prototype.toString.call(N)]|0}function hu(N,ge){var Be=ge.length;switch(N.type){case Ll:case xf:case bf:case kl:var Dt=Pt.allocType(N.type,Be);Dt.set(ge),N.data=Dt;break;case Ol:N.data=Tu(ge);break;default:me.raise("unsupported texture type, must specify a typed array")}}function Go(N,ge){return Pt.allocType(N.type===Ol?kl:N.type,ge)}function fl(N,ge){N.type===Ol?(N.data=Tu(ge),Pt.freeType(ge)):N.data=ge}function as(N,ge,Be,Dt,ir,Lt){for(var Jt=N.width,cr=N.height,vr=N.channels,yr=Jt*cr*vr,wr=Go(N,yr),Tr=0,jr=0;jr<cr;++jr)for(var mr=0;mr<Jt;++mr)for(var Ar=0;Ar<vr;++Ar)wr[Tr++]=ge[Be*mr+Dt*jr+ir*Ar+Lt];fl(N,wr)}function $s(N,ge,Be,Dt,ir,Lt){var Jt;if(typeof Aa[N]!="undefined"?Jt=Aa[N]:Jt=fo[N]*ll[ge],Lt&&(Jt*=6),ir){for(var cr=0,vr=Be;vr>=1;)cr+=Jt*vr*vr,vr/=2;return cr}else return Jt*Be*Dt}function Ss(N,ge,Be,Dt,ir,Lt,Jt){var cr={"don't care":qu,"dont care":qu,nice:sc,fast:ja},vr={repeat:Tp,clamp:ac,mirror:Mp},yr={nearest:oc,linear:ca},wr=m({mipmap:bs,"nearest mipmap nearest":Pu,"linear mipmap nearest":qi,"nearest mipmap linear":Pa,"linear mipmap linear":bs},yr),Tr={none:0,browser:Bl},jr={uint8:Ll,rgba4:Gf,rgb565:Hf,"rgb5 a1":Ap},mr={alpha:vf,luminance:Ni,"luminance alpha":Pl,rgb:Ml,rgba:cu,rgba4:Cp,"rgb5 a1":sl,rgb565:Fc},Ar={};ge.ext_srgb&&(mr.srgb=Il,mr.srgba=ul),ge.oes_texture_float&&(jr.float32=jr.float=kl),ge.oes_texture_half_float&&(jr.float16=jr["half float"]=Ol),ge.webgl_depth_texture&&(m(mr,{depth:rc,"depth stencil":nc}),m(jr,{uint16:xf,uint32:bf,"depth stencil":Bc})),ge.webgl_compressed_texture_s3tc&&m(Ar,{"rgb s3tc dxt1":Yu,"rgba s3tc dxt1":qs,"rgba s3tc dxt3":mf,"rgba s3tc dxt5":gf}),ge.webgl_compressed_texture_atc&&m(Ar,{"rgb atc":Wf,"rgba atc explicit alpha":fu,"rgba atc interpolated alpha":ic}),ge.webgl_compressed_texture_pvrtc&&m(Ar,{"rgb pvrtc 4bppv1":Nc,"rgb pvrtc 2bppv1":yf,"rgba pvrtc 4bppv1":Rl,"rgba pvrtc 2bppv1":uh}),ge.webgl_compressed_texture_etc1&&(Ar["rgb etc1"]=_f);var st=Array.prototype.slice.call(N.getParameter(Vf)||new Uint32Array(0));Object.keys(Ar).forEach(function(Te){var zt=Ar[Te];st.indexOf(zt)>=0&&(mr[Te]=zt)});var Vt=Object.keys(mr);Be.textureFormats=Vt;var _r=[];Object.keys(mr).forEach(function(Te){var zt=mr[Te];_r[zt]=Te});var Nr=[];Object.keys(jr).forEach(function(Te){var zt=jr[Te];Nr[zt]=Te});var lr=[];Object.keys(yr).forEach(function(Te){var zt=yr[Te];lr[zt]=Te});var Rr=[];Object.keys(wr).forEach(function(Te){var zt=wr[Te];Rr[zt]=Te});var qr=[];Object.keys(vr).forEach(function(Te){var zt=vr[Te];qr[zt]=Te});var Bn=Vt.reduce(function(Te,zt){var Et=mr[zt];return Et===Ni||Et===vf||Et===Ni||Et===Pl||Et===rc||Et===nc||ge.ext_srgb&&(Et===Il||Et===ul)?Te[Et]=Et:Et===sl||zt.indexOf("rgba")>=0?Te[Et]=cu:Te[Et]=Ml,Te},{});function er(){this.internalformat=cu,this.format=cu,this.type=Ll,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Bl,this.width=0,this.height=0,this.channels=0}function nr(Te,zt){Te.internalformat=zt.internalformat,Te.format=zt.format,Te.type=zt.type,Te.compressed=zt.compressed,Te.premultiplyAlpha=zt.premultiplyAlpha,Te.flipY=zt.flipY,Te.unpackAlignment=zt.unpackAlignment,Te.colorSpace=zt.colorSpace,Te.width=zt.width,Te.height=zt.height,Te.channels=zt.channels}function xn(Te,zt){if(!(typeof zt!="object"||!zt)){if("premultiplyAlpha"in zt&&(me.type(zt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Te.premultiplyAlpha=zt.premultiplyAlpha),"flipY"in zt&&(me.type(zt.flipY,"boolean","invalid texture flip"),Te.flipY=zt.flipY),"alignment"in zt&&(me.oneOf(zt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Te.unpackAlignment=zt.alignment),"colorSpace"in zt&&(me.parameter(zt.colorSpace,Tr,"invalid colorSpace"),Te.colorSpace=Tr[zt.colorSpace]),"type"in zt){var Et=zt.type;me(ge.oes_texture_float||!(Et==="float"||Et==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),me(ge.oes_texture_half_float||!(Et==="half float"||Et==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),me(ge.webgl_depth_texture||!(Et==="uint16"||Et==="uint32"||Et==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(Et,jr,"invalid texture type"),Te.type=jr[Et]}var vn=Te.width,Wi=Te.height,Ce=Te.channels,se=!1;"shape"in zt?(me(Array.isArray(zt.shape)&&zt.shape.length>=2,"shape must be an array"),vn=zt.shape[0],Wi=zt.shape[1],zt.shape.length===3&&(Ce=zt.shape[2],me(Ce>0&&Ce<=4,"invalid number of channels"),se=!0),me(vn>=0&&vn<=Be.maxTextureSize,"invalid width"),me(Wi>=0&&Wi<=Be.maxTextureSize,"invalid height")):("radius"in zt&&(vn=Wi=zt.radius,me(vn>=0&&vn<=Be.maxTextureSize,"invalid radius")),"width"in zt&&(vn=zt.width,me(vn>=0&&vn<=Be.maxTextureSize,"invalid width")),"height"in zt&&(Wi=zt.height,me(Wi>=0&&Wi<=Be.maxTextureSize,"invalid height")),"channels"in zt&&(Ce=zt.channels,me(Ce>0&&Ce<=4,"invalid number of channels"),se=!0)),Te.width=vn|0,Te.height=Wi|0,Te.channels=Ce|0;var Ge=!1;if("format"in zt){var lt=zt.format;me(ge.webgl_depth_texture||!(lt==="depth"||lt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),me.parameter(lt,mr,"invalid texture format");var Ot=Te.internalformat=mr[lt];Te.format=Bn[Ot],lt in jr&&("type"in zt||(Te.type=jr[lt])),lt in Ar&&(Te.compressed=!0),Ge=!0}!se&&Ge?Te.channels=fo[Te.format]:se&&!Ge?Te.channels!==dn[Te.format]&&(Te.format=Te.internalformat=dn[Te.channels]):Ge&&se&&me(Te.channels===fo[Te.format],"number of channels inconsistent with specified format")}}function Vr(Te){N.pixelStorei(Zc,Te.flipY),N.pixelStorei(Iu,Te.premultiplyAlpha),N.pixelStorei(mo,Te.colorSpace),N.pixelStorei(Ku,Te.unpackAlignment)}function Er(){er.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Xr(Te,zt){var Et=null;if(Ti(zt)?Et=zt:zt&&(me.type(zt,"object","invalid pixel data type"),xn(Te,zt),"x"in zt&&(Te.xOffset=zt.x|0),"y"in zt&&(Te.yOffset=zt.y|0),Ti(zt.data)&&(Et=zt.data)),me(!Te.compressed||Et instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),zt.copy){me(!Et,"can not specify copy and data field for the same texture");var vn=ir.viewportWidth,Wi=ir.viewportHeight;Te.width=Te.width||vn-Te.xOffset,Te.height=Te.height||Wi-Te.yOffset,Te.needsCopy=!0,me(Te.xOffset>=0&&Te.xOffset<vn&&Te.yOffset>=0&&Te.yOffset<Wi&&Te.width>0&&Te.width<=vn&&Te.height>0&&Te.height<=Wi,"copy texture read out of bounds")}else if(!Et)Te.width=Te.width||1,Te.height=Te.height||1,Te.channels=Te.channels||4;else if(re(Et))Te.channels=Te.channels||4,Te.data=Et,!("type"in zt)&&Te.type===Ll&&(Te.type=Lu(Et));else if(Es(Et))Te.channels=Te.channels||4,hu(Te,Et),Te.alignment=1,Te.needsFree=!0;else if(ms(Et)){var Ce=Et.data;!Array.isArray(Ce)&&Te.type===Ll&&(Te.type=Lu(Ce));var se=Et.shape,Ge=Et.stride,lt,Ot,qe,Fe,rt,_e;se.length===3?(qe=se[2],_e=Ge[2]):(me(se.length===2,"invalid ndarray pixel data, must be 2 or 3D"),qe=1,_e=1),lt=se[0],Ot=se[1],Fe=Ge[0],rt=Ge[1],Te.alignment=1,Te.width=lt,Te.height=Ot,Te.channels=qe,Te.format=Te.internalformat=dn[qe],Te.needsFree=!0,as(Te,Ce,Fe,rt,_e,Et.offset)}else if(pu(Et)||Bs(Et)||Ru(Et)||Xf(Et))pu(Et)||Bs(Et)||Ru(Et)?Te.element=Et:Te.element=Et.canvas,Te.width=Te.element.width,Te.height=Te.element.height,Te.channels=4;else if(cl(Et))Te.element=Et,Te.width=Et.width,Te.height=Et.height,Te.channels=4;else if(Yf(Et))Te.element=Et,Te.width=Et.naturalWidth,Te.height=Et.naturalHeight,Te.channels=4;else if(Ps(Et))Te.element=Et,Te.width=Et.width,Te.height=Et.height,Te.channels=4;else if(Af(Et))Te.element=Et,Te.width=Et.videoWidth,Te.height=Et.videoHeight,Te.channels=4;else if(Cf(Et)){var je=Te.width||Et[0].length,we=Te.height||Et.length,ct=Te.channels;co(Et[0][0])?ct=ct||Et[0][0].length:ct=ct||1;for(var wt=be.shape(Et),fr=1,zr=0;zr<wt.length;++zr)fr*=wt[zr];var Ur=Go(Te,fr);be.flatten(Et,wt,"",Ur),fl(Te,Ur),Te.alignment=1,Te.width=je,Te.height=we,Te.channels=ct,Te.format=Te.internalformat=dn[ct],Te.needsFree=!0}Te.type===kl?me(Be.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Te.type===Ol&&me(Be.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Yr(Te,zt,Et){var vn=Te.element,Wi=Te.data,Ce=Te.internalformat,se=Te.format,Ge=Te.type,lt=Te.width,Ot=Te.height;Vr(Te),vn?N.texImage2D(zt,Et,se,se,Ge,vn):Te.compressed?N.compressedTexImage2D(zt,Et,Ce,lt,Ot,0,Wi):Te.needsCopy?(Dt(),N.copyTexImage2D(zt,Et,se,Te.xOffset,Te.yOffset,lt,Ot,0)):N.texImage2D(zt,Et,se,lt,Ot,0,se,Ge,Wi||null)}function yi(Te,zt,Et,vn,Wi){var Ce=Te.element,se=Te.data,Ge=Te.internalformat,lt=Te.format,Ot=Te.type,qe=Te.width,Fe=Te.height;Vr(Te),Ce?N.texSubImage2D(zt,Wi,Et,vn,lt,Ot,Ce):Te.compressed?N.compressedTexSubImage2D(zt,Wi,Et,vn,Ge,qe,Fe,se):Te.needsCopy?(Dt(),N.copyTexSubImage2D(zt,Wi,Et,vn,Te.xOffset,Te.yOffset,qe,Fe)):N.texSubImage2D(zt,Wi,Et,vn,qe,Fe,lt,Ot,se)}var oi=[];function Gr(){return oi.pop()||new Er}function rn(Te){Te.needsFree&&Pt.freeType(Te.data),Er.call(Te),oi.push(Te)}function Jn(){er.call(this),this.genMipmaps=!1,this.mipmapHint=qu,this.mipmask=0,this.images=Array(16)}function ci(Te,zt,Et){var vn=Te.images[0]=Gr();Te.mipmask=1,vn.width=Te.width=zt,vn.height=Te.height=Et,vn.channels=Te.channels=4}function zi(Te,zt){var Et=null;if(Ti(zt))Et=Te.images[0]=Gr(),nr(Et,Te),Xr(Et,zt),Te.mipmask=1;else if(xn(Te,zt),Array.isArray(zt.mipmap))for(var vn=zt.mipmap,Wi=0;Wi<vn.length;++Wi)Et=Te.images[Wi]=Gr(),nr(Et,Te),Et.width>>=Wi,Et.height>>=Wi,Xr(Et,vn[Wi]),Te.mipmask|=1<<Wi;else Et=Te.images[0]=Gr(),nr(Et,Te),Xr(Et,zt),Te.mipmask=1;nr(Te,Te.images[0]),Te.compressed&&(Te.internalformat===Yu||Te.internalformat===qs||Te.internalformat===mf||Te.internalformat===gf)&&me(Te.width%4==0&&Te.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function so(Te,zt){for(var Et=Te.images,vn=0;vn<Et.length;++vn){if(!Et[vn])return;Yr(Et[vn],zt,vn)}}var uo=[];function Bi(){var Te=uo.pop()||new Jn;er.call(Te),Te.mipmask=0;for(var zt=0;zt<16;++zt)Te.images[zt]=null;return Te}function es(Te){for(var zt=Te.images,Et=0;Et<zt.length;++Et)zt[Et]&&rn(zt[Et]),zt[Et]=null;uo.push(Te)}function Va(){this.minFilter=oc,this.magFilter=oc,this.wrapS=ac,this.wrapT=ac,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=qu}function No(Te,zt){if("min"in zt){var Et=zt.min;me.parameter(Et,wr),Te.minFilter=wr[Et],go.indexOf(Te.minFilter)>=0&&!("faces"in zt)&&(Te.genMipmaps=!0)}if("mag"in zt){var vn=zt.mag;me.parameter(vn,yr),Te.magFilter=yr[vn]}var Wi=Te.wrapS,Ce=Te.wrapT;if("wrap"in zt){var se=zt.wrap;typeof se=="string"?(me.parameter(se,vr),Wi=Ce=vr[se]):Array.isArray(se)&&(me.parameter(se[0],vr),me.parameter(se[1],vr),Wi=vr[se[0]],Ce=vr[se[1]])}else{if("wrapS"in zt){var Ge=zt.wrapS;me.parameter(Ge,vr),Wi=vr[Ge]}if("wrapT"in zt){var lt=zt.wrapT;me.parameter(lt,vr),Ce=vr[lt]}}if(Te.wrapS=Wi,Te.wrapT=Ce,"anisotropic"in zt){var Ot=zt.anisotropic;me(typeof Ot=="number"&&Ot>=1&&Ot<=Be.maxAnisotropic,"aniso samples must be between 1 and "),Te.anisotropic=zt.anisotropic}if("mipmap"in zt){var qe=!1;switch(typeof zt.mipmap){case"string":me.parameter(zt.mipmap,cr,"invalid mipmap hint"),Te.mipmapHint=cr[zt.mipmap],Te.genMipmaps=!0,qe=!0;break;case"boolean":qe=Te.genMipmaps=zt.mipmap;break;case"object":me(Array.isArray(zt.mipmap),"invalid mipmap type"),Te.genMipmaps=!1,qe=!0;break;default:me.raise("invalid mipmap type")}qe&&!("min"in zt)&&(Te.minFilter=Pu)}}function So(Te,zt){N.texParameteri(zt,Ji,Te.minFilter),N.texParameteri(zt,Dl,Te.magFilter),N.texParameteri(zt,zc,Te.wrapS),N.texParameteri(zt,wp,Te.wrapT),ge.ext_texture_filter_anisotropic&&N.texParameteri(zt,Fl,Te.anisotropic),Te.genMipmaps&&(N.hint(Uc,Te.mipmapHint),N.generateMipmap(zt))}var Wo=0,Io={},us=Be.maxTextureUnits,ho=Array(us).map(function(){return null});function _i(Te){er.call(this),this.mipmask=0,this.internalformat=cu,this.id=Wo++,this.refCount=1,this.target=Te,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Va,Jt.profile&&(this.stats={size:0})}function Oo(Te){N.activeTexture(uc),N.bindTexture(Te.target,Te.texture)}function ea(){var Te=ho[0];Te?N.bindTexture(Te.target,Te.texture):N.bindTexture($o,null)}function zo(Te){var zt=Te.texture;me(zt,"must not double destroy texture");var Et=Te.unit,vn=Te.target;Et>=0&&(N.activeTexture(uc+Et),N.bindTexture(vn,null),ho[Et]=null),N.deleteTexture(zt),Te.texture=null,Te.params=null,Te.pixels=null,Te.refCount=0,delete Io[Te.id],Lt.textureCount--}m(_i.prototype,{bind:function(){var Te=this;Te.bindCount+=1;var zt=Te.unit;if(zt<0){for(var Et=0;Et<us;++Et){var vn=ho[Et];if(vn){if(vn.bindCount>0)continue;vn.unit=-1}ho[Et]=Te,zt=Et;break}zt>=us&&me.raise("insufficient number of texture units"),Jt.profile&&Lt.maxTextureUnits<zt+1&&(Lt.maxTextureUnits=zt+1),Te.unit=zt,N.activeTexture(uc+zt),N.bindTexture(Te.target,Te.texture)}return zt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&zo(this)}});function ri(Te,zt){var Et=new _i($o);Io[Et.id]=Et,Lt.textureCount++;function vn(se,Ge){var lt=Et.texInfo;Va.call(lt);var Ot=Bi();return typeof se=="number"?typeof Ge=="number"?ci(Ot,se|0,Ge|0):ci(Ot,se|0,se|0):se?(me.type(se,"object","invalid arguments to regl.texture"),No(lt,se),zi(Ot,se)):ci(Ot,1,1),lt.genMipmaps&&(Ot.mipmask=(Ot.width<<1)-1),Et.mipmask=Ot.mipmask,nr(Et,Ot),me.texture2D(lt,Ot,Be),Et.internalformat=Ot.internalformat,vn.width=Ot.width,vn.height=Ot.height,Oo(Et),so(Ot,$o),So(lt,$o),ea(),es(Ot),Jt.profile&&(Et.stats.size=$s(Et.internalformat,Et.type,Ot.width,Ot.height,lt.genMipmaps,!1)),vn.format=_r[Et.internalformat],vn.type=Nr[Et.type],vn.mag=lr[lt.magFilter],vn.min=Rr[lt.minFilter],vn.wrapS=qr[lt.wrapS],vn.wrapT=qr[lt.wrapT],vn}function Wi(se,Ge,lt,Ot){me(!!se,"must specify image data");var qe=Ge|0,Fe=lt|0,rt=Ot|0,_e=Gr();return nr(_e,Et),_e.width=0,_e.height=0,Xr(_e,se),_e.width=_e.width||(Et.width>>rt)-qe,_e.height=_e.height||(Et.height>>rt)-Fe,me(Et.type===_e.type&&Et.format===_e.format&&Et.internalformat===_e.internalformat,"incompatible format for texture.subimage"),me(qe>=0&&Fe>=0&&qe+_e.width<=Et.width&&Fe+_e.height<=Et.height,"texture.subimage write out of bounds"),me(Et.mipmask&1<<rt,"missing mipmap data"),me(_e.data||_e.element||_e.needsCopy,"missing image data"),Oo(Et),yi(_e,$o,qe,Fe,rt),ea(),rn(_e),vn}function Ce(se,Ge){var lt=se|0,Ot=Ge|0||lt;if(lt===Et.width&&Ot===Et.height)return vn;vn.width=Et.width=lt,vn.height=Et.height=Ot,Oo(Et);for(var qe=0;Et.mipmask>>qe;++qe){var Fe=lt>>qe,rt=Ot>>qe;if(!Fe||!rt)break;N.texImage2D($o,qe,Et.format,Fe,rt,0,Et.format,Et.type,null)}return ea(),Jt.profile&&(Et.stats.size=$s(Et.internalformat,Et.type,lt,Ot,!1,!1)),vn}return vn(Te,zt),vn.subimage=Wi,vn.resize=Ce,vn._reglType="texture2d",vn._texture=Et,Jt.profile&&(vn.stats=Et.stats),vn.destroy=function(){Et.decRef()},vn}function Ui(Te,zt,Et,vn,Wi,Ce){var se=new _i(Dc);Io[se.id]=se,Lt.cubeCount++;var Ge=new Array(6);function lt(Fe,rt,_e,je,we,ct){var wt,fr=se.texInfo;for(Va.call(fr),wt=0;wt<6;++wt)Ge[wt]=Bi();if(typeof Fe=="number"||!Fe){var zr=Fe|0||1;for(wt=0;wt<6;++wt)ci(Ge[wt],zr,zr)}else if(typeof Fe=="object")if(rt)zi(Ge[0],Fe),zi(Ge[1],rt),zi(Ge[2],_e),zi(Ge[3],je),zi(Ge[4],we),zi(Ge[5],ct);else if(No(fr,Fe),xn(se,Fe),"faces"in Fe){var Ur=Fe.faces;for(me(Array.isArray(Ur)&&Ur.length===6,"cube faces must be a length 6 array"),wt=0;wt<6;++wt)me(typeof Ur[wt]=="object"&&!!Ur[wt],"invalid input for cube map face"),nr(Ge[wt],se),zi(Ge[wt],Ur[wt])}else for(wt=0;wt<6;++wt)zi(Ge[wt],Fe);else me.raise("invalid arguments to cube map");for(nr(se,Ge[0]),me.optional(function(){Be.npotTextureCube||me(jf(se.width)&&jf(se.height),"your browser does not support non power or two texture dimensions")}),fr.genMipmaps?se.mipmask=(Ge[0].width<<1)-1:se.mipmask=Ge[0].mipmask,me.textureCube(se,fr,Ge,Be),se.internalformat=Ge[0].internalformat,lt.width=Ge[0].width,lt.height=Ge[0].height,Oo(se),wt=0;wt<6;++wt)so(Ge[wt],Mu+wt);for(So(fr,Dc),ea(),Jt.profile&&(se.stats.size=$s(se.internalformat,se.type,lt.width,lt.height,fr.genMipmaps,!0)),lt.format=_r[se.internalformat],lt.type=Nr[se.type],lt.mag=lr[fr.magFilter],lt.min=Rr[fr.minFilter],lt.wrapS=qr[fr.wrapS],lt.wrapT=qr[fr.wrapT],wt=0;wt<6;++wt)es(Ge[wt]);return lt}function Ot(Fe,rt,_e,je,we){me(!!rt,"must specify image data"),me(typeof Fe=="number"&&Fe===(Fe|0)&&Fe>=0&&Fe<6,"invalid face");var ct=_e|0,wt=je|0,fr=we|0,zr=Gr();return nr(zr,se),zr.width=0,zr.height=0,Xr(zr,rt),zr.width=zr.width||(se.width>>fr)-ct,zr.height=zr.height||(se.height>>fr)-wt,me(se.type===zr.type&&se.format===zr.format&&se.internalformat===zr.internalformat,"incompatible format for texture.subimage"),me(ct>=0&&wt>=0&&ct+zr.width<=se.width&&wt+zr.height<=se.height,"texture.subimage write out of bounds"),me(se.mipmask&1<<fr,"missing mipmap data"),me(zr.data||zr.element||zr.needsCopy,"missing image data"),Oo(se),yi(zr,Mu+Fe,ct,wt,fr),ea(),rn(zr),lt}function qe(Fe){var rt=Fe|0;if(rt!==se.width){lt.width=se.width=rt,lt.height=se.height=rt,Oo(se);for(var _e=0;_e<6;++_e)for(var je=0;se.mipmask>>je;++je)N.texImage2D(Mu+_e,je,se.format,rt>>je,rt>>je,0,se.format,se.type,null);return ea(),Jt.profile&&(se.stats.size=$s(se.internalformat,se.type,lt.width,lt.height,!1,!0)),lt}}return lt(Te,zt,Et,vn,Wi,Ce),lt.subimage=Ot,lt.resize=qe,lt._reglType="textureCube",lt._texture=se,Jt.profile&&(lt.stats=se.stats),lt.destroy=function(){se.decRef()},lt}function va(){for(var Te=0;Te<us;++Te)N.activeTexture(uc+Te),N.bindTexture($o,null),ho[Te]=null;ne(Io).forEach(zo),Lt.cubeCount=0,Lt.textureCount=0}Jt.profile&&(Lt.getTotalTextureSize=function(){var Te=0;return Object.keys(Io).forEach(function(zt){Te+=Io[zt].stats.size}),Te});function Nn(){for(var Te=0;Te<us;++Te){var zt=ho[Te];zt&&(zt.bindCount=0,zt.unit=-1,ho[Te]=null)}ne(Io).forEach(function(Et){Et.texture=N.createTexture(),N.bindTexture(Et.target,Et.texture);for(var vn=0;vn<32;++vn)if((Et.mipmask&1<<vn)!=0)if(Et.target===$o)N.texImage2D($o,vn,Et.internalformat,Et.width>>vn,Et.height>>vn,0,Et.internalformat,Et.type,null);else for(var Wi=0;Wi<6;++Wi)N.texImage2D(Mu+Wi,vn,Et.internalformat,Et.width>>vn,Et.height>>vn,0,Et.internalformat,Et.type,null);So(Et.texInfo,Et.target)})}function si(){for(var Te=0;Te<us;++Te){var zt=ho[Te];zt&&(zt.bindCount=0,zt.unit=-1,ho[Te]=null),N.activeTexture(uc+Te),N.bindTexture($o,null),N.bindTexture(Dc,null)}}return{create2D:ri,createCube:Ui,clear:va,getTexture:function(Te){return null},restore:Nn,refresh:si}}var xu=36161,On=32854,Cn=32855,jc=36194,Qo=33189,Qs=36168,Ho=34041,du=35907,qf=34836,Vc=34842,ya=34843,Da=[];Da[On]=2,Da[Cn]=2,Da[jc]=2,Da[Qo]=2,Da[Qs]=1,Da[Ho]=4,Da[du]=4,Da[qf]=16,Da[Vc]=8,Da[ya]=6;function pl(N,ge,Be){return Da[N]*ge*Be}var cc=function(N,ge,Be,Dt,ir){var Lt={rgba4:On,rgb565:jc,"rgb5 a1":Cn,depth:Qo,stencil:Qs,"depth stencil":Ho};ge.ext_srgb&&(Lt.srgba=du),ge.ext_color_buffer_half_float&&(Lt.rgba16f=Vc,Lt.rgb16f=ya),ge.webgl_color_buffer_float&&(Lt.rgba32f=qf);var Jt=[];Object.keys(Lt).forEach(function(mr){var Ar=Lt[mr];Jt[Ar]=mr});var cr=0,vr={};function yr(mr){this.id=cr++,this.refCount=1,this.renderbuffer=mr,this.format=On,this.width=0,this.height=0,ir.profile&&(this.stats={size:0})}yr.prototype.decRef=function(){--this.refCount<=0&&wr(this)};function wr(mr){var Ar=mr.renderbuffer;me(Ar,"must not double destroy renderbuffer"),N.bindRenderbuffer(xu,null),N.deleteRenderbuffer(Ar),mr.renderbuffer=null,mr.refCount=0,delete vr[mr.id],Dt.renderbufferCount--}function Tr(mr,Ar){var st=new yr(N.createRenderbuffer());vr[st.id]=st,Dt.renderbufferCount++;function Vt(Nr,lr){var Rr=0,qr=0,Bn=On;if(typeof Nr=="object"&&Nr){var er=Nr;if("shape"in er){var nr=er.shape;me(Array.isArray(nr)&&nr.length>=2,"invalid renderbuffer shape"),Rr=nr[0]|0,qr=nr[1]|0}else"radius"in er&&(Rr=qr=er.radius|0),"width"in er&&(Rr=er.width|0),"height"in er&&(qr=er.height|0);"format"in er&&(me.parameter(er.format,Lt,"invalid renderbuffer format"),Bn=Lt[er.format])}else typeof Nr=="number"?(Rr=Nr|0,typeof lr=="number"?qr=lr|0:qr=Rr):Nr?me.raise("invalid arguments to renderbuffer constructor"):Rr=qr=1;if(me(Rr>0&&qr>0&&Rr<=Be.maxRenderbufferSize&&qr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),!(Rr===st.width&&qr===st.height&&Bn===st.format))return Vt.width=st.width=Rr,Vt.height=st.height=qr,st.format=Bn,N.bindRenderbuffer(xu,st.renderbuffer),N.renderbufferStorage(xu,Bn,Rr,qr),me(N.getError()===0,"invalid render buffer format"),ir.profile&&(st.stats.size=pl(st.format,st.width,st.height)),Vt.format=Jt[st.format],Vt}function _r(Nr,lr){var Rr=Nr|0,qr=lr|0||Rr;return Rr===st.width&&qr===st.height||(me(Rr>0&&qr>0&&Rr<=Be.maxRenderbufferSize&&qr<=Be.maxRenderbufferSize,"invalid renderbuffer size"),Vt.width=st.width=Rr,Vt.height=st.height=qr,N.bindRenderbuffer(xu,st.renderbuffer),N.renderbufferStorage(xu,st.format,Rr,qr),me(N.getError()===0,"invalid render buffer format"),ir.profile&&(st.stats.size=pl(st.format,st.width,st.height))),Vt}return Vt(mr,Ar),Vt.resize=_r,Vt._reglType="renderbuffer",Vt._renderbuffer=st,ir.profile&&(Vt.stats=st.stats),Vt.destroy=function(){st.decRef()},Vt}ir.profile&&(Dt.getTotalRenderbufferSize=function(){var mr=0;return Object.keys(vr).forEach(function(Ar){mr+=vr[Ar].stats.size}),mr});function jr(){ne(vr).forEach(function(mr){mr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(xu,mr.renderbuffer),N.renderbufferStorage(xu,mr.format,mr.width,mr.height)}),N.bindRenderbuffer(xu,null)}return{create:Tr,clear:function(){ne(vr).forEach(wr)},restore:jr}},Js=36160,vu=36161,bi=3553,Ns=34069,Is=36064,hl=36096,ku=36128,Qu=33306,Gc=36053,Ia=36054,eu=36055,Nl=36057,dl=36061,vl=36193,Hc=5121,ml=5126,tu=6407,fc=6408,zl=6402,Kf=[tu,fc],Ul=[];Ul[fc]=4,Ul[tu]=3;var l=[];l[Hc]=1,l[ml]=4,l[vl]=2;var f=32854,c=32855,d=36194,E=33189,w=36168,P=34041,k=35907,Z=34836,X=34842,le=34843,pe=[f,c,d,k,X,le,Z],ve={};ve[Gc]="complete",ve[Ia]="incomplete attachment",ve[Nl]="incomplete dimensions",ve[eu]="incomplete, missing attachment",ve[dl]="unsupported";function Re(N,ge,Be,Dt,ir,Lt){var Jt={cur:null,next:null,dirty:!1,setFBO:null},cr=["rgba"],vr=["rgba4","rgb565","rgb5 a1"];ge.ext_srgb&&vr.push("srgba"),ge.ext_color_buffer_half_float&&vr.push("rgba16f","rgb16f"),ge.webgl_color_buffer_float&&vr.push("rgba32f");var yr=["uint8"];ge.oes_texture_half_float&&yr.push("half float","float16"),ge.oes_texture_float&&yr.push("float","float32");function wr(Er,Xr,Yr){this.target=Er,this.texture=Xr,this.renderbuffer=Yr;var yi=0,oi=0;Xr?(yi=Xr.width,oi=Xr.height):Yr&&(yi=Yr.width,oi=Yr.height),this.width=yi,this.height=oi}function Tr(Er){Er&&(Er.texture&&Er.texture._texture.decRef(),Er.renderbuffer&&Er.renderbuffer._renderbuffer.decRef())}function jr(Er,Xr,Yr){if(!!Er)if(Er.texture){var yi=Er.texture._texture,oi=Math.max(1,yi.width),Gr=Math.max(1,yi.height);me(oi===Xr&&Gr===Yr,"inconsistent width/height for supplied texture"),yi.refCount+=1}else{var rn=Er.renderbuffer._renderbuffer;me(rn.width===Xr&&rn.height===Yr,"inconsistent width/height for renderbuffer"),rn.refCount+=1}}function mr(Er,Xr){Xr&&(Xr.texture?N.framebufferTexture2D(Js,Er,Xr.target,Xr.texture._texture.texture,0):N.framebufferRenderbuffer(Js,Er,vu,Xr.renderbuffer._renderbuffer.renderbuffer))}function Ar(Er){var Xr=bi,Yr=null,yi=null,oi=Er;typeof Er=="object"&&(oi=Er.data,"target"in Er&&(Xr=Er.target|0)),me.type(oi,"function","invalid attachment data");var Gr=oi._reglType;return Gr==="texture2d"?(Yr=oi,me(Xr===bi)):Gr==="textureCube"?(Yr=oi,me(Xr>=Ns&&Xr<Ns+6,"invalid cube map target")):Gr==="renderbuffer"?(yi=oi,Xr=vu):me.raise("invalid regl object for attachment"),new wr(Xr,Yr,yi)}function st(Er,Xr,Yr,yi,oi){if(Yr){var Gr=Dt.create2D({width:Er,height:Xr,format:yi,type:oi});return Gr._texture.refCount=0,new wr(bi,Gr,null)}else{var rn=ir.create({width:Er,height:Xr,format:yi});return rn._renderbuffer.refCount=0,new wr(vu,null,rn)}}function Vt(Er){return Er&&(Er.texture||Er.renderbuffer)}function _r(Er,Xr,Yr){Er&&(Er.texture?Er.texture.resize(Xr,Yr):Er.renderbuffer&&Er.renderbuffer.resize(Xr,Yr),Er.width=Xr,Er.height=Yr)}var Nr=0,lr={};function Rr(){this.id=Nr++,lr[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function qr(Er){Er.colorAttachments.forEach(Tr),Tr(Er.depthAttachment),Tr(Er.stencilAttachment),Tr(Er.depthStencilAttachment)}function Bn(Er){var Xr=Er.framebuffer;me(Xr,"must not double destroy framebuffer"),N.deleteFramebuffer(Xr),Er.framebuffer=null,Lt.framebufferCount--,delete lr[Er.id]}function er(Er){var Xr;N.bindFramebuffer(Js,Er.framebuffer);var Yr=Er.colorAttachments;for(Xr=0;Xr<Yr.length;++Xr)mr(Is+Xr,Yr[Xr]);for(Xr=Yr.length;Xr<Be.maxColorAttachments;++Xr)N.framebufferTexture2D(Js,Is+Xr,bi,null,0);N.framebufferTexture2D(Js,Qu,bi,null,0),N.framebufferTexture2D(Js,hl,bi,null,0),N.framebufferTexture2D(Js,ku,bi,null,0),mr(hl,Er.depthAttachment),mr(ku,Er.stencilAttachment),mr(Qu,Er.depthStencilAttachment);var yi=N.checkFramebufferStatus(Js);!N.isContextLost()&&yi!==Gc&&me.raise("framebuffer configuration not supported, status = "+ve[yi]),N.bindFramebuffer(Js,Jt.next?Jt.next.framebuffer:null),Jt.cur=Jt.next,N.getError()}function nr(Er,Xr){var Yr=new Rr;Lt.framebufferCount++;function yi(Gr,rn){var Jn;me(Jt.next!==Yr,"can not update framebuffer which is currently in use");var ci=0,zi=0,so=!0,uo=!0,Bi=null,es=!0,Va="rgba",No="uint8",So=1,Wo=null,Io=null,us=null,ho=!1;if(typeof Gr=="number")ci=Gr|0,zi=rn|0||ci;else if(!Gr)ci=zi=1;else{me.type(Gr,"object","invalid arguments for framebuffer");var _i=Gr;if("shape"in _i){var Oo=_i.shape;me(Array.isArray(Oo)&&Oo.length>=2,"invalid shape for framebuffer"),ci=Oo[0],zi=Oo[1]}else"radius"in _i&&(ci=zi=_i.radius),"width"in _i&&(ci=_i.width),"height"in _i&&(zi=_i.height);("color"in _i||"colors"in _i)&&(Bi=_i.color||_i.colors,Array.isArray(Bi)&&me(Bi.length===1||ge.webgl_draw_buffers,"multiple render targets not supported")),Bi||("colorCount"in _i&&(So=_i.colorCount|0,me(So>0,"invalid color buffer count")),"colorTexture"in _i&&(es=!!_i.colorTexture,Va="rgba4"),"colorType"in _i&&(No=_i.colorType,es?(me(ge.oes_texture_float||!(No==="float"||No==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),me(ge.oes_texture_half_float||!(No==="half float"||No==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):No==="half float"||No==="float16"?(me(ge.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Va="rgba16f"):(No==="float"||No==="float32")&&(me(ge.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Va="rgba32f"),me.oneOf(No,yr,"invalid color type")),"colorFormat"in _i&&(Va=_i.colorFormat,cr.indexOf(Va)>=0?es=!0:vr.indexOf(Va)>=0?es=!1:me.optional(function(){es?me.oneOf(_i.colorFormat,cr,"invalid color format for texture"):me.oneOf(_i.colorFormat,vr,"invalid color format for renderbuffer")}))),("depthTexture"in _i||"depthStencilTexture"in _i)&&(ho=!!(_i.depthTexture||_i.depthStencilTexture),me(!ho||ge.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in _i&&(typeof _i.depth=="boolean"?so=_i.depth:(Wo=_i.depth,uo=!1)),"stencil"in _i&&(typeof _i.stencil=="boolean"?uo=_i.stencil:(Io=_i.stencil,so=!1)),"depthStencil"in _i&&(typeof _i.depthStencil=="boolean"?so=uo=_i.depthStencil:(us=_i.depthStencil,so=!1,uo=!1))}var ea=null,zo=null,ri=null,Ui=null;if(Array.isArray(Bi))ea=Bi.map(Ar);else if(Bi)ea=[Ar(Bi)];else for(ea=new Array(So),Jn=0;Jn<So;++Jn)ea[Jn]=st(ci,zi,es,Va,No);me(ge.webgl_draw_buffers||ea.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),me(ea.length<=Be.maxColorAttachments,"too many color attachments, not supported"),ci=ci||ea[0].width,zi=zi||ea[0].height,Wo?zo=Ar(Wo):so&&!uo&&(zo=st(ci,zi,ho,"depth","uint32")),Io?ri=Ar(Io):uo&&!so&&(ri=st(ci,zi,!1,"stencil","uint8")),us?Ui=Ar(us):!Wo&&!Io&&uo&&so&&(Ui=st(ci,zi,ho,"depth stencil","depth stencil")),me(!!Wo+!!Io+!!us<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var va=null;for(Jn=0;Jn<ea.length;++Jn)if(jr(ea[Jn],ci,zi),me(!ea[Jn]||ea[Jn].texture&&Kf.indexOf(ea[Jn].texture._texture.format)>=0||ea[Jn].renderbuffer&&pe.indexOf(ea[Jn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Jn+" is invalid"),ea[Jn]&&ea[Jn].texture){var Nn=Ul[ea[Jn].texture._texture.format]*l[ea[Jn].texture._texture.type];va===null?va=Nn:me(va===Nn,"all color attachments much have the same number of bits per pixel.")}return jr(zo,ci,zi),me(!zo||zo.texture&&zo.texture._texture.format===zl||zo.renderbuffer&&zo.renderbuffer._renderbuffer.format===E,"invalid depth attachment for framebuffer object"),jr(ri,ci,zi),me(!ri||ri.renderbuffer&&ri.renderbuffer._renderbuffer.format===w,"invalid stencil attachment for framebuffer object"),jr(Ui,ci,zi),me(!Ui||Ui.texture&&Ui.texture._texture.format===P||Ui.renderbuffer&&Ui.renderbuffer._renderbuffer.format===P,"invalid depth-stencil attachment for framebuffer object"),qr(Yr),Yr.width=ci,Yr.height=zi,Yr.colorAttachments=ea,Yr.depthAttachment=zo,Yr.stencilAttachment=ri,Yr.depthStencilAttachment=Ui,yi.color=ea.map(Vt),yi.depth=Vt(zo),yi.stencil=Vt(ri),yi.depthStencil=Vt(Ui),yi.width=Yr.width,yi.height=Yr.height,er(Yr),yi}function oi(Gr,rn){me(Jt.next!==Yr,"can not resize a framebuffer which is currently in use");var Jn=Math.max(Gr|0,1),ci=Math.max(rn|0||Jn,1);if(Jn===Yr.width&&ci===Yr.height)return yi;for(var zi=Yr.colorAttachments,so=0;so<zi.length;++so)_r(zi[so],Jn,ci);return _r(Yr.depthAttachment,Jn,ci),_r(Yr.stencilAttachment,Jn,ci),_r(Yr.depthStencilAttachment,Jn,ci),Yr.width=yi.width=Jn,Yr.height=yi.height=ci,er(Yr),yi}return yi(Er,Xr),m(yi,{resize:oi,_reglType:"framebuffer",_framebuffer:Yr,destroy:function(){Bn(Yr),qr(Yr)},use:function(Gr){Jt.setFBO({framebuffer:yi},Gr)}})}function xn(Er){var Xr=Array(6);function Yr(oi){var Gr;me(Xr.indexOf(Jt.next)<0,"can not update framebuffer which is currently in use");var rn={color:null},Jn=0,ci=null,zi="rgba",so="uint8",uo=1;if(typeof oi=="number")Jn=oi|0;else if(!oi)Jn=1;else{me.type(oi,"object","invalid arguments for framebuffer");var Bi=oi;if("shape"in Bi){var es=Bi.shape;me(Array.isArray(es)&&es.length>=2,"invalid shape for framebuffer"),me(es[0]===es[1],"cube framebuffer must be square"),Jn=es[0]}else"radius"in Bi&&(Jn=Bi.radius|0),"width"in Bi?(Jn=Bi.width|0,"height"in Bi&&me(Bi.height===Jn,"must be square")):"height"in Bi&&(Jn=Bi.height|0);("color"in Bi||"colors"in Bi)&&(ci=Bi.color||Bi.colors,Array.isArray(ci)&&me(ci.length===1||ge.webgl_draw_buffers,"multiple render targets not supported")),ci||("colorCount"in Bi&&(uo=Bi.colorCount|0,me(uo>0,"invalid color buffer count")),"colorType"in Bi&&(me.oneOf(Bi.colorType,yr,"invalid color type"),so=Bi.colorType),"colorFormat"in Bi&&(zi=Bi.colorFormat,me.oneOf(Bi.colorFormat,cr,"invalid color format for texture"))),"depth"in Bi&&(rn.depth=Bi.depth),"stencil"in Bi&&(rn.stencil=Bi.stencil),"depthStencil"in Bi&&(rn.depthStencil=Bi.depthStencil)}var Va;if(ci)if(Array.isArray(ci))for(Va=[],Gr=0;Gr<ci.length;++Gr)Va[Gr]=ci[Gr];else Va=[ci];else{Va=Array(uo);var No={radius:Jn,format:zi,type:so};for(Gr=0;Gr<uo;++Gr)Va[Gr]=Dt.createCube(No)}for(rn.color=Array(Va.length),Gr=0;Gr<Va.length;++Gr){var So=Va[Gr];me(typeof So=="function"&&So._reglType==="textureCube","invalid cube map"),Jn=Jn||So.width,me(So.width===Jn&&So.height===Jn,"invalid cube map shape"),rn.color[Gr]={target:Ns,data:Va[Gr]}}for(Gr=0;Gr<6;++Gr){for(var Wo=0;Wo<Va.length;++Wo)rn.color[Wo].target=Ns+Gr;Gr>0&&(rn.depth=Xr[0].depth,rn.stencil=Xr[0].stencil,rn.depthStencil=Xr[0].depthStencil),Xr[Gr]?Xr[Gr](rn):Xr[Gr]=nr(rn)}return m(Yr,{width:Jn,height:Jn,color:Va})}function yi(oi){var Gr,rn=oi|0;if(me(rn>0&&rn<=Be.maxCubeMapSize,"invalid radius for cube fbo"),rn===Yr.width)return Yr;var Jn=Yr.color;for(Gr=0;Gr<Jn.length;++Gr)Jn[Gr].resize(rn);for(Gr=0;Gr<6;++Gr)Xr[Gr].resize(rn);return Yr.width=Yr.height=rn,Yr}return Yr(Er),m(Yr,{faces:Xr,resize:yi,_reglType:"framebufferCube",destroy:function(){Xr.forEach(function(oi){oi.destroy()})}})}function Vr(){Jt.cur=null,Jt.next=null,Jt.dirty=!0,ne(lr).forEach(function(Er){Er.framebuffer=N.createFramebuffer(),er(Er)})}return m(Jt,{getFramebuffer:function(Er){if(typeof Er=="function"&&Er._reglType==="framebuffer"){var Xr=Er._framebuffer;if(Xr instanceof Rr)return Xr}return null},create:nr,createCube:xn,clear:function(){ne(lr).forEach(Bn)},restore:Vr})}var Ie=5126,ze=34962,Ee=34963,Ve=["attributes","elements","offset","count","primitive","instances"];function et(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ie,this.offset=0,this.stride=0,this.divisor=0}function vt(N,ge,Be,Dt,ir,Lt,Jt){for(var cr=Be.maxAttributes,vr=new Array(cr),yr=0;yr<cr;++yr)vr[yr]=new et;var wr=0,Tr={},jr={Record:et,scope:{},state:vr,currentVAO:null,targetVAO:null,restore:Ar()?qr:function(){},createVAO:Bn,getVAO:Vt,destroyBuffer:mr,setVAO:Ar()?_r:Nr,clear:Ar()?lr:function(){}};function mr(er){for(var nr=0;nr<vr.length;++nr){var xn=vr[nr];xn.buffer===er&&(N.disableVertexAttribArray(nr),xn.buffer=null)}}function Ar(){return ge.oes_vertex_array_object}function st(){return ge.angle_instanced_arrays}function Vt(er){return typeof er=="function"&&er._vao?er._vao:null}function _r(er){if(er!==jr.currentVAO){var nr=Ar();er?nr.bindVertexArrayOES(er.vao):nr.bindVertexArrayOES(null),jr.currentVAO=er}}function Nr(er){if(er!==jr.currentVAO){if(er)er.bindAttrs();else{for(var nr=st(),xn=0;xn<vr.length;++xn){var Vr=vr[xn];Vr.buffer?(N.enableVertexAttribArray(xn),Vr.buffer.bind(),N.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offfset),nr&&Vr.divisor&&nr.vertexAttribDivisorANGLE(xn,Vr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}Jt.elements?N.bindBuffer(Ee,Jt.elements.buffer.buffer):N.bindBuffer(Ee,null)}jr.currentVAO=er}}function lr(){ne(Tr).forEach(function(er){er.destroy()})}function Rr(){this.id=++wr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var er=Ar();er?this.vao=er.createVertexArrayOES():this.vao=null,Tr[this.id]=this,this.buffers=[]}Rr.prototype.bindAttrs=function(){for(var er=st(),nr=this.attributes,xn=0;xn<nr.length;++xn){var Vr=nr[xn];Vr.buffer?(N.enableVertexAttribArray(xn),N.bindBuffer(ze,Vr.buffer.buffer),N.vertexAttribPointer(xn,Vr.size,Vr.type,Vr.normalized,Vr.stride,Vr.offset),er&&Vr.divisor&&er.vertexAttribDivisorANGLE(xn,Vr.divisor)):(N.disableVertexAttribArray(xn),N.vertexAttrib4f(xn,Vr.x,Vr.y,Vr.z,Vr.w))}for(var Er=nr.length;Er<cr;++Er)N.disableVertexAttribArray(Er);var Xr=Lt.getElements(this.elements);Xr?N.bindBuffer(Ee,Xr.buffer.buffer):N.bindBuffer(Ee,null)},Rr.prototype.refresh=function(){var er=Ar();er&&(er.bindVertexArrayOES(this.vao),this.bindAttrs(),jr.currentVAO=null,er.bindVertexArrayOES(null))},Rr.prototype.destroy=function(){if(this.vao){var er=Ar();this===jr.currentVAO&&(jr.currentVAO=null,er.bindVertexArrayOES(null)),er.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Tr[this.id]&&(delete Tr[this.id],Dt.vaoCount-=1)};function qr(){var er=Ar();er&&ne(Tr).forEach(function(nr){nr.refresh()})}function Bn(er){var nr=new Rr;Dt.vaoCount+=1;function xn(Vr){var Er;if(Array.isArray(Vr))Er=Vr,nr.elements&&nr.ownsElements&&nr.elements.destroy(),nr.elements=null,nr.ownsElements=!1,nr.offset=0,nr.count=0,nr.instances=-1,nr.primitive=4;else{if(me(typeof Vr=="object","invalid arguments for create vao"),me("attributes"in Vr,"must specify attributes for vao"),Vr.elements){var Xr=Vr.elements;nr.ownsElements?typeof Xr=="function"&&Xr._reglType==="elements"?(nr.elements.destroy(),nr.ownsElements=!1):(nr.elements(Xr),nr.ownsElements=!1):Lt.getElements(Vr.elements)?(nr.elements=Vr.elements,nr.ownsElements=!1):(nr.elements=Lt.create(Vr.elements),nr.ownsElements=!0)}else nr.elements=null,nr.ownsElements=!1;Er=Vr.attributes,nr.offset=0,nr.count=-1,nr.instances=-1,nr.primitive=4,nr.elements&&(nr.count=nr.elements._elements.vertCount,nr.primitive=nr.elements._elements.primType),"offset"in Vr&&(nr.offset=Vr.offset|0),"count"in Vr&&(nr.count=Vr.count|0),"instances"in Vr&&(nr.instances=Vr.instances|0),"primitive"in Vr&&(me(Vr.primitive in ar,"bad primitive type: "+Vr.primitive),nr.primitive=ar[Vr.primitive]),me.optional(function(){for(var so=Object.keys(Vr),uo=0;uo<so.length;++uo)me(Ve.indexOf(so[uo])>=0,'invalid option for vao: "'+so[uo]+'" valid options are '+Ve)}),me(Array.isArray(Er),"attributes must be an array")}me(Er.length<cr,"too many attributes"),me(Er.length>0,"must specify at least one attribute");var Yr={},yi=nr.attributes;yi.length=Er.length;for(var oi=0;oi<Er.length;++oi){var Gr=Er[oi],rn=yi[oi]=new et,Jn=Gr.data||Gr;if(Array.isArray(Jn)||re(Jn)||ms(Jn)){var ci;nr.buffers[oi]&&(ci=nr.buffers[oi],re(Jn)&&ci._buffer.byteLength>=Jn.byteLength?ci.subdata(Jn):(ci.destroy(),nr.buffers[oi]=null)),nr.buffers[oi]||(ci=nr.buffers[oi]=ir.create(Gr,ze,!1,!0)),rn.buffer=ir.getBuffer(ci),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1,Yr[oi]=1}else ir.getBuffer(Gr)?(rn.buffer=ir.getBuffer(Gr),rn.size=rn.buffer.dimension|0,rn.normalized=!1,rn.type=rn.buffer.dtype,rn.offset=0,rn.stride=0,rn.divisor=0,rn.state=1):ir.getBuffer(Gr.buffer)?(rn.buffer=ir.getBuffer(Gr.buffer),rn.size=(+Gr.size||rn.buffer.dimension)|0,rn.normalized=!!Gr.normalized||!1,"type"in Gr?(me.parameter(Gr.type,uu,"invalid buffer type"),rn.type=uu[Gr.type]):rn.type=rn.buffer.dtype,rn.offset=(Gr.offset||0)|0,rn.stride=(Gr.stride||0)|0,rn.divisor=(Gr.divisor||0)|0,rn.state=1,me(rn.size>=1&&rn.size<=4,"size must be between 1 and 4"),me(rn.offset>=0,"invalid offset"),me(rn.stride>=0&&rn.stride<=255,"stride must be between 0 and 255"),me(rn.divisor>=0,"divisor must be positive"),me(!rn.divisor||!!ge.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Gr?(me(oi>0,"first attribute must not be a constant"),rn.x=+Gr.x||0,rn.y=+Gr.y||0,rn.z=+Gr.z||0,rn.w=+Gr.w||0,rn.state=2):me(!1,"invalid attribute spec for location "+oi)}for(var zi=0;zi<nr.buffers.length;++zi)!Yr[zi]&&nr.buffers[zi]&&(nr.buffers[zi].destroy(),nr.buffers[zi]=null);return nr.refresh(),xn}return xn.destroy=function(){for(var Vr=0;Vr<nr.buffers.length;++Vr)nr.buffers[Vr]&&nr.buffers[Vr].destroy();nr.buffers.length=0,nr.ownsElements&&(nr.elements.destroy(),nr.elements=null,nr.ownsElements=!1),nr.destroy()},xn._vao=nr,xn._reglType="vao",xn(er)}return jr}var Xt=35632,jt=35633,Qt=35718,dr=35721;function Lr(N,ge,Be,Dt){var ir={},Lt={};function Jt(st,Vt,_r,Nr){this.name=st,this.id=Vt,this.location=_r,this.info=Nr}function cr(st,Vt){for(var _r=0;_r<st.length;++_r)if(st[_r].id===Vt.id){st[_r].location=Vt.location;return}st.push(Vt)}function vr(st,Vt,_r){var Nr=st===Xt?ir:Lt,lr=Nr[Vt];if(!lr){var Rr=ge.str(Vt);lr=N.createShader(st),N.shaderSource(lr,Rr),N.compileShader(lr),me.shaderError(N,lr,Rr,st,_r),Nr[Vt]=lr}return lr}var yr={},wr=[],Tr=0;function jr(st,Vt){this.id=Tr++,this.fragId=st,this.vertId=Vt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Dt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function mr(st,Vt,_r){var Nr,lr,Rr=vr(Xt,st.fragId),qr=vr(jt,st.vertId),Bn=st.program=N.createProgram();if(N.attachShader(Bn,Rr),N.attachShader(Bn,qr),_r)for(Nr=0;Nr<_r.length;++Nr){var er=_r[Nr];N.bindAttribLocation(Bn,er[0],er[1])}N.linkProgram(Bn),me.linkError(N,Bn,ge.str(st.fragId),ge.str(st.vertId),Vt);var nr=N.getProgramParameter(Bn,Qt);Dt.profile&&(st.stats.uniformsCount=nr);var xn=st.uniforms;for(Nr=0;Nr<nr;++Nr)if(lr=N.getActiveUniform(Bn,Nr),lr)if(lr.size>1)for(var Vr=0;Vr<lr.size;++Vr){var Er=lr.name.replace("[0]","["+Vr+"]");cr(xn,new Jt(Er,ge.id(Er),N.getUniformLocation(Bn,Er),lr))}else cr(xn,new Jt(lr.name,ge.id(lr.name),N.getUniformLocation(Bn,lr.name),lr));var Xr=N.getProgramParameter(Bn,dr);Dt.profile&&(st.stats.attributesCount=Xr);var Yr=st.attributes;for(Nr=0;Nr<Xr;++Nr)lr=N.getActiveAttrib(Bn,Nr),lr&&cr(Yr,new Jt(lr.name,ge.id(lr.name),N.getAttribLocation(Bn,lr.name),lr))}Dt.profile&&(Be.getMaxUniformsCount=function(){var st=0;return wr.forEach(function(Vt){Vt.stats.uniformsCount>st&&(st=Vt.stats.uniformsCount)}),st},Be.getMaxAttributesCount=function(){var st=0;return wr.forEach(function(Vt){Vt.stats.attributesCount>st&&(st=Vt.stats.attributesCount)}),st});function Ar(){ir={},Lt={};for(var st=0;st<wr.length;++st)mr(wr[st],null,wr[st].attributes.map(function(Vt){return[Vt.location,Vt.name]}))}return{clear:function(){var st=N.deleteShader.bind(N);ne(ir).forEach(st),ir={},ne(Lt).forEach(st),Lt={},wr.forEach(function(Vt){N.deleteProgram(Vt.program)}),wr.length=0,yr={},Be.shaderCount=0},program:function(st,Vt,_r,Nr){me.command(st>=0,"missing vertex shader",_r),me.command(Vt>=0,"missing fragment shader",_r);var lr=yr[Vt];lr||(lr=yr[Vt]={});var Rr=lr[st];if(Rr&&(Rr.refCount++,!Nr))return Rr;var qr=new jr(Vt,st);return Be.shaderCount++,mr(qr,_r,Nr),Rr||(lr[st]=qr),wr.push(qr),m(qr,{destroy:function(){if(qr.refCount--,qr.refCount<=0){N.deleteProgram(qr.program);var Bn=wr.indexOf(qr);wr.splice(Bn,1),Be.shaderCount--}lr[qr.vertId].refCount<=0&&(N.deleteShader(Lt[qr.vertId]),delete Lt[qr.vertId],delete yr[qr.fragId][qr.vertId]),Object.keys(yr[qr.fragId]).length||(N.deleteShader(ir[qr.fragId]),delete ir[qr.fragId],delete yr[qr.fragId])}})},restore:Ar,shader:vr,frag:-1,vert:-1}}var gr=6408,sn=5121,zn=3333,Un=5126;function Ln(N,ge,Be,Dt,ir,Lt,Jt){function cr(wr){var Tr;ge.next===null?(me(ir.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Tr=sn):(me(ge.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Tr=ge.next.colorAttachments[0].texture._texture.type,me.optional(function(){Lt.oes_texture_float?(me(Tr===sn||Tr===Un,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Tr===Un&&me(Jt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):me(Tr===sn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var jr=0,mr=0,Ar=Dt.framebufferWidth,st=Dt.framebufferHeight,Vt=null;re(wr)?Vt=wr:wr&&(me.type(wr,"object","invalid arguments to regl.read()"),jr=wr.x|0,mr=wr.y|0,me(jr>=0&&jr<Dt.framebufferWidth,"invalid x offset for regl.read"),me(mr>=0&&mr<Dt.framebufferHeight,"invalid y offset for regl.read"),Ar=(wr.width||Dt.framebufferWidth-jr)|0,st=(wr.height||Dt.framebufferHeight-mr)|0,Vt=wr.data||null),Vt&&(Tr===sn?me(Vt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Tr===Un&&me(Vt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),me(Ar>0&&Ar+jr<=Dt.framebufferWidth,"invalid width for read pixels"),me(st>0&&st+mr<=Dt.framebufferHeight,"invalid height for read pixels"),Be();var _r=Ar*st*4;return Vt||(Tr===sn?Vt=new Uint8Array(_r):Tr===Un&&(Vt=Vt||new Float32Array(_r))),me.isTypedArray(Vt,"data buffer for regl.read() must be a typedarray"),me(Vt.byteLength>=_r,"data buffer for regl.read() too small"),N.pixelStorei(zn,4),N.readPixels(jr,mr,Ar,st,gr,Tr,Vt),Vt}function vr(wr){var Tr;return ge.setFBO({framebuffer:wr.framebuffer},function(){Tr=cr(wr)}),Tr}function yr(wr){return!wr||!("framebuffer"in wr)?cr(wr):vr(wr)}return yr}function ki(N){return Array.prototype.slice.call(N)}function tn(N){return ki(N).join("")}function ai(){var N=0,ge=[],Be=[];function Dt(Tr){for(var jr=0;jr<Be.length;++jr)if(Be[jr]===Tr)return ge[jr];var mr="g"+N++;return ge.push(mr),Be.push(Tr),mr}function ir(){var Tr=[];function jr(){Tr.push.apply(Tr,ki(arguments))}var mr=[];function Ar(){var st="v"+N++;return mr.push(st),arguments.length>0&&(Tr.push(st,"="),Tr.push.apply(Tr,ki(arguments)),Tr.push(";")),st}return m(jr,{def:Ar,toString:function(){return tn([mr.length>0?"var "+mr.join(",")+";":"",tn(Tr)])}})}function Lt(){var Tr=ir(),jr=ir(),mr=Tr.toString,Ar=jr.toString;function st(Vt,_r){jr(Vt,_r,"=",Tr.def(Vt,_r),";")}return m(function(){Tr.apply(Tr,ki(arguments))},{def:Tr.def,entry:Tr,exit:jr,save:st,set:function(Vt,_r,Nr){st(Vt,_r),Tr(Vt,_r,"=",Nr,";")},toString:function(){return mr()+Ar()}})}function Jt(){var Tr=tn(arguments),jr=Lt(),mr=Lt(),Ar=jr.toString,st=mr.toString;return m(jr,{then:function(){return jr.apply(jr,ki(arguments)),this},else:function(){return mr.apply(mr,ki(arguments)),this},toString:function(){var Vt=st();return Vt&&(Vt="else{"+Vt+"}"),tn(["if(",Tr,"){",Ar(),"}",Vt])}})}var cr=ir(),vr={};function yr(Tr,jr){var mr=[];function Ar(){var lr="a"+mr.length;return mr.push(lr),lr}jr=jr||0;for(var st=0;st<jr;++st)Ar();var Vt=Lt(),_r=Vt.toString,Nr=vr[Tr]=m(Vt,{arg:Ar,toString:function(){return tn(["function(",mr.join(),"){",_r(),"}"])}});return Nr}function wr(){var Tr=['"use strict";',cr,"return {"];Object.keys(vr).forEach(function(st){Tr.push('"',st,'":',vr[st].toString(),",")}),Tr.push("}");var jr=tn(Tr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),mr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,Ar=mr?ie.Function.apply(null,ge.concat(jr)):Function.apply(null,ge.concat(jr));return Ar.apply(null,Be)}return{global:cr,link:Dt,block:ir,proc:yr,scope:Lt,cond:Jt,compile:wr}}var li="xyzw".split(""),$n=5121,jn=1,mi=2,Yn=0,Hn=1,yo=2,Ja=3,To=4,Fa=5,Wa=6,po="dither",Os="blend.enable",os="blend.color",Du="blend.equation",ss="blend.func",mu="depth.enable",Rs="depth.func",Cs="depth.range",Zl="depth.mask",Fu="colorMask",gl="cull.enable",jl="cull.face",ru="frontFace",yl="lineWidth",bu="polygonOffset.enable",Eo="polygonOffset.offset",Bu="sample.alpha",Nu="sample.enable",Ju="sample.coverage",oa="stencil.enable",zs="stencil.mask",Jo="stencil.func",gu="stencil.opFront",Wc="stencil.opBack",Xc="scissor.enable",wf="scissor.box",nu="viewport",pc="profile",iu="framebuffer",_l="vert",hc="frag",au="elements",Bo="primitive",Yc="count",$f="offset",Pp="instances",Qf="vao",lh="Width",dc="Height",vc=iu+lh,Tf=iu+dc,Ip=nu+lh,Hh=nu+dc,xl="drawingBuffer",qc=xl+lh,Wh=xl+dc,Md=[ss,Du,Jo,gu,Wc,Ju,nu,wf,Eo],Kc=34962,Op=34963,Pd=35632,Id=35633,Xh=3553,ch=34067,fh=2884,Jf=3042,Wr=3024,Mo=2960,Ht=2929,Yh=3089,Rp=32823,ep=32926,Mf=32928,tp=5126,rp=35664,Vl=35665,bl=35666,np=5124,Lp=35667,Gl=35668,ip=35669,Pf=35670,ap=35671,$c=35672,If=35673,Us=35674,Of=35675,Qc=35676,op=35678,sp=35680,kp=4,El=1028,Jc=1029,qh=2304,Dp=2305,ph=32775,Od=32776,Kh=519,Eu=7680,Rd=0,Fp=1,ef=32774,zu=513,$h=36160,Qh=36064,el={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Rf=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],tf={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},mc={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},hh={frag:Pd,vert:Id},rf={cw:qh,ccw:Dp};function Bp(N){return Array.isArray(N)||re(N)||ms(N)}function Oa(N){return N.sort(function(ge,Be){return ge===nu?-1:Be===nu?1:ge<Be?-1:1})}function Ki(N,ge,Be,Dt){this.thisDep=N,this.contextDep=ge,this.propDep=Be,this.append=Dt}function gc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Po(N){return new Ki(!1,!1,!1,N)}function Zs(N,ge){var Be=N.type;if(Be===Yn){var Dt=N.data.length;return new Ki(!0,Dt>=1,Dt>=2,ge)}else if(Be===To){var ir=N.data;return new Ki(ir.thisDep,ir.contextDep,ir.propDep,ge)}else{if(Be===Fa)return new Ki(!1,!1,!1,ge);if(Be===Wa){for(var Lt=!1,Jt=!1,cr=!1,vr=0;vr<N.data.length;++vr){var yr=N.data[vr];if(yr.type===Hn)cr=!0;else if(yr.type===yo)Jt=!0;else if(yr.type===Ja)Lt=!0;else if(yr.type===Yn){Lt=!0;var wr=yr.data;wr>=1&&(Jt=!0),wr>=2&&(cr=!0)}else yr.type===To&&(Lt=Lt||yr.data.thisDep,Jt=Jt||yr.data.contextDep,cr=cr||yr.data.propDep)}return new Ki(Lt,Jt,cr,ge)}else return new Ki(Be===Ja,Be===yo,Be===Hn,ge)}}var Jh=new Ki(!1,!1,!1,function(){});function dh(N,ge,Be,Dt,ir,Lt,Jt,cr,vr,yr,wr,Tr,jr,mr,Ar){var st=yr.Record,Vt={add:32774,subtract:32778,"reverse subtract":32779};Be.ext_blend_minmax&&(Vt.min=ph,Vt.max=Od);var _r=Be.angle_instanced_arrays,Nr=Be.webgl_draw_buffers,lr=Be.oes_vertex_array_object,Rr={dirty:!0,profile:Ar.profile},qr={},Bn=[],er={},nr={};function xn(Ce){return Ce.replace(".","_")}function Vr(Ce,se,Ge){var lt=xn(Ce);Bn.push(Ce),qr[lt]=Rr[lt]=!!Ge,er[lt]=se}function Er(Ce,se,Ge){var lt=xn(Ce);Bn.push(Ce),Array.isArray(Ge)?(Rr[lt]=Ge.slice(),qr[lt]=Ge.slice()):Rr[lt]=qr[lt]=Ge,nr[lt]=se}Vr(po,Wr),Vr(Os,Jf),Er(os,"blendColor",[0,0,0,0]),Er(Du,"blendEquationSeparate",[ef,ef]),Er(ss,"blendFuncSeparate",[Fp,Rd,Fp,Rd]),Vr(mu,Ht,!0),Er(Rs,"depthFunc",zu),Er(Cs,"depthRange",[0,1]),Er(Zl,"depthMask",!0),Er(Fu,Fu,[!0,!0,!0,!0]),Vr(gl,fh),Er(jl,"cullFace",Jc),Er(ru,ru,Dp),Er(yl,yl,1),Vr(bu,Rp),Er(Eo,"polygonOffset",[0,0]),Vr(Bu,ep),Vr(Nu,Mf),Er(Ju,"sampleCoverage",[1,!1]),Vr(oa,Mo),Er(zs,"stencilMask",-1),Er(Jo,"stencilFunc",[Kh,0,-1]),Er(gu,"stencilOpSeparate",[El,Eu,Eu,Eu]),Er(Wc,"stencilOpSeparate",[Jc,Eu,Eu,Eu]),Vr(Xc,Yh),Er(wf,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),Er(nu,nu,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var Xr={gl:N,context:jr,strings:ge,next:qr,current:Rr,draw:Tr,elements:Lt,buffer:ir,shader:wr,attributes:yr.state,vao:yr,uniforms:vr,framebuffer:cr,extensions:Be,timer:mr,isBufferArgs:Bp},Yr={primTypes:ar,compareFuncs:tf,blendFuncs:el,blendEquations:Vt,stencilOps:mc,glTypes:uu,orientationType:rf};me.optional(function(){Xr.isArrayLike=co}),Nr&&(Yr.backBuffer=[Jc],Yr.drawBuffer=He(Dt.maxDrawbuffers,function(Ce){return Ce===0?[0]:He(Ce,function(se){return Qh+se})}));var yi=0;function oi(){var Ce=ai(),se=Ce.link,Ge=Ce.global;Ce.id=yi++,Ce.batchId="0";var lt=se(Xr),Ot=Ce.shared={props:"a0"};Object.keys(Xr).forEach(function(je){Ot[je]=Ge.def(lt,".",je)}),me.optional(function(){Ce.CHECK=se(me),Ce.commandStr=me.guessCommand(),Ce.command=se(Ce.commandStr),Ce.assert=function(je,we,ct){je("if(!(",we,"))",this.CHECK,".commandRaise(",se(ct),",",this.command,");")},Yr.invalidBlendCombinations=Rf});var qe=Ce.next={},Fe=Ce.current={};Object.keys(nr).forEach(function(je){Array.isArray(Rr[je])&&(qe[je]=Ge.def(Ot.next,".",je),Fe[je]=Ge.def(Ot.current,".",je))});var rt=Ce.constants={};Object.keys(Yr).forEach(function(je){rt[je]=Ge.def(JSON.stringify(Yr[je]))}),Ce.invoke=function(je,we){switch(we.type){case Yn:var ct=["this",Ot.context,Ot.props,Ce.batchId];return je.def(se(we.data),".call(",ct.slice(0,Math.max(we.data.length+1,4)),")");case Hn:return je.def(Ot.props,we.data);case yo:return je.def(Ot.context,we.data);case Ja:return je.def("this",we.data);case To:return we.data.append(Ce,je),we.data.ref;case Fa:return we.data.toString();case Wa:return we.data.map(function(wt){return Ce.invoke(je,wt)})}},Ce.attribCache={};var _e={};return Ce.scopeAttrib=function(je){var we=ge.id(je);if(we in _e)return _e[we];var ct=yr.scope[we];ct||(ct=yr.scope[we]=new st);var wt=_e[we]=se(ct);return wt},Ce}function Gr(Ce){var se=Ce.static,Ge=Ce.dynamic,lt;if(pc in se){var Ot=!!se[pc];lt=Po(function(Fe,rt){return Ot}),lt.enable=Ot}else if(pc in Ge){var qe=Ge[pc];lt=Zs(qe,function(Fe,rt){return Fe.invoke(rt,qe)})}return lt}function rn(Ce,se){var Ge=Ce.static,lt=Ce.dynamic;if(iu in Ge){var Ot=Ge[iu];return Ot?(Ot=cr.getFramebuffer(Ot),me.command(Ot,"invalid framebuffer object"),Po(function(Fe,rt){var _e=Fe.link(Ot),je=Fe.shared;rt.set(je.framebuffer,".next",_e);var we=je.context;return rt.set(we,"."+vc,_e+".width"),rt.set(we,"."+Tf,_e+".height"),_e})):Po(function(Fe,rt){var _e=Fe.shared;rt.set(_e.framebuffer,".next","null");var je=_e.context;return rt.set(je,"."+vc,je+"."+qc),rt.set(je,"."+Tf,je+"."+Wh),"null"})}else if(iu in lt){var qe=lt[iu];return Zs(qe,function(Fe,rt){var _e=Fe.invoke(rt,qe),je=Fe.shared,we=je.framebuffer,ct=rt.def(we,".getFramebuffer(",_e,")");me.optional(function(){Fe.assert(rt,"!"+_e+"||"+ct,"invalid framebuffer object")}),rt.set(we,".next",ct);var wt=je.context;return rt.set(wt,"."+vc,ct+"?"+ct+".width:"+wt+"."+qc),rt.set(wt,"."+Tf,ct+"?"+ct+".height:"+wt+"."+Wh),ct})}else return null}function Jn(Ce,se,Ge){var lt=Ce.static,Ot=Ce.dynamic;function qe(_e){if(_e in lt){var je=lt[_e];me.commandType(je,"object","invalid "+_e,Ge.commandStr);var we=!0,ct=je.x|0,wt=je.y|0,fr,zr;return"width"in je?(fr=je.width|0,me.command(fr>=0,"invalid "+_e,Ge.commandStr)):we=!1,"height"in je?(zr=je.height|0,me.command(zr>=0,"invalid "+_e,Ge.commandStr)):we=!1,new Ki(!we&&se&&se.thisDep,!we&&se&&se.contextDep,!we&&se&&se.propDep,function(Dr,An){var un=Dr.shared.context,En=fr;"width"in je||(En=An.def(un,".",vc,"-",ct));var bn=zr;return"height"in je||(bn=An.def(un,".",Tf,"-",wt)),[ct,wt,En,bn]})}else if(_e in Ot){var Ur=Ot[_e],nn=Zs(Ur,function(Dr,An){var un=Dr.invoke(An,Ur);me.optional(function(){Dr.assert(An,un+"&&typeof "+un+'==="object"',"invalid "+_e)});var En=Dr.shared.context,bn=An.def(un,".x|0"),ln=An.def(un,".y|0"),ei=An.def('"width" in ',un,"?",un,".width|0:","(",En,".",vc,"-",bn,")"),Sa=An.def('"height" in ',un,"?",un,".height|0:","(",En,".",Tf,"-",ln,")");return me.optional(function(){Dr.assert(An,ei+">=0&&"+Sa+">=0","invalid "+_e)}),[bn,ln,ei,Sa]});return se&&(nn.thisDep=nn.thisDep||se.thisDep,nn.contextDep=nn.contextDep||se.contextDep,nn.propDep=nn.propDep||se.propDep),nn}else return se?new Ki(se.thisDep,se.contextDep,se.propDep,function(Dr,An){var un=Dr.shared.context;return[0,0,An.def(un,".",vc),An.def(un,".",Tf)]}):null}var Fe=qe(nu);if(Fe){var rt=Fe;Fe=new Ki(Fe.thisDep,Fe.contextDep,Fe.propDep,function(_e,je){var we=rt.append(_e,je),ct=_e.shared.context;return je.set(ct,"."+Ip,we[2]),je.set(ct,"."+Hh,we[3]),we})}return{viewport:Fe,scissor_box:qe(wf)}}function ci(Ce,se){var Ge=Ce.static,lt=typeof Ge[hc]=="string"&&typeof Ge[_l]=="string";if(lt){if(Object.keys(se.dynamic).length>0)return null;var Ot=se.static,qe=Object.keys(Ot);if(qe.length>0&&typeof Ot[qe[0]]=="number"){for(var Fe=[],rt=0;rt<qe.length;++rt)me(typeof Ot[qe[rt]]=="number","must specify all vertex attribute locations when using vaos"),Fe.push([Ot[qe[rt]]|0,qe[rt]]);return Fe}}return null}function zi(Ce,se,Ge){var lt=Ce.static,Ot=Ce.dynamic;function qe(we){if(we in lt){var ct=ge.id(lt[we]);me.optional(function(){wr.shader(hh[we],ct,me.guessCommand())});var wt=Po(function(){return ct});return wt.id=ct,wt}else if(we in Ot){var fr=Ot[we];return Zs(fr,function(zr,Ur){var nn=zr.invoke(Ur,fr),Dr=Ur.def(zr.shared.strings,".id(",nn,")");return me.optional(function(){Ur(zr.shared.shader,".shader(",hh[we],",",Dr,",",zr.command,");")}),Dr})}return null}var Fe=qe(hc),rt=qe(_l),_e=null,je;return gc(Fe)&&gc(rt)?(_e=wr.program(rt.id,Fe.id,null,Ge),je=Po(function(we,ct){return we.link(_e)})):je=new Ki(Fe&&Fe.thisDep||rt&&rt.thisDep,Fe&&Fe.contextDep||rt&&rt.contextDep,Fe&&Fe.propDep||rt&&rt.propDep,function(we,ct){var wt=we.shared.shader,fr;Fe?fr=Fe.append(we,ct):fr=ct.def(wt,".",hc);var zr;rt?zr=rt.append(we,ct):zr=ct.def(wt,".",_l);var Ur=wt+".program("+zr+","+fr;return me.optional(function(){Ur+=","+we.command}),ct.def(Ur+")")}),{frag:Fe,vert:rt,progVar:je,program:_e}}function so(Ce,se){var Ge=Ce.static,lt=Ce.dynamic,Ot={},qe=!1;function Fe(){if(Qf in Ge){var An=Ge[Qf];return An!==null&&yr.getVAO(An)===null&&(An=yr.createVAO(An)),qe=!0,Ot.vao=An,Po(function(En){var bn=yr.getVAO(An);return bn?En.link(bn):"null"})}else if(Qf in lt){qe=!0;var un=lt[Qf];return Zs(un,function(En,bn){var ln=En.invoke(bn,un);return bn.def(En.shared.vao+".getVAO("+ln+")")})}return null}var rt=Fe(),_e=!1;function je(){if(au in Ge){var An=Ge[au];if(Ot.elements=An,Bp(An)){var un=Ot.elements=Lt.create(An,!0);An=Lt.getElements(un),_e=!0}else An&&(An=Lt.getElements(An),_e=!0,me.command(An,"invalid elements",se.commandStr));var En=Po(function(ln,ei){if(An){var Sa=ln.link(An);return ln.ELEMENTS=Sa,Sa}return ln.ELEMENTS=null,null});return En.value=An,En}else if(au in lt){_e=!0;var bn=lt[au];return Zs(bn,function(ln,ei){var Sa=ln.shared,ls=Sa.isBufferArgs,Ga=Sa.elements,_a=ln.invoke(ei,bn),Xl=ei.def("null"),js=ei.def(ls,"(",_a,")"),Cl=ln.cond(js).then(Xl,"=",Ga,".createStream(",_a,");").else(Xl,"=",Ga,".getElements(",_a,");");return me.optional(function(){ln.assert(Cl.else,"!"+_a+"||"+Xl,"invalid elements")}),ei.entry(Cl),ei.exit(ln.cond(js).then(Ga,".destroyStream(",Xl,");")),ln.ELEMENTS=Xl,Xl})}else if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(ln,ei){return ei.def(ln.shared.vao+".currentVAO?"+ln.shared.elements+".getElements("+ln.shared.vao+".currentVAO.elements):null")});return null}var we=je();function ct(){if(Bo in Ge){var An=Ge[Bo];return Ot.primitive=An,me.commandParameter(An,ar,"invalid primitve",se.commandStr),Po(function(En,bn){return ar[An]})}else if(Bo in lt){var un=lt[Bo];return Zs(un,function(En,bn){var ln=En.constants.primTypes,ei=En.invoke(bn,un);return me.optional(function(){En.assert(bn,ei+" in "+ln,"invalid primitive, must be one of "+Object.keys(ar))}),bn.def(ln,"[",ei,"]")})}else{if(_e)return gc(we)?we.value?Po(function(En,bn){return bn.def(En.ELEMENTS,".primType")}):Po(function(){return kp}):new Ki(we.thisDep,we.contextDep,we.propDep,function(En,bn){var ln=En.ELEMENTS;return bn.def(ln,"?",ln,".primType:",kp)});if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(En,bn){return bn.def(En.shared.vao+".currentVAO?"+En.shared.vao+".currentVAO.primitive:"+kp)})}return null}function wt(An,un){if(An in Ge){var En=Ge[An]|0;return un?Ot.offset=En:Ot.instances=En,me.command(!un||En>=0,"invalid "+An,se.commandStr),Po(function(ln,ei){return un&&(ln.OFFSET=En),En})}else if(An in lt){var bn=lt[An];return Zs(bn,function(ln,ei){var Sa=ln.invoke(ei,bn);return un&&(ln.OFFSET=Sa,me.optional(function(){ln.assert(ei,Sa+">=0","invalid "+An)})),Sa})}else if(un){if(_e)return Po(function(ln,ei){return ln.OFFSET=0,0});if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(ln,ei){return ei.def(ln.shared.vao+".currentVAO?"+ln.shared.vao+".currentVAO.offset:0")})}else if(qe)return new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(ln,ei){return ei.def(ln.shared.vao+".currentVAO?"+ln.shared.vao+".currentVAO.instances:-1")});return null}var fr=wt($f,!0);function zr(){if(Yc in Ge){var An=Ge[Yc]|0;return Ot.count=An,me.command(typeof An=="number"&&An>=0,"invalid vertex count",se.commandStr),Po(function(){return An})}else if(Yc in lt){var un=lt[Yc];return Zs(un,function(ei,Sa){var ls=ei.invoke(Sa,un);return me.optional(function(){ei.assert(Sa,"typeof "+ls+'==="number"&&'+ls+">=0&&"+ls+"===("+ls+"|0)","invalid vertex count")}),ls})}else if(_e)if(gc(we)){if(we)return fr?new Ki(fr.thisDep,fr.contextDep,fr.propDep,function(ei,Sa){var ls=Sa.def(ei.ELEMENTS,".vertCount-",ei.OFFSET);return me.optional(function(){ei.assert(Sa,ls+">=0","invalid vertex offset/element buffer too small")}),ls}):Po(function(ei,Sa){return Sa.def(ei.ELEMENTS,".vertCount")});var En=Po(function(){return-1});return me.optional(function(){En.MISSING=!0}),En}else{var bn=new Ki(we.thisDep||fr.thisDep,we.contextDep||fr.contextDep,we.propDep||fr.propDep,function(ei,Sa){var ls=ei.ELEMENTS;return ei.OFFSET?Sa.def(ls,"?",ls,".vertCount-",ei.OFFSET,":-1"):Sa.def(ls,"?",ls,".vertCount:-1")});return me.optional(function(){bn.DYNAMIC=!0}),bn}else if(qe){var ln=new Ki(rt.thisDep,rt.contextDep,rt.propDep,function(ei,Sa){return Sa.def(ei.shared.vao,".currentVAO?",ei.shared.vao,".currentVAO.count:-1")});return ln}return null}var Ur=ct(),nn=zr(),Dr=wt(Pp,!1);return{elements:we,primitive:Ur,count:nn,instances:Dr,offset:fr,vao:rt,vaoActive:qe,elementsActive:_e,static:Ot}}function uo(Ce,se){var Ge=Ce.static,lt=Ce.dynamic,Ot={};return Bn.forEach(function(qe){var Fe=xn(qe);function rt(_e,je){if(qe in Ge){var we=_e(Ge[qe]);Ot[Fe]=Po(function(){return we})}else if(qe in lt){var ct=lt[qe];Ot[Fe]=Zs(ct,function(wt,fr){return je(wt,fr,wt.invoke(fr,ct))})}}switch(qe){case gl:case Os:case po:case oa:case mu:case Xc:case bu:case Bu:case Nu:case Zl:return rt(function(_e){return me.commandType(_e,"boolean",qe,se.commandStr),_e},function(_e,je,we){return me.optional(function(){_e.assert(je,"typeof "+we+'==="boolean"',"invalid flag "+qe,_e.commandStr)}),we});case Rs:return rt(function(_e){return me.commandParameter(_e,tf,"invalid "+qe,se.commandStr),tf[_e]},function(_e,je,we){var ct=_e.constants.compareFuncs;return me.optional(function(){_e.assert(je,we+" in "+ct,"invalid "+qe+", must be one of "+Object.keys(tf))}),je.def(ct,"[",we,"]")});case Cs:return rt(function(_e){return me.command(co(_e)&&_e.length===2&&typeof _e[0]=="number"&&typeof _e[1]=="number"&&_e[0]<=_e[1],"depth range is 2d array",se.commandStr),_e},function(_e,je,we){me.optional(function(){_e.assert(je,_e.shared.isArrayLike+"("+we+")&&"+we+".length===2&&typeof "+we+'[0]==="number"&&typeof '+we+'[1]==="number"&&'+we+"[0]<="+we+"[1]","depth range must be a 2d array")});var ct=je.def("+",we,"[0]"),wt=je.def("+",we,"[1]");return[ct,wt]});case ss:return rt(function(_e){me.commandType(_e,"object","blend.func",se.commandStr);var je="srcRGB"in _e?_e.srcRGB:_e.src,we="srcAlpha"in _e?_e.srcAlpha:_e.src,ct="dstRGB"in _e?_e.dstRGB:_e.dst,wt="dstAlpha"in _e?_e.dstAlpha:_e.dst;return me.commandParameter(je,el,Fe+".srcRGB",se.commandStr),me.commandParameter(we,el,Fe+".srcAlpha",se.commandStr),me.commandParameter(ct,el,Fe+".dstRGB",se.commandStr),me.commandParameter(wt,el,Fe+".dstAlpha",se.commandStr),me.command(Rf.indexOf(je+", "+ct)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+je+", "+ct+")",se.commandStr),[el[je],el[ct],el[we],el[wt]]},function(_e,je,we){var ct=_e.constants.blendFuncs;me.optional(function(){_e.assert(je,we+"&&typeof "+we+'==="object"',"invalid blend func, must be an object")});function wt(un,En){var bn=je.def('"',un,En,'" in ',we,"?",we,".",un,En,":",we,".",un);return me.optional(function(){_e.assert(je,bn+" in "+ct,"invalid "+qe+"."+un+En+", must be one of "+Object.keys(el))}),bn}var fr=wt("src","RGB"),zr=wt("dst","RGB");me.optional(function(){var un=_e.constants.invalidBlendCombinations;_e.assert(je,un+".indexOf("+fr+'+", "+'+zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Ur=je.def(ct,"[",fr,"]"),nn=je.def(ct,"[",wt("src","Alpha"),"]"),Dr=je.def(ct,"[",zr,"]"),An=je.def(ct,"[",wt("dst","Alpha"),"]");return[Ur,Dr,nn,An]});case Du:return rt(function(_e){if(typeof _e=="string")return me.commandParameter(_e,Vt,"invalid "+qe,se.commandStr),[Vt[_e],Vt[_e]];if(typeof _e=="object")return me.commandParameter(_e.rgb,Vt,qe+".rgb",se.commandStr),me.commandParameter(_e.alpha,Vt,qe+".alpha",se.commandStr),[Vt[_e.rgb],Vt[_e.alpha]];me.commandRaise("invalid blend.equation",se.commandStr)},function(_e,je,we){var ct=_e.constants.blendEquations,wt=je.def(),fr=je.def(),zr=_e.cond("typeof ",we,'==="string"');return me.optional(function(){function Ur(nn,Dr,An){_e.assert(nn,An+" in "+ct,"invalid "+Dr+", must be one of "+Object.keys(Vt))}Ur(zr.then,qe,we),_e.assert(zr.else,we+"&&typeof "+we+'==="object"',"invalid "+qe),Ur(zr.else,qe+".rgb",we+".rgb"),Ur(zr.else,qe+".alpha",we+".alpha")}),zr.then(wt,"=",fr,"=",ct,"[",we,"];"),zr.else(wt,"=",ct,"[",we,".rgb];",fr,"=",ct,"[",we,".alpha];"),je(zr),[wt,fr]});case os:return rt(function(_e){return me.command(co(_e)&&_e.length===4,"blend.color must be a 4d array",se.commandStr),He(4,function(je){return+_e[je]})},function(_e,je,we){return me.optional(function(){_e.assert(je,_e.shared.isArrayLike+"("+we+")&&"+we+".length===4","blend.color must be a 4d array")}),He(4,function(ct){return je.def("+",we,"[",ct,"]")})});case zs:return rt(function(_e){return me.commandType(_e,"number",Fe,se.commandStr),_e|0},function(_e,je,we){return me.optional(function(){_e.assert(je,"typeof "+we+'==="number"',"invalid stencil.mask")}),je.def(we,"|0")});case Jo:return rt(function(_e){me.commandType(_e,"object",Fe,se.commandStr);var je=_e.cmp||"keep",we=_e.ref||0,ct="mask"in _e?_e.mask:-1;return me.commandParameter(je,tf,qe+".cmp",se.commandStr),me.commandType(we,"number",qe+".ref",se.commandStr),me.commandType(ct,"number",qe+".mask",se.commandStr),[tf[je],we,ct]},function(_e,je,we){var ct=_e.constants.compareFuncs;me.optional(function(){function Ur(){_e.assert(je,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Ur(we+"&&typeof ",we,'==="object"'),Ur('!("cmp" in ',we,")||(",we,".cmp in ",ct,")")});var wt=je.def('"cmp" in ',we,"?",ct,"[",we,".cmp]",":",Eu),fr=je.def(we,".ref|0"),zr=je.def('"mask" in ',we,"?",we,".mask|0:-1");return[wt,fr,zr]});case gu:case Wc:return rt(function(_e){me.commandType(_e,"object",Fe,se.commandStr);var je=_e.fail||"keep",we=_e.zfail||"keep",ct=_e.zpass||"keep";return me.commandParameter(je,mc,qe+".fail",se.commandStr),me.commandParameter(we,mc,qe+".zfail",se.commandStr),me.commandParameter(ct,mc,qe+".zpass",se.commandStr),[qe===Wc?Jc:El,mc[je],mc[we],mc[ct]]},function(_e,je,we){var ct=_e.constants.stencilOps;me.optional(function(){_e.assert(je,we+"&&typeof "+we+'==="object"',"invalid "+qe)});function wt(fr){return me.optional(function(){_e.assert(je,'!("'+fr+'" in '+we+")||("+we+"."+fr+" in "+ct+")","invalid "+qe+"."+fr+", must be one of "+Object.keys(mc))}),je.def('"',fr,'" in ',we,"?",ct,"[",we,".",fr,"]:",Eu)}return[qe===Wc?Jc:El,wt("fail"),wt("zfail"),wt("zpass")]});case Eo:return rt(function(_e){me.commandType(_e,"object",Fe,se.commandStr);var je=_e.factor|0,we=_e.units|0;return me.commandType(je,"number",Fe+".factor",se.commandStr),me.commandType(we,"number",Fe+".units",se.commandStr),[je,we]},function(_e,je,we){me.optional(function(){_e.assert(je,we+"&&typeof "+we+'==="object"',"invalid "+qe)});var ct=je.def(we,".factor|0"),wt=je.def(we,".units|0");return[ct,wt]});case jl:return rt(function(_e){var je=0;return _e==="front"?je=El:_e==="back"&&(je=Jc),me.command(!!je,Fe,se.commandStr),je},function(_e,je,we){return me.optional(function(){_e.assert(je,we+'==="front"||'+we+'==="back"',"invalid cull.face")}),je.def(we,'==="front"?',El,":",Jc)});case yl:return rt(function(_e){return me.command(typeof _e=="number"&&_e>=Dt.lineWidthDims[0]&&_e<=Dt.lineWidthDims[1],"invalid line width, must be a positive number between "+Dt.lineWidthDims[0]+" and "+Dt.lineWidthDims[1],se.commandStr),_e},function(_e,je,we){return me.optional(function(){_e.assert(je,"typeof "+we+'==="number"&&'+we+">="+Dt.lineWidthDims[0]+"&&"+we+"<="+Dt.lineWidthDims[1],"invalid line width")}),we});case ru:return rt(function(_e){return me.commandParameter(_e,rf,Fe,se.commandStr),rf[_e]},function(_e,je,we){return me.optional(function(){_e.assert(je,we+'==="cw"||'+we+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),je.def(we+'==="cw"?'+qh+":"+Dp)});case Fu:return rt(function(_e){return me.command(co(_e)&&_e.length===4,"color.mask must be length 4 array",se.commandStr),_e.map(function(je){return!!je})},function(_e,je,we){return me.optional(function(){_e.assert(je,_e.shared.isArrayLike+"("+we+")&&"+we+".length===4","invalid color.mask")}),He(4,function(ct){return"!!"+we+"["+ct+"]"})});case Ju:return rt(function(_e){me.command(typeof _e=="object"&&_e,Fe,se.commandStr);var je="value"in _e?_e.value:1,we=!!_e.invert;return me.command(typeof je=="number"&&je>=0&&je<=1,"sample.coverage.value must be a number between 0 and 1",se.commandStr),[je,we]},function(_e,je,we){me.optional(function(){_e.assert(je,we+"&&typeof "+we+'==="object"',"invalid sample.coverage")});var ct=je.def('"value" in ',we,"?+",we,".value:1"),wt=je.def("!!",we,".invert");return[ct,wt]})}}),Ot}function Bi(Ce,se){var Ge=Ce.static,lt=Ce.dynamic,Ot={};return Object.keys(Ge).forEach(function(qe){var Fe=Ge[qe],rt;if(typeof Fe=="number"||typeof Fe=="boolean")rt=Po(function(){return Fe});else if(typeof Fe=="function"){var _e=Fe._reglType;_e==="texture2d"||_e==="textureCube"?rt=Po(function(je){return je.link(Fe)}):_e==="framebuffer"||_e==="framebufferCube"?(me.command(Fe.color.length>0,'missing color attachment for framebuffer sent to uniform "'+qe+'"',se.commandStr),rt=Po(function(je){return je.link(Fe.color[0])})):me.commandRaise('invalid data for uniform "'+qe+'"',se.commandStr)}else co(Fe)?rt=Po(function(je){var we=je.global.def("[",He(Fe.length,function(ct){return me.command(typeof Fe[ct]=="number"||typeof Fe[ct]=="boolean","invalid uniform "+qe,je.commandStr),Fe[ct]}),"]");return we}):me.commandRaise('invalid or missing data for uniform "'+qe+'"',se.commandStr);rt.value=Fe,Ot[qe]=rt}),Object.keys(lt).forEach(function(qe){var Fe=lt[qe];Ot[qe]=Zs(Fe,function(rt,_e){return rt.invoke(_e,Fe)})}),Ot}function es(Ce,se){var Ge=Ce.static,lt=Ce.dynamic,Ot={};return Object.keys(Ge).forEach(function(qe){var Fe=Ge[qe],rt=ge.id(qe),_e=new st;if(Bp(Fe))_e.state=jn,_e.buffer=ir.getBuffer(ir.create(Fe,Kc,!1,!0)),_e.type=0;else{var je=ir.getBuffer(Fe);if(je)_e.state=jn,_e.buffer=je,_e.type=0;else if(me.command(typeof Fe=="object"&&Fe,"invalid data for attribute "+qe,se.commandStr),"constant"in Fe){var we=Fe.constant;_e.buffer="null",_e.state=mi,typeof we=="number"?_e.x=we:(me.command(co(we)&&we.length>0&&we.length<=4,"invalid constant for attribute "+qe,se.commandStr),li.forEach(function(Dr,An){An<we.length&&(_e[Dr]=we[An])}))}else{Bp(Fe.buffer)?je=ir.getBuffer(ir.create(Fe.buffer,Kc,!1,!0)):je=ir.getBuffer(Fe.buffer),me.command(!!je,'missing buffer for attribute "'+qe+'"',se.commandStr);var ct=Fe.offset|0;me.command(ct>=0,'invalid offset for attribute "'+qe+'"',se.commandStr);var wt=Fe.stride|0;me.command(wt>=0&&wt<256,'invalid stride for attribute "'+qe+'", must be integer betweeen [0, 255]',se.commandStr);var fr=Fe.size|0;me.command(!("size"in Fe)||fr>0&&fr<=4,'invalid size for attribute "'+qe+'", must be 1,2,3,4',se.commandStr);var zr=!!Fe.normalized,Ur=0;"type"in Fe&&(me.commandParameter(Fe.type,uu,"invalid type for attribute "+qe,se.commandStr),Ur=uu[Fe.type]);var nn=Fe.divisor|0;me.optional(function(){"divisor"in Fe&&(me.command(nn===0||_r,'cannot specify divisor for attribute "'+qe+'", instancing not supported',se.commandStr),me.command(nn>=0,'invalid divisor for attribute "'+qe+'"',se.commandStr));var Dr=se.commandStr,An=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Fe).forEach(function(un){me.command(An.indexOf(un)>=0,'unknown parameter "'+un+'" for attribute pointer "'+qe+'" (valid parameters are '+An+")",Dr)})}),_e.buffer=je,_e.state=jn,_e.size=fr,_e.normalized=zr,_e.type=Ur||je.dtype,_e.offset=ct,_e.stride=wt,_e.divisor=nn}}Ot[qe]=Po(function(Dr,An){var un=Dr.attribCache;if(rt in un)return un[rt];var En={isStream:!1};return Object.keys(_e).forEach(function(bn){En[bn]=_e[bn]}),_e.buffer&&(En.buffer=Dr.link(_e.buffer),En.type=En.type||En.buffer+".dtype"),un[rt]=En,En})}),Object.keys(lt).forEach(function(qe){var Fe=lt[qe];function rt(_e,je){var we=_e.invoke(je,Fe),ct=_e.shared,wt=_e.constants,fr=ct.isBufferArgs,zr=ct.buffer;me.optional(function(){_e.assert(je,we+"&&(typeof "+we+'==="object"||typeof '+we+'==="function")&&('+fr+"("+we+")||"+zr+".getBuffer("+we+")||"+zr+".getBuffer("+we+".buffer)||"+fr+"("+we+'.buffer)||("constant" in '+we+"&&(typeof "+we+'.constant==="number"||'+ct.isArrayLike+"("+we+".constant))))",'invalid dynamic attribute "'+qe+'"')});var Ur={isStream:je.def(!1)},nn=new st;nn.state=jn,Object.keys(nn).forEach(function(En){Ur[En]=je.def(""+nn[En])});var Dr=Ur.buffer,An=Ur.type;je("if(",fr,"(",we,")){",Ur.isStream,"=true;",Dr,"=",zr,".createStream(",Kc,",",we,");",An,"=",Dr,".dtype;","}else{",Dr,"=",zr,".getBuffer(",we,");","if(",Dr,"){",An,"=",Dr,".dtype;",'}else if("constant" in ',we,"){",Ur.state,"=",mi,";","if(typeof "+we+'.constant === "number"){',Ur[li[0]],"=",we,".constant;",li.slice(1).map(function(En){return Ur[En]}).join("="),"=0;","}else{",li.map(function(En,bn){return Ur[En]+"="+we+".constant.length>"+bn+"?"+we+".constant["+bn+"]:0;"}).join(""),"}}else{","if(",fr,"(",we,".buffer)){",Dr,"=",zr,".createStream(",Kc,",",we,".buffer);","}else{",Dr,"=",zr,".getBuffer(",we,".buffer);","}",An,'="type" in ',we,"?",wt.glTypes,"[",we,".type]:",Dr,".dtype;",Ur.normalized,"=!!",we,".normalized;");function un(En){je(Ur[En],"=",we,".",En,"|0;")}return un("size"),un("offset"),un("stride"),un("divisor"),je("}}"),je.exit("if(",Ur.isStream,"){",zr,".destroyStream(",Dr,");","}"),Ur}Ot[qe]=Zs(Fe,rt)}),Ot}function Va(Ce){var se=Ce.static,Ge=Ce.dynamic,lt={};return Object.keys(se).forEach(function(Ot){var qe=se[Ot];lt[Ot]=Po(function(Fe,rt){return typeof qe=="number"||typeof qe=="boolean"?""+qe:Fe.link(qe)})}),Object.keys(Ge).forEach(function(Ot){var qe=Ge[Ot];lt[Ot]=Zs(qe,function(Fe,rt){return Fe.invoke(rt,qe)})}),lt}function No(Ce,se,Ge,lt,Ot){var qe=Ce.static,Fe=Ce.dynamic;me.optional(function(){var un=[iu,_l,hc,au,Bo,$f,Yc,Pp,pc,Qf].concat(Bn);function En(bn){Object.keys(bn).forEach(function(ln){me.command(un.indexOf(ln)>=0,'unknown parameter "'+ln+'"',Ot.commandStr)})}En(qe),En(Fe)});var rt=ci(Ce,se),_e=rn(Ce,Ot),je=Jn(Ce,_e,Ot),we=so(Ce,Ot),ct=uo(Ce,Ot),wt=zi(Ce,Ot,rt);function fr(un){var En=je[un];En&&(ct[un]=En)}fr(nu),fr(xn(wf));var zr=Object.keys(ct).length>0,Ur={framebuffer:_e,draw:we,shader:wt,state:ct,dirty:zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Ur.profile=Gr(Ce,Ot),Ur.uniforms=Bi(Ge,Ot),Ur.drawVAO=Ur.scopeVAO=we.vao,!Ur.drawVAO&&wt.program&&!rt&&Be.angle_instanced_arrays&&we.static.elements){var nn=!0,Dr=wt.program.attributes.map(function(un){var En=se.static[un];return nn=nn&&!!En,En});if(nn&&Dr.length>0){var An=yr.getVAO(yr.createVAO({attributes:Dr,elements:we.static.elements}));Ur.drawVAO=new Ki(null,null,null,function(un,En){return un.link(An)}),Ur.useVAO=!0}}return rt?Ur.useVAO=!0:Ur.attributes=es(se,Ot),Ur.context=Va(lt,Ot),Ur}function So(Ce,se,Ge){var lt=Ce.shared,Ot=lt.context,qe=Ce.scope();Object.keys(Ge).forEach(function(Fe){se.save(Ot,"."+Fe);var rt=Ge[Fe],_e=rt.append(Ce,se);Array.isArray(_e)?qe(Ot,".",Fe,"=[",_e.join(),"];"):qe(Ot,".",Fe,"=",_e,";")}),se(qe)}function Wo(Ce,se,Ge,lt){var Ot=Ce.shared,qe=Ot.gl,Fe=Ot.framebuffer,rt;Nr&&(rt=se.def(Ot.extensions,".webgl_draw_buffers"));var _e=Ce.constants,je=_e.drawBuffer,we=_e.backBuffer,ct;Ge?ct=Ge.append(Ce,se):ct=se.def(Fe,".next"),lt||se("if(",ct,"!==",Fe,".cur){"),se("if(",ct,"){",qe,".bindFramebuffer(",$h,",",ct,".framebuffer);"),Nr&&se(rt,".drawBuffersWEBGL(",je,"[",ct,".colorAttachments.length]);"),se("}else{",qe,".bindFramebuffer(",$h,",null);"),Nr&&se(rt,".drawBuffersWEBGL(",we,");"),se("}",Fe,".cur=",ct,";"),lt||se("}")}function Io(Ce,se,Ge){var lt=Ce.shared,Ot=lt.gl,qe=Ce.current,Fe=Ce.next,rt=lt.current,_e=lt.next,je=Ce.cond(rt,".dirty");Bn.forEach(function(we){var ct=xn(we);if(!(ct in Ge.state)){var wt,fr;if(ct in Fe){wt=Fe[ct],fr=qe[ct];var zr=He(Rr[ct].length,function(nn){return je.def(wt,"[",nn,"]")});je(Ce.cond(zr.map(function(nn,Dr){return nn+"!=="+fr+"["+Dr+"]"}).join("||")).then(Ot,".",nr[ct],"(",zr,");",zr.map(function(nn,Dr){return fr+"["+Dr+"]="+nn}).join(";"),";"))}else{wt=je.def(_e,".",ct);var Ur=Ce.cond(wt,"!==",rt,".",ct);je(Ur),ct in er?Ur(Ce.cond(wt).then(Ot,".enable(",er[ct],");").else(Ot,".disable(",er[ct],");"),rt,".",ct,"=",wt,";"):Ur(Ot,".",nr[ct],"(",wt,");",rt,".",ct,"=",wt,";")}}}),Object.keys(Ge.state).length===0&&je(rt,".dirty=false;"),se(je)}function us(Ce,se,Ge,lt){var Ot=Ce.shared,qe=Ce.current,Fe=Ot.current,rt=Ot.gl;Oa(Object.keys(Ge)).forEach(function(_e){var je=Ge[_e];if(!(lt&&!lt(je))){var we=je.append(Ce,se);if(er[_e]){var ct=er[_e];gc(je)?we?se(rt,".enable(",ct,");"):se(rt,".disable(",ct,");"):se(Ce.cond(we).then(rt,".enable(",ct,");").else(rt,".disable(",ct,");")),se(Fe,".",_e,"=",we,";")}else if(co(we)){var wt=qe[_e];se(rt,".",nr[_e],"(",we,");",we.map(function(fr,zr){return wt+"["+zr+"]="+fr}).join(";"),";")}else se(rt,".",nr[_e],"(",we,");",Fe,".",_e,"=",we,";")}})}function ho(Ce,se){_r&&(Ce.instancing=se.def(Ce.shared.extensions,".angle_instanced_arrays"))}function _i(Ce,se,Ge,lt,Ot){var qe=Ce.shared,Fe=Ce.stats,rt=qe.current,_e=qe.timer,je=Ge.profile;function we(){var un=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;return un||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ct,wt;function fr(un){ct=se.def(),un(ct,"=",we(),";"),typeof Ot=="string"?un(Fe,".count+=",Ot,";"):un(Fe,".count++;"),mr&&(lt?(wt=se.def(),un(wt,"=",_e,".getNumPendingQueries();")):un(_e,".beginQuery(",Fe,");"))}function zr(un){un(Fe,".cpuTime+=",we(),"-",ct,";"),mr&&(lt?un(_e,".pushScopeStats(",wt,",",_e,".getNumPendingQueries(),",Fe,");"):un(_e,".endQuery();"))}function Ur(un){var En=se.def(rt,".profile");se(rt,".profile=",un,";"),se.exit(rt,".profile=",En,";")}var nn;if(je){if(gc(je)){je.enable?(fr(se),zr(se.exit),Ur("true")):Ur("false");return}nn=je.append(Ce,se),Ur(nn)}else nn=se.def(rt,".profile");var Dr=Ce.block();fr(Dr),se("if(",nn,"){",Dr,"}");var An=Ce.block();zr(An),se.exit("if(",nn,"){",An,"}")}function Oo(Ce,se,Ge,lt,Ot){var qe=Ce.shared;function Fe(_e){switch(_e){case rp:case Lp:case ap:return 2;case Vl:case Gl:case $c:return 3;case bl:case ip:case If:return 4;default:return 1}}function rt(_e,je,we){var ct=qe.gl,wt=se.def(_e,".location"),fr=se.def(qe.attributes,"[",wt,"]"),zr=we.state,Ur=we.buffer,nn=[we.x,we.y,we.z,we.w],Dr=["buffer","normalized","offset","stride"];function An(){se("if(!",fr,".buffer){",ct,".enableVertexAttribArray(",wt,");}");var En=we.type,bn;if(we.size?bn=se.def(we.size,"||",je):bn=je,se("if(",fr,".type!==",En,"||",fr,".size!==",bn,"||",Dr.map(function(ei){return fr+"."+ei+"!=="+we[ei]}).join("||"),"){",ct,".bindBuffer(",Kc,",",Ur,".buffer);",ct,".vertexAttribPointer(",[wt,bn,En,we.normalized,we.stride,we.offset],");",fr,".type=",En,";",fr,".size=",bn,";",Dr.map(function(ei){return fr+"."+ei+"="+we[ei]+";"}).join(""),"}"),_r){var ln=we.divisor;se("if(",fr,".divisor!==",ln,"){",Ce.instancing,".vertexAttribDivisorANGLE(",[wt,ln],");",fr,".divisor=",ln,";}")}}function un(){se("if(",fr,".buffer){",ct,".disableVertexAttribArray(",wt,");",fr,".buffer=null;","}if(",li.map(function(En,bn){return fr+"."+En+"!=="+nn[bn]}).join("||"),"){",ct,".vertexAttrib4f(",wt,",",nn,");",li.map(function(En,bn){return fr+"."+En+"="+nn[bn]+";"}).join(""),"}")}zr===jn?An():zr===mi?un():(se("if(",zr,"===",jn,"){"),An(),se("}else{"),un(),se("}"))}lt.forEach(function(_e){var je=_e.name,we=Ge.attributes[je],ct;if(we){if(!Ot(we))return;ct=we.append(Ce,se)}else{if(!Ot(Jh))return;var wt=Ce.scopeAttrib(je);me.optional(function(){Ce.assert(se,wt+".state","missing attribute "+je)}),ct={},Object.keys(new st).forEach(function(fr){ct[fr]=se.def(wt,".",fr)})}rt(Ce.link(_e),Fe(_e.info.type),ct)})}function ea(Ce,se,Ge,lt,Ot,qe){for(var Fe=Ce.shared,rt=Fe.gl,_e,je=0;je<lt.length;++je){var we=lt[je],ct=we.name,wt=we.info.type,fr=Ge.uniforms[ct],zr=Ce.link(we),Ur=zr+".location",nn;if(fr){if(!Ot(fr))continue;if(gc(fr)){var Dr=fr.value;if(me.command(Dr!==null&&typeof Dr!="undefined",'missing uniform "'+ct+'"',Ce.commandStr),wt===op||wt===sp){me.command(typeof Dr=="function"&&(wt===op&&(Dr._reglType==="texture2d"||Dr._reglType==="framebuffer")||wt===sp&&(Dr._reglType==="textureCube"||Dr._reglType==="framebufferCube")),"invalid texture for uniform "+ct,Ce.commandStr);var An=Ce.link(Dr._texture||Dr.color[0]._texture);se(rt,".uniform1i(",Ur,",",An+".bind());"),se.exit(An,".unbind();")}else if(wt===Us||wt===Of||wt===Qc){me.optional(function(){me.command(co(Dr),"invalid matrix for uniform "+ct,Ce.commandStr),me.command(wt===Us&&Dr.length===4||wt===Of&&Dr.length===9||wt===Qc&&Dr.length===16,"invalid length for matrix uniform "+ct,Ce.commandStr)});var un=Ce.global.def("new Float32Array(["+Array.prototype.slice.call(Dr)+"])"),En=2;wt===Of?En=3:wt===Qc&&(En=4),se(rt,".uniformMatrix",En,"fv(",Ur,",false,",un,");")}else{switch(wt){case tp:me.commandType(Dr,"number","uniform "+ct,Ce.commandStr),_e="1f";break;case rp:me.command(co(Dr)&&Dr.length===2,"uniform "+ct,Ce.commandStr),_e="2f";break;case Vl:me.command(co(Dr)&&Dr.length===3,"uniform "+ct,Ce.commandStr),_e="3f";break;case bl:me.command(co(Dr)&&Dr.length===4,"uniform "+ct,Ce.commandStr),_e="4f";break;case Pf:me.commandType(Dr,"boolean","uniform "+ct,Ce.commandStr),_e="1i";break;case np:me.commandType(Dr,"number","uniform "+ct,Ce.commandStr),_e="1i";break;case ap:me.command(co(Dr)&&Dr.length===2,"uniform "+ct,Ce.commandStr),_e="2i";break;case Lp:me.command(co(Dr)&&Dr.length===2,"uniform "+ct,Ce.commandStr),_e="2i";break;case $c:me.command(co(Dr)&&Dr.length===3,"uniform "+ct,Ce.commandStr),_e="3i";break;case Gl:me.command(co(Dr)&&Dr.length===3,"uniform "+ct,Ce.commandStr),_e="3i";break;case If:me.command(co(Dr)&&Dr.length===4,"uniform "+ct,Ce.commandStr),_e="4i";break;case ip:me.command(co(Dr)&&Dr.length===4,"uniform "+ct,Ce.commandStr),_e="4i";break}se(rt,".uniform",_e,"(",Ur,",",co(Dr)?Array.prototype.slice.call(Dr):Dr,");")}continue}else nn=fr.append(Ce,se)}else{if(!Ot(Jh))continue;nn=se.def(Fe.uniforms,"[",ge.id(ct),"]")}wt===op?(me(!Array.isArray(nn),"must specify a scalar prop for textures"),se("if(",nn,"&&",nn,'._reglType==="framebuffer"){',nn,"=",nn,".color[0];","}")):wt===sp&&(me(!Array.isArray(nn),"must specify a scalar prop for cube maps"),se("if(",nn,"&&",nn,'._reglType==="framebufferCube"){',nn,"=",nn,".color[0];","}")),me.optional(function(){function js(Zu,af){Ce.assert(se,Zu,'bad data or missing for uniform "'+ct+'".  '+af)}function Cl(Zu){me(!Array.isArray(nn),"must not specify an array type for uniform"),js("typeof "+nn+'==="'+Zu+'"',"invalid type, expected "+Zu)}function Uu(Zu,af){Array.isArray(nn)?me(nn.length===Zu,"must have length "+Zu):js(Fe.isArrayLike+"("+nn+")&&"+nn+".length==="+Zu,"invalid vector, should have length "+Zu,Ce.commandStr)}function td(Zu){me(!Array.isArray(nn),"must not specify a value type"),js("typeof "+nn+'==="function"&&'+nn+'._reglType==="texture'+(Zu===Xh?"2d":"Cube")+'"',"invalid texture type",Ce.commandStr)}switch(wt){case np:Cl("number");break;case Lp:Uu(2,"number");break;case Gl:Uu(3,"number");break;case ip:Uu(4,"number");break;case tp:Cl("number");break;case rp:Uu(2,"number");break;case Vl:Uu(3,"number");break;case bl:Uu(4,"number");break;case Pf:Cl("boolean");break;case ap:Uu(2,"boolean");break;case $c:Uu(3,"boolean");break;case If:Uu(4,"boolean");break;case Us:Uu(4,"number");break;case Of:Uu(9,"number");break;case Qc:Uu(16,"number");break;case op:td(Xh);break;case sp:td(ch);break}});var bn=1;switch(wt){case op:case sp:var ln=se.def(nn,"._texture");se(rt,".uniform1i(",Ur,",",ln,".bind());"),se.exit(ln,".unbind();");continue;case np:case Pf:_e="1i";break;case Lp:case ap:_e="2i",bn=2;break;case Gl:case $c:_e="3i",bn=3;break;case ip:case If:_e="4i",bn=4;break;case tp:_e="1f";break;case rp:_e="2f",bn=2;break;case Vl:_e="3f",bn=3;break;case bl:_e="4f",bn=4;break;case Us:_e="Matrix2fv";break;case Of:_e="Matrix3fv";break;case Qc:_e="Matrix4fv";break}if(_e.charAt(0)==="M"){se(rt,".uniform",_e,"(",Ur,",");var ei=Math.pow(wt-Us+2,2),Sa=Ce.global.def("new Float32Array(",ei,")");Array.isArray(nn)?se("false,(",He(ei,function(js){return Sa+"["+js+"]="+nn[js]}),",",Sa,")"):se("false,(Array.isArray(",nn,")||",nn," instanceof Float32Array)?",nn,":(",He(ei,function(js){return Sa+"["+js+"]="+nn+"["+js+"]"}),",",Sa,")"),se(");")}else if(bn>1){for(var ls=[],Ga=[],_a=0;_a<bn;++_a)Array.isArray(nn)?Ga.push(nn[_a]):Ga.push(se.def(nn+"["+_a+"]")),qe&&ls.push(se.def());qe&&se("if(!",Ce.batchId,"||",ls.map(function(js,Cl){return js+"!=="+Ga[Cl]}).join("||"),"){",ls.map(function(js,Cl){return js+"="+Ga[Cl]+";"}).join("")),se(rt,".uniform",_e,"(",Ur,",",Ga.join(","),");"),qe&&se("}")}else{if(me(!Array.isArray(nn),"uniform value must not be an array"),qe){var Xl=se.def();se("if(!",Ce.batchId,"||",Xl,"!==",nn,"){",Xl,"=",nn,";")}se(rt,".uniform",_e,"(",Ur,",",nn,");"),qe&&se("}")}}}function zo(Ce,se,Ge,lt){var Ot=Ce.shared,qe=Ot.gl,Fe=Ot.draw,rt=lt.draw;function _e(){var bn=rt.elements,ln,ei=se;return bn?((bn.contextDep&&lt.contextDynamic||bn.propDep)&&(ei=Ge),ln=bn.append(Ce,ei),rt.elementsActive&&ei("if("+ln+")"+qe+".bindBuffer("+Op+","+ln+".buffer.buffer);")):(ln=ei.def(),ei(ln,"=",Fe,".",au,";","if(",ln,"){",qe,".bindBuffer(",Op,",",ln,".buffer.buffer);}","else if(",Ot.vao,".currentVAO){",ln,"=",Ce.shared.elements+".getElements("+Ot.vao,".currentVAO.elements);",lr?"":"if("+ln+")"+qe+".bindBuffer("+Op+","+ln+".buffer.buffer);","}")),ln}function je(){var bn=rt.count,ln,ei=se;return bn?((bn.contextDep&&lt.contextDynamic||bn.propDep)&&(ei=Ge),ln=bn.append(Ce,ei),me.optional(function(){bn.MISSING&&Ce.assert(se,"false","missing vertex count"),bn.DYNAMIC&&Ce.assert(ei,ln+">=0","missing vertex count")})):(ln=ei.def(Fe,".",Yc),me.optional(function(){Ce.assert(ei,ln+">=0","missing vertex count")})),ln}var we=_e();function ct(bn){var ln=rt[bn];return ln?ln.contextDep&&lt.contextDynamic||ln.propDep?ln.append(Ce,Ge):ln.append(Ce,se):se.def(Fe,".",bn)}var wt=ct(Bo),fr=ct($f),zr=je();if(typeof zr=="number"){if(zr===0)return}else Ge("if(",zr,"){"),Ge.exit("}");var Ur,nn;_r&&(Ur=ct(Pp),nn=Ce.instancing);var Dr=we+".type",An=rt.elements&&gc(rt.elements)&&!rt.vaoActive;function un(){function bn(){Ge(nn,".drawElementsInstancedANGLE(",[wt,zr,Dr,fr+"<<(("+Dr+"-"+$n+")>>1)",Ur],");")}function ln(){Ge(nn,".drawArraysInstancedANGLE(",[wt,fr,zr,Ur],");")}we&&we!=="null"?An?bn():(Ge("if(",we,"){"),bn(),Ge("}else{"),ln(),Ge("}")):ln()}function En(){function bn(){Ge(qe+".drawElements("+[wt,zr,Dr,fr+"<<(("+Dr+"-"+$n+")>>1)"]+");")}function ln(){Ge(qe+".drawArrays("+[wt,fr,zr]+");")}we&&we!=="null"?An?bn():(Ge("if(",we,"){"),bn(),Ge("}else{"),ln(),Ge("}")):ln()}_r&&(typeof Ur!="number"||Ur>=0)?typeof Ur=="string"?(Ge("if(",Ur,">0){"),un(),Ge("}else if(",Ur,"<0){"),En(),Ge("}")):un():En()}function ri(Ce,se,Ge,lt,Ot){var qe=oi(),Fe=qe.proc("body",Ot);return me.optional(function(){qe.commandStr=se.commandStr,qe.command=qe.link(se.commandStr)}),_r&&(qe.instancing=Fe.def(qe.shared.extensions,".angle_instanced_arrays")),Ce(qe,Fe,Ge,lt),qe.compile().body}function Ui(Ce,se,Ge,lt){ho(Ce,se),Ge.useVAO?Ge.drawVAO?se(Ce.shared.vao,".setVAO(",Ge.drawVAO.append(Ce,se),");"):se(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(se(Ce.shared.vao,".setVAO(null);"),Oo(Ce,se,Ge,lt.attributes,function(){return!0})),ea(Ce,se,Ge,lt.uniforms,function(){return!0},!1),zo(Ce,se,se,Ge)}function va(Ce,se){var Ge=Ce.proc("draw",1);ho(Ce,Ge),So(Ce,Ge,se.context),Wo(Ce,Ge,se.framebuffer),Io(Ce,Ge,se),us(Ce,Ge,se.state),_i(Ce,Ge,se,!1,!0);var lt=se.shader.progVar.append(Ce,Ge);if(Ge(Ce.shared.gl,".useProgram(",lt,".program);"),se.shader.program)Ui(Ce,Ge,se,se.shader.program);else{Ge(Ce.shared.vao,".setVAO(null);");var Ot=Ce.global.def("{}"),qe=Ge.def(lt,".id"),Fe=Ge.def(Ot,"[",qe,"]");Ge(Ce.cond(Fe).then(Fe,".call(this,a0);").else(Fe,"=",Ot,"[",qe,"]=",Ce.link(function(rt){return ri(Ui,Ce,se,rt,1)}),"(",lt,");",Fe,".call(this,a0);"))}Object.keys(se.state).length>0&&Ge(Ce.shared.current,".dirty=true;"),Ce.shared.vao&&Ge(Ce.shared.vao,".setVAO(null);")}function Nn(Ce,se,Ge,lt){Ce.batchId="a1",ho(Ce,se);function Ot(){return!0}Oo(Ce,se,Ge,lt.attributes,Ot),ea(Ce,se,Ge,lt.uniforms,Ot,!1),zo(Ce,se,se,Ge)}function si(Ce,se,Ge,lt){ho(Ce,se);var Ot=Ge.contextDep,qe=se.def(),Fe="a0",rt="a1",_e=se.def();Ce.shared.props=_e,Ce.batchId=qe;var je=Ce.scope(),we=Ce.scope();se(je.entry,"for(",qe,"=0;",qe,"<",rt,";++",qe,"){",_e,"=",Fe,"[",qe,"];",we,"}",je.exit);function ct(Dr){return Dr.contextDep&&Ot||Dr.propDep}function wt(Dr){return!ct(Dr)}if(Ge.needsContext&&So(Ce,we,Ge.context),Ge.needsFramebuffer&&Wo(Ce,we,Ge.framebuffer),us(Ce,we,Ge.state,ct),Ge.profile&&ct(Ge.profile)&&_i(Ce,we,Ge,!1,!0),lt)Ge.useVAO?Ge.drawVAO?ct(Ge.drawVAO)?we(Ce.shared.vao,".setVAO(",Ge.drawVAO.append(Ce,we),");"):je(Ce.shared.vao,".setVAO(",Ge.drawVAO.append(Ce,je),");"):je(Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"):(je(Ce.shared.vao,".setVAO(null);"),Oo(Ce,je,Ge,lt.attributes,wt),Oo(Ce,we,Ge,lt.attributes,ct)),ea(Ce,je,Ge,lt.uniforms,wt,!1),ea(Ce,we,Ge,lt.uniforms,ct,!0),zo(Ce,je,we,Ge);else{var fr=Ce.global.def("{}"),zr=Ge.shader.progVar.append(Ce,we),Ur=we.def(zr,".id"),nn=we.def(fr,"[",Ur,"]");we(Ce.shared.gl,".useProgram(",zr,".program);","if(!",nn,"){",nn,"=",fr,"[",Ur,"]=",Ce.link(function(Dr){return ri(Nn,Ce,Ge,Dr,2)}),"(",zr,");}",nn,".call(this,a0[",qe,"],",qe,");")}}function Te(Ce,se){var Ge=Ce.proc("batch",2);Ce.batchId="0",ho(Ce,Ge);var lt=!1,Ot=!0;Object.keys(se.context).forEach(function(fr){lt=lt||se.context[fr].propDep}),lt||(So(Ce,Ge,se.context),Ot=!1);var qe=se.framebuffer,Fe=!1;qe?(qe.propDep?lt=Fe=!0:qe.contextDep&&lt&&(Fe=!0),Fe||Wo(Ce,Ge,qe)):Wo(Ce,Ge,null),se.state.viewport&&se.state.viewport.propDep&&(lt=!0);function rt(fr){return fr.contextDep&&lt||fr.propDep}Io(Ce,Ge,se),us(Ce,Ge,se.state,function(fr){return!rt(fr)}),(!se.profile||!rt(se.profile))&&_i(Ce,Ge,se,!1,"a1"),se.contextDep=lt,se.needsContext=Ot,se.needsFramebuffer=Fe;var _e=se.shader.progVar;if(_e.contextDep&&lt||_e.propDep)si(Ce,Ge,se,null);else{var je=_e.append(Ce,Ge);if(Ge(Ce.shared.gl,".useProgram(",je,".program);"),se.shader.program)si(Ce,Ge,se,se.shader.program);else{Ge(Ce.shared.vao,".setVAO(null);");var we=Ce.global.def("{}"),ct=Ge.def(je,".id"),wt=Ge.def(we,"[",ct,"]");Ge(Ce.cond(wt).then(wt,".call(this,a0,a1);").else(wt,"=",we,"[",ct,"]=",Ce.link(function(fr){return ri(si,Ce,se,fr,2)}),"(",je,");",wt,".call(this,a0,a1);"))}}Object.keys(se.state).length>0&&Ge(Ce.shared.current,".dirty=true;"),Ce.shared.vao&&Ge(Ce.shared.vao,".setVAO(null);")}function zt(Ce,se){var Ge=Ce.proc("scope",3);Ce.batchId="a2";var lt=Ce.shared,Ot=lt.current;So(Ce,Ge,se.context),se.framebuffer&&se.framebuffer.append(Ce,Ge),Oa(Object.keys(se.state)).forEach(function(Fe){var rt=se.state[Fe],_e=rt.append(Ce,Ge);co(_e)?_e.forEach(function(je,we){Ge.set(Ce.next[Fe],"["+we+"]",je)}):Ge.set(lt.next,"."+Fe,_e)}),_i(Ce,Ge,se,!0,!0),[au,$f,Yc,Pp,Bo].forEach(function(Fe){var rt=se.draw[Fe];!rt||Ge.set(lt.draw,"."+Fe,""+rt.append(Ce,Ge))}),Object.keys(se.uniforms).forEach(function(Fe){var rt=se.uniforms[Fe].append(Ce,Ge);Array.isArray(rt)&&(rt="["+rt.join()+"]"),Ge.set(lt.uniforms,"["+ge.id(Fe)+"]",rt)}),Object.keys(se.attributes).forEach(function(Fe){var rt=se.attributes[Fe].append(Ce,Ge),_e=Ce.scopeAttrib(Fe);Object.keys(new st).forEach(function(je){Ge.set(_e,"."+je,rt[je])})}),se.scopeVAO&&Ge.set(lt.vao,".targetVAO",se.scopeVAO.append(Ce,Ge));function qe(Fe){var rt=se.shader[Fe];rt&&Ge.set(lt.shader,"."+Fe,rt.append(Ce,Ge))}qe(_l),qe(hc),Object.keys(se.state).length>0&&(Ge(Ot,".dirty=true;"),Ge.exit(Ot,".dirty=true;")),Ge("a1(",Ce.shared.context,",a0,",Ce.batchId,");")}function Et(Ce){if(!(typeof Ce!="object"||co(Ce))){for(var se=Object.keys(Ce),Ge=0;Ge<se.length;++Ge)if(an.isDynamic(Ce[se[Ge]]))return!0;return!1}}function vn(Ce,se,Ge){var lt=se.static[Ge];if(!lt||!Et(lt))return;var Ot=Ce.global,qe=Object.keys(lt),Fe=!1,rt=!1,_e=!1,je=Ce.global.def("{}");qe.forEach(function(ct){var wt=lt[ct];if(an.isDynamic(wt)){typeof wt=="function"&&(wt=lt[ct]=an.unbox(wt));var fr=Zs(wt,null);Fe=Fe||fr.thisDep,_e=_e||fr.propDep,rt=rt||fr.contextDep}else{switch(Ot(je,".",ct,"="),typeof wt){case"number":Ot(wt);break;case"string":Ot('"',wt,'"');break;case"object":Array.isArray(wt)&&Ot("[",wt.join(),"]");break;default:Ot(Ce.link(wt));break}Ot(";")}});function we(ct,wt){qe.forEach(function(fr){var zr=lt[fr];if(!!an.isDynamic(zr)){var Ur=ct.invoke(wt,zr);wt(je,".",fr,"=",Ur,";")}})}se.dynamic[Ge]=new an.DynamicVariable(To,{thisDep:Fe,contextDep:rt,propDep:_e,ref:je,append:we}),delete se.static[Ge]}function Wi(Ce,se,Ge,lt,Ot){var qe=oi();qe.stats=qe.link(Ot),Object.keys(se.static).forEach(function(rt){vn(qe,se,rt)}),Md.forEach(function(rt){vn(qe,Ce,rt)});var Fe=No(Ce,se,Ge,lt,qe);return va(qe,Fe),zt(qe,Fe),Te(qe,Fe),m(qe.compile(),{destroy:function(){Fe.shader.program.destroy()}})}return{next:qr,current:Rr,procs:function(){var Ce=oi(),se=Ce.proc("poll"),Ge=Ce.proc("refresh"),lt=Ce.block();se(lt),Ge(lt);var Ot=Ce.shared,qe=Ot.gl,Fe=Ot.next,rt=Ot.current;lt(rt,".dirty=false;"),Wo(Ce,se),Wo(Ce,Ge,null,!0);var _e;_r&&(_e=Ce.link(_r)),Be.oes_vertex_array_object&&Ge(Ce.link(Be.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var je=0;je<Dt.maxAttributes;++je){var we=Ge.def(Ot.attributes,"[",je,"]"),ct=Ce.cond(we,".buffer");ct.then(qe,".enableVertexAttribArray(",je,");",qe,".bindBuffer(",Kc,",",we,".buffer.buffer);",qe,".vertexAttribPointer(",je,",",we,".size,",we,".type,",we,".normalized,",we,".stride,",we,".offset);").else(qe,".disableVertexAttribArray(",je,");",qe,".vertexAttrib4f(",je,",",we,".x,",we,".y,",we,".z,",we,".w);",we,".buffer=null;"),Ge(ct),_r&&Ge(_e,".vertexAttribDivisorANGLE(",je,",",we,".divisor);")}return Ge(Ce.shared.vao,".currentVAO=null;",Ce.shared.vao,".setVAO(",Ce.shared.vao,".targetVAO);"),Object.keys(er).forEach(function(wt){var fr=er[wt],zr=lt.def(Fe,".",wt),Ur=Ce.block();Ur("if(",zr,"){",qe,".enable(",fr,")}else{",qe,".disable(",fr,")}",rt,".",wt,"=",zr,";"),Ge(Ur),se("if(",zr,"!==",rt,".",wt,"){",Ur,"}")}),Object.keys(nr).forEach(function(wt){var fr=nr[wt],zr=Rr[wt],Ur,nn,Dr=Ce.block();if(Dr(qe,".",fr,"("),co(zr)){var An=zr.length;Ur=Ce.global.def(Fe,".",wt),nn=Ce.global.def(rt,".",wt),Dr(He(An,function(un){return Ur+"["+un+"]"}),");",He(An,function(un){return nn+"["+un+"]="+Ur+"["+un+"];"}).join("")),se("if(",He(An,function(un){return Ur+"["+un+"]!=="+nn+"["+un+"]"}).join("||"),"){",Dr,"}")}else Ur=lt.def(Fe,".",wt),nn=lt.def(rt,".",wt),Dr(Ur,");",rt,".",wt,"=",Ur,";"),se("if(",Ur,"!==",nn,"){",Dr,"}");Ge(Dr)}),Ce.compile()}(),compile:Wi}}function Ld(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Np=34918,kd=34919,vh=35007,Sl=function(N,ge){if(!ge.ext_disjoint_timer_query)return null;var Be=[];function Dt(){return Be.pop()||ge.ext_disjoint_timer_query.createQueryEXT()}function ir(_r){Be.push(_r)}var Lt=[];function Jt(_r){var Nr=Dt();ge.ext_disjoint_timer_query.beginQueryEXT(vh,Nr),Lt.push(Nr),mr(Lt.length-1,Lt.length,_r)}function cr(){ge.ext_disjoint_timer_query.endQueryEXT(vh)}function vr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var yr=[];function wr(){return yr.pop()||new vr}function Tr(_r){yr.push(_r)}var jr=[];function mr(_r,Nr,lr){var Rr=wr();Rr.startQueryIndex=_r,Rr.endQueryIndex=Nr,Rr.sum=0,Rr.stats=lr,jr.push(Rr)}var Ar=[],st=[];function Vt(){var _r,Nr,lr=Lt.length;if(lr!==0){st.length=Math.max(st.length,lr+1),Ar.length=Math.max(Ar.length,lr+1),Ar[0]=0,st[0]=0;var Rr=0;for(_r=0,Nr=0;Nr<Lt.length;++Nr){var qr=Lt[Nr];ge.ext_disjoint_timer_query.getQueryObjectEXT(qr,kd)?(Rr+=ge.ext_disjoint_timer_query.getQueryObjectEXT(qr,Np),ir(qr)):Lt[_r++]=qr,Ar[Nr+1]=Rr,st[Nr+1]=_r}for(Lt.length=_r,_r=0,Nr=0;Nr<jr.length;++Nr){var Bn=jr[Nr],er=Bn.startQueryIndex,nr=Bn.endQueryIndex;Bn.sum+=Ar[nr]-Ar[er];var xn=st[er],Vr=st[nr];Vr===xn?(Bn.stats.gpuTime+=Bn.sum/1e6,Tr(Bn)):(Bn.startQueryIndex=xn,Bn.endQueryIndex=Vr,jr[_r++]=Bn)}jr.length=_r}}return{beginQuery:Jt,endQuery:cr,pushScopeStats:mr,update:Vt,getNumPendingQueries:function(){return Lt.length},clear:function(){Be.push.apply(Be,Lt);for(var _r=0;_r<Be.length;_r++)ge.ext_disjoint_timer_query.deleteQueryEXT(Be[_r]);Lt.length=0,Be.length=0},restore:function(){Lt.length=0,Be.length=0}}},up=16384,Hl=256,ed=1024,lp=34962,nf="webglcontextlost",Ea="webglcontextrestored",zp=1,Wl=2,Lf=3;function mh(N,ge){for(var Be=0;Be<N.length;++Be)if(N[Be]===ge)return Be;return-1}function Dd(N){var ge=ye(N);if(!ge)return null;var Be=ge.gl,Dt=Be.getContextAttributes(),ir=Be.isContextLost(),Lt=Pe(Be,ge);if(!Lt)return null;var Jt=vs(),cr=Ld(),vr=Lt.extensions,yr=Sl(Be,vr),wr=ao(),Tr=Be.drawingBufferWidth,jr=Be.drawingBufferHeight,mr={tick:0,time:0,viewportWidth:Tr,viewportHeight:jr,framebufferWidth:Tr,framebufferHeight:jr,drawingBufferWidth:Tr,drawingBufferHeight:jr,pixelRatio:ge.pixelRatio},Ar={},st={elements:null,primitive:4,count:-1,offset:0,instances:-1},Vt=wl(Be,vr),_r=B(Be,cr,ge,Rr),Nr=ol(Be,vr,_r,cr),lr=vt(Be,vr,Vt,cr,_r,Nr,st);function Rr(ri){return lr.destroyBuffer(ri)}var qr=Lr(Be,Jt,cr,ge),Bn=Ss(Be,vr,Vt,function(){xn.procs.poll()},mr,cr,ge),er=cc(Be,vr,Vt,cr,ge),nr=Re(Be,vr,Vt,Bn,er,cr),xn=dh(Be,Jt,vr,Vt,_r,Nr,Bn,nr,Ar,lr,qr,st,mr,yr,ge),Vr=Ln(Be,nr,xn.procs.poll,mr,Dt,vr,Vt),Er=xn.next,Xr=Be.canvas,Yr=[],yi=[],oi=[],Gr=[ge.onDestroy],rn=null;function Jn(){if(Yr.length===0){yr&&yr.update(),rn=null;return}rn=Fi.next(Jn),ho();for(var ri=Yr.length-1;ri>=0;--ri){var Ui=Yr[ri];Ui&&Ui(mr,null,0)}Be.flush(),yr&&yr.update()}function ci(){!rn&&Yr.length>0&&(rn=Fi.next(Jn))}function zi(){rn&&(Fi.cancel(Jn),rn=null)}function so(ri){ri.preventDefault(),ir=!0,zi(),yi.forEach(function(Ui){Ui()})}function uo(ri){Be.getError(),ir=!1,Lt.restore(),qr.restore(),_r.restore(),Bn.restore(),er.restore(),nr.restore(),lr.restore(),yr&&yr.restore(),xn.procs.refresh(),ci(),oi.forEach(function(Ui){Ui()})}var Bi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0;!Bi&&Xr&&(Xr.addEventListener(nf,so,!1),Xr.addEventListener(Ea,uo,!1));function es(){Yr.length=0,zi(),!Bi&&Xr&&(Xr.removeEventListener(nf,so),Xr.removeEventListener(Ea,uo)),qr.clear(),nr.clear(),er.clear(),lr.clear(),Bn.clear(),Nr.clear(),_r.clear(),yr&&yr.clear(),Gr.forEach(function(ri){ri()})}function Va(ri){me(!!ri,"invalid args to regl({...})"),me.type(ri,"object","invalid args to regl({...})");function Ui(qe){var Fe=m({},qe);delete Fe.uniforms,delete Fe.attributes,delete Fe.context,delete Fe.vao,"stencil"in Fe&&Fe.stencil.op&&(Fe.stencil.opBack=Fe.stencil.opFront=Fe.stencil.op,delete Fe.stencil.op);function rt(_e){if(_e in Fe){var je=Fe[_e];delete Fe[_e],Object.keys(je).forEach(function(we){Fe[_e+"."+we]=je[we]})}}return rt("blend"),rt("depth"),rt("cull"),rt("stencil"),rt("polygonOffset"),rt("scissor"),rt("sample"),"vao"in qe&&(Fe.vao=qe.vao),Fe}function va(qe,Fe){var rt={},_e={};return Object.keys(qe).forEach(function(je){var we=qe[je];if(an.isDynamic(we)){_e[je]=an.unbox(we,je);return}else if(Fe&&Array.isArray(we)){for(var ct=0;ct<we.length;++ct)if(an.isDynamic(we[ct])){_e[je]=an.unbox(we,je);return}}rt[je]=we}),{dynamic:_e,static:rt}}var Nn=va(ri.context||{},!0),si=va(ri.uniforms||{},!0),Te=va(ri.attributes||{},!1),zt=va(Ui(ri),!1),Et={gpuTime:0,cpuTime:0,count:0},vn=xn.compile(zt,Te,si,Nn,Et),Wi=vn.draw,Ce=vn.batch,se=vn.scope,Ge=[];function lt(qe){for(;Ge.length<qe;)Ge.push(null);return Ge}function Ot(qe,Fe){var rt;if(ir&&me.raise("context lost"),typeof qe=="function")return se.call(this,null,qe,0);if(typeof Fe=="function")if(typeof qe=="number")for(rt=0;rt<qe;++rt)se.call(this,null,Fe,rt);else if(Array.isArray(qe))for(rt=0;rt<qe.length;++rt)se.call(this,qe[rt],Fe,rt);else return se.call(this,qe,Fe,0);else if(typeof qe=="number"){if(qe>0)return Ce.call(this,lt(qe|0),qe|0)}else if(Array.isArray(qe)){if(qe.length)return Ce.call(this,qe,qe.length)}else return Wi.call(this,qe)}return m(Ot,{stats:Et,destroy:function(){vn.destroy()}})}var No=nr.setFBO=Va({framebuffer:an.define.call(null,zp,"framebuffer")});function So(ri,Ui){var va=0;xn.procs.poll();var Nn=Ui.color;Nn&&(Be.clearColor(+Nn[0]||0,+Nn[1]||0,+Nn[2]||0,+Nn[3]||0),va|=up),"depth"in Ui&&(Be.clearDepth(+Ui.depth),va|=Hl),"stencil"in Ui&&(Be.clearStencil(Ui.stencil|0),va|=ed),me(!!va,"called regl.clear with no buffer specified"),Be.clear(va)}function Wo(ri){if(me(typeof ri=="object"&&ri,"regl.clear() takes an object as input"),"framebuffer"in ri)if(ri.framebuffer&&ri.framebuffer_reglType==="framebufferCube")for(var Ui=0;Ui<6;++Ui)No(m({framebuffer:ri.framebuffer.faces[Ui]},ri),So);else No(ri,So);else So(null,ri)}function Io(ri){me.type(ri,"function","regl.frame() callback must be a function"),Yr.push(ri);function Ui(){var va=mh(Yr,ri);me(va>=0,"cannot cancel a frame twice");function Nn(){var si=mh(Yr,Nn);Yr[si]=Yr[Yr.length-1],Yr.length-=1,Yr.length<=0&&zi()}Yr[va]=Nn}return ci(),{cancel:Ui}}function us(){var ri=Er.viewport,Ui=Er.scissor_box;ri[0]=ri[1]=Ui[0]=Ui[1]=0,mr.viewportWidth=mr.framebufferWidth=mr.drawingBufferWidth=ri[2]=Ui[2]=Be.drawingBufferWidth,mr.viewportHeight=mr.framebufferHeight=mr.drawingBufferHeight=ri[3]=Ui[3]=Be.drawingBufferHeight}function ho(){mr.tick+=1,mr.time=Oo(),us(),xn.procs.poll()}function _i(){Bn.refresh(),us(),xn.procs.refresh(),yr&&yr.update()}function Oo(){return(ao()-wr)/1e3}_i();function ea(ri,Ui){me.type(Ui,"function","listener callback must be a function");var va;switch(ri){case"frame":return Io(Ui);case"lost":va=yi;break;case"restore":va=oi;break;case"destroy":va=Gr;break;default:me.raise("invalid event, must be one of frame,lost,restore,destroy")}return va.push(Ui),{cancel:function(){for(var Nn=0;Nn<va.length;++Nn)if(va[Nn]===Ui){va[Nn]=va[va.length-1],va.pop();return}}}}var zo=m(Va,{clear:Wo,prop:an.define.bind(null,zp),context:an.define.bind(null,Wl),this:an.define.bind(null,Lf),draw:Va({}),buffer:function(ri){return _r.create(ri,lp,!1,!1)},elements:function(ri){return Nr.create(ri,!1)},texture:Bn.create2D,cube:Bn.createCube,renderbuffer:er.create,framebuffer:nr.create,framebufferCube:nr.createCube,vao:lr.createVAO,attributes:Dt,frame:Io,on:ea,limits:Vt,hasExtension:function(ri){return Vt.extensions.indexOf(ri.toLowerCase())>=0},read:Vr,destroy:es,_gl:Be,_refresh:_i,poll:function(){ho(),yr&&yr.update()},now:Oo,stats:cr});return ge.onDone(null,zo),zo}return Dd})},77412:function(Mt){function Q(U,ie){for(var re=-1,m=U==null?0:U.length;++re<m&&ie(U[re],re,U)!==!1;);return U}Mt.exports=Q},47443:function(Mt,Q,U){var ie=U(42118);function re(m,he){var V=m==null?0:m.length;return!!V&&ie(m,he,0)>-1}Mt.exports=re},1196:function(Mt){function Q(U,ie,re){for(var m=-1,he=U==null?0:U.length;++m<he;)if(re(ie,U[m]))return!0;return!1}Mt.exports=Q},62663:function(Mt){function Q(U,ie,re,m){var he=-1,V=U==null?0:U.length;for(m&&V&&(re=U[++he]);++he<V;)re=ie(re,U[he],he,U);return re}Mt.exports=Q},49029:function(Mt){var Q=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function U(ie){return ie.match(Q)||[]}Mt.exports=U},44037:function(Mt,Q,U){var ie=U(98363),re=U(3674);function m(he,V){return he&&ie(V,re(V),he)}Mt.exports=m},63886:function(Mt,Q,U){var ie=U(98363),re=U(81704);function m(he,V){return he&&ie(V,re(V),he)}Mt.exports=m},29750:function(Mt){function Q(U,ie,re){return U===U&&(re!==void 0&&(U=U<=re?U:re),ie!==void 0&&(U=U>=ie?U:ie)),U}Mt.exports=Q},85990:function(Mt,Q,U){var ie=U(46384),re=U(77412),m=U(34865),he=U(44037),V=U(63886),ue=U(64626),ce=U(278),Le=U(18805),ee=U(1911),Xe=U(58234),Je=U(46904),Ze=U(64160),gt=U(43824),tr=U(29148),yt=U(38517),Wt=U(1469),bt=U(44144),at=U(56688),nt=U(13218),Zt=U(72928),Y=U(3674),qt=U(81704),ut=1,Qe=2,Ct=4,$e="[object Arguments]",Kt="[object Array]",xr="[object Boolean]",kr="[object Date]",Kr="[object Error]",A="[object Function]",Ae="[object GeneratorFunction]",De="[object Map]",At="[object Number]",mt="[object Object]",Ft="[object RegExp]",Yt="[object Set]",Sr="[object String]",qn="[object Symbol]",hn="[object WeakMap]",fi="[object ArrayBuffer]",Gn="[object DataView]",ni="[object Float32Array]",pi="[object Float64Array]",Wn="[object Int8Array]",hi="[object Int16Array]",ua="[object Int32Array]",Gi="[object Uint8Array]",Di="[object Uint8ClampedArray]",$i="[object Uint16Array]",la="[object Uint32Array]",Mi={};Mi[$e]=Mi[Kt]=Mi[fi]=Mi[Gn]=Mi[xr]=Mi[kr]=Mi[ni]=Mi[pi]=Mi[Wn]=Mi[hi]=Mi[ua]=Mi[De]=Mi[At]=Mi[mt]=Mi[Ft]=Mi[Yt]=Mi[Sr]=Mi[qn]=Mi[Gi]=Mi[Di]=Mi[$i]=Mi[la]=!0,Mi[Kr]=Mi[A]=Mi[hn]=!1;function ma(Xn,Si,Zi,Qi,ko,me){var kn,Ha=Si&ut,ns=Si&Qe,Bt=Si&Ct;if(Zi&&(kn=ko?Zi(Xn,Qi,ko,me):Zi(Xn)),kn!==void 0)return kn;if(!nt(Xn))return Xn;var rr=Wt(Xn);if(rr){if(kn=gt(Xn),!Ha)return ce(Xn,kn)}else{var Cr=Ze(Xn),Qr=Cr==A||Cr==Ae;if(bt(Xn))return ue(Xn,Ha);if(Cr==mt||Cr==$e||Qr&&!ko){if(kn=ns||Qr?{}:yt(Xn),!Ha)return ns?ee(Xn,V(kn,Xn)):Le(Xn,he(kn,Xn))}else{if(!Mi[Cr])return ko?Xn:{};kn=tr(Xn,Cr,Ha)}}me||(me=new ie);var Sn=me.get(Xn);if(Sn)return Sn;me.set(Xn,kn),Zt(Xn)?Xn.forEach(function(Kn){kn.add(ma(Kn,Si,Zi,Kn,Xn,me))}):at(Xn)&&Xn.forEach(function(Kn,an){kn.set(an,ma(Kn,Si,Zi,an,Xn,me))});var Fn=Bt?ns?Je:Xe:ns?qt:Y,di=rr?void 0:Fn(Xn);return re(di||Xn,function(Kn,an){di&&(an=Kn,Kn=Xn[an]),m(kn,an,ma(Kn,Si,Zi,an,Xn,me))}),kn}Mt.exports=ma},41848:function(Mt){function Q(U,ie,re,m){for(var he=U.length,V=re+(m?1:-1);m?V--:++V<he;)if(ie(U[V],V,U))return V;return-1}Mt.exports=Q},42118:function(Mt,Q,U){var ie=U(41848),re=U(62722),m=U(42351);function he(V,ue,ce){return ue===ue?m(V,ue,ce):ie(V,re,ce)}Mt.exports=he},25588:function(Mt,Q,U){var ie=U(64160),re=U(37005),m="[object Map]";function he(V){return re(V)&&ie(V)==m}Mt.exports=he},62722:function(Mt){function Q(U){return U!==U}Mt.exports=Q},29221:function(Mt,Q,U){var ie=U(64160),re=U(37005),m="[object Set]";function he(V){return re(V)&&ie(V)==m}Mt.exports=he},40371:function(Mt){function Q(U){return function(ie){return ie==null?void 0:ie[U]}}Mt.exports=Q},18674:function(Mt){function Q(U){return function(ie){return U==null?void 0:U[ie]}}Mt.exports=Q},45652:function(Mt,Q,U){var ie=U(88668),re=U(47443),m=U(1196),he=U(74757),V=U(23593),ue=U(21814),ce=200;function Le(ee,Xe,Je){var Ze=-1,gt=re,tr=ee.length,yt=!0,Wt=[],bt=Wt;if(Je)yt=!1,gt=m;else if(tr>=ce){var at=Xe?null:V(ee);if(at)return ue(at);yt=!1,gt=he,bt=new ie}else bt=Xe?[]:Wt;e:for(;++Ze<tr;){var nt=ee[Ze],Zt=Xe?Xe(nt):nt;if(nt=Je||nt!==0?nt:0,yt&&Zt===Zt){for(var Y=bt.length;Y--;)if(bt[Y]===Zt)continue e;Xe&&bt.push(Zt),Wt.push(nt)}else gt(bt,Zt,Je)||(bt!==Wt&&bt.push(Zt),Wt.push(nt))}return Wt}Mt.exports=Le},57157:function(Mt,Q,U){var ie=U(74318);function re(m,he){var V=he?ie(m.buffer):m.buffer;return new m.constructor(V,m.byteOffset,m.byteLength)}Mt.exports=re},93147:function(Mt){var Q=/\w*$/;function U(ie){var re=new ie.constructor(ie.source,Q.exec(ie));return re.lastIndex=ie.lastIndex,re}Mt.exports=U},40419:function(Mt,Q,U){var ie=U(62705),re=ie?ie.prototype:void 0,m=re?re.valueOf:void 0;function he(V){return m?Object(m.call(V)):{}}Mt.exports=he},18805:function(Mt,Q,U){var ie=U(98363),re=U(99551);function m(he,V){return ie(he,re(he),V)}Mt.exports=m},1911:function(Mt,Q,U){var ie=U(98363),re=U(51442);function m(he,V){return ie(he,re(he),V)}Mt.exports=m},98805:function(Mt,Q,U){var ie=U(40180),re=U(62689),m=U(83140),he=U(79833);function V(ue){return function(ce){ce=he(ce);var Le=re(ce)?m(ce):void 0,ee=Le?Le[0]:ce.charAt(0),Xe=Le?ie(Le,1).join(""):ce.slice(1);return ee[ue]()+Xe}}Mt.exports=V},35393:function(Mt,Q,U){var ie=U(62663),re=U(53816),m=U(58748),he="['\u2019]",V=RegExp(he,"g");function ue(ce){return function(Le){return ie(m(re(Le).replace(V,"")),ce,"")}}Mt.exports=ue},23593:function(Mt,Q,U){var ie=U(58525),re=U(50308),m=U(21814),he=1/0,V=ie&&1/m(new ie([,-0]))[1]==he?function(ue){return new ie(ue)}:re;Mt.exports=V},69389:function(Mt,Q,U){var ie=U(18674),re={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},m=ie(re);Mt.exports=m},46904:function(Mt,Q,U){var ie=U(68866),re=U(51442),m=U(81704);function he(V){return ie(V,m,re)}Mt.exports=he},51442:function(Mt,Q,U){var ie=U(62488),re=U(85924),m=U(99551),he=U(70479),V=Object.getOwnPropertySymbols,ue=V?function(ce){for(var Le=[];ce;)ie(Le,m(ce)),ce=re(ce);return Le}:he;Mt.exports=ue},93157:function(Mt){var Q=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function U(ie){return Q.test(ie)}Mt.exports=U},43824:function(Mt){var Q=Object.prototype,U=Q.hasOwnProperty;function ie(re){var m=re.length,he=new re.constructor(m);return m&&typeof re[0]=="string"&&U.call(re,"index")&&(he.index=re.index,he.input=re.input),he}Mt.exports=ie},29148:function(Mt,Q,U){var ie=U(74318),re=U(57157),m=U(93147),he=U(40419),V=U(77133),ue="[object Boolean]",ce="[object Date]",Le="[object Map]",ee="[object Number]",Xe="[object RegExp]",Je="[object Set]",Ze="[object String]",gt="[object Symbol]",tr="[object ArrayBuffer]",yt="[object DataView]",Wt="[object Float32Array]",bt="[object Float64Array]",at="[object Int8Array]",nt="[object Int16Array]",Zt="[object Int32Array]",Y="[object Uint8Array]",qt="[object Uint8ClampedArray]",ut="[object Uint16Array]",Qe="[object Uint32Array]";function Ct($e,Kt,xr){var kr=$e.constructor;switch(Kt){case tr:return ie($e);case ue:case ce:return new kr(+$e);case yt:return re($e,xr);case Wt:case bt:case at:case nt:case Zt:case Y:case qt:case ut:case Qe:return V($e,xr);case Le:return new kr;case ee:case Ze:return new kr($e);case Xe:return m($e);case Je:return new kr;case gt:return he($e)}}Mt.exports=Ct},42351:function(Mt){function Q(U,ie,re){for(var m=re-1,he=U.length;++m<he;)if(U[m]===ie)return m;return-1}Mt.exports=Q},2757:function(Mt){var Q="\\ud800-\\udfff",U="\\u0300-\\u036f",ie="\\ufe20-\\ufe2f",re="\\u20d0-\\u20ff",m=U+ie+re,he="\\u2700-\\u27bf",V="a-z\\xdf-\\xf6\\xf8-\\xff",ue="\\xac\\xb1\\xd7\\xf7",ce="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Le="\\u2000-\\u206f",ee=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Xe="A-Z\\xc0-\\xd6\\xd8-\\xde",Je="\\ufe0e\\ufe0f",Ze=ue+ce+Le+ee,gt="['\u2019]",tr="["+Ze+"]",yt="["+m+"]",Wt="\\d+",bt="["+he+"]",at="["+V+"]",nt="[^"+Q+Ze+Wt+he+V+Xe+"]",Zt="\\ud83c[\\udffb-\\udfff]",Y="(?:"+yt+"|"+Zt+")",qt="[^"+Q+"]",ut="(?:\\ud83c[\\udde6-\\uddff]){2}",Qe="[\\ud800-\\udbff][\\udc00-\\udfff]",Ct="["+Xe+"]",$e="\\u200d",Kt="(?:"+at+"|"+nt+")",xr="(?:"+Ct+"|"+nt+")",kr="(?:"+gt+"(?:d|ll|m|re|s|t|ve))?",Kr="(?:"+gt+"(?:D|LL|M|RE|S|T|VE))?",A=Y+"?",Ae="["+Je+"]?",De="(?:"+$e+"(?:"+[qt,ut,Qe].join("|")+")"+Ae+A+")*",At="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",mt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ft=Ae+A+De,Yt="(?:"+[bt,ut,Qe].join("|")+")"+Ft,Sr=RegExp([Ct+"?"+at+"+"+kr+"(?="+[tr,Ct,"$"].join("|")+")",xr+"+"+Kr+"(?="+[tr,Ct+Kt,"$"].join("|")+")",Ct+"?"+Kt+"+"+kr,Ct+"+"+Kr,mt,At,Wt,Yt].join("|"),"g");function qn(hn){return hn.match(Sr)||[]}Mt.exports=qn},68929:function(Mt,Q,U){var ie=U(48403),re=U(35393),m=re(function(he,V,ue){return V=V.toLowerCase(),he+(ue?ie(V):V)});Mt.exports=m},48403:function(Mt,Q,U){var ie=U(79833),re=U(11700);function m(he){return re(ie(he).toLowerCase())}Mt.exports=m},74691:function(Mt,Q,U){var ie=U(29750),re=U(14841);function m(he,V,ue){return ue===void 0&&(ue=V,V=void 0),ue!==void 0&&(ue=re(ue),ue=ue===ue?ue:0),V!==void 0&&(V=re(V),V=V===V?V:0),ie(re(he),V,ue)}Mt.exports=m},50361:function(Mt,Q,U){var ie=U(85990),re=1,m=4;function he(V){return ie(V,re|m)}Mt.exports=he},53816:function(Mt,Q,U){var ie=U(69389),re=U(79833),m=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,he="\\u0300-\\u036f",V="\\ufe20-\\ufe2f",ue="\\u20d0-\\u20ff",ce=he+V+ue,Le="["+ce+"]",ee=RegExp(Le,"g");function Xe(Je){return Je=re(Je),Je&&Je.replace(m,ie).replace(ee,"")}Mt.exports=Xe},56688:function(Mt,Q,U){var ie=U(25588),re=U(7518),m=U(31167),he=m&&m.isMap,V=he?re(he):ie;Mt.exports=V},14293:function(Mt){function Q(U){return U==null}Mt.exports=Q},81763:function(Mt,Q,U){var ie=U(44239),re=U(37005),m="[object Number]";function he(V){return typeof V=="number"||re(V)&&ie(V)==m}Mt.exports=he},72928:function(Mt,Q,U){var ie=U(29221),re=U(7518),m=U(31167),he=m&&m.isSet,V=he?re(he):ie;Mt.exports=V},47037:function(Mt,Q,U){var ie=U(44239),re=U(1469),m=U(37005),he="[object String]";function V(ue){return typeof ue=="string"||!re(ue)&&m(ue)&&ie(ue)==he}Mt.exports=V},52353:function(Mt){function Q(U){return U===void 0}Mt.exports=Q},30236:function(Mt,Q,U){var ie=U(42980),re=U(21463),m=re(function(he,V,ue,ce){ie(he,V,ue,ce)});Mt.exports=m},50308:function(Mt){function Q(){}Mt.exports=Q},44908:function(Mt,Q,U){var ie=U(45652);function re(m){return m&&m.length?ie(m):[]}Mt.exports=re},11700:function(Mt,Q,U){var ie=U(98805),re=ie("toUpperCase");Mt.exports=re},58748:function(Mt,Q,U){var ie=U(49029),re=U(93157),m=U(79833),he=U(2757);function V(ue,ce,Le){return ue=m(ue),ce=Le?void 0:ce,ce===void 0?re(ue)?he(ue):ie(ue):ue.match(ce)||[]}Mt.exports=V},6158:function(Mt){(function(Q,U){Mt.exports=U()})(this,function(){"use strict";var Q,U,ie;function re(m,he){if(!Q)Q=he;else if(!U)U=he;else{var V="var sharedChunk = {}; ("+Q+")(sharedChunk); ("+U+")(sharedChunk);",ue={};Q(ue),ie=he(ue),typeof window!="undefined"&&(ie.workerUrl=window.URL.createObjectURL(new Blob([V],{type:"text/javascript"})))}}return re(["exports"],function(m){"use strict";function he(t,o){return t(o={exports:{}},o.exports),o.exports}var V=ue;function ue(t,o,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*o,this.by=3*(h-o)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}ue.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},ue.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},ue.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},ue.prototype.solveCurveX=function(t,o){var u,h,y,b,S;for(o===void 0&&(o=1e-6),y=t,S=0;S<8;S++){if(b=this.sampleCurveX(y)-t,Math.abs(b)<o)return y;var I=this.sampleCurveDerivativeX(y);if(Math.abs(I)<1e-6)break;y-=b/I}if((y=t)<(u=0))return u;if(y>(h=1))return h;for(;u<h;){if(b=this.sampleCurveX(y),Math.abs(b-t)<o)return y;t>b?u=y:h=y,y=.5*(h-u)+u}return y},ue.prototype.solve=function(t,o){return this.sampleCurveY(this.solveCurveX(t,o))};var ce=Le;function Le(t,o){this.x=t,this.y=o}Le.prototype={clone:function(){return new Le(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,o){return this.clone()._rotateAround(t,o)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var o=t.x-this.x,u=t.y-this.y;return o*o+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,o){return Math.atan2(this.x*o-this.y*t,this.x*t+this.y*o)},_matMult:function(t){var o=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=o,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var o=Math.cos(t),u=Math.sin(t),h=u*this.x+o*this.y;return this.x=o*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,o){var u=Math.cos(t),h=Math.sin(t),y=o.y+h*(this.x-o.x)+u*(this.y-o.y);return this.x=o.x+u*(this.x-o.x)-h*(this.y-o.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Le.convert=function(t){return t instanceof Le?t:Array.isArray(t)?new Le(t[0],t[1]):t};var ee=typeof self!="undefined"?self:{},Xe=Math.pow(2,53)-1;function Je(t,o,u,h){var y=new V(t,o,u,h);return function(b){return y.solve(b)}}var Ze=Je(.25,.1,.25,1);function gt(t,o,u){return Math.min(u,Math.max(o,t))}function tr(t,o,u){var h=u-o,y=((t-o)%h+h)%h+o;return y===o?u:y}function yt(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}var Wt=1;function bt(){return Wt++}function at(){return function t(o){return o?(o^16*Math.random()>>o/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function nt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Zt(t,o){t.forEach(function(u){o[u]&&(o[u]=o[u].bind(o))})}function Y(t,o){return t.indexOf(o,t.length-o.length)!==-1}function qt(t,o,u){var h={};for(var y in t)h[y]=o.call(u||this,t[y],y,t);return h}function ut(t,o,u){var h={};for(var y in t)o.call(u||this,t[y],y,t)&&(h[y]=t[y]);return h}function Qe(t){return Array.isArray(t)?t.map(Qe):typeof t=="object"&&t?qt(t,Qe):t}var Ct={};function $e(t){Ct[t]||(typeof console!="undefined"&&console.warn(t),Ct[t]=!0)}function Kt(t,o,u){return(u.y-t.y)*(o.x-t.x)>(o.y-t.y)*(u.x-t.x)}function xr(t){for(var o=0,u=0,h=t.length,y=h-1,b=void 0,S=void 0;u<h;y=u++)o+=((S=t[y]).x-(b=t[u]).x)*(b.y+S.y);return o}function kr(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Kr(t){var o={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,y,b,S){var I=b||S;return o[y]=!I||I.toLowerCase(),""}),o["max-age"]){var u=parseInt(o["max-age"],10);isNaN(u)?delete o["max-age"]:o["max-age"]=u}return o}var A=null;function Ae(t){if(A==null){var o=t.navigator?t.navigator.userAgent:null;A=!!t.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return A}function De(t){try{var o=ee[t];return o.setItem("_mapbox_test_",1),o.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var At,mt,Ft,Yt,Sr=ee.performance&&ee.performance.now?ee.performance.now.bind(ee.performance):Date.now.bind(Date),qn=ee.requestAnimationFrame||ee.mozRequestAnimationFrame||ee.webkitRequestAnimationFrame||ee.msRequestAnimationFrame,hn=ee.cancelAnimationFrame||ee.mozCancelAnimationFrame||ee.webkitCancelAnimationFrame||ee.msCancelAnimationFrame,fi={now:Sr,frame:function(t){var o=qn(t);return{cancel:function(){return hn(o)}}},getImageData:function(t,o){o===void 0&&(o=0);var u=ee.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-o,-o,t.width+2*o,t.height+2*o)},resolveURL:function(t){return At||(At=ee.document.createElement("a")),At.href=t,At.href},hardwareConcurrency:ee.navigator&&ee.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ee.devicePixelRatio},get prefersReducedMotion(){return!!ee.matchMedia&&(mt==null&&(mt=ee.matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)}},Gn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ni={supported:!1,testSupport:function(t){!pi&&Yt&&(Wn?hi(t):Ft=t)}},pi=!1,Wn=!1;function hi(t){var o=t.createTexture();t.bindTexture(t.TEXTURE_2D,o);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Yt),t.isContextLost())return;ni.supported=!0}catch(u){}t.deleteTexture(o),pi=!0}ee.document&&((Yt=ee.document.createElement("img")).onload=function(){Ft&&hi(Ft),Ft=null,Wn=!0},Yt.onerror=function(){pi=!0,Ft=null},Yt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ua="01",Gi=function(t,o){this._transformRequestFn=t,this._customAccessToken=o,this._createSkuToken()};function Di(t){return t.indexOf("mapbox:")===0}Gi.prototype._createSkuToken=function(){var t=function(){for(var o="",u=0;u<10;u++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ua,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Gi.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Gi.prototype.transformRequest=function(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}},Gi.prototype.normalizeStyleURL=function(t,o){if(!Di(t))return t;var u=ma(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeGlyphsURL=function(t,o){if(!Di(t))return t;var u=ma(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeSourceURL=function(t,o){if(!Di(t))return t;var u=ma(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||o)},Gi.prototype.normalizeSpriteURL=function(t,o,u,h){var y=ma(t);return Di(t)?(y.path="/styles/v1"+y.path+"/sprite"+o+u,this._makeAPIURL(y,this._customAccessToken||h)):(y.path+=""+o+u,Xn(y))},Gi.prototype.normalizeTileURL=function(t,o){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Di(t))return t;var u=ma(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(fi.devicePixelRatio>=2||o===512?"@2x":"")+(ni.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(y){for(var b=0,S=y;b<S.length;b+=1){var I=S[b].match(/^access_token=(.*)$/);if(I)return I[1]}return null}(u.params)||Gn.ACCESS_TOKEN;return Gn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Gi.prototype.canonicalizeTileURL=function(t,o){var u=ma(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var y=u.params;return o&&(y=y.filter(function(b){return!b.match(/^access_token=/)})),y.length&&(h+="?"+y.join("&")),h},Gi.prototype.canonicalizeTileset=function(t,o){for(var u=!!o&&Di(o),h=[],y=0,b=t.tiles||[];y<b.length;y+=1){var S=b[y];la(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Gi.prototype._makeAPIURL=function(t,o){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=ma(Gn.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Gn.REQUIRE_ACCESS_TOKEN)return Xn(t);if(!(o=o||Gn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(o[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(b){return b.indexOf("access_token")===-1}),t.params.push("access_token="+o),Xn(t)};var $i=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function la(t){return $i.test(t)}var Mi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ma(t){var o=t.match(Mi);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function Xn(t){var o=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+o}function Si(t){if(!t)return null;var o=t.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(decodeURIComponent(ee.atob(o[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Zi=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Zi.prototype.getStorageKey=function(t){var o,u=Si(Gn.ACCESS_TOKEN);return o=u&&u.u?ee.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,y){return String.fromCharCode(Number("0x"+y))})):Gn.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+o:"mapbox.eventData:"+o},Zi.prototype.fetchEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=ee.localStorage.getItem(o);h&&(this.eventData=JSON.parse(h));var y=ee.localStorage.getItem(u);y&&(this.anonId=y)}catch(b){$e("Unable to read from LocalStorage")}},Zi.prototype.saveEventData=function(){var t=De("localStorage"),o=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ee.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ee.localStorage.setItem(o,JSON.stringify(this.eventData))}catch(h){$e("Unable to write to LocalStorage")}},Zi.prototype.processRequests=function(t){},Zi.prototype.postEvent=function(t,o,u,h){var y=this;if(Gn.EVENTS_URL){var b=ma(Gn.EVENTS_URL);b.params.push("access_token="+(h||Gn.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:ua,userId:this.anonId},I=o?yt(S,o):S,D={url:Xn(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=ba(D,function(z){y.pendingRequest=null,u(z),y.saveEventData(),y.processRequests(h)})}},Zi.prototype.queueRequest=function(t,o){this.queue.push(t),this.processRequests(o)};var Qi,ko,me=function(t){function o(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postMapLoadEvent=function(u,h,y,b){this.skuToken=y,(Gn.EVENTS_URL&&b||Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Di(S)||la(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},b)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var y=this.queue.shift(),b=y.id,S=y.timestamp;b&&this.success[b]||(this.anonId||this.fetchEventData(),nt(this.anonId)||(this.anonId=at()),this.postEvent(S,{skuToken:this.skuToken},function(I){I||b&&(h.success[b]=!0)},u))}},o}(Zi),kn=new(function(t){function o(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.postTurnstileEvent=function(u,h){Gn.EVENTS_URL&&Gn.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(y){return Di(y)||la(y)})&&this.queueRequest(Date.now(),h)},o.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var y=Si(Gn.ACCESS_TOKEN),b=y?y.u:Gn.ACCESS_TOKEN,S=b!==this.eventData.tokenU;nt(this.anonId)||(this.anonId=at(),S=!0);var I=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),z=new Date(I),j=(I-this.eventData.lastSuccess)/864e5;S=S||j>=1||j<-1||D.getDate()!==z.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(I,{"enabled.telemetry":!1},function(W){W||(h.eventData.lastSuccess=I,h.eventData.tokenU=b)},u)}},o}(Zi)),Ha=kn.postTurnstileEvent.bind(kn),ns=new me,Bt=ns.postMapLoadEvent.bind(ns),rr=500,Cr=50;function Qr(){ee.caches&&!Qi&&(Qi=ee.caches.open("mapbox-tiles"))}function Sn(t){var o=t.indexOf("?");return o<0?t:t.slice(0,o)}var Fn,di=1/0;function Kn(){return Fn==null&&(Fn=ee.OffscreenCanvas&&new ee.OffscreenCanvas(1,1).getContext("2d")&&typeof ee.createImageBitmap=="function"),Fn}var an={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(an);var Fi=function(t){function o(u,h,y){h===401&&la(y)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=y,this.name=this.constructor.name,this.message=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},o}(Error),Li=kr()?function(){return self.worker&&self.worker.referrer}:function(){return(ee.location.protocol==="blob:"?ee.parent:ee).location.href},ao,vs,Zo=function(t,o){if(!(/^file:/.test(u=t.url)||/^file:/.test(Li())&&!/^\w+:/.test(u))){if(ee.fetch&&ee.Request&&ee.AbortController&&ee.Request.prototype.hasOwnProperty("signal"))return function(h,y){var b,S=new ee.AbortController,I=new ee.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Li(),signal:S.signal}),D=!1,z=!1,j=(b=I.url).indexOf("sku=")>0&&la(b);h.type==="json"&&I.headers.set("Accept","application/json");var W=function(oe,Me,Oe){if(!z){if(oe&&oe.message!=="SecurityError"&&$e(oe),Me&&Oe)return K(Me);var L=Date.now();ee.fetch(I).then(function(Ue){if(Ue.ok){var ot=j?Ue.clone():null;return K(Ue,ot,L)}return y(new Fi(Ue.statusText,Ue.status,h.url))}).catch(function(Ue){Ue.code!==20&&y(new Error(Ue.message))})}},K=function(oe,Me,Oe){(h.type==="arrayBuffer"?oe.arrayBuffer():h.type==="json"?oe.json():oe.text()).then(function(L){z||(Me&&Oe&&function(Ue,ot,xt){if(Qr(),Qi){var Ut={status:ot.status,statusText:ot.statusText,headers:new ee.Headers};ot.headers.forEach(function(or,Mr){return Ut.headers.set(Mr,or)});var Gt=Kr(ot.headers.get("Cache-Control")||"");Gt["no-store"]||(Gt["max-age"]&&Ut.headers.set("Expires",new Date(xt+1e3*Gt["max-age"]).toUTCString()),new Date(Ut.headers.get("Expires")).getTime()-xt<42e4||function(or,Mr){if(ko===void 0)try{new Response(new ReadableStream),ko=!0}catch(Fr){ko=!1}ko?Mr(or.body):or.blob().then(Mr)}(ot,function(or){var Mr=new ee.Response(or,Ut);Qr(),Qi&&Qi.then(function(Fr){return Fr.put(Sn(Ue.url),Mr)}).catch(function(Fr){return $e(Fr.message)})}))}}(I,Me,Oe),D=!0,y(null,L,oe.headers.get("Cache-Control"),oe.headers.get("Expires")))}).catch(function(L){z||y(new Error(L.message))})};return j?function(oe,Me){if(Qr(),!Qi)return Me(null);var Oe=Sn(oe.url);Qi.then(function(L){L.match(Oe).then(function(Ue){var ot=function(xt){if(!xt)return!1;var Ut=new Date(xt.headers.get("Expires")||0),Gt=Kr(xt.headers.get("Cache-Control")||"");return Ut>Date.now()&&!Gt["no-cache"]}(Ue);L.delete(Oe),ot&&L.put(Oe,Ue.clone()),Me(null,Ue,ot)}).catch(Me)}).catch(Me)}(I,W):W(null,null),{cancel:function(){z=!0,D||S.abort()}}}(t,o);if(kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,o,void 0,!0)}var u;return function(h,y){var b=new ee.XMLHttpRequest;for(var S in b.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(b.responseType="arraybuffer"),h.headers)b.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(b.responseType="text",b.setRequestHeader("Accept","application/json")),b.withCredentials=h.credentials==="include",b.onerror=function(){y(new Error(b.statusText))},b.onload=function(){if((b.status>=200&&b.status<300||b.status===0)&&b.response!==null){var I=b.response;if(h.type==="json")try{I=JSON.parse(b.response)}catch(D){return y(D)}y(null,I,b.getResponseHeader("Cache-Control"),b.getResponseHeader("Expires"))}else y(new Fi(b.statusText,b.status,h.url))},b.send(h.body),{cancel:function(){return b.abort()}}}(t,o)},za=function(t,o){return Zo(yt(t,{type:"arrayBuffer"}),o)},ba=function(t,o){return Zo(yt(t,{method:"POST"}),o)},H="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ao=[],vs=0;var J=function(t,o){if(ni.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),vs>=Gn.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:o,cancelled:!1,cancel:function(){this.cancelled=!0}};return ao.push(u),u}vs++;var h=!1,y=function(){if(!h)for(h=!0,vs--;ao.length&&vs<Gn.MAX_PARALLEL_IMAGE_REQUESTS;){var S=ao.shift();S.cancelled||(S.cancel=J(S.requestParameters,S.callback).cancel)}},b=za(t,function(S,I,D,z){y(),S?o(S):I&&(Kn()?function(j,W){var K=new ee.Blob([new Uint8Array(j)],{type:"image/png"});ee.createImageBitmap(K).then(function(oe){W(null,oe)}).catch(function(oe){W(new Error("Could not load image because of "+oe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(I,o):function(j,W,K,oe){var Me=new ee.Image,Oe=ee.URL;Me.onload=function(){W(null,Me),Oe.revokeObjectURL(Me.src),Me.onload=null,ee.requestAnimationFrame(function(){Me.src=H})},Me.onerror=function(){return W(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var L=new ee.Blob([new Uint8Array(j)],{type:"image/png"});Me.cacheControl=K,Me.expires=oe,Me.src=j.byteLength?Oe.createObjectURL(L):H}(I,o,D,z))});return{cancel:function(){b.cancel(),y()}}};function ae(t,o,u){u[t]&&u[t].indexOf(o)!==-1||(u[t]=u[t]||[],u[t].push(o))}function ye(t,o,u){if(u&&u[t]){var h=u[t].indexOf(o);h!==-1&&u[t].splice(h,1)}}var Pe=function(t,o){o===void 0&&(o={}),yt(this,o),this.type=t},He=function(t){function o(u,h){h===void 0&&(h={}),t.call(this,"error",yt({error:u},h))}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Pe),tt=function(){};tt.prototype.on=function(t,o){return this._listeners=this._listeners||{},ae(t,o,this._listeners),this},tt.prototype.off=function(t,o){return ye(t,o,this._listeners),ye(t,o,this._oneTimeListeners),this},tt.prototype.once=function(t,o){return this._oneTimeListeners=this._oneTimeListeners||{},ae(t,o,this._oneTimeListeners),this},tt.prototype.fire=function(t,o){typeof t=="string"&&(t=new Pe(t,o||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,y=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<y.length;h+=1)y[h].call(this,t);for(var b=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];b<S.length;b+=1){var I=S[b];ye(u,I,this._oneTimeListeners),I.call(this,t)}var D=this._eventedParent;D&&(yt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(t))}else t instanceof He&&console.error(t.error);return this},tt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},tt.prototype.setEventedParent=function(t,o){return this._eventedParent=t,this._eventedParentData=o,this};var fe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},ke=function(t,o,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),o!=null&&o.__line__&&(this.line=o.__line__)};function ht(t){var o=t.value;return o?[new ke(t.key,o,"constants have been deprecated as of v8")]:[]}function pr(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];for(var h=0,y=o;h<y.length;h+=1){var b=y[h];for(var S in b)t[S]=b[S]}return t}function kt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Nt(t){if(Array.isArray(t))return t.map(Nt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var o={};for(var u in t)o[u]=Nt(t[u]);return o}return kt(t)}var hr=function(t){function o(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(Error),_n=function(t,o){o===void 0&&(o=[]),this.parent=t,this.bindings={};for(var u=0,h=o;u<h.length;u+=1){var y=h[u];this.bindings[y[0]]=y[1]}};_n.prototype.concat=function(t){return new _n(this,t)},_n.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},_n.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var fn={kind:"null"},Pt={kind:"number"},Jr={kind:"string"},Br={kind:"boolean"},Hr={kind:"color"},gi={kind:"object"},en={kind:"value"},yn={kind:"collator"},Xi={kind:"formatted"},vi={kind:"resolvedImage"};function Pi(t,o){return{kind:"array",itemType:t,N:o}}function xi(t){if(t.kind==="array"){var o=xi(t.itemType);return typeof t.N=="number"?"array<"+o+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+o+">"}return t.kind}var dt=[fn,Pt,Jr,Br,Hr,Xi,gi,Pi(en),vi];function It(t,o){if(o.kind==="error")return null;if(t.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!It(t.itemType,o.itemType))&&(typeof t.N!="number"||t.N===o.N))return null}else{if(t.kind===o.kind)return null;if(t.kind==="value"){for(var u=0,h=dt;u<h.length;u+=1)if(!It(h[u],o))return null}}return"Expected "+xi(t)+" but found "+xi(o)+" instead."}function Ta(t,o){return o.some(function(u){return u.kind===t.kind})}function Ci(t,o){return o.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ii=he(function(t,o){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(I){return(I=Math.round(I))<0?0:I>255?255:I}function y(I){return h(I[I.length-1]==="%"?parseFloat(I)/100*255:parseInt(I))}function b(I){return(D=I[I.length-1]==="%"?parseFloat(I)/100:parseFloat(I))<0?0:D>1?1:D;var D}function S(I,D,z){return z<0?z+=1:z>1&&(z-=1),6*z<1?I+(D-I)*z*6:2*z<1?D:3*z<2?I+(D-I)*(2/3-z)*6:I}try{o.parseCSSColor=function(I){var D,z=I.replace(/ /g,"").toLowerCase();if(z in u)return u[z].slice();if(z[0]==="#")return z.length===4?(D=parseInt(z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:z.length===7&&(D=parseInt(z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var j=z.indexOf("("),W=z.indexOf(")");if(j!==-1&&W+1===z.length){var K=z.substr(0,j),oe=z.substr(j+1,W-(j+1)).split(","),Me=1;switch(K){case"rgba":if(oe.length!==4)return null;Me=b(oe.pop());case"rgb":return oe.length!==3?null:[y(oe[0]),y(oe[1]),y(oe[2]),Me];case"hsla":if(oe.length!==4)return null;Me=b(oe.pop());case"hsl":if(oe.length!==3)return null;var Oe=(parseFloat(oe[0])%360+360)%360/360,L=b(oe[1]),Ue=b(oe[2]),ot=Ue<=.5?Ue*(L+1):Ue+L-Ue*L,xt=2*Ue-ot;return[h(255*S(xt,ot,Oe+1/3)),h(255*S(xt,ot,Oe)),h(255*S(xt,ot,Oe-1/3)),Me];default:return null}}return null}}catch(I){}}).parseCSSColor,ji=function(t,o,u,h){h===void 0&&(h=1),this.r=t,this.g=o,this.b=u,this.a=h};ji.parse=function(t){if(t){if(t instanceof ji)return t;if(typeof t=="string"){var o=Ii(t);if(o)return new ji(o[0]/255*o[3],o[1]/255*o[3],o[2]/255*o[3],o[3])}}},ji.prototype.toString=function(){var t=this.toArray(),o=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(o)+","+Math.round(u)+","+h+")"},ji.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ji.black=new ji(0,0,0,1),ji.white=new ji(1,1,1,1),ji.transparent=new ji(0,0,0,0),ji.red=new ji(1,0,0,1);var Ir=function(t,o,u){this.sensitivity=t?o?"variant":"case":o?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Ir.prototype.compare=function(t,o){return this.collator.compare(t,o)},Ir.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var on=function(t,o,u,h,y){this.text=t,this.image=o,this.scale=u,this.fontStack=h,this.textColor=y},_t=function(t){this.sections=t};_t.fromString=function(t){return new _t([new on(t,null,null,null,null)])},_t.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},_t.factory=function(t){return t instanceof _t?t:_t.fromString(t)},_t.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},_t.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var y={};h.fontStack&&(y["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(y["font-scale"]=h.scale),h.textColor&&(y["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(y)}}return t};var na=function(t){this.name=t.name,this.available=t.available};function de(t,o,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,o,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,o,u,h]:[t,o,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function Ko(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof ji||t instanceof Ir||t instanceof _t||t instanceof na)return!0;if(Array.isArray(t)){for(var o=0,u=t;o<u.length;o+=1)if(!Ko(u[o]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!Ko(t[h]))return!1;return!0}return!1}function ra(t){if(t===null)return fn;if(typeof t=="string")return Jr;if(typeof t=="boolean")return Br;if(typeof t=="number")return Pt;if(t instanceof ji)return Hr;if(t instanceof Ir)return yn;if(t instanceof _t)return Xi;if(t instanceof na)return vi;if(Array.isArray(t)){for(var o,u=t.length,h=0,y=t;h<y.length;h+=1){var b=ra(y[h]);if(o){if(o===b)continue;o=en;break}o=b}return Pi(o||en,u)}return gi}function _u(t){var o=typeof t;return t===null?"":o==="string"||o==="number"||o==="boolean"?String(t):t instanceof ji||t instanceof _t||t instanceof na?t.toString():JSON.stringify(t)}na.prototype.toString=function(){return this.name},na.fromString=function(t){return t?new na({name:t,available:!1}):null},na.prototype.serialize=function(){return["image",this.name]};var Ua=function(t,o){this.type=t,this.value=o};Ua.parse=function(t,o){if(t.length!==2)return o.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!Ko(t[1]))return o.error("invalid value");var u=t[1],h=ra(u),y=o.expectedType;return h.kind!=="array"||h.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(h=y),new Ua(h,u)},Ua.prototype.evaluate=function(){return this.value},Ua.prototype.eachChild=function(){},Ua.prototype.outputDefined=function(){return!0},Ua.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof ji?["rgba"].concat(this.value.toArray()):this.value instanceof _t?this.value.serialize():this.value};var Ma=function(t){this.name="ExpressionEvaluationError",this.message=t};Ma.prototype.toJSON=function(){return this.message};var Ka={string:Jr,number:Pt,boolean:Br,object:gi},ia=function(t,o){this.type=t,this.args=o};ia.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u,h=1,y=t[0];if(y==="array"){var b,S;if(t.length>2){var I=t[1];if(typeof I!="string"||!(I in Ka)||I==="object")return o.error('The item type argument of "array" must be one of string, number, boolean',1);b=Ka[I],h++}else b=en;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return o.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Pi(b,S)}else u=Ka[y];for(var D=[];h<t.length;h++){var z=o.parse(t[h],h,en);if(!z)return null;D.push(z)}return new ia(u,D)},ia.prototype.evaluate=function(t){for(var o=0;o<this.args.length;o++){var u=this.args[o].evaluate(t);if(!It(this.type,ra(u)))return u;if(o===this.args.length-1)throw new Ma("Expected value to be of type "+xi(this.type)+", but found "+xi(ra(u))+" instead.")}return null},ia.prototype.eachChild=function(t){this.args.forEach(t)},ia.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ia.prototype.serialize=function(){var t=this.type,o=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){o.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&o.push(h)}}return o.concat(this.args.map(function(y){return y.serialize()}))};var Ao=function(t){this.type=Xi,this.sections=t};Ao.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return o.error("First argument must be an image or text section.");for(var h=[],y=!1,b=1;b<=t.length-1;++b){var S=t[b];if(y&&typeof S=="object"&&!Array.isArray(S)){y=!1;var I=null;if(S["font-scale"]&&!(I=o.parse(S["font-scale"],1,Pt)))return null;var D=null;if(S["text-font"]&&!(D=o.parse(S["text-font"],1,Pi(Jr))))return null;var z=null;if(S["text-color"]&&!(z=o.parse(S["text-color"],1,Hr)))return null;var j=h[h.length-1];j.scale=I,j.font=D,j.textColor=z}else{var W=o.parse(t[b],1,en);if(!W)return null;var K=W.type.kind;if(K!=="string"&&K!=="value"&&K!=="null"&&K!=="resolvedImage")return o.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,h.push({content:W,scale:null,font:null,textColor:null})}}return new Ao(h)},Ao.prototype.evaluate=function(t){return new _t(this.sections.map(function(o){var u=o.content.evaluate(t);return ra(u)===vi?new on("",u,null,null,null):new on(_u(u),null,o.scale?o.scale.evaluate(t):null,o.font?o.font.evaluate(t).join(","):null,o.textColor?o.textColor.evaluate(t):null)}))},Ao.prototype.eachChild=function(t){for(var o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Ao.prototype.outputDefined=function(){return!1},Ao.prototype.serialize=function(){for(var t=["format"],o=0,u=this.sections;o<u.length;o+=1){var h=u[o];t.push(h.content.serialize());var y={};h.scale&&(y["font-scale"]=h.scale.serialize()),h.font&&(y["text-font"]=h.font.serialize()),h.textColor&&(y["text-color"]=h.textColor.serialize()),t.push(y)}return t};var jo=function(t){this.type=vi,this.input=t};jo.parse=function(t,o){if(t.length!==2)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Jr);return u?new jo(u):o.error("No image name provided.")},jo.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=na.fromString(o);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(o)>-1),u},jo.prototype.eachChild=function(t){t(this.input)},jo.prototype.outputDefined=function(){return!1},jo.prototype.serialize=function(){return["image",this.input.serialize()]};var Cu={"to-boolean":Br,"to-color":Hr,"to-number":Pt,"to-string":Jr},vo=function(t,o){this.type=t,this.args=o};vo.parse=function(t,o){if(t.length<2)return o.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return o.error("Expected one argument.");for(var h=Cu[u],y=[],b=1;b<t.length;b++){var S=o.parse(t[b],b,en);if(!S)return null;y.push(S)}return new vo(h,y)},vo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var o,u,h=0,y=this.args;h<y.length;h+=1){if(u=null,(o=y[h].evaluate(t))instanceof ji)return o;if(typeof o=="string"){var b=t.parseColor(o);if(b)return b}else if(Array.isArray(o)&&!(u=o.length<3||o.length>4?"Invalid rbga value "+JSON.stringify(o)+": expected an array containing either three or four numeric values.":de(o[0],o[1],o[2],o[3])))return new ji(o[0]/255,o[1]/255,o[2]/255,o[3])}throw new Ma(u||"Could not parse color from value '"+(typeof o=="string"?o:String(JSON.stringify(o)))+"'")}if(this.type.kind==="number"){for(var S=null,I=0,D=this.args;I<D.length;I+=1){if((S=D[I].evaluate(t))===null)return 0;var z=Number(S);if(!isNaN(z))return z}throw new Ma("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?_t.fromString(_u(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?na.fromString(_u(this.args[0].evaluate(t))):_u(this.args[0].evaluate(t))},vo.prototype.eachChild=function(t){this.args.forEach(t)},vo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},vo.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(o){t.push(o.serialize())}),t};var Do=["Unknown","Point","LineString","Polygon"],aa=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};aa.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},aa.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Do[this.feature.type]:this.feature.type:null},aa.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},aa.prototype.canonicalID=function(){return this.canonical},aa.prototype.properties=function(){return this.feature&&this.feature.properties||{}},aa.prototype.parseColor=function(t){var o=this._parseColorCache[t];return o||(o=this._parseColorCache[t]=ji.parse(t)),o};var $a=function(t,o,u,h){this.name=t,this.type=o,this._evaluate=u,this.args=h};$a.prototype.evaluate=function(t){return this._evaluate(t,this.args)},$a.prototype.eachChild=function(t){this.args.forEach(t)},$a.prototype.outputDefined=function(){return!1},$a.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},$a.parse=function(t,o){var u,h=t[0],y=$a.definitions[h];if(!y)return o.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var b=Array.isArray(y)?y[0]:y.type,S=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,I=S.filter(function(Zn){var pn=Zn[0];return!Array.isArray(pn)||pn.length===t.length-1}),D=null,z=0,j=I;z<j.length;z+=1){var W=j[z],K=W[0],oe=W[1];D=new Fs(o.registry,o.path,null,o.scope);for(var Me=[],Oe=!1,L=1;L<t.length;L++){var Ue=t[L],ot=Array.isArray(K)?K[L-1]:K.type,xt=D.parse(Ue,1+Me.length,ot);if(!xt){Oe=!0;break}Me.push(xt)}if(!Oe)if(Array.isArray(K)&&K.length!==Me.length)D.error("Expected "+K.length+" arguments, but found "+Me.length+" instead.");else{for(var Ut=0;Ut<Me.length;Ut++){var Gt=Array.isArray(K)?K[Ut]:K.type,or=Me[Ut];D.concat(Ut+1).checkSubtype(Gt,or.type)}if(D.errors.length===0)return new $a(h,b,oe,Me)}}if(I.length===1)(u=o.errors).push.apply(u,D.errors);else{for(var Mr=(I.length?I:S).map(function(Zn){var pn;return pn=Zn[0],Array.isArray(pn)?"("+pn.map(xi).join(", ")+")":"("+xi(pn.type)+"...)"}).join(" | "),Fr=[],Dn=1;Dn<t.length;Dn++){var cn=o.parse(t[Dn],1+Fr.length);if(!cn)return null;Fr.push(xi(cn.type))}o.error("Expected arguments of type "+Mr+", but found ("+Fr.join(", ")+") instead.")}return null},$a.register=function(t,o){for(var u in $a.definitions=o,o)t[u]=$a};var Fo=function(t,o,u){this.type=yn,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=o};function Qa(t,o){t[0]=Math.min(t[0],o[0]),t[1]=Math.min(t[1],o[1]),t[2]=Math.max(t[2],o[0]),t[3]=Math.max(t[3],o[1])}function ws(t,o){return!(t[0]<=o[0]||t[2]>=o[2]||t[1]<=o[1]||t[3]>=o[3])}function wl(t,o){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,y=Math.pow(2,o.z);return[Math.round(u*y*8192),Math.round(h*y*8192)]}function ms(t,o,u){return o[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-o[0])*(t[1]-o[1])/(u[1]-o[1])+o[0]}function ne(t,o){for(var u,h,y,b,S,I,D,z=!1,j=0,W=o.length;j<W;j++)for(var K=o[j],oe=0,Me=K.length;oe<Me-1;oe++){if((b=(u=t)[0]-(h=K[oe])[0])*(D=u[1]-(y=K[oe+1])[1])-(I=u[0]-y[0])*(S=u[1]-h[1])==0&&b*I<=0&&S*D<=0)return!1;ms(t,K[oe],K[oe+1])&&(z=!z)}return z}function be(t,o){for(var u=0;u<o.length;u++)if(ne(t,o[u]))return!0;return!1}function Ye(t,o,u,h){var y=h[0]-u[0],b=h[1]-u[1],S=(t[0]-u[0])*b-y*(t[1]-u[1]),I=(o[0]-u[0])*b-y*(o[1]-u[1]);return S>0&&I<0||S<0&&I>0}function Rt(t,o,u){for(var h=0,y=u;h<y.length;h+=1)for(var b=y[h],S=0;S<b.length-1;++S)if((W=[(j=b[S+1])[0]-(z=b[S])[0],j[1]-z[1]])[0]*(K=[(D=o)[0]-(I=t)[0],D[1]-I[1]])[1]-W[1]*K[0]!=0&&Ye(I,D,z,j)&&Ye(z,j,I,D))return!0;var I,D,z,j,W,K;return!1}function Or(t,o){for(var u=0;u<t.length;++u)if(!ne(t[u],o))return!1;for(var h=0;h<t.length-1;++h)if(Rt(t[h],t[h+1],o))return!1;return!0}function Pn(t,o){for(var u=0;u<o.length;u++)if(Or(t,o[u]))return!0;return!1}function Oi(t,o,u){for(var h=[],y=0;y<t.length;y++){for(var b=[],S=0;S<t[y].length;S++){var I=wl(t[y][S],u);Qa(o,I),b.push(I)}h.push(b)}return h}function oo(t,o,u){for(var h=[],y=0;y<t.length;y++){var b=Oi(t[y],o,u);h.push(b)}return h}function La(t,o,u,h){if(t[0]<u[0]||t[0]>u[2]){var y=.5*h,b=t[0]-u[0]>y?-h:u[0]-t[0]>y?h:0;b===0&&(b=t[0]-u[2]>y?-h:u[2]-t[0]>y?h:0),t[0]+=b}Qa(o,t)}function Za(t,o,u,h){for(var y=8192*Math.pow(2,h.z),b=[8192*h.x,8192*h.y],S=[],I=0,D=t;I<D.length;I+=1)for(var z=0,j=D[I];z<j.length;z+=1){var W=j[z],K=[W.x+b[0],W.y+b[1]];La(K,o,u,y),S.push(K)}return S}function Vo(t,o,u,h){for(var y,b=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],I=[],D=0,z=t;D<z.length;D+=1){for(var j=[],W=0,K=z[D];W<K.length;W+=1){var oe=K[W],Me=[oe.x+S[0],oe.y+S[1]];Qa(o,Me),j.push(Me)}I.push(j)}if(o[2]-o[0]<=b/2){(y=o)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(var Oe=0,L=I;Oe<L.length;Oe+=1)for(var Ue=0,ot=L[Oe];Ue<ot.length;Ue+=1)La(ot[Ue],o,u,b)}return I}Fo.parse=function(t,o){if(t.length!==2)return o.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return o.error("Collator options argument must be an object.");var h=o.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Br);if(!h)return null;var y=o.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Br);if(!y)return null;var b=null;return u.locale&&!(b=o.parse(u.locale,1,Jr))?null:new Fo(h,y,b)},Fo.prototype.evaluate=function(t){return new Ir(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Fo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Fo.prototype.outputDefined=function(){return!1},Fo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var gs=function(t,o){this.type=Br,this.geojson=t,this.geometries=o};function lo(t){if(t instanceof $a&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof gs)return!1;var o=!0;return t.eachChild(function(u){o&&!lo(u)&&(o=!1)}),o}function wo(t){if(t instanceof $a&&t.name==="feature-state")return!1;var o=!0;return t.eachChild(function(u){o&&!wo(u)&&(o=!1)}),o}function ys(t,o){if(t instanceof $a&&o.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!ys(h,o)&&(u=!1)}),u}gs.parse=function(t,o){if(t.length!==2)return o.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(Ko(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var y=u.features[h].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new gs(u,u.features[h].geometry)}else if(u.type==="Feature"){var b=u.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new gs(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new gs(u,u)}return o.error("'within' expression requires valid geojson object that contains polygon geometry type.")},gs.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Oi(u.coordinates,y,b),I=Za(o.geometry(),h,y,b);if(!ws(h,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!ne(z[D],S))return!1}if(u.type==="MultiPolygon"){var j=oo(u.coordinates,y,b),W=Za(o.geometry(),h,y,b);if(!ws(h,y))return!1;for(var K=0,oe=W;K<oe.length;K+=1)if(!be(oe[K],j))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(o,u){var h=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],b=o.canonicalID();if(u.type==="Polygon"){var S=Oi(u.coordinates,y,b),I=Vo(o.geometry(),h,y,b);if(!ws(h,y))return!1;for(var D=0,z=I;D<z.length;D+=1)if(!Or(z[D],S))return!1}if(u.type==="MultiPolygon"){var j=oo(u.coordinates,y,b),W=Vo(o.geometry(),h,y,b);if(!ws(h,y))return!1;for(var K=0,oe=W;K<oe.length;K+=1)if(!Pn(oe[K],j))return!1}return!0}(t,this.geometries)}return!1},gs.prototype.eachChild=function(){},gs.prototype.outputDefined=function(){return!0},gs.prototype.serialize=function(){return["within",this.geojson]};var Ts=function(t,o){this.type=o.type,this.name=t,this.boundExpression=o};Ts.parse=function(t,o){if(t.length!==2||typeof t[1]!="string")return o.error("'var' expression requires exactly one string literal argument.");var u=t[1];return o.scope.has(u)?new Ts(u,o.scope.get(u)):o.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},Ts.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Ts.prototype.eachChild=function(){},Ts.prototype.outputDefined=function(){return!1},Ts.prototype.serialize=function(){return["var",this.name]};var Fs=function(t,o,u,h,y){o===void 0&&(o=[]),h===void 0&&(h=new _n),y===void 0&&(y=[]),this.registry=t,this.path=o,this.key=o.map(function(b){return"["+b+"]"}).join(""),this.scope=h,this.errors=y,this.expectedType=u};function uu(t,o){for(var u,h=t.length-1,y=0,b=h,S=0;y<=b;)if((u=t[S=Math.floor((y+b)/2)])<=o){if(S===h||o<t[S+1])return S;y=S+1}else{if(!(u>o))throw new Ma("Input is not a number.");b=S-1}return 0}Fs.prototype.parse=function(t,o,u,h,y){return y===void 0&&(y={}),o?this.concat(o,u,h)._parse(t,y):this._parse(t,y)},Fs.prototype._parse=function(t,o){function u(z,j,W){return W==="assert"?new ia(j,[z]):W==="coerce"?new vo(j,[z]):z}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var y=this.registry[h];if(y){var b=y.parse(t,this);if(!b)return null;if(this.expectedType){var S=this.expectedType,I=b.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||I.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string"){if(this.checkSubtype(S,I))return null}else b=u(b,S,o.typeAnnotation||"coerce");else b=u(b,S,o.typeAnnotation||"assert")}if(!(b instanceof Ua)&&b.type.kind!=="resolvedImage"&&function z(j){if(j instanceof Ts)return z(j.boundExpression);if(j instanceof $a&&j.name==="error"||j instanceof Fo||j instanceof gs)return!1;var W=j instanceof vo||j instanceof ia,K=!0;return j.eachChild(function(oe){K=W?K&&z(oe):K&&oe instanceof Ua}),!!K&&lo(j)&&ys(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(b)){var D=new aa;try{b=new Ua(b.type,b.evaluate(D))}catch(z){return this.error(z.message),null}}return b}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Fs.prototype.concat=function(t,o,u){var h=typeof t=="number"?this.path.concat(t):this.path,y=u?this.scope.concat(u):this.scope;return new Fs(this.registry,h,o||null,y,this.errors)},Fs.prototype.error=function(t){for(var o=[],u=arguments.length-1;u-- >0;)o[u]=arguments[u+1];var h=""+this.key+o.map(function(y){return"["+y+"]"}).join("");this.errors.push(new hr(h,t))},Fs.prototype.checkSubtype=function(t,o){var u=It(t,o);return u&&this.error(u),u};var _s=function(t,o,u){this.type=t,this.input=o,this.labels=[],this.outputs=[];for(var h=0,y=u;h<y.length;h+=1){var b=y[h],S=b[1];this.labels.push(b[0]),this.outputs.push(S)}};function ga(t,o,u){return t*(1-u)+o*u}_s.parse=function(t,o){if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");var u=o.parse(t[1],1,Pt);if(!u)return null;var h=[],y=null;o.expectedType&&o.expectedType.kind!=="value"&&(y=o.expectedType);for(var b=1;b<t.length;b+=2){var S=b===1?-1/0:t[b],I=t[b+1],D=b,z=b+1;if(typeof S!="number")return o.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=S)return o.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var j=o.parse(I,z,y);if(!j)return null;y=y||j.type,h.push([S,j])}return new _s(y,u,h)},_s.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;return h>=o[y-1]?u[y-1].evaluate(t):u[uu(o,h)].evaluate(t)},_s.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},_s.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_s.prototype.serialize=function(){for(var t=["step",this.input.serialize()],o=0;o<this.labels.length;o++)o>0&&t.push(this.labels[o]),t.push(this.outputs[o].serialize());return t};var xa=Object.freeze({__proto__:null,number:ga,color:function(t,o,u){return new ji(ga(t.r,o.r,u),ga(t.g,o.g,u),ga(t.b,o.b,u),ga(t.a,o.a,u))},array:function(t,o,u){return t.map(function(h,y){return ga(h,o[y],u)})}}),is=6/29*3*(6/29),hf=Math.PI/180,Tl=180/Math.PI;function Xs(t){return t>.008856451679035631?Math.pow(t,1/3):t/is+4/29}function tc(t){return t>6/29?t*t*t:is*(t-4/29)}function Wu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ys(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function al(t){var o=Ys(t.r),u=Ys(t.g),h=Ys(t.b),y=Xs((.4124564*o+.3575761*u+.1804375*h)/.95047),b=Xs((.2126729*o+.7151522*u+.072175*h)/1);return{l:116*b-16,a:500*(y-b),b:200*(b-Xs((.0193339*o+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function _(t){var o=(t.l+16)/116,u=isNaN(t.a)?o:o+t.a/500,h=isNaN(t.b)?o:o-t.b/200;return o=1*tc(o),u=.95047*tc(u),h=1.08883*tc(h),new ji(Wu(3.2404542*u-1.5371385*o-.4985314*h),Wu(-.969266*u+1.8760108*o+.041556*h),Wu(.0556434*u-.2040259*o+1.0572252*h),t.alpha)}function M(t,o,u){var h=o-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var B={forward:al,reverse:_,interpolate:function(t,o,u){return{l:ga(t.l,o.l,u),a:ga(t.a,o.a,u),b:ga(t.b,o.b,u),alpha:ga(t.alpha,o.alpha,u)}}},O={forward:function(t){var o=al(t),u=o.l,h=o.a,y=o.b,b=Math.atan2(y,h)*Tl;return{h:b<0?b+360:b,c:Math.sqrt(h*h+y*y),l:u,alpha:t.a}},reverse:function(t){var o=t.h*hf,u=t.c;return _({l:t.l,a:Math.cos(o)*u,b:Math.sin(o)*u,alpha:t.alpha})},interpolate:function(t,o,u){return{h:M(t.h,o.h,u),c:ga(t.c,o.c,u),l:ga(t.l,o.l,u),alpha:ga(t.alpha,o.alpha,u)}}},$=Object.freeze({__proto__:null,lab:B,hcl:O}),xe=function(t,o,u,h,y){this.type=t,this.operator=o,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var b=0,S=y;b<S.length;b+=1){var I=S[b],D=I[1];this.labels.push(I[0]),this.outputs.push(D)}};function We(t,o,u,h){var y=h-u,b=t-u;return y===0?0:o===1?b/y:(Math.pow(o,b)-1)/(Math.pow(o,y)-1)}xe.interpolationFactor=function(t,o,u,h){var y=0;if(t.name==="exponential")y=We(o,t.base,u,h);else if(t.name==="linear")y=We(o,1,u,h);else if(t.name==="cubic-bezier"){var b=t.controlPoints;y=new V(b[0],b[1],b[2],b[3]).solve(We(o,1,u,h))}return y},xe.parse=function(t,o){var u=t[0],h=t[1],y=t[2],b=t.slice(3);if(!Array.isArray(h)||h.length===0)return o.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return o.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return o.error("Unknown interpolation type "+String(h[0]),1,0);var I=h.slice(1);if(I.length!==4||I.some(function(L){return typeof L!="number"||L<0||L>1}))return o.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:I}}if(t.length-1<4)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return o.error("Expected an even number of arguments.");if(!(y=o.parse(y,2,Pt)))return null;var D=[],z=null;u==="interpolate-hcl"||u==="interpolate-lab"?z=Hr:o.expectedType&&o.expectedType.kind!=="value"&&(z=o.expectedType);for(var j=0;j<b.length;j+=2){var W=b[j],K=b[j+1],oe=j+3,Me=j+4;if(typeof W!="number")return o.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',oe);if(D.length&&D[D.length-1][0]>=W)return o.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',oe);var Oe=o.parse(K,Me,z);if(!Oe)return null;z=z||Oe.type,D.push([W,Oe])}return z.kind==="number"||z.kind==="color"||z.kind==="array"&&z.itemType.kind==="number"&&typeof z.N=="number"?new xe(z,u,h,y,D):o.error("Type "+xi(z)+" is not interpolatable.")},xe.prototype.evaluate=function(t){var o=this.labels,u=this.outputs;if(o.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=o[0])return u[0].evaluate(t);var y=o.length;if(h>=o[y-1])return u[y-1].evaluate(t);var b=uu(o,h),S=xe.interpolationFactor(this.interpolation,h,o[b],o[b+1]),I=u[b].evaluate(t),D=u[b+1].evaluate(t);return this.operator==="interpolate"?xa[this.type.kind.toLowerCase()](I,D,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(I),O.forward(D),S)):B.reverse(B.interpolate(B.forward(I),B.forward(D),S))},xe.prototype.eachChild=function(t){t(this.input);for(var o=0,u=this.outputs;o<u.length;o+=1)t(u[o])},xe.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},xe.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var o=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)o.push(this.labels[u],this.outputs[u].serialize());return o};var ft=function(t,o){this.type=t,this.args=o};ft.parse=function(t,o){if(t.length<2)return o.error("Expectected at least one argument.");var u=null,h=o.expectedType;h&&h.kind!=="value"&&(u=h);for(var y=[],b=0,S=t.slice(1);b<S.length;b+=1){var I=o.parse(S[b],1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}var D=h&&y.some(function(z){return It(h,z.type)});return new ft(D?en:u,y)},ft.prototype.evaluate=function(t){for(var o,u=null,h=0,y=0,b=this.args;y<b.length&&(h++,(u=b[y].evaluate(t))&&u instanceof na&&!u.available&&(o||(o=u.name),u=null,h===this.args.length&&(u=o)),u===null);y+=1);return u},ft.prototype.eachChild=function(t){this.args.forEach(t)},ft.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ft.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(o){t.push(o.serialize())}),t};var pt=function(t,o){this.type=o.type,this.bindings=[].concat(t),this.result=o};pt.prototype.evaluate=function(t){return this.result.evaluate(t)},pt.prototype.eachChild=function(t){for(var o=0,u=this.bindings;o<u.length;o+=1)t(u[o][1]);t(this.result)},pt.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var y=t[h];if(typeof y!="string")return o.error("Expected string, but found "+typeof y+" instead.",h);if(/[^a-zA-Z0-9_]/.test(y))return o.error("Variable names must contain only alphanumeric characters or '_'.",h);var b=o.parse(t[h+1],h+1);if(!b)return null;u.push([y,b])}var S=o.parse(t[t.length-1],t.length-1,o.expectedType,u);return S?new pt(u,S):null},pt.prototype.outputDefined=function(){return this.result.outputDefined()},pt.prototype.serialize=function(){for(var t=["let"],o=0,u=this.bindings;o<u.length;o+=1){var h=u[o];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var ar=function(t,o,u){this.type=t,this.index=o,this.input=u};ar.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,Pt),h=o.parse(t[2],2,Pi(o.expectedType||en));return u&&h?new ar(h.type.itemType,u,h):null},ar.prototype.evaluate=function(t){var o=this.index.evaluate(t),u=this.input.evaluate(t);if(o<0)throw new Ma("Array index out of bounds: "+o+" < 0.");if(o>=u.length)throw new Ma("Array index out of bounds: "+o+" > "+(u.length-1)+".");if(o!==Math.floor(o))throw new Ma("Array index must be an integer, but found "+o+" instead.");return u[o]},ar.prototype.eachChild=function(t){t(this.index),t(this.input)},ar.prototype.outputDefined=function(){return!1},ar.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ur=function(t,o){this.type=Br,this.needle=t,this.haystack=o};ur.parse=function(t,o){if(t.length!==3)return o.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),h=o.parse(t[2],2,en);return u&&h?Ta(u.type,[Br,Jr,Pt,fn,en])?new ur(u,h):o.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead"):null},ur.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!Ci(o,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+xi(ra(o))+" instead.");if(!Ci(u,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+xi(ra(u))+" instead.");return u.indexOf(o)>=0},ur.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},ur.prototype.outputDefined=function(){return!0},ur.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Tn=function(t,o,u){this.type=Pt,this.needle=t,this.haystack=o,this.fromIndex=u};Tn.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),h=o.parse(t[2],2,en);if(!u||!h)return null;if(!Ta(u.type,[Br,Jr,Pt,fn,en]))return o.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Pt);return y?new Tn(u,h,y):null}return new Tn(u,h)},Tn.prototype.evaluate=function(t){var o=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!Ci(o,["boolean","string","number","null"]))throw new Ma("Expected first argument to be of type boolean, string, number or null, but found "+xi(ra(o))+" instead.");if(!Ci(u,["string","array"]))throw new Ma("Expected second argument to be of type array or string, but found "+xi(ra(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(o,h)}return u.indexOf(o)},Tn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var ii=function(t,o,u,h,y,b){this.inputType=t,this.type=o,this.input=u,this.cases=h,this.outputs=y,this.otherwise=b};ii.parse=function(t,o){if(t.length<5)return o.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return o.error("Expected an even number of arguments.");var u,h;o.expectedType&&o.expectedType.kind!=="value"&&(h=o.expectedType);for(var y={},b=[],S=2;S<t.length-1;S+=2){var I=t[S],D=t[S+1];Array.isArray(I)||(I=[I]);var z=o.concat(S);if(I.length===0)return z.error("Expected at least one branch label.");for(var j=0,W=I;j<W.length;j+=1){var K=W[j];if(typeof K!="number"&&typeof K!="string")return z.error("Branch labels must be numbers or strings.");if(typeof K=="number"&&Math.abs(K)>Number.MAX_SAFE_INTEGER)return z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof K=="number"&&Math.floor(K)!==K)return z.error("Numeric branch labels must be integer values.");if(u){if(z.checkSubtype(u,ra(K)))return null}else u=ra(K);if(y[String(K)]!==void 0)return z.error("Branch labels must be unique.");y[String(K)]=b.length}var oe=o.parse(D,S,h);if(!oe)return null;h=h||oe.type,b.push(oe)}var Me=o.parse(t[1],1,en);if(!Me)return null;var Oe=o.parse(t[t.length-1],t.length-1,h);return Oe?Me.type.kind!=="value"&&o.concat(1).checkSubtype(u,Me.type)?null:new ii(u,h,Me,y,b,Oe):null},ii.prototype.evaluate=function(t){var o=this.input.evaluate(t);return(ra(o)===this.inputType&&this.outputs[this.cases[o]]||this.otherwise).evaluate(t)},ii.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},ii.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},ii.prototype.serialize=function(){for(var t=this,o=["match",this.input.serialize()],u=[],h={},y=0,b=Object.keys(this.cases).sort();y<b.length;y+=1){var S=b[y];(W=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[W][1].push(S)}for(var I=function(oe){return t.inputType.kind==="number"?Number(oe):oe},D=0,z=u;D<z.length;D+=1){var j=z[D],W=j[0],K=j[1];o.push(K.length===1?I(K[0]):K.map(I)),o.push(this.outputs[outputIndex$1].serialize())}return o.push(this.otherwise.serialize()),o};var Rn=function(t,o,u){this.type=t,this.branches=o,this.otherwise=u};Rn.parse=function(t,o){if(t.length<4)return o.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return o.error("Expected an odd number of arguments.");var u;o.expectedType&&o.expectedType.kind!=="value"&&(u=o.expectedType);for(var h=[],y=1;y<t.length-1;y+=2){var b=o.parse(t[y],y,Br);if(!b)return null;var S=o.parse(t[y+1],y+1,u);if(!S)return null;h.push([b,S]),u=u||S.type}var I=o.parse(t[t.length-1],t.length-1,u);return I?new Rn(u,h,I):null},Rn.prototype.evaluate=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];if(h[0].evaluate(t))return y.evaluate(t)}return this.otherwise.evaluate(t)},Rn.prototype.eachChild=function(t){for(var o=0,u=this.branches;o<u.length;o+=1){var h=u[o],y=h[1];t(h[0]),t(y)}t(this.otherwise)},Rn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Rn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Yi=function(t,o,u,h){this.type=t,this.input=o,this.beginIndex=u,this.endIndex=h};function da(t,o){return t==="=="||t==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ca(t,o,u,h){return h.compare(o,u)===0}function Hi(t,o,u){var h=t!=="=="&&t!=="!=";return function(){function y(b,S,I){this.type=Br,this.lhs=b,this.rhs=S,this.collator=I,this.hasUntypedArgument=b.type.kind==="value"||S.type.kind==="value"}return y.parse=function(b,S){if(b.length!==3&&b.length!==4)return S.error("Expected two or three arguments.");var I=b[0],D=S.parse(b[1],1,en);if(!D)return null;if(!da(I,D.type))return S.concat(1).error('"'+I+`" comparisons are not supported for type '`+xi(D.type)+"'.");var z=S.parse(b[2],2,en);if(!z)return null;if(!da(I,z.type))return S.concat(2).error('"'+I+`" comparisons are not supported for type '`+xi(z.type)+"'.");if(D.type.kind!==z.type.kind&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot compare types '"+xi(D.type)+"' and '"+xi(z.type)+"'.");h&&(D.type.kind==="value"&&z.type.kind!=="value"?D=new ia(z.type,[D]):D.type.kind!=="value"&&z.type.kind==="value"&&(z=new ia(D.type,[z])));var j=null;if(b.length===4){if(D.type.kind!=="string"&&z.type.kind!=="string"&&D.type.kind!=="value"&&z.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(j=S.parse(b[3],3,yn)))return null}return new y(D,z,j)},y.prototype.evaluate=function(b){var S=this.lhs.evaluate(b),I=this.rhs.evaluate(b);if(h&&this.hasUntypedArgument){var D=ra(S),z=ra(I);if(D.kind!==z.kind||D.kind!=="string"&&D.kind!=="number")throw new Ma('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+D.kind+", "+z.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var j=ra(S),W=ra(I);if(j.kind!=="string"||W.kind!=="string")return o(b,S,I)}return this.collator?u(b,S,I,this.collator.evaluate(b)):o(b,S,I)},y.prototype.eachChild=function(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)},y.prototype.outputDefined=function(){return!0},y.prototype.serialize=function(){var b=[t];return this.eachChild(function(S){b.push(S.serialize())}),b},y}()}Yi.parse=function(t,o){if(t.length<=2||t.length>=5)return o.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1,en),h=o.parse(t[2],2,Pt);if(!u||!h)return null;if(!Ta(u.type,[Pi(en),Jr,en]))return o.error("Expected first argument to be of type array or string, but found "+xi(u.type)+" instead");if(t.length===4){var y=o.parse(t[3],3,Pt);return y?new Yi(u.type,u,h,y):null}return new Yi(u.type,u,h)},Yi.prototype.evaluate=function(t){var o=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!Ci(o,["string","array"]))throw new Ma("Expected first argument to be of type array or string, but found "+xi(ra(o))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return o.slice(u,h)}return o.slice(u)},Yi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Yi.prototype.outputDefined=function(){return!1},Yi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var xs=Hi("==",function(t,o,u){return o===u},Ca),lu=Hi("!=",function(t,o,u){return o!==u},function(t,o,u,h){return!Ca(0,o,u,h)}),Xu=Hi("<",function(t,o,u){return o<u},function(t,o,u,h){return h.compare(o,u)<0}),df=Hi(">",function(t,o,u){return o>u},function(t,o,u,h){return h.compare(o,u)>0}),ol=Hi("<=",function(t,o,u){return o<=u},function(t,o,u,h){return h.compare(o,u)<=0}),kc=Hi(">=",function(t,o,u){return o>=u},function(t,o,u,h){return h.compare(o,u)>=0}),Au=function(t,o,u,h,y){this.type=Jr,this.number=t,this.locale=o,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=y};Au.parse=function(t,o){if(t.length!==3)return o.error("Expected two arguments.");var u=o.parse(t[1],1,Pt);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return o.error("NumberFormat options argument must be an object.");var y=null;if(h.locale&&!(y=o.parse(h.locale,1,Jr)))return null;var b=null;if(h.currency&&!(b=o.parse(h.currency,1,Jr)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=o.parse(h["min-fraction-digits"],1,Pt)))return null;var I=null;return h["max-fraction-digits"]&&!(I=o.parse(h["max-fraction-digits"],1,Pt))?null:new Au(u,y,b,S,I)},Au.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Au.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Au.prototype.outputDefined=function(){return!1},Au.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var wu=function(t){this.type=Pt,this.input=t};wu.parse=function(t,o){if(t.length!==2)return o.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=o.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?o.error("Expected argument of type string or array, but found "+xi(u.type)+" instead."):new wu(u):null},wu.prototype.evaluate=function(t){var o=this.input.evaluate(t);if(typeof o=="string"||Array.isArray(o))return o.length;throw new Ma("Expected value to be of type string or array, but found "+xi(ra(o))+" instead.")},wu.prototype.eachChild=function(t){t(this.input)},wu.prototype.outputDefined=function(){return!1},wu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(o){t.push(o.serialize())}),t};var Tu={"==":xs,"!=":lu,">":df,"<":Xu,">=":kc,"<=":ol,array:ia,at:ar,boolean:ia,case:Rn,coalesce:ft,collator:Fo,format:Ao,image:jo,in:ur,"index-of":Tn,interpolate:xe,"interpolate-hcl":xe,"interpolate-lab":xe,length:wu,let:pt,literal:Ua,match:ii,number:ia,"number-format":Au,object:ia,slice:Yi,step:_s,string:ia,"to-boolean":vo,"to-color":vo,"to-number":vo,"to-string":vo,var:Ts,within:gs};function co(t,o){var u=o[0],h=o[1],y=o[2],b=o[3];u=u.evaluate(t),h=h.evaluate(t),y=y.evaluate(t);var S=b?b.evaluate(t):1,I=de(u,h,y,S);if(I)throw new Ma(I);return new ji(u/255*S,h/255*S,y/255*S,S)}function jf(t,o){return t in o}function Vf(t,o){var u=o[t];return u===void 0?null:u}function $o(t){return{type:t}}function Dc(t){return{result:"success",value:t}}function Mu(t){return{result:"error",value:t}}function cu(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function vf(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Ml(t){return!!t.expression&&t.expression.interpolated}function Ni(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Pl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Cp(t){return t}function sl(t,o,u){return t!==void 0?t:o!==void 0?o:u!==void 0?u:void 0}function Fc(t,o,u,h,y){return sl(typeof u===y?h[u]:void 0,t.default,o.default)}function Gf(t,o,u){if(Ni(u)!=="number")return sl(t.default,o.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var y=uu(t.stops.map(function(b){return b[0]}),u);return t.stops[y][1]}function Ap(t,o,u){var h=t.base!==void 0?t.base:1;if(Ni(u)!=="number")return sl(t.default,o.default);var y=t.stops.length;if(y===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[y-1][0])return t.stops[y-1][1];var b=uu(t.stops.map(function(W){return W[0]}),u),S=function(W,K,oe,Me){var Oe=Me-oe,L=W-oe;return Oe===0?0:K===1?L/Oe:(Math.pow(K,L)-1)/(Math.pow(K,Oe)-1)}(u,h,t.stops[b][0],t.stops[b+1][0]),I=t.stops[b][1],D=t.stops[b+1][1],z=xa[o.type]||Cp;if(t.colorSpace&&t.colorSpace!=="rgb"){var j=$[t.colorSpace];z=function(W,K){return j.reverse(j.interpolate(j.forward(W),j.forward(K),S))}}return typeof I.evaluate=="function"?{evaluate:function(){for(var W=[],K=arguments.length;K--;)W[K]=arguments[K];var oe=I.evaluate.apply(void 0,W),Me=D.evaluate.apply(void 0,W);if(oe!==void 0&&Me!==void 0)return z(oe,Me,S)}}:z(I,D,S)}function Hf(t,o,u){return o.type==="color"?u=ji.parse(u):o.type==="formatted"?u=_t.fromString(u.toString()):o.type==="resolvedImage"?u=na.fromString(u.toString()):Ni(u)===o.type||o.type==="enum"&&o.values[u]||(u=void 0),sl(u,t.default,o.default)}$a.register(Tu,{error:[{kind:"error"},[Jr],function(t,o){throw new Ma(o[0].evaluate(t))}],typeof:[Jr,[en],function(t,o){return xi(ra(o[0].evaluate(t)))}],"to-rgba":[Pi(Pt,4),[Hr],function(t,o){return o[0].evaluate(t).toArray()}],rgb:[Hr,[Pt,Pt,Pt],co],rgba:[Hr,[Pt,Pt,Pt,Pt],co],has:{type:Br,overloads:[[[Jr],function(t,o){return jf(o[0].evaluate(t),t.properties())}],[[Jr,gi],function(t,o){var u=o[1];return jf(o[0].evaluate(t),u.evaluate(t))}]]},get:{type:en,overloads:[[[Jr],function(t,o){return Vf(o[0].evaluate(t),t.properties())}],[[Jr,gi],function(t,o){var u=o[1];return Vf(o[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[en,[Jr],function(t,o){return Vf(o[0].evaluate(t),t.featureState||{})}],properties:[gi,[],function(t){return t.properties()}],"geometry-type":[Jr,[],function(t){return t.geometryType()}],id:[en,[],function(t){return t.id()}],zoom:[Pt,[],function(t){return t.globals.zoom}],"heatmap-density":[Pt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Pt,[],function(t){return t.globals.lineProgress||0}],accumulated:[en,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Pt,$o(Pt),function(t,o){for(var u=0,h=0,y=o;h<y.length;h+=1)u+=y[h].evaluate(t);return u}],"*":[Pt,$o(Pt),function(t,o){for(var u=1,h=0,y=o;h<y.length;h+=1)u*=y[h].evaluate(t);return u}],"-":{type:Pt,overloads:[[[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)-u.evaluate(t)}],[[Pt],function(t,o){return-o[0].evaluate(t)}]]},"/":[Pt,[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)/u.evaluate(t)}],"%":[Pt,[Pt,Pt],function(t,o){var u=o[1];return o[0].evaluate(t)%u.evaluate(t)}],ln2:[Pt,[],function(){return Math.LN2}],pi:[Pt,[],function(){return Math.PI}],e:[Pt,[],function(){return Math.E}],"^":[Pt,[Pt,Pt],function(t,o){var u=o[1];return Math.pow(o[0].evaluate(t),u.evaluate(t))}],sqrt:[Pt,[Pt],function(t,o){return Math.sqrt(o[0].evaluate(t))}],log10:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN10}],ln:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))}],log2:[Pt,[Pt],function(t,o){return Math.log(o[0].evaluate(t))/Math.LN2}],sin:[Pt,[Pt],function(t,o){return Math.sin(o[0].evaluate(t))}],cos:[Pt,[Pt],function(t,o){return Math.cos(o[0].evaluate(t))}],tan:[Pt,[Pt],function(t,o){return Math.tan(o[0].evaluate(t))}],asin:[Pt,[Pt],function(t,o){return Math.asin(o[0].evaluate(t))}],acos:[Pt,[Pt],function(t,o){return Math.acos(o[0].evaluate(t))}],atan:[Pt,[Pt],function(t,o){return Math.atan(o[0].evaluate(t))}],min:[Pt,$o(Pt),function(t,o){return Math.min.apply(Math,o.map(function(u){return u.evaluate(t)}))}],max:[Pt,$o(Pt),function(t,o){return Math.max.apply(Math,o.map(function(u){return u.evaluate(t)}))}],abs:[Pt,[Pt],function(t,o){return Math.abs(o[0].evaluate(t))}],round:[Pt,[Pt],function(t,o){var u=o[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Pt,[Pt],function(t,o){return Math.floor(o[0].evaluate(t))}],ceil:[Pt,[Pt],function(t,o){return Math.ceil(o[0].evaluate(t))}],"filter-==":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Br,[en],function(t,o){var u=o[0];return t.id()===u.value}],"filter-type-==":[Br,[Jr],function(t,o){var u=o[0];return t.geometryType()===u.value}],"filter-<":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<b}],"filter-id-<":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<y}],"filter->":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>b}],"filter-id->":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>y}],"filter-<=":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y<=b}],"filter-id-<=":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h<=y}],"filter->=":[Br,[Jr,en],function(t,o){var u=o[0],h=o[1],y=t.properties()[u.value],b=h.value;return typeof y==typeof b&&y>=b}],"filter-id->=":[Br,[en],function(t,o){var u=o[0],h=t.id(),y=u.value;return typeof h==typeof y&&h>=y}],"filter-has":[Br,[en],function(t,o){return o[0].value in t.properties()}],"filter-has-id":[Br,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Br,[Pi(Jr)],function(t,o){return o[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Br,[Pi(en)],function(t,o){return o[0].value.indexOf(t.id())>=0}],"filter-in-small":[Br,[Jr,Pi(en)],function(t,o){var u=o[0];return o[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Br,[Jr,Pi(en)],function(t,o){var u=o[0],h=o[1];return function(y,b,S,I){for(;S<=I;){var D=S+I>>1;if(b[D]===y)return!0;b[D]>y?I=D-1:S=D+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Br,overloads:[[[Br,Br],function(t,o){var u=o[1];return o[0].evaluate(t)&&u.evaluate(t)}],[$o(Br),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Br,overloads:[[[Br,Br],function(t,o){var u=o[1];return o[0].evaluate(t)||u.evaluate(t)}],[$o(Br),function(t,o){for(var u=0,h=o;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Br,[Br],function(t,o){return!o[0].evaluate(t)}],"is-supported-script":[Br,[Jr],function(t,o){var u=t.globals&&t.globals.isSupportedScript;return!u||u(o[0].evaluate(t))}],upcase:[Jr,[Jr],function(t,o){return o[0].evaluate(t).toUpperCase()}],downcase:[Jr,[Jr],function(t,o){return o[0].evaluate(t).toLowerCase()}],concat:[Jr,$o(en),function(t,o){return o.map(function(u){return _u(u.evaluate(t))}).join("")}],"resolved-locale":[Jr,[yn],function(t,o){return o[0].evaluate(t).resolvedLocale()}]});var Bc=function(t,o){this.expression=t,this._warningHistory={},this._evaluator=new aa,this._defaultValue=o?function(u){return u.type==="color"&&Pl(u.default)?new ji(0,0,0,0):u.type==="color"?ji.parse(u.default)||null:u.default===void 0?null:u.default}(o):null,this._enumValues=o&&o.type==="enum"?o.values:null};function rc(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Tu}function nc(t,o){var u=new Fs(Tu,[],o?function(y){var b={color:Hr,string:Jr,number:Pt,enum:Jr,boolean:Br,formatted:Xi,resolvedImage:vi};return y.type==="array"?Pi(b[y.value]||en,y.length):b[y.type]}(o):void 0),h=u.parse(t,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Dc(new Bc(h,o)):Mu(u.errors)}Bc.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._evaluator.globals=t,this._evaluator.feature=o,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)},Bc.prototype.evaluate=function(t,o,u,h,y,b){this._evaluator.globals=t,this._evaluator.feature=o||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=b||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Ma("Expected value to be one of "+Object.keys(this._enumValues).map(function(I){return JSON.stringify(I)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(I){return this._warningHistory[I.message]||(this._warningHistory[I.message]=!0,typeof console!="undefined"&&console.warn(I.message)),this._defaultValue}};var Il=function(t,o){this.kind=t,this._styleExpression=o,this.isStateDependent=t!=="constant"&&!wo(o.expression)};Il.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},Il.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)};var ul=function(t,o,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=o,this.isStateDependent=t!=="camera"&&!wo(o.expression),this.interpolationType=h};function Ol(t,o){if((t=nc(t,o)).result==="error")return t;var u=t.value.expression,h=lo(u);if(!h&&!cu(o))return Mu([new hr("","data expressions not supported")]);var y=ys(u,["zoom"]);if(!y&&!vf(o))return Mu([new hr("","zoom expressions not supported")]);var b=function S(I){var D=null;if(I instanceof pt)D=S(I.result);else if(I instanceof ft)for(var z=0,j=I.args;z<j.length&&!(D=S(j[z]));z+=1);else(I instanceof _s||I instanceof xe)&&I.input instanceof $a&&I.input.name==="zoom"&&(D=I);return D instanceof hr||I.eachChild(function(W){var K=S(W);K instanceof hr?D=K:!D&&K?D=new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&K&&D!==K&&(D=new hr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(u);return b||y?b instanceof hr?Mu([b]):b instanceof xe&&!Ml(o)?Mu([new hr("",'"interpolate" expressions cannot be used with this property')]):Dc(b?new ul(h?"camera":"composite",t.value,b.labels,b instanceof xe?b.interpolation:void 0):new Il(h?"constant":"source",t.value)):Mu([new hr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}ul.prototype.evaluateWithoutErrorHandling=function(t,o,u,h,y,b){return this._styleExpression.evaluateWithoutErrorHandling(t,o,u,h,y,b)},ul.prototype.evaluate=function(t,o,u,h,y,b){return this._styleExpression.evaluate(t,o,u,h,y,b)},ul.prototype.interpolationFactor=function(t,o,u){return this.interpolationType?xe.interpolationFactor(this.interpolationType,t,o,u):0};var Yu=function(t,o){this._parameters=t,this._specification=o,pr(this,function u(h,y){var b,S,I,D=y.type==="color",z=h.stops&&typeof h.stops[0][0]=="object",j=z||!(z||h.property!==void 0),W=h.type||(Ml(y)?"exponential":"interval");if(D&&((h=pr({},h)).stops&&(h.stops=h.stops.map(function(cn){return[cn[0],ji.parse(cn[1])]})),h.default=ji.parse(h.default?h.default:y.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!$[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(W==="exponential")b=Ap;else if(W==="interval")b=Gf;else if(W==="categorical"){b=Fc,S=Object.create(null);for(var K=0,oe=h.stops;K<oe.length;K+=1){var Me=oe[K];S[Me[0]]=Me[1]}I=typeof h.stops[0][0]}else{if(W!=="identity")throw new Error('Unknown function type "'+W+'"');b=Hf}if(z){for(var Oe={},L=[],Ue=0;Ue<h.stops.length;Ue++){var ot=h.stops[Ue],xt=ot[0].zoom;Oe[xt]===void 0&&(Oe[xt]={zoom:xt,type:h.type,property:h.property,default:h.default,stops:[]},L.push(xt)),Oe[xt].stops.push([ot[0].value,ot[1]])}for(var Ut=[],Gt=0,or=L;Gt<or.length;Gt+=1){var Mr=or[Gt];Ut.push([Oe[Mr].zoom,u(Oe[Mr],y)])}var Fr={name:"linear"};return{kind:"composite",interpolationType:Fr,interpolationFactor:xe.interpolationFactor.bind(void 0,Fr),zoomStops:Ut.map(function(cn){return cn[0]}),evaluate:function(cn,Zn){var pn=cn.zoom;return Ap({stops:Ut,base:h.base},y,pn).evaluate(pn,Zn)}}}if(j){var Dn=W==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:Dn,interpolationFactor:xe.interpolationFactor.bind(void 0,Dn),zoomStops:h.stops.map(function(cn){return cn[0]}),evaluate:function(cn){return b(h,y,cn.zoom,S,I)}}}return{kind:"source",evaluate:function(cn,Zn){var pn=Zn&&Zn.properties?Zn.properties[h.property]:void 0;return pn===void 0?sl(h.default,y.default):b(h,y,pn,S,I)}}}(this._parameters,this._specification))};function qs(t){var o=t.key,u=t.value,h=t.valueSpec||{},y=t.objectElementValidators||{},b=t.style,S=t.styleSpec,I=[],D=Ni(u);if(D!=="object")return[new ke(o,u,"object expected, "+D+" found")];for(var z in u){var j=z.split(".")[0],W=h[j]||h["*"],K=void 0;if(y[j])K=y[j];else if(h[j])K=qi;else if(y["*"])K=y["*"];else{if(!h["*"]){I.push(new ke(o,u[z],'unknown property "'+z+'"'));continue}K=qi}I=I.concat(K({key:(o&&o+".")+z,value:u[z],valueSpec:W,style:b,styleSpec:S,object:u,objectKey:z},u))}for(var oe in h)y[oe]||h[oe].required&&h[oe].default===void 0&&u[oe]===void 0&&I.push(new ke(o,u,'missing required property "'+oe+'"'));return I}function mf(t){var o=t.value,u=t.valueSpec,h=t.style,y=t.styleSpec,b=t.key,S=t.arrayElementValidator||qi;if(Ni(o)!=="array")return[new ke(b,o,"array expected, "+Ni(o)+" found")];if(u.length&&o.length!==u.length)return[new ke(b,o,"array length "+u.length+" expected, length "+o.length+" found")];if(u["min-length"]&&o.length<u["min-length"])return[new ke(b,o,"array length at least "+u["min-length"]+" expected, length "+o.length+" found")];var I={type:u.value,values:u.values};y.$version<7&&(I.function=u.function),Ni(u.value)==="object"&&(I=u.value);for(var D=[],z=0;z<o.length;z++)D=D.concat(S({array:o,arrayIndex:z,value:o[z],valueSpec:I,style:h,styleSpec:y,key:b+"["+z+"]"}));return D}function gf(t){var o=t.key,u=t.value,h=t.valueSpec,y=Ni(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new ke(o,u,"number expected, "+y+" found")]:"minimum"in h&&u<h.minimum?[new ke(o,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new ke(o,u,u+" is greater than the maximum value "+h.maximum)]:[]}function Wf(t){var o,u,h,y=t.valueSpec,b=kt(t.value.type),S={},I=b!=="categorical"&&t.value.property===void 0,D=!I,z=Ni(t.value.stops)==="array"&&Ni(t.value.stops[0])==="array"&&Ni(t.value.stops[0][0])==="object",j=qs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(oe){if(b==="identity")return[new ke(oe.key,oe.value,'identity function may not have a "stops" property')];var Me=[],Oe=oe.value;return Me=Me.concat(mf({key:oe.key,value:Oe,valueSpec:oe.valueSpec,style:oe.style,styleSpec:oe.styleSpec,arrayElementValidator:W})),Ni(Oe)==="array"&&Oe.length===0&&Me.push(new ke(oe.key,Oe,"array must have at least one stop")),Me},default:function(oe){return qi({key:oe.key,value:oe.value,valueSpec:y,style:oe.style,styleSpec:oe.styleSpec})}}});return b==="identity"&&I&&j.push(new ke(t.key,t.value,'missing required property "property"')),b==="identity"||t.value.stops||j.push(new ke(t.key,t.value,'missing required property "stops"')),b==="exponential"&&t.valueSpec.expression&&!Ml(t.valueSpec)&&j.push(new ke(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(D&&!cu(t.valueSpec)?j.push(new ke(t.key,t.value,"property functions not supported")):I&&!vf(t.valueSpec)&&j.push(new ke(t.key,t.value,"zoom functions not supported"))),b!=="categorical"&&!z||t.value.property!==void 0||j.push(new ke(t.key,t.value,'"property" property is required')),j;function W(oe){var Me=[],Oe=oe.value,L=oe.key;if(Ni(Oe)!=="array")return[new ke(L,Oe,"array expected, "+Ni(Oe)+" found")];if(Oe.length!==2)return[new ke(L,Oe,"array length 2 expected, length "+Oe.length+" found")];if(z){if(Ni(Oe[0])!=="object")return[new ke(L,Oe,"object expected, "+Ni(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new ke(L,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new ke(L,Oe,"object stop key must have value")];if(h&&h>kt(Oe[0].zoom))return[new ke(L,Oe[0].zoom,"stop zoom values must appear in ascending order")];kt(Oe[0].zoom)!==h&&(h=kt(Oe[0].zoom),u=void 0,S={}),Me=Me.concat(qs({key:L+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:oe.style,styleSpec:oe.styleSpec,objectElementValidators:{zoom:gf,value:K}}))}else Me=Me.concat(K({key:L+"[0]",value:Oe[0],valueSpec:{},style:oe.style,styleSpec:oe.styleSpec},Oe));return rc(Nt(Oe[1]))?Me.concat([new ke(L+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Me.concat(qi({key:L+"[1]",value:Oe[1],valueSpec:y,style:oe.style,styleSpec:oe.styleSpec}))}function K(oe,Me){var Oe=Ni(oe.value),L=kt(oe.value),Ue=oe.value!==null?oe.value:Me;if(o){if(Oe!==o)return[new ke(oe.key,Ue,Oe+" stop domain type must match previous stop domain type "+o)]}else o=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new ke(oe.key,Ue,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&b!=="categorical"){var ot="number expected, "+Oe+" found";return cu(y)&&b===void 0&&(ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ke(oe.key,Ue,ot)]}return b!=="categorical"||Oe!=="number"||isFinite(L)&&Math.floor(L)===L?b!=="categorical"&&Oe==="number"&&u!==void 0&&L<u?[new ke(oe.key,Ue,"stop domain values must appear in ascending order")]:(u=L,b==="categorical"&&L in S?[new ke(oe.key,Ue,"stop domain values must be unique")]:(S[L]=!0,[])):[new ke(oe.key,Ue,"integer expected, found "+L)]}}function fu(t){var o=(t.expressionContext==="property"?Ol:nc)(Nt(t.value),t.valueSpec);if(o.result==="error")return o.value.map(function(h){return new ke(""+t.key+h.key,t.value,h.message)});var u=o.value.expression||o.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new ke(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!wo(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!wo(u))return[new ke(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ys(u,["zoom","feature-state"]))return[new ke(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!lo(u))return[new ke(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ic(t){var o=t.key,u=t.value,h=t.valueSpec,y=[];return Array.isArray(h.values)?h.values.indexOf(kt(u))===-1&&y.push(new ke(o,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(kt(u))===-1&&y.push(new ke(o,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),y}function Nc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var o=0,u=t.slice(1);o<u.length;o+=1){var h=u[o];if(!Nc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Yu.deserialize=function(t){return new Yu(t._parameters,t._specification)},Yu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var yf={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Rl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Nc(t)||(t=_f(t));var o=nc(t,yf);if(o.result==="error")throw new Error(o.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,y){return o.value.evaluate(u,h,{},y)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var y=1;y<h.length;y++)if(u(h[y]))return!0;return!1}(t)}}function uh(t,o){return t<o?-1:t>o?1:0}function _f(t){if(!t)return!0;var o,u=t[0];return t.length<=1?u!=="any":u==="=="?Ll(t[1],t[2],"=="):u==="!="?kl(Ll(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?Ll(t[1],t[2],u):u==="any"?(o=t.slice(1),["any"].concat(o.map(_f))):u==="all"?["all"].concat(t.slice(1).map(_f)):u==="none"?["all"].concat(t.slice(1).map(_f).map(kl)):u==="in"?xf(t[1],t.slice(2)):u==="!in"?kl(xf(t[1],t.slice(2))):u==="has"?bf(t[1]):u==="!has"?kl(bf(t[1])):u!=="within"||t}function Ll(t,o,u){switch(t){case"$type":return["filter-type-"+u,o];case"$id":return["filter-id-"+u,o];default:return["filter-"+u,t,o]}}function xf(t,o){if(o.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(function(u){return typeof u!=typeof o[0]})?["filter-in-large",t,["literal",o.sort(uh)]]:["filter-in-small",t,["literal",o]]}}function bf(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function kl(t){return["!",t]}function zc(t){return Nc(Nt(t.value))?fu(pr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function o(u){var h=u.value,y=u.key;if(Ni(h)!=="array")return[new ke(y,h,"array expected, "+Ni(h)+" found")];var b,S=u.styleSpec,I=[];if(h.length<1)return[new ke(y,h,"filter array must have at least 1 element")];switch(I=I.concat(ic({key:y+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),kt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&kt(h[1])==="$type"&&I.push(new ke(y,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&I.push(new ke(y,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(b=Ni(h[1]))!=="string"&&I.push(new ke(y+"[1]",h[1],"string expected, "+b+" found"));for(var D=2;D<h.length;D++)b=Ni(h[D]),kt(h[1])==="$type"?I=I.concat(ic({key:y+"["+D+"]",value:h[D],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&I.push(new ke(y+"["+D+"]",h[D],"string, number, or boolean expected, "+b+" found"));break;case"any":case"all":case"none":for(var z=1;z<h.length;z++)I=I.concat(o({key:y+"["+z+"]",value:h[z],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":b=Ni(h[1]),h.length!==2?I.push(new ke(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="string"&&I.push(new ke(y+"[1]",h[1],"string expected, "+b+" found"));break;case"within":b=Ni(h[1]),h.length!==2?I.push(new ke(y,h,'filter array for "'+h[0]+'" operator must have 2 elements')):b!=="object"&&I.push(new ke(y+"[1]",h[1],"object expected, "+b+" found"))}return I}(t)}function wp(t,o){var u=t.key,h=t.style,y=t.styleSpec,b=t.value,S=t.objectKey,I=y[o+"_"+t.layerType];if(!I)return[];var D=S.match(/^(.*)-transition$/);if(o==="paint"&&D&&I[D[1]]&&I[D[1]].transition)return qi({key:u,value:b,valueSpec:y.transition,style:h,styleSpec:y});var z,j=t.valueSpec||I[S];if(!j)return[new ke(u,b,'unknown property "'+S+'"')];if(Ni(b)==="string"&&cu(j)&&!j.tokens&&(z=/^{([^}]+)}$/.exec(b)))return[new ke(u,b,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(z[1])+" }`.")];var W=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&W.push(new ke(u,b,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Pl(Nt(b))&&kt(b.type)==="identity"&&W.push(new ke(u,b,'"text-font" does not support identity functions'))),W.concat(qi({key:t.key,value:b,valueSpec:j,style:h,styleSpec:y,expressionContext:"property",propertyType:o,propertyKey:S}))}function Tp(t){return wp(t,"paint")}function ac(t){return wp(t,"layout")}function Mp(t){var o=[],u=t.value,h=t.key,y=t.style,b=t.styleSpec;u.type||u.ref||o.push(new ke(h,u,'either "type" or "ref" is required'));var S,I=kt(u.type),D=kt(u.ref);if(u.id)for(var z=kt(u.id),j=0;j<t.arrayIndex;j++){var W=y.layers[j];kt(W.id)===z&&o.push(new ke(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+W.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Me){Me in u&&o.push(new ke(h,u[Me],'"'+Me+'" is prohibited for ref layers'))}),y.layers.forEach(function(Me){kt(Me.id)===D&&(S=Me)}),S?S.ref?o.push(new ke(h,u.ref,"ref cannot reference another ref layer")):I=kt(S.type):o.push(new ke(h,u.ref,'ref layer "'+D+'" not found'));else if(I!=="background")if(u.source){var K=y.sources&&y.sources[u.source],oe=K&&kt(K.type);K?oe==="vector"&&I==="raster"?o.push(new ke(h,u.source,'layer "'+u.id+'" requires a raster source')):oe==="raster"&&I!=="raster"?o.push(new ke(h,u.source,'layer "'+u.id+'" requires a vector source')):oe!=="vector"||u["source-layer"]?oe==="raster-dem"&&I!=="hillshade"?o.push(new ke(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="line"||!u.paint||!u.paint["line-gradient"]||oe==="geojson"&&K.lineMetrics||o.push(new ke(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):o.push(new ke(h,u,'layer "'+u.id+'" must specify a "source-layer"')):o.push(new ke(h,u.source,'source "'+u.source+'" not found'))}else o.push(new ke(h,u,'missing required property "source"'));return o=o.concat(qs({key:h,value:u,valueSpec:b.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return qi({key:h+".type",value:u.type,valueSpec:b.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:zc,layout:function(Me){return qs({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return ac(pr({layerType:I},Oe))}}})},paint:function(Me){return qs({layer:u,key:Me.key,value:Me.value,style:Me.style,styleSpec:Me.styleSpec,objectElementValidators:{"*":function(Oe){return Tp(pr({layerType:I},Oe))}}})}}}))}function Dl(t){var o=t.value,u=t.key,h=Ni(o);return h!=="string"?[new ke(u,o,"string expected, "+h+" found")]:[]}var Ji={promoteId:function(t){var o=t.key,u=t.value;if(Ni(u)==="string")return Dl({key:o,value:u});var h=[];for(var y in u)h.push.apply(h,Dl({key:o+"."+y,value:u[y]}));return h}};function oc(t){var o=t.value,u=t.key,h=t.styleSpec,y=t.style;if(!o.type)return[new ke(u,o,'"type" is required')];var b,S=kt(o.type);switch(S){case"vector":case"raster":case"raster-dem":return qs({key:u,value:o,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Ji});case"geojson":if(b=qs({key:u,value:o,valueSpec:h.source_geojson,style:y,styleSpec:h,objectElementValidators:Ji}),o.cluster)for(var I in o.clusterProperties){var D=o.clusterProperties[I],z=D[0],j=typeof z=="string"?[z,["accumulated"],["get",I]]:z;b.push.apply(b,fu({key:u+"."+I+".map",value:D[1],expressionContext:"cluster-map"})),b.push.apply(b,fu({key:u+"."+I+".reduce",value:j,expressionContext:"cluster-reduce"}))}return b;case"video":return qs({key:u,value:o,valueSpec:h.source_video,style:y,styleSpec:h});case"image":return qs({key:u,value:o,valueSpec:h.source_image,style:y,styleSpec:h});case"canvas":return[new ke(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ic({key:u+".type",value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,styleSpec:h})}}function ca(t){var o=t.value,u=t.styleSpec,h=u.light,y=t.style,b=[],S=Ni(o);if(o===void 0)return b;if(S!=="object")return b.concat([new ke("light",o,"object expected, "+S+" found")]);for(var I in o){var D=I.match(/^(.*)-transition$/);b=b.concat(D&&h[D[1]]&&h[D[1]].transition?qi({key:I,value:o[I],valueSpec:u.transition,style:y,styleSpec:u}):h[I]?qi({key:I,value:o[I],valueSpec:h[I],style:y,styleSpec:u}):[new ke(I,o[I],'unknown property "'+I+'"')])}return b}var Pu={"*":function(){return[]},array:mf,boolean:function(t){var o=t.value,u=t.key,h=Ni(o);return h!=="boolean"?[new ke(u,o,"boolean expected, "+h+" found")]:[]},number:gf,color:function(t){var o=t.key,u=t.value,h=Ni(u);return h!=="string"?[new ke(o,u,"color expected, "+h+" found")]:Ii(u)===null?[new ke(o,u,'color expected, "'+u+'" found')]:[]},constants:ht,enum:ic,filter:zc,function:Wf,layer:Mp,object:qs,source:oc,light:ca,string:Dl,formatted:function(t){return Dl(t).length===0?[]:fu(t)},resolvedImage:function(t){return Dl(t).length===0?[]:fu(t)}};function qi(t){var o=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Pl(kt(o))?Wf(t):u.expression&&rc(Nt(o))?fu(t):u.type&&Pu[u.type]?Pu[u.type](t):qs(pr({},t,{valueSpec:u.type?h[u.type]:u}))}function Pa(t){var o=t.value,u=t.key,h=Dl(t);return h.length||(o.indexOf("{fontstack}")===-1&&h.push(new ke(u,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&h.push(new ke(u,o,'"glyphs" url must include a "{range}" token'))),h}function bs(t,o){o===void 0&&(o=fe);var u=[];return u=u.concat(qi({key:"",value:t,valueSpec:o.$root,styleSpec:o,style:t,objectElementValidators:{glyphs:Pa,"*":function(){return[]}}})),t.constants&&(u=u.concat(ht({key:"constants",value:t.constants,style:t,styleSpec:o}))),Uc(u)}function Uc(t){return[].concat(t).sort(function(o,u){return o.line-u.line})}function qu(t){return function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];return Uc(t.apply(this,o))}}bs.source=qu(oc),bs.light=qu(ca),bs.layer=qu(Mp),bs.filter=qu(zc),bs.paintProperty=qu(Tp),bs.layoutProperty=qu(ac);var ja=bs,sc=ja.light,Fl=ja.paintProperty,Ku=ja.layoutProperty;function Zc(t,o){var u=!1;if(o&&o.length)for(var h=0,y=o;h<y.length;h+=1)t.fire(new He(new Error(y[h].message))),u=!0;return u}var Iu=mo;function mo(t,o,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var y=new Int32Array(this.arrayBuffer);t=y[0],this.d=(o=y[1])+2*(u=y[2]);for(var b=0;b<this.d*this.d;b++){var S=y[3+b],I=y[3+b+1];h.push(S===I?null:y.subarray(S,I))}var D=y[3+h.length+1];this.keys=y.subarray(y[3+h.length],D),this.bboxes=y.subarray(D),this.insert=this._insertReadonly}else{this.d=o+2*u;for(var z=0;z<this.d*this.d;z++)h.push([]);this.keys=[],this.bboxes=[]}this.n=o,this.extent=t,this.padding=u,this.scale=o/t,this.uid=0;var j=u/o*t;this.min=-j,this.max=t+j}mo.prototype.insert=function(t,o,u,h,y){this._forEachCell(o,u,h,y,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(o),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(y)},mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},mo.prototype._insertCell=function(t,o,u,h,y,b){this.cells[y].push(b)},mo.prototype.query=function(t,o,u,h,y){var b=this.min,S=this.max;if(t<=b&&o<=b&&S<=u&&S<=h&&!y)return Array.prototype.slice.call(this.keys);var I=[];return this._forEachCell(t,o,u,h,this._queryCell,I,{},y),I},mo.prototype._queryCell=function(t,o,u,h,y,b,S,I){var D=this.cells[y];if(D!==null)for(var z=this.keys,j=this.bboxes,W=0;W<D.length;W++){var K=D[W];if(S[K]===void 0){var oe=4*K;(I?I(j[oe+0],j[oe+1],j[oe+2],j[oe+3]):t<=j[oe+2]&&o<=j[oe+3]&&u>=j[oe+0]&&h>=j[oe+1])?(S[K]=!0,b.push(z[K])):S[K]=!1}}},mo.prototype._forEachCell=function(t,o,u,h,y,b,S,I){for(var D=this._convertToCellCoord(t),z=this._convertToCellCoord(o),j=this._convertToCellCoord(u),W=this._convertToCellCoord(h),K=D;K<=j;K++)for(var oe=z;oe<=W;oe++){var Me=this.d*oe+K;if((!I||I(this._convertFromCellCoord(K),this._convertFromCellCoord(oe),this._convertFromCellCoord(K+1),this._convertFromCellCoord(oe+1)))&&y.call(this,t,o,u,h,Me,b,S,I))return}},mo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},mo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,o=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var y=new Int32Array(o+u+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;for(var b=o,S=0;S<t.length;S++){var I=t[S];y[3+S]=b,y.set(I,b),b+=I.length}return y[3+t.length]=b,y.set(this.keys,b),y[3+t.length+1]=b+=this.keys.length,y.set(this.bboxes,b),b+=this.bboxes.length,y.buffer};var Bl=ee.ImageData,uc=ee.ImageBitmap,go={};function dn(t,o,u){u===void 0&&(u={}),Object.defineProperty(o,"_classRegistryKey",{value:t,writeable:!1}),go[t]={klass:o,omit:u.omit||[],shallow:u.shallow||[]}}for(var fo in dn("Object",Object),Iu.serialize=function(t,o){var u=t.toArrayBuffer();return o&&o.push(u),{buffer:u}},Iu.deserialize=function(t){return new Iu(t.buffer)},dn("Grid",Iu),dn("Color",ji),dn("Error",Error),dn("ResolvedImage",na),dn("StylePropertyFunction",Yu),dn("StyleExpression",Bc,{omit:["_evaluator"]}),dn("ZoomDependentExpression",ul),dn("ZoomConstantExpression",Il),dn("CompoundExpression",$a,{omit:["_evaluate"]}),Tu)Tu[fo]._classRegistryKey||dn("Expression_"+fo,Tu[fo]);function $u(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function ka(t){return uc&&t instanceof uc}function Ks(t,o){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if($u(t)||ka(t))return o&&o.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return o&&o.push(u.buffer),u}if(t instanceof Bl)return o&&o.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],y=0,b=t;y<b.length;y+=1)h.push(Ks(b[y],o));return h}if(typeof t=="object"){var S=t.constructor,I=S._classRegistryKey;if(!I)throw new Error("can't serialize object of unregistered class");var D=S.serialize?S.serialize(t,o):{};if(!S.serialize){for(var z in t)if(t.hasOwnProperty(z)&&!(go[I].omit.indexOf(z)>=0)){var j=t[z];D[z]=go[I].shallow.indexOf(z)>=0?j:Ks(j,o)}t instanceof Error&&(D.message=t.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return I!=="Object"&&(D.$name=I),D}throw new Error("can't serialize object of type "+typeof t)}function Ms(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||$u(t)||ka(t)||ArrayBuffer.isView(t)||t instanceof Bl)return t;if(Array.isArray(t))return t.map(Ms);if(typeof t=="object"){var o=t.$name||"Object",u=go[o].klass;if(!u)throw new Error("can't deserialize unregistered class "+o);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),y=0,b=Object.keys(t);y<b.length;y+=1){var S=b[y];if(S!=="$name"){var I=t[S];h[S]=go[o].shallow.indexOf(S)>=0?I:Ms(I)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Ef=function(){this.first=!0};Ef.prototype.update=function(t,o){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=o):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=o),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var Zr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function lc(t){for(var o=0,u=t;o<u.length;o+=1)if(Sf(u[o].charCodeAt(0)))return!0;return!1}function Sf(t){return!(t!==746&&t!==747&&(t<4352||!(Zr["Bopomofo Extended"](t)||Zr.Bopomofo(t)||Zr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Zr["CJK Compatibility Ideographs"](t)||Zr["CJK Compatibility"](t)||Zr["CJK Radicals Supplement"](t)||Zr["CJK Strokes"](t)||!(!Zr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Zr["CJK Unified Ideographs Extension A"](t)||Zr["CJK Unified Ideographs"](t)||Zr["Enclosed CJK Letters and Months"](t)||Zr["Hangul Compatibility Jamo"](t)||Zr["Hangul Jamo Extended-A"](t)||Zr["Hangul Jamo Extended-B"](t)||Zr["Hangul Jamo"](t)||Zr["Hangul Syllables"](t)||Zr.Hiragana(t)||Zr["Ideographic Description Characters"](t)||Zr.Kanbun(t)||Zr["Kangxi Radicals"](t)||Zr["Katakana Phonetic Extensions"](t)||Zr.Katakana(t)&&t!==12540||!(!Zr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Zr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Zr["Unified Canadian Aboriginal Syllabics"](t)||Zr["Unified Canadian Aboriginal Syllabics Extended"](t)||Zr["Vertical Forms"](t)||Zr["Yijing Hexagram Symbols"](t)||Zr["Yi Syllables"](t)||Zr["Yi Radicals"](t))))}function ll(t){return!(Sf(t)||function(o){return!!(Zr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Zr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Zr["Letterlike Symbols"](o)||Zr["Number Forms"](o)||Zr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Zr["Control Pictures"](o)&&o!==9251||Zr["Optical Character Recognition"](o)||Zr["Enclosed Alphanumerics"](o)||Zr["Geometric Shapes"](o)||Zr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Zr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Zr["CJK Symbols and Punctuation"](o)||Zr.Katakana(o)||Zr["Private Use Area"](o)||Zr["CJK Compatibility Forms"](o)||Zr["Small Form Variants"](o)||Zr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(t))}function Aa(t){return t>=1424&&t<=2303||Zr["Arabic Presentation Forms-A"](t)||Zr["Arabic Presentation Forms-B"](t)}function Es(t,o){return!(!o&&Aa(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Zr.Khmer(t))}function Cf(t){for(var o=0,u=t;o<u.length;o+=1)if(Aa(u[o].charCodeAt(0)))return!0;return!1}var Ou=null,Bs="unavailable",Ru=null,Xf=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Bs="error"),Ou&&Ou(t)};function cl(){Yf.fire(new Pe("pluginStateChange",{pluginStatus:Bs,pluginURL:Ru}))}var Yf=new tt,Af=function(){return Bs},pu=function(){if(Bs!=="deferred"||!Ru)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Bs="loading",cl(),Ru&&za({url:Ru},function(t){t?Xf(t):(Bs="loaded",cl())})},Ps={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return Bs==="loaded"||Ps.applyArabicShaping!=null},isLoading:function(){return Bs==="loading"},setState:function(t){Bs=t.pluginStatus,Ru=t.pluginURL},isParsed:function(){return Ps.applyArabicShaping!=null&&Ps.processBidirectionalText!=null&&Ps.processStyledBidirectionalText!=null},getPluginURL:function(){return Ru}},Ti=function(t,o){this.zoom=t,o?(this.now=o.now,this.fadeDuration=o.fadeDuration,this.zoomHistory=o.zoomHistory,this.transition=o.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ef,this.transition={})};Ti.prototype.isSupportedScript=function(t){return function(o,u){for(var h=0,y=o;h<y.length;h+=1)if(!Es(y[h].charCodeAt(0),u))return!1;return!0}(t,Ps.isLoaded())},Ti.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Ti.prototype.getCrossfadeParameters=function(){var t=this.zoom,o=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:o+(1-o)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*o}};var Lu=function(t,o){this.property=t,this.value=o,this.expression=function(u,h){if(Pl(u))return new Yu(u,h);if(rc(u)){var y=Ol(u,h);if(y.result==="error")throw new Error(y.value.map(function(S){return S.key+": "+S.message}).join(", "));return y.value}var b=u;return typeof u=="string"&&h.type==="color"&&(b=ji.parse(u)),{kind:"constant",evaluate:function(){return b}}}(o===void 0?t.specification.default:o,t.specification)};Lu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Lu.prototype.possiblyEvaluate=function(t,o,u){return this.property.possiblyEvaluate(this,t,o,u)};var hu=function(t){this.property=t,this.value=new Lu(t,void 0)};hu.prototype.transitioned=function(t,o){return new fl(this.property,this.value,o,yt({},t.transition,this.transition),t.now)},hu.prototype.untransitioned=function(){return new fl(this.property,this.value,null,{},0)};var Go=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Go.prototype.getValue=function(t){return Qe(this._values[t].value.value)},Go.prototype.setValue=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new hu(this._values[t].property)),this._values[t].value=new Lu(this._values[t].property,o===null?void 0:Qe(o))},Go.prototype.getTransition=function(t){return Qe(this._values[t].transition)},Go.prototype.setTransition=function(t,o){this._values.hasOwnProperty(t)||(this._values[t]=new hu(this._values[t].property)),this._values[t].transition=Qe(o)||void 0},Go.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y);var b=this.getTransition(h);b!==void 0&&(t[h+"-transition"]=b)}return t},Go.prototype.transitioned=function(t,o){for(var u=new as(this._properties),h=0,y=Object.keys(this._values);h<y.length;h+=1){var b=y[h];u._values[b]=this._values[b].transitioned(t,o._values[b])}return u},Go.prototype.untransitioned=function(){for(var t=new as(this._properties),o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o];t._values[h]=this._values[h].untransitioned()}return t};var fl=function(t,o,u,h,y){this.property=t,this.value=o,this.begin=y+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};fl.prototype.possiblyEvaluate=function(t,o,u){var h=t.now||0,y=this.value.possiblyEvaluate(t,o,u),b=this.prior;if(b){if(h>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(h<this.begin)return b.possiblyEvaluate(t,o,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(t,o,u),y,function(I){if(I<=0)return 0;if(I>=1)return 1;var D=I*I,z=D*I;return 4*(I<.5?z:3*(I-D)+z-.75)}(S))}return y};var as=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};as.prototype.possiblyEvaluate=function(t,o,u){for(var h=new xu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h},as.prototype.hasTransition=function(){for(var t=0,o=Object.keys(this._values);t<o.length;t+=1)if(this._values[o[t]].prior)return!0;return!1};var $s=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};$s.prototype.getValue=function(t){return Qe(this._values[t].value)},$s.prototype.setValue=function(t,o){this._values[t]=new Lu(this._values[t].property,o===null?void 0:Qe(o))},$s.prototype.serialize=function(){for(var t={},o=0,u=Object.keys(this._values);o<u.length;o+=1){var h=u[o],y=this.getValue(h);y!==void 0&&(t[h]=y)}return t},$s.prototype.possiblyEvaluate=function(t,o,u){for(var h=new xu(this._properties),y=0,b=Object.keys(this._values);y<b.length;y+=1){var S=b[y];h._values[S]=this._values[S].possiblyEvaluate(t,o,u)}return h};var Ss=function(t,o,u){this.property=t,this.value=o,this.parameters=u};Ss.prototype.isConstant=function(){return this.value.kind==="constant"},Ss.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},Ss.prototype.evaluate=function(t,o,u,h){return this.property.evaluate(this.value,this.parameters,t,o,u,h)};var xu=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};xu.prototype.get=function(t){return this._values[t]};var On=function(t){this.specification=t};On.prototype.possiblyEvaluate=function(t,o){return t.expression.evaluate(o)},On.prototype.interpolate=function(t,o,u){var h=xa[this.specification.type];return h?h(t,o,u):t};var Cn=function(t,o){this.specification=t,this.overrides=o};Cn.prototype.possiblyEvaluate=function(t,o,u,h){return new Ss(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(o,null,{},u,h)}:t.expression,o)},Cn.prototype.interpolate=function(t,o,u){if(t.value.kind!=="constant"||o.value.kind!=="constant")return t;if(t.value.value===void 0||o.value.value===void 0)return new Ss(this,{kind:"constant",value:void 0},t.parameters);var h=xa[this.specification.type];return h?new Ss(this,{kind:"constant",value:h(t.value.value,o.value.value,u)},t.parameters):t},Cn.prototype.evaluate=function(t,o,u,h,y,b){return t.kind==="constant"?t.value:t.evaluate(o,u,h,y,b)};var jc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h,y,b){if(u.value===void 0)return new Ss(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},y,b),I=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,D=this._calculate(I,I,I,h);return new Ss(this,{kind:"constant",value:D},h)}if(u.expression.kind==="camera"){var z=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new Ss(this,{kind:"constant",value:z},h)}return new Ss(this,u.expression,h)},o.prototype.evaluate=function(u,h,y,b,S,I){if(u.kind==="source"){var D=u.evaluate(h,y,b,S,I);return this._calculate(D,D,D,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},y,b),u.evaluate({zoom:Math.floor(h.zoom)},y,b),u.evaluate({zoom:Math.floor(h.zoom)+1},y,b),h):u.value},o.prototype._calculate=function(u,h,y,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:y,to:h}},o.prototype.interpolate=function(u){return u},o}(Cn),Qo=function(t){this.specification=t};Qo.prototype.possiblyEvaluate=function(t,o,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var y=t.expression.evaluate(o,null,{},u,h);return this._calculate(y,y,y,o)}return this._calculate(t.expression.evaluate(new Ti(Math.floor(o.zoom-1),o)),t.expression.evaluate(new Ti(Math.floor(o.zoom),o)),t.expression.evaluate(new Ti(Math.floor(o.zoom+1),o)),o)}},Qo.prototype._calculate=function(t,o,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:o}:{from:u,to:o}},Qo.prototype.interpolate=function(t){return t};var Qs=function(t){this.specification=t};Qs.prototype.possiblyEvaluate=function(t,o,u,h){return!!t.expression.evaluate(o,null,{},u,h)},Qs.prototype.interpolate=function(){return!1};var Ho=function(t){for(var o in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[o];u.specification.overridable&&this.overridableProperties.push(o);var h=this.defaultPropertyValues[o]=new Lu(u,void 0),y=this.defaultTransitionablePropertyValues[o]=new hu(u);this.defaultTransitioningPropertyValues[o]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[o]=h.possiblyEvaluate({})}};dn("DataDrivenProperty",Cn),dn("DataConstantProperty",On),dn("CrossFadedDataDrivenProperty",jc),dn("CrossFadedProperty",Qo),dn("ColorRampProperty",Qs);var du=function(t){function o(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new $s(h.layout)),h.paint)){for(var y in this._transitionablePaint=new Go(h.paint),u.paint)this.setPaintProperty(y,u.paint[y],{validate:!1});for(var b in u.layout)this.setLayoutProperty(b,u.layout[b],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xu(h.paint)}}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},o.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},o.prototype.setLayoutProperty=function(u,h,y){y===void 0&&(y={}),h!=null&&this._validate(Ku,"layers."+this.id+".layout."+u,u,h,y)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},o.prototype.getPaintProperty=function(u){return Y(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},o.prototype.setPaintProperty=function(u,h,y){if(y===void 0&&(y={}),h!=null&&this._validate(Fl,"layers."+this.id+".paint."+u,u,h,y))return!1;if(Y(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var b=this._transitionablePaint._values[u],S=b.property.specification["property-type"]==="cross-faded-data-driven",I=b.value.isDataDriven(),D=b.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var z=this._transitionablePaint._values[u].value;return z.isDataDriven()||I||S||this._handleOverridablePaintPropertyUpdate(u,D,z)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!1},o.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},o.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},o.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},o.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},o.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),ut(u,function(h,y){return!(h===void 0||y==="layout"&&!Object.keys(h).length||y==="paint"&&!Object.keys(h).length)})},o.prototype._validate=function(u,h,y,b,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Zc(this,u.call(ja,{key:h,layerType:this.type,objectKey:y,value:b,styleSpec:fe,style:{glyphs:!0,sprite:!0}}))},o.prototype.is3D=function(){return!1},o.prototype.isTileClipped=function(){return!1},o.prototype.hasOffscreenPass=function(){return!1},o.prototype.resize=function(){},o.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof Ss&&cu(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},o}(tt),qf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Vc=function(t,o){this._structArray=t,this._pos1=o*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ya=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Da(t,o){o===void 0&&(o=1);var u=0,h=0;return{members:t.map(function(y){var b=qf[y.type].BYTES_PER_ELEMENT,S=u=pl(u,Math.max(o,b)),I=y.components||1;return h=Math.max(h,b),u+=b*I,{name:y.name,type:y.type,components:I,offset:S}}),size:pl(u,Math.max(h,o)),alignment:o}}function pl(t,o){return Math.ceil(t/o)*o}ya.serialize=function(t,o){return t._trim(),o&&(t.isTransferred=!0,o.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},ya.deserialize=function(t){var o=Object.create(this.prototype);return o.arrayBuffer=t.arrayBuffer,o.length=t.length,o.capacity=t.arrayBuffer.byteLength/o.bytesPerElement,o._refreshViews(),o},ya.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ya.prototype.clear=function(){this.length=0},ya.prototype.resize=function(t){this.reserve(t),this.length=t},ya.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var o=this.uint8;this._refreshViews(),o&&this.uint8.set(o)}},ya.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var cc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.int16[b+0]=h,this.int16[b+1]=y,u},o}(ya);cc.prototype.bytesPerElement=4,dn("StructArrayLayout2i4",cc);var Js=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.int16[I+0]=h,this.int16[I+1]=y,this.int16[I+2]=b,this.int16[I+3]=S,u},o}(ya);Js.prototype.bytesPerElement=8,dn("StructArrayLayout4i8",Js);var vu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ya);vu.prototype.bytesPerElement=12,dn("StructArrayLayout2i4i12",vu);var bi=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=4*u,j=8*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.uint8[j+4]=b,this.uint8[j+5]=S,this.uint8[j+6]=I,this.uint8[j+7]=D,u},o}(ya);bi.prototype.bytesPerElement=8,dn("StructArrayLayout2i4ub8",bi);var Ns=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.float32[b+0]=h,this.float32[b+1]=y,u},o}(ya);Ns.prototype.bytesPerElement=8,dn("StructArrayLayout2f8",Ns);var Is=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,j,W){var K=this.length;return this.resize(K+1),this.emplace(K,u,h,y,b,S,I,D,z,j,W)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,j,W,K){var oe=10*u;return this.uint16[oe+0]=h,this.uint16[oe+1]=y,this.uint16[oe+2]=b,this.uint16[oe+3]=S,this.uint16[oe+4]=I,this.uint16[oe+5]=D,this.uint16[oe+6]=z,this.uint16[oe+7]=j,this.uint16[oe+8]=W,this.uint16[oe+9]=K,u},o}(ya);Is.prototype.bytesPerElement=20,dn("StructArrayLayout10ui20",Is);var hl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,j,W,K,oe){var Me=this.length;return this.resize(Me+1),this.emplace(Me,u,h,y,b,S,I,D,z,j,W,K,oe)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,j,W,K,oe,Me){var Oe=12*u;return this.int16[Oe+0]=h,this.int16[Oe+1]=y,this.int16[Oe+2]=b,this.int16[Oe+3]=S,this.uint16[Oe+4]=I,this.uint16[Oe+5]=D,this.uint16[Oe+6]=z,this.uint16[Oe+7]=j,this.int16[Oe+8]=W,this.int16[Oe+9]=K,this.int16[Oe+10]=oe,this.int16[Oe+11]=Me,u},o}(ya);hl.prototype.bytesPerElement=24,dn("StructArrayLayout4i4ui4i24",hl);var ku=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=y,this.float32[S+2]=b,u},o}(ya);ku.prototype.bytesPerElement=12,dn("StructArrayLayout3f12",ku);var Qu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},o}(ya);Qu.prototype.bytesPerElement=4,dn("StructArrayLayout1ul4",Qu);var Gc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,j){var W=this.length;return this.resize(W+1),this.emplace(W,u,h,y,b,S,I,D,z,j)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,j,W){var K=10*u,oe=5*u;return this.int16[K+0]=h,this.int16[K+1]=y,this.int16[K+2]=b,this.int16[K+3]=S,this.int16[K+4]=I,this.int16[K+5]=D,this.uint32[oe+3]=z,this.uint16[K+8]=j,this.uint16[K+9]=W,u},o}(ya);Gc.prototype.bytesPerElement=20,dn("StructArrayLayout6i1ul2ui20",Gc);var Ia=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I){var D=this.length;return this.resize(D+1),this.emplace(D,u,h,y,b,S,I)},o.prototype.emplace=function(u,h,y,b,S,I,D){var z=6*u;return this.int16[z+0]=h,this.int16[z+1]=y,this.int16[z+2]=b,this.int16[z+3]=S,this.int16[z+4]=I,this.int16[z+5]=D,u},o}(ya);Ia.prototype.bytesPerElement=12,dn("StructArrayLayout2i2i2i12",Ia);var eu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S){var I=this.length;return this.resize(I+1),this.emplace(I,u,h,y,b,S)},o.prototype.emplace=function(u,h,y,b,S,I){var D=4*u,z=8*u;return this.float32[D+0]=h,this.float32[D+1]=y,this.float32[D+2]=b,this.int16[z+6]=S,this.int16[z+7]=I,u},o}(ya);eu.prototype.bytesPerElement=16,dn("StructArrayLayout2f1f2i16",eu);var Nl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=12*u,D=3*u;return this.uint8[I+0]=h,this.uint8[I+1]=y,this.float32[D+1]=b,this.float32[D+2]=S,u},o}(ya);Nl.prototype.bytesPerElement=12,dn("StructArrayLayout2ub2f12",Nl);var dl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=y,this.uint16[S+2]=b,u},o}(ya);dl.prototype.bytesPerElement=6,dn("StructArrayLayout3ui6",dl);var vl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe,L,Ue,ot){var xt=this.length;return this.resize(xt+1),this.emplace(xt,u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe,L,Ue,ot)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe,L,Ue,ot,xt){var Ut=24*u,Gt=12*u,or=48*u;return this.int16[Ut+0]=h,this.int16[Ut+1]=y,this.uint16[Ut+2]=b,this.uint16[Ut+3]=S,this.uint32[Gt+2]=I,this.uint32[Gt+3]=D,this.uint32[Gt+4]=z,this.uint16[Ut+10]=j,this.uint16[Ut+11]=W,this.uint16[Ut+12]=K,this.float32[Gt+7]=oe,this.float32[Gt+8]=Me,this.uint8[or+36]=Oe,this.uint8[or+37]=L,this.uint8[or+38]=Ue,this.uint32[Gt+10]=ot,this.int16[Ut+22]=xt,u},o}(ya);vl.prototype.bytesPerElement=48,dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",vl);var Hc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe,L,Ue,ot,xt,Ut,Gt,or,Mr,Fr,Dn,cn,Zn,pn,Ri){var ti=this.length;return this.resize(ti+1),this.emplace(ti,u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe,L,Ue,ot,xt,Ut,Gt,or,Mr,Fr,Dn,cn,Zn,pn,Ri)},o.prototype.emplace=function(u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe,L,Ue,ot,xt,Ut,Gt,or,Mr,Fr,Dn,cn,Zn,pn,Ri,ti){var wn=34*u,Vi=17*u;return this.int16[wn+0]=h,this.int16[wn+1]=y,this.int16[wn+2]=b,this.int16[wn+3]=S,this.int16[wn+4]=I,this.int16[wn+5]=D,this.int16[wn+6]=z,this.int16[wn+7]=j,this.uint16[wn+8]=W,this.uint16[wn+9]=K,this.uint16[wn+10]=oe,this.uint16[wn+11]=Me,this.uint16[wn+12]=Oe,this.uint16[wn+13]=L,this.uint16[wn+14]=Ue,this.uint16[wn+15]=ot,this.uint16[wn+16]=xt,this.uint16[wn+17]=Ut,this.uint16[wn+18]=Gt,this.uint16[wn+19]=or,this.uint16[wn+20]=Mr,this.uint16[wn+21]=Fr,this.uint16[wn+22]=Dn,this.uint32[Vi+12]=cn,this.float32[Vi+13]=Zn,this.float32[Vi+14]=pn,this.float32[Vi+15]=Ri,this.float32[Vi+16]=ti,u},o}(ya);Hc.prototype.bytesPerElement=68,dn("StructArrayLayout8i15ui1ul4f68",Hc);var ml=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},o}(ya);ml.prototype.bytesPerElement=4,dn("StructArrayLayout1f4",ml);var tu=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=y,this.int16[S+2]=b,u},o}(ya);tu.prototype.bytesPerElement=6,dn("StructArrayLayout3i6",tu);var fc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y){var b=this.length;return this.resize(b+1),this.emplace(b,u,h,y)},o.prototype.emplace=function(u,h,y,b){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=y,this.uint16[S+3]=b,u},o}(ya);fc.prototype.bytesPerElement=8,dn("StructArrayLayout1ul2ui8",fc);var zl=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h){var y=this.length;return this.resize(y+1),this.emplace(y,u,h)},o.prototype.emplace=function(u,h,y){var b=2*u;return this.uint16[b+0]=h,this.uint16[b+1]=y,u},o}(ya);zl.prototype.bytesPerElement=4,dn("StructArrayLayout2ui4",zl);var Kf=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},o.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},o}(ya);Kf.prototype.bytesPerElement=2,dn("StructArrayLayout1ui2",Kf);var Ul=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},o.prototype.emplaceBack=function(u,h,y,b){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,y,b)},o.prototype.emplace=function(u,h,y,b,S){var I=4*u;return this.float32[I+0]=h,this.float32[I+1]=y,this.float32[I+2]=b,this.float32[I+3]=S,u},o}(ya);Ul.prototype.bytesPerElement=16,dn("StructArrayLayout4f16",Ul);var l=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new ce(this.anchorPointX,this.anchorPointY)},Object.defineProperties(o.prototype,u),o}(Vc);l.prototype.size=20;var f=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new l(this,u)},o}(Gc);dn("CollisionBoxArray",f);var c=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(o.prototype,u),o}(Vc);c.prototype.size=48;var d=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new c(this,u)},o}(vl);dn("PlacedSymbolArray",d);var E=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(o.prototype,u),o}(Vc);E.prototype.size=68;var w=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new E(this,u)},o}(Hc);dn("SymbolInstanceArray",w);var P=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getoffsetX=function(u){return this.float32[1*u+0]},o}(ml);dn("GlyphOffsetArray",P);var k=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.getx=function(u){return this.int16[3*u+0]},o.prototype.gety=function(u){return this.int16[3*u+1]},o.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},o}(tu);dn("SymbolLineVertexArray",k);var Z=function(t){function o(){t.apply(this,arguments)}t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(o.prototype,u),o}(Vc);Z.prototype.size=8;var X=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.get=function(u){return new Z(this,u)},o}(fc);dn("FeatureIndexArray",X);var le=Da([{name:"a_pos",components:2,type:"Int16"}],4).members,pe=function(t){t===void 0&&(t=[]),this.segments=t};function ve(t,o){return 256*(t=gt(Math.floor(t),0,255))+gt(Math.floor(o),0,255)}pe.prototype.prepareSegment=function(t,o,u,h){var y=this.segments[this.segments.length-1];return t>pe.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+pe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!y||y.vertexLength+t>pe.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==h)&&(y={vertexOffset:o.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(y.sortKey=h),this.segments.push(y)),y},pe.prototype.get=function(){return this.segments},pe.prototype.destroy=function(){for(var t=0,o=this.segments;t<o.length;t+=1){var u=o[t];for(var h in u.vaos)u.vaos[h].destroy()}},pe.simpleSegment=function(t,o,u,h){return new pe([{vertexOffset:t,primitiveOffset:o,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},pe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn("SegmentVector",pe);var Re=Da([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ie=he(function(t){t.exports=function(o,u){var h,y,b,S,I,D,z,j;for(y=o.length-(h=3&o.length),b=u,I=3432918353,D=461845907,j=0;j<y;)z=255&o.charCodeAt(j)|(255&o.charCodeAt(++j))<<8|(255&o.charCodeAt(++j))<<16|(255&o.charCodeAt(++j))<<24,++j,b=27492+(65535&(S=5*(65535&(b=(b^=z=(65535&(z=(z=(65535&z)*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(z=0,h){case 3:z^=(255&o.charCodeAt(j+2))<<16;case 2:z^=(255&o.charCodeAt(j+1))<<8;case 1:b^=z=(65535&(z=(z=(65535&(z^=255&o.charCodeAt(j)))*I+(((z>>>16)*I&65535)<<16)&4294967295)<<15|z>>>17))*D+(((z>>>16)*D&65535)<<16)&4294967295}return b^=o.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0}}),ze=he(function(t){t.exports=function(o,u){for(var h,y=o.length,b=u^y,S=0;y>=4;)h=1540483477*(65535&(h=255&o.charCodeAt(S)|(255&o.charCodeAt(++S))<<8|(255&o.charCodeAt(++S))<<16|(255&o.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),y-=4,++S;switch(y){case 3:b^=(255&o.charCodeAt(S+2))<<16;case 2:b^=(255&o.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&o.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0}}),Ee=Ie,Ve=ze;Ee.murmur3=Ie,Ee.murmur2=Ve;var et=function(){this.ids=[],this.positions=[],this.indexed=!1};et.prototype.add=function(t,o,u,h){this.ids.push(Xt(t)),this.positions.push(o,u,h)},et.prototype.getPositions=function(t){for(var o=Xt(t),u=0,h=this.ids.length-1;u<h;){var y=u+h>>1;this.ids[y]>=o?h=y:u=y+1}for(var b=[];this.ids[u]===o;)b.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return b},et.serialize=function(t,o){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function y(b,S,I,D){for(;I<D;){for(var z=b[I+D>>1],j=I-1,W=D+1;;){do j++;while(b[j]<z);do W--;while(b[W]>z);if(j>=W)break;jt(b,j,W),jt(S,3*j,3*W),jt(S,3*j+1,3*W+1),jt(S,3*j+2,3*W+2)}W-I<D-W?(y(b,S,I,W),I=W+1):(y(b,S,W+1,D),D=W)}}(u,h,0,u.length-1),o&&o.push(u.buffer,h.buffer),{ids:u,positions:h}},et.deserialize=function(t){var o=new et;return o.ids=t.ids,o.positions=t.positions,o.indexed=!0,o};var vt=Math.pow(2,53)-1;function Xt(t){var o=+t;return!isNaN(o)&&o<=vt?o:Ee(String(t))}function jt(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}dn("FeaturePositionMap",et);var Qt=function(t,o){this.gl=t.gl,this.location=o},dr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},o}(Qt),Lr=function(t){function o(u,h){t.call(this,u,h),this.current=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},o}(Qt),gr=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},o}(Qt),sn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},o}(Qt),zn=function(t){function o(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},o}(Qt),Un=function(t){function o(u,h){t.call(this,u,h),this.current=ji.transparent}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},o}(Qt),Ln=new Float32Array(16),ki=function(t){function o(u,h){t.call(this,u,h),this.current=Ln}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},o}(Qt);function tn(t){return[ve(255*t.r,255*t.g),ve(255*t.b,255*t.a)]}var ai=function(t,o,u){this.value=t,this.uniformNames=o.map(function(h){return"u_"+h}),this.type=u};ai.prototype.setUniform=function(t,o,u){t.set(u.constantOr(this.value))},ai.prototype.getBinding=function(t,o,u){return this.type==="color"?new Un(t,o):new Lr(t,o)};var li=function(t,o){this.uniformNames=o.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};li.prototype.setConstantPatternPositions=function(t,o){this.pixelRatioFrom=o.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=o.tlbr,this.patternTo=t.tlbr},li.prototype.setUniform=function(t,o,u,h){var y=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&t.set(y)},li.prototype.getBinding=function(t,o,u){return u.substr(0,9)==="u_pattern"?new zn(t,o):new Lr(t,o)};var $n=function(t,o,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=o.map(function(y){return{name:"a_"+y,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};$n.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.paintVertexArray.length,S=this.expression.evaluate(new Ti(0),o,{},h,[],y);this.paintVertexArray.resize(t),this._setPaintValue(b,t,S)},$n.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,o,y)},$n.prototype._setPaintValue=function(t,o,u){if(this.type==="color")for(var h=tn(u),y=t;y<o;y++)this.paintVertexArray.emplace(y,h[0],h[1]);else{for(var b=t;b<o;b++)this.paintVertexArray.emplace(b,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},$n.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},$n.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var jn=function(t,o,u,h,y,b){this.expression=t,this.uniformNames=o.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=o.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new b};jn.prototype.populatePaintArray=function(t,o,u,h,y){var b=this.expression.evaluate(new Ti(this.zoom),o,{},h,[],y),S=this.expression.evaluate(new Ti(this.zoom+1),o,{},h,[],y),I=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(I,t,b,S)},jn.prototype.updatePaintArray=function(t,o,u,h){var y=this.expression.evaluate({zoom:this.zoom},u,h),b=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,o,y,b)},jn.prototype._setPaintValue=function(t,o,u,h){if(this.type==="color")for(var y=tn(u),b=tn(h),S=t;S<o;S++)this.paintVertexArray.emplace(S,y[0],y[1],b[0],b[1]);else{for(var I=t;I<o;I++)this.paintVertexArray.emplace(I,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},jn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},jn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},jn.prototype.setUniform=function(t,o){var u=this.useIntegerZoom?Math.floor(o.zoom):o.zoom,h=gt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},jn.prototype.getBinding=function(t,o,u){return new Lr(t,o)};var mi=function(t,o,u,h,y,b){this.expression=t,this.type=o,this.useIntegerZoom=u,this.zoom=h,this.layerId=b,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y};mi.prototype.populatePaintArray=function(t,o,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,o.patterns&&o.patterns[this.layerId],u)},mi.prototype.updatePaintArray=function(t,o,u,h,y){this._setPaintValues(t,o,u.patterns&&u.patterns[this.layerId],y)},mi.prototype._setPaintValues=function(t,o,u,h){if(h&&u){var y=h[u.min],b=h[u.mid],S=h[u.max];if(y&&b&&S)for(var I=t;I<o;I++)this.zoomInPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],y.tl[0],y.tl[1],y.br[0],y.br[1],b.pixelRatio,y.pixelRatio),this.zoomOutPaintVertexArray.emplace(I,b.tl[0],b.tl[1],b.br[0],b.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],b.pixelRatio,S.pixelRatio)}},mi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Re.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Re.members,this.expression.isStateDependent))},mi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Yn=function(t,o,u){this.binders={},this._buffers=[];var h=[];for(var y in t.paint._values)if(u(y)){var b=t.paint.get(y);if(b instanceof Ss&&cu(b.property.specification)){var S=yo(y,t.type),I=b.value,D=b.property.specification.type,z=b.property.useIntegerZoom,j=b.property.specification["property-type"],W=j==="cross-faded"||j==="cross-faded-data-driven";if(I.kind==="constant")this.binders[y]=W?new li(I.value,S):new ai(I.value,S,D),h.push("/u_"+y);else if(I.kind==="source"||W){var K=Ja(y,D,"source");this.binders[y]=W?new mi(I,D,z,o,K,t.id):new $n(I,S,D,K),h.push("/a_"+y)}else{var oe=Ja(y,D,"composite");this.binders[y]=new jn(I,S,D,z,o,oe),h.push("/z_"+y)}}}this.cacheKey=h.sort().join("")};Yn.prototype.getMaxValue=function(t){var o=this.binders[t];return o instanceof $n||o instanceof jn?o.maxValue:0},Yn.prototype.populatePaintArrays=function(t,o,u,h,y){for(var b in this.binders){var S=this.binders[b];(S instanceof $n||S instanceof jn||S instanceof mi)&&S.populatePaintArray(t,o,u,h,y)}},Yn.prototype.setConstantPatternPositions=function(t,o){for(var u in this.binders){var h=this.binders[u];h instanceof li&&h.setConstantPatternPositions(t,o)}},Yn.prototype.updatePaintArrays=function(t,o,u,h,y){var b=!1;for(var S in t)for(var I=0,D=o.getPositions(S);I<D.length;I+=1){var z=D[I],j=u.feature(z.index);for(var W in this.binders){var K=this.binders[W];if((K instanceof $n||K instanceof jn||K instanceof mi)&&K.expression.isStateDependent===!0){var oe=h.paint.get(W);K.expression=oe.value,K.updatePaintArray(z.start,z.end,j,t[S],y),b=!0}}}return b},Yn.prototype.defines=function(){var t=[];for(var o in this.binders){var u=this.binders[o];(u instanceof ai||u instanceof li)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},Yn.prototype.getBinderAttributes=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof $n||u instanceof jn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof mi)for(var y=0;y<Re.members.length;y++)t.push(Re.members[y].name)}return t},Yn.prototype.getBinderUniforms=function(){var t=[];for(var o in this.binders){var u=this.binders[o];if(u instanceof ai||u instanceof li||u instanceof jn)for(var h=0,y=u.uniformNames;h<y.length;h+=1)t.push(y[h])}return t},Yn.prototype.getPaintVertexBuffers=function(){return this._buffers},Yn.prototype.getUniforms=function(t,o){var u=[];for(var h in this.binders){var y=this.binders[h];if(y instanceof ai||y instanceof li||y instanceof jn)for(var b=0,S=y.uniformNames;b<S.length;b+=1){var I=S[b];if(o[I]){var D=y.getBinding(t,o[I],I);u.push({name:I,property:h,binding:D})}}}return u},Yn.prototype.setUniforms=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1){var S=b[y],I=S.name,D=S.property;this.binders[D].setUniform(S.binding,h,u.get(D),I)}},Yn.prototype.updatePaintBuffers=function(t){for(var o in this._buffers=[],this.binders){var u=this.binders[o];if(t&&u instanceof mi){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof $n||u instanceof jn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},Yn.prototype.upload=function(t){for(var o in this.binders){var u=this.binders[o];(u instanceof $n||u instanceof jn||u instanceof mi)&&u.upload(t)}this.updatePaintBuffers()},Yn.prototype.destroy=function(){for(var t in this.binders){var o=this.binders[t];(o instanceof $n||o instanceof jn||o instanceof mi)&&o.destroy()}};var Hn=function(t,o,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,y=t;h<y.length;h+=1){var b=y[h];this.programConfigurations[b.id]=new Yn(b,o,u)}this.needsUpload=!1,this._featureMap=new et,this._bufferOffset=0};function yo(t,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(o+"-","").replace(/-/g,"_")]}function Ja(t,o,u){var h={color:{source:Ns,composite:Ul},number:{source:ml,composite:Ns}},y=function(b){return{"line-pattern":{source:Is,composite:Is},"fill-pattern":{source:Is,composite:Is},"fill-extrusion-pattern":{source:Is,composite:Is}}[b]}(t);return y&&y[u]||h[o][u]}Hn.prototype.populatePaintArrays=function(t,o,u,h,y,b){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,o,h,y,b);o.id!==void 0&&this._featureMap.add(o.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Hn.prototype.updatePaintArrays=function(t,o,u,h){for(var y=0,b=u;y<b.length;y+=1){var S=b[y];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,o,S,h)||this.needsUpload}},Hn.prototype.get=function(t){return this.programConfigurations[t]},Hn.prototype.upload=function(t){if(this.needsUpload){for(var o in this.programConfigurations)this.programConfigurations[o].upload(t);this.needsUpload=!1}},Hn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},dn("ConstantBinder",ai),dn("CrossFadedConstantBinder",li),dn("SourceExpressionBinder",$n),dn("CrossFadedCompositeBinder",mi),dn("CompositeExpressionBinder",jn),dn("ProgramConfiguration",Yn,{omit:["_buffers"]}),dn("ProgramConfigurationSet",Hn);var To=Math.pow(2,14)-1,Fa=-To-1;function Wa(t){for(var o=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var y=u[h],b=0;b<y.length;b++){var S=y[b],I=Math.round(S.x*o),D=Math.round(S.y*o);S.x=gt(I,Fa,To),S.y=gt(D,Fa,To),(I<S.x||I>S.x+1||D<S.y||D>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function po(t,o){return{type:t.type,id:t.id,properties:t.properties,geometry:o?Wa(t):[]}}function Os(t,o,u,h,y){t.emplaceBack(2*o+(h+1)/2,2*u+(y+1)/2)}var os=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new cc,this.indexArray=new dl,this.segments=new pe,this.programConfigurations=new Hn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function Du(t,o){for(var u=0;u<t.length;u++)if(ru(o,t[u]))return!0;for(var h=0;h<o.length;h++)if(ru(t,o[h]))return!0;return!!Cs(t,o)}function ss(t,o,u){return!!ru(t,o)||!!Fu(o,t,u)}function mu(t,o){if(t.length===1)return jl(o,t[0]);for(var u=0;u<o.length;u++)for(var h=o[u],y=0;y<h.length;y++)if(ru(t,h[y]))return!0;for(var b=0;b<t.length;b++)if(jl(o,t[b]))return!0;for(var S=0;S<o.length;S++)if(Cs(t,o[S]))return!0;return!1}function Rs(t,o,u){if(t.length>1){if(Cs(t,o))return!0;for(var h=0;h<o.length;h++)if(Fu(o[h],t,u))return!0}for(var y=0;y<t.length;y++)if(Fu(t[y],o,u))return!0;return!1}function Cs(t,o){if(t.length===0||o.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],y=t[u+1],b=0;b<o.length-1;b++)if(Zl(h,y,o[b],o[b+1]))return!0;return!1}function Zl(t,o,u,h){return Kt(t,u,h)!==Kt(o,u,h)&&Kt(t,o,u)!==Kt(t,o,h)}function Fu(t,o,u){var h=u*u;if(o.length===1)return t.distSqr(o[0])<h;for(var y=1;y<o.length;y++)if(gl(t,o[y-1],o[y])<h)return!0;return!1}function gl(t,o,u){var h=o.distSqr(u);if(h===0)return t.distSqr(o);var y=((t.x-o.x)*(u.x-o.x)+(t.y-o.y)*(u.y-o.y))/h;return t.distSqr(y<0?o:y>1?u:u.sub(o)._mult(y)._add(o))}function jl(t,o){for(var u,h,y,b=!1,S=0;S<t.length;S++)for(var I=0,D=(u=t[S]).length-1;I<u.length;D=I++)(h=u[I]).y>o.y!=(y=u[D]).y>o.y&&o.x<(y.x-h.x)*(o.y-h.y)/(y.y-h.y)+h.x&&(b=!b);return b}function ru(t,o){for(var u=!1,h=0,y=t.length-1;h<t.length;y=h++){var b=t[h],S=t[y];b.y>o.y!=S.y>o.y&&o.x<(S.x-b.x)*(o.y-b.y)/(S.y-b.y)+b.x&&(u=!u)}return u}function yl(t,o,u){var h=u[0],y=u[2];if(t.x<h.x&&o.x<h.x||t.x>y.x&&o.x>y.x||t.y<h.y&&o.y<h.y||t.y>y.y&&o.y>y.y)return!1;var b=Kt(t,o,u[0]);return b!==Kt(t,o,u[1])||b!==Kt(t,o,u[2])||b!==Kt(t,o,u[3])}function bu(t,o,u){var h=o.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(o.id).getMaxValue(t)}function Eo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Bu(t,o,u,h,y){if(!o[0]&&!o[1])return t;var b=ce.convert(o)._mult(y);u==="viewport"&&b._rotate(-h);for(var S=[],I=0;I<t.length;I++)S.push(t[I].sub(b));return S}os.prototype.populate=function(t,o,u){var h=this.layers[0],y=[],b=null;h.type==="circle"&&(b=h.layout.get("circle-sort-key"));for(var S=0,I=t;S<I.length;S+=1){var D=I[S],z=D.feature,j=D.id,W=D.index,K=D.sourceLayerIndex,oe=this.layers[0]._featureFilter.needGeometry,Me=po(z,oe);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),Me,u)){var Oe=b?b.evaluate(Me,{},u):void 0,L={id:j,properties:z.properties,type:z.type,sourceLayerIndex:K,index:W,geometry:oe?Me.geometry:Wa(z),patterns:{},sortKey:Oe};y.push(L)}}b&&y.sort(function(Fr,Dn){return Fr.sortKey-Dn.sortKey});for(var Ue=0,ot=y;Ue<ot.length;Ue+=1){var xt=ot[Ue],Ut=xt.geometry,Gt=xt.index,or=xt.sourceLayerIndex,Mr=t[Gt].feature;this.addFeature(xt,Ut,Gt,u),o.featureIndex.insert(Mr,Ut,Gt,or,this.index)}},os.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},os.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},os.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},os.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},os.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},os.prototype.addFeature=function(t,o,u,h){for(var y=0,b=o;y<b.length;y+=1)for(var S=0,I=b[y];S<I.length;S+=1){var D=I[S],z=D.x,j=D.y;if(!(z<0||z>=8192||j<0||j>=8192)){var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),K=W.vertexLength;Os(this.layoutVertexArray,z,j,-1,-1),Os(this.layoutVertexArray,z,j,1,-1),Os(this.layoutVertexArray,z,j,1,1),Os(this.layoutVertexArray,z,j,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),W.vertexLength+=4,W.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},dn("CircleBucket",os,{omit:["layers"]});var Nu=new Ho({"circle-sort-key":new Cn(fe.layout_circle["circle-sort-key"])}),Ju={paint:new Ho({"circle-radius":new Cn(fe.paint_circle["circle-radius"]),"circle-color":new Cn(fe.paint_circle["circle-color"]),"circle-blur":new Cn(fe.paint_circle["circle-blur"]),"circle-opacity":new Cn(fe.paint_circle["circle-opacity"]),"circle-translate":new On(fe.paint_circle["circle-translate"]),"circle-translate-anchor":new On(fe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(fe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(fe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Cn(fe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Cn(fe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Cn(fe.paint_circle["circle-stroke-opacity"])}),layout:Nu},oa=typeof Float32Array!="undefined"?Float32Array:Array;function zs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Jo(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],j=o[7],W=o[8],K=o[9],oe=o[10],Me=o[11],Oe=o[12],L=o[13],Ue=o[14],ot=o[15],xt=u[0],Ut=u[1],Gt=u[2],or=u[3];return t[0]=xt*h+Ut*I+Gt*W+or*Oe,t[1]=xt*y+Ut*D+Gt*K+or*L,t[2]=xt*b+Ut*z+Gt*oe+or*Ue,t[3]=xt*S+Ut*j+Gt*Me+or*ot,t[4]=(xt=u[4])*h+(Ut=u[5])*I+(Gt=u[6])*W+(or=u[7])*Oe,t[5]=xt*y+Ut*D+Gt*K+or*L,t[6]=xt*b+Ut*z+Gt*oe+or*Ue,t[7]=xt*S+Ut*j+Gt*Me+or*ot,t[8]=(xt=u[8])*h+(Ut=u[9])*I+(Gt=u[10])*W+(or=u[11])*Oe,t[9]=xt*y+Ut*D+Gt*K+or*L,t[10]=xt*b+Ut*z+Gt*oe+or*Ue,t[11]=xt*S+Ut*j+Gt*Me+or*ot,t[12]=(xt=u[12])*h+(Ut=u[13])*I+(Gt=u[14])*W+(or=u[15])*Oe,t[13]=xt*y+Ut*D+Gt*K+or*L,t[14]=xt*b+Ut*z+Gt*oe+or*Ue,t[15]=xt*S+Ut*j+Gt*Me+or*ot,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,o=0,u=arguments.length;u--;)o+=t[u]*t[u];return Math.sqrt(o)});var gu,Wc=Jo;function Xc(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3];return t[0]=u[0]*h+u[4]*y+u[8]*b+u[12]*S,t[1]=u[1]*h+u[5]*y+u[9]*b+u[13]*S,t[2]=u[2]*h+u[6]*y+u[10]*b+u[14]*S,t[3]=u[3]*h+u[7]*y+u[11]*b+u[15]*S,t}gu=new oa(3),oa!=Float32Array&&(gu[0]=0,gu[1]=0,gu[2]=0),function(){var t=new oa(4);oa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var wf=(function(){var t=new oa(2);oa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function o(u){t.call(this,u,Ju)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new os(u)},o.prototype.queryRadius=function(u){var h=u;return bu("circle-radius",this,h)+bu("circle-stroke-width",this,h)+Eo(this.paint.get("circle-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D,z){for(var j=Bu(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),I.angle,D),W=this.paint.get("circle-radius").evaluate(h,y)+this.paint.get("circle-stroke-width").evaluate(h,y),K=this.paint.get("circle-pitch-alignment")==="map",oe=K?j:function(Mr,Fr){return Mr.map(function(Dn){return nu(Dn,Fr)})}(j,z),Me=K?W*D:W,Oe=0,L=b;Oe<L.length;Oe+=1)for(var Ue=0,ot=L[Oe];Ue<ot.length;Ue+=1){var xt=ot[Ue],Ut=K?xt:nu(xt,z),Gt=Me,or=Xc([],[xt.x,xt.y,0,1],z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Gt*=or[3]/I.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Gt*=I.cameraToCenterDistance/or[3]),ss(oe,Ut,Gt))return!0}return!1},o}(du));function nu(t,o){var u=Xc([],[t.x,t.y,0,1],o);return new ce(u[0]/u[3],u[1]/u[3])}var pc=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(os);function iu(t,o,u,h){var y=o.width,b=o.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==y*b*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(y*b*u);return t.width=y,t.height=b,t.data=h,t}function _l(t,o,u){var h=o.width,y=o.height;if(h!==t.width||y!==t.height){var b=iu({},{width:h,height:y},u);hc(t,b,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,y)},u),t.width=h,t.height=y,t.data=b.data}}function hc(t,o,u,h,y,b){if(y.width===0||y.height===0)return o;if(y.width>t.width||y.height>t.height||u.x>t.width-y.width||u.y>t.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>o.width||y.height>o.height||h.x>o.width-y.width||h.y>o.height-y.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,I=o.data,D=0;D<y.height;D++)for(var z=((u.y+D)*t.width+u.x)*b,j=((h.y+D)*o.width+h.x)*b,W=0;W<y.width*b;W++)I[j+W]=S[z+W];return o}dn("HeatmapBucket",pc,{omit:["layers"]});var au=function(t,o){iu(this,t,1,o)};au.prototype.resize=function(t){_l(this,t,1)},au.prototype.clone=function(){return new au({width:this.width,height:this.height},new Uint8Array(this.data))},au.copy=function(t,o,u,h,y){hc(t,o,u,h,y,1)};var Bo=function(t,o){iu(this,t,4,o)};Bo.prototype.resize=function(t){_l(this,t,4)},Bo.prototype.replace=function(t,o){o?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Bo.prototype.clone=function(){return new Bo({width:this.width,height:this.height},new Uint8Array(this.data))},Bo.copy=function(t,o,u,h,y){hc(t,o,u,h,y,4)},dn("AlphaImage",au),dn("RGBAImage",Bo);var Yc={paint:new Ho({"heatmap-radius":new Cn(fe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Cn(fe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(fe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Qs(fe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(fe.paint_heatmap["heatmap-opacity"])})};function $f(t){var o={},u=t.resolution||256,h=t.clips?t.clips.length:1,y=t.image||new Bo({width:u,height:h}),b=function(Me,Oe,L){o[t.evaluationKey]=L;var Ue=t.expression.evaluate(o);y.data[Me+Oe+0]=Math.floor(255*Ue.r/Ue.a),y.data[Me+Oe+1]=Math.floor(255*Ue.g/Ue.a),y.data[Me+Oe+2]=Math.floor(255*Ue.b/Ue.a),y.data[Me+Oe+3]=Math.floor(255*Ue.a)};if(t.clips)for(var S=0,I=0;S<h;++S,I+=4*u)for(var D=0,z=0;D<u;D++,z+=4){var j=D/(u-1),W=t.clips[S];b(I,z,W.start*(1-j)+W.end*j)}else for(var K=0,oe=0;K<u;K++,oe+=4)b(0,oe,K/(u-1));return y}var Pp=function(t){function o(u){t.call(this,u,Yc),this._updateColorRamp()}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new pc(u)},o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},o.prototype._updateColorRamp=function(){this.colorRamp=$f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},o.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},o}(du),Qf={paint:new Ho({"hillshade-illumination-direction":new On(fe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(fe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(fe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(fe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(fe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(fe.paint_hillshade["hillshade-accent-color"])})},lh=function(t){function o(u){t.call(this,u,Qf)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},o}(du),dc=Da([{name:"a_pos",components:2,type:"Int16"}],4).members,vc=Ip,Tf=Ip;function Ip(t,o,u){u=u||2;var h,y,b,S,I,D,z,j=o&&o.length,W=j?o[0]*u:t.length,K=Hh(t,0,W,u,!0),oe=[];if(!K||K.next===K.prev)return oe;if(j&&(K=function(Oe,L,Ue,ot){var xt,Ut,Gt,or=[];for(xt=0,Ut=L.length;xt<Ut;xt++)(Gt=Hh(Oe,L[xt]*ot,xt<Ut-1?L[xt+1]*ot:Oe.length,ot,!1))===Gt.next&&(Gt.steiner=!0),or.push(fh(Gt));for(or.sort(Pd),xt=0;xt<or.length;xt++)Id(or[xt],Ue),Ue=xl(Ue,Ue.next);return Ue}(t,o,K,u)),t.length>80*u){h=b=t[0],y=S=t[1];for(var Me=u;Me<W;Me+=u)(I=t[Me])<h&&(h=I),(D=t[Me+1])<y&&(y=D),I>b&&(b=I),D>S&&(S=D);z=(z=Math.max(b-h,S-y))!==0?1/z:0}return qc(K,oe,u,h,y,z),oe}function Hh(t,o,u,h,y){var b,S;if(y===np(t,o,u,h)>0)for(b=o;b<u;b+=h)S=rp(b,t[b],t[b+1],S);else for(b=u-h;b>=o;b-=h)S=rp(b,t[b],t[b+1],S);return S&&Ht(S,S.next)&&(Vl(S),S=S.next),S}function xl(t,o){if(!t)return t;o||(o=t);var u,h=t;do if(u=!1,h.steiner||!Ht(h,h.next)&&Mo(h.prev,h,h.next)!==0)h=h.next;else{if(Vl(h),(h=o=h.prev)===h.next)break;u=!0}while(u||h!==o);return o}function qc(t,o,u,h,y,b,S){if(t){!S&&b&&function(j,W,K,oe){var Me=j;do Me.z===null&&(Me.z=ch(Me.x,Me.y,W,K,oe)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==j);Me.prevZ.nextZ=null,Me.prevZ=null,function(Oe){var L,Ue,ot,xt,Ut,Gt,or,Mr,Fr=1;do{for(Ue=Oe,Oe=null,Ut=null,Gt=0;Ue;){for(Gt++,ot=Ue,or=0,L=0;L<Fr&&(or++,ot=ot.nextZ);L++);for(Mr=Fr;or>0||Mr>0&&ot;)or!==0&&(Mr===0||!ot||Ue.z<=ot.z)?(xt=Ue,Ue=Ue.nextZ,or--):(xt=ot,ot=ot.nextZ,Mr--),Ut?Ut.nextZ=xt:Oe=xt,xt.prevZ=Ut,Ut=xt;Ue=ot}Ut.nextZ=null,Fr*=2}while(Gt>1)}(Me)}(t,h,y,b);for(var I,D,z=t;t.prev!==t.next;)if(I=t.prev,D=t.next,b?Md(t,h,y,b):Wh(t))o.push(I.i/u),o.push(t.i/u),o.push(D.i/u),Vl(t),t=D.next,z=D.next;else if((t=D)===z){S?S===1?qc(t=Kc(xl(t),o,u),o,u,h,y,b,2):S===2&&Op(t,o,u,h,y,b):qc(xl(t),o,u,h,y,b,1);break}}}function Wh(t){var o=t.prev,u=t,h=t.next;if(Mo(o,u,h)>=0)return!1;for(var y=t.next.next;y!==t.prev;){if(Jf(o.x,o.y,u.x,u.y,h.x,h.y,y.x,y.y)&&Mo(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function Md(t,o,u,h){var y=t.prev,b=t,S=t.next;if(Mo(y,b,S)>=0)return!1;for(var I=y.x>b.x?y.x>S.x?y.x:S.x:b.x>S.x?b.x:S.x,D=y.y>b.y?y.y>S.y?y.y:S.y:b.y>S.y?b.y:S.y,z=ch(y.x<b.x?y.x<S.x?y.x:S.x:b.x<S.x?b.x:S.x,y.y<b.y?y.y<S.y?y.y:S.y:b.y<S.y?b.y:S.y,o,u,h),j=ch(I,D,o,u,h),W=t.prevZ,K=t.nextZ;W&&W.z>=z&&K&&K.z<=j;){if(W!==t.prev&&W!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Mo(W.prev,W,W.next)>=0||(W=W.prevZ,K!==t.prev&&K!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,K.x,K.y)&&Mo(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;W&&W.z>=z;){if(W!==t.prev&&W!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,W.x,W.y)&&Mo(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;K&&K.z<=j;){if(K!==t.prev&&K!==t.next&&Jf(y.x,y.y,b.x,b.y,S.x,S.y,K.x,K.y)&&Mo(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function Kc(t,o,u){var h=t;do{var y=h.prev,b=h.next.next;!Ht(y,b)&&Yh(y,h,h.next,b)&&Mf(y,b)&&Mf(b,y)&&(o.push(y.i/u),o.push(h.i/u),o.push(b.i/u),Vl(h),Vl(h.next),h=t=b),h=h.next}while(h!==t);return xl(h)}function Op(t,o,u,h,y,b){var S=t;do{for(var I=S.next.next;I!==S.prev;){if(S.i!==I.i&&Wr(S,I)){var D=tp(S,I);return S=xl(S,S.next),D=xl(D,D.next),qc(S,o,u,h,y,b),void qc(D,o,u,h,y,b)}I=I.next}S=S.next}while(S!==t)}function Pd(t,o){return t.x-o.x}function Id(t,o){if(o=function(h,y){var b,S=y,I=h.x,D=h.y,z=-1/0;do{if(D<=S.y&&D>=S.next.y&&S.next.y!==S.y){var j=S.x+(D-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(j<=I&&j>z){if(z=j,j===I){if(D===S.y)return S;if(D===S.next.y)return S.next}b=S.x<S.next.x?S:S.next}}S=S.next}while(S!==y);if(!b)return null;if(I===z)return b;var W,K=b,oe=b.x,Me=b.y,Oe=1/0;S=b;do I>=S.x&&S.x>=oe&&I!==S.x&&Jf(D<Me?I:z,D,oe,Me,D<Me?z:I,D,S.x,S.y)&&(W=Math.abs(D-S.y)/(I-S.x),Mf(S,h)&&(W<Oe||W===Oe&&(S.x>b.x||S.x===b.x&&Xh(b,S)))&&(b=S,Oe=W)),S=S.next;while(S!==K);return b}(t,o)){var u=tp(o,t);xl(o,o.next),xl(u,u.next)}}function Xh(t,o){return Mo(t.prev,t,o.prev)<0&&Mo(o.next,t,t.next)<0}function ch(t,o,u,h,y){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*y)|t<<8))|t<<4))|t<<2))|t<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-h)*y)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function fh(t){var o=t,u=t;do(o.x<u.x||o.x===u.x&&o.y<u.y)&&(u=o),o=o.next;while(o!==t);return u}function Jf(t,o,u,h,y,b,S,I){return(y-S)*(o-I)-(t-S)*(b-I)>=0&&(t-S)*(h-I)-(u-S)*(o-I)>=0&&(u-S)*(b-I)-(y-S)*(h-I)>=0}function Wr(t,o){return t.next.i!==o.i&&t.prev.i!==o.i&&!function(u,h){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==h.i&&y.next.i!==h.i&&Yh(y,y.next,u,h))return!0;y=y.next}while(y!==u);return!1}(t,o)&&(Mf(t,o)&&Mf(o,t)&&function(u,h){var y=u,b=!1,S=(u.x+h.x)/2,I=(u.y+h.y)/2;do y.y>I!=y.next.y>I&&y.next.y!==y.y&&S<(y.next.x-y.x)*(I-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==u);return b}(t,o)&&(Mo(t.prev,t,o.prev)||Mo(t,o.prev,o))||Ht(t,o)&&Mo(t.prev,t,t.next)>0&&Mo(o.prev,o,o.next)>0)}function Mo(t,o,u){return(o.y-t.y)*(u.x-o.x)-(o.x-t.x)*(u.y-o.y)}function Ht(t,o){return t.x===o.x&&t.y===o.y}function Yh(t,o,u,h){var y=ep(Mo(t,o,u)),b=ep(Mo(t,o,h)),S=ep(Mo(u,h,t)),I=ep(Mo(u,h,o));return y!==b&&S!==I||!(y!==0||!Rp(t,u,o))||!(b!==0||!Rp(t,h,o))||!(S!==0||!Rp(u,t,h))||!(I!==0||!Rp(u,o,h))}function Rp(t,o,u){return o.x<=Math.max(t.x,u.x)&&o.x>=Math.min(t.x,u.x)&&o.y<=Math.max(t.y,u.y)&&o.y>=Math.min(t.y,u.y)}function ep(t){return t>0?1:t<0?-1:0}function Mf(t,o){return Mo(t.prev,t,t.next)<0?Mo(t,o,t.next)>=0&&Mo(t,t.prev,o)>=0:Mo(t,o,t.prev)<0||Mo(t,t.next,o)<0}function tp(t,o){var u=new bl(t.i,t.x,t.y),h=new bl(o.i,o.x,o.y),y=t.next,b=o.prev;return t.next=o,o.prev=t,u.next=y,y.prev=u,h.next=u,u.prev=h,b.next=h,h.prev=b,h}function rp(t,o,u,h){var y=new bl(t,o,u);return h?(y.next=h.next,y.prev=h,h.next.prev=y,h.next=y):(y.prev=y,y.next=y),y}function Vl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function bl(t,o,u){this.i=t,this.x=o,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function np(t,o,u,h){for(var y=0,b=o,S=u-h;b<u;b+=h)y+=(t[S]-t[b])*(t[b+1]+t[S+1]),S=b;return y}function Lp(t,o,u,h,y){(function b(S,I,D,z,j){for(;z>D;){if(z-D>600){var W=z-D+1,K=I-D+1,oe=Math.log(W),Me=.5*Math.exp(2*oe/3),Oe=.5*Math.sqrt(oe*Me*(W-Me)/W)*(K-W/2<0?-1:1);b(S,I,Math.max(D,Math.floor(I-K*Me/W+Oe)),Math.min(z,Math.floor(I+(W-K)*Me/W+Oe)),j)}var L=S[I],Ue=D,ot=z;for(Gl(S,D,I),j(S[z],L)>0&&Gl(S,D,z);Ue<ot;){for(Gl(S,Ue,ot),Ue++,ot--;j(S[Ue],L)<0;)Ue++;for(;j(S[ot],L)>0;)ot--}j(S[D],L)===0?Gl(S,D,ot):Gl(S,++ot,z),ot<=I&&(D=ot+1),I<=ot&&(z=ot-1)}})(t,o,u||0,h||t.length-1,y||ip)}function Gl(t,o,u){var h=t[o];t[o]=t[u],t[u]=h}function ip(t,o){return t<o?-1:t>o?1:0}function Pf(t,o){var u=t.length;if(u<=1)return[t];for(var h,y,b=[],S=0;S<u;S++){var I=xr(t[S]);I!==0&&(t[S].area=Math.abs(I),y===void 0&&(y=I<0),y===I<0?(h&&b.push(h),h=[t[S]]):h.push(t[S]))}if(h&&b.push(h),o>1)for(var D=0;D<b.length;D++)b[D].length<=o||(Lp(b[D],o,1,b[D].length-1,ap),b[D]=b[D].slice(0,o));return b}function ap(t,o){return o.area-t.area}function $c(t,o,u){for(var h=u.patternDependencies,y=!1,b=0,S=o;b<S.length;b+=1){var I=S[b].paint.get(t+"-pattern");I.isConstant()||(y=!0);var D=I.constantOr(null);D&&(y=!0,h[D.to]=!0,h[D.from]=!0)}return y}function If(t,o,u,h,y){for(var b=y.patternDependencies,S=0,I=o;S<I.length;S+=1){var D=I[S],z=D.paint.get(t+"-pattern").value;if(z.kind!=="constant"){var j=z.evaluate({zoom:h-1},u,{},y.availableImages),W=z.evaluate({zoom:h},u,{},y.availableImages),K=z.evaluate({zoom:h+1},u,{},y.availableImages);W=W&&W.name?W.name:W,K=K&&K.name?K.name:K,b[j=j&&j.name?j.name:j]=!0,b[W]=!0,b[K]=!0,u.patterns[D.id]={min:j,mid:W,max:K}}}return u}Ip.deviation=function(t,o,u,h){var y=o&&o.length,b=Math.abs(np(t,0,y?o[0]*u:t.length,u));if(y)for(var S=0,I=o.length;S<I;S++)b-=Math.abs(np(t,o[S]*u,S<I-1?o[S+1]*u:t.length,u));var D=0;for(S=0;S<h.length;S+=3){var z=h[S]*u,j=h[S+1]*u,W=h[S+2]*u;D+=Math.abs((t[z]-t[W])*(t[j+1]-t[z+1])-(t[z]-t[j])*(t[W+1]-t[z+1]))}return b===0&&D===0?0:Math.abs((D-b)/b)},Ip.flatten=function(t){for(var o=t[0][0].length,u={vertices:[],holes:[],dimensions:o},h=0,y=0;y<t.length;y++){for(var b=0;b<t[y].length;b++)for(var S=0;S<o;S++)u.vertices.push(t[y][b][S]);y>0&&u.holes.push(h+=t[y-1].length)}return u},vc.default=Tf;var Us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new cc,this.indexArray=new dl,this.indexArray2=new zl,this.programConfigurations=new Hn(t.layers,t.zoom),this.segments=new pe,this.segments2=new pe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};Us.prototype.populate=function(t,o,u){this.hasPattern=$c("fill",this.layers,o);for(var h=this.layers[0].layout.get("fill-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,j=I.index,W=I.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,oe=po(D,K);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),oe,u)){var Me=h?h.evaluate(oe,{},u,o.availableImages):void 0,Oe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:W,index:j,geometry:K?oe.geometry:Wa(D),patterns:{},sortKey:Me};y.push(Oe)}}h&&y.sort(function(Mr,Fr){return Mr.sortKey-Fr.sortKey});for(var L=0,Ue=y;L<Ue.length;L+=1){var ot=Ue[L],xt=ot.geometry,Ut=ot.index,Gt=ot.sourceLayerIndex;if(this.hasPattern){var or=If("fill",this.layers,ot,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(ot,xt,Ut,u,{});o.featureIndex.insert(t[Ut].feature,xt,Ut,Gt,this.index)}},Us.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Us.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Us.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,dc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Us.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Pf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,j=I;z<j.length;z+=1)D+=j[z].length;for(var W=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),K=W.vertexLength,oe=[],Me=[],Oe=0,L=I;Oe<L.length;Oe+=1){var Ue=L[Oe];if(Ue.length!==0){Ue!==I[0]&&Me.push(oe.length/2);var ot=this.segments2.prepareSegment(Ue.length,this.layoutVertexArray,this.indexArray2),xt=ot.vertexLength;this.layoutVertexArray.emplaceBack(Ue[0].x,Ue[0].y),this.indexArray2.emplaceBack(xt+Ue.length-1,xt),oe.push(Ue[0].x),oe.push(Ue[0].y);for(var Ut=1;Ut<Ue.length;Ut++)this.layoutVertexArray.emplaceBack(Ue[Ut].x,Ue[Ut].y),this.indexArray2.emplaceBack(xt+Ut-1,xt+Ut),oe.push(Ue[Ut].x),oe.push(Ue[Ut].y);ot.vertexLength+=Ue.length,ot.primitiveLength+=Ue.length}}for(var Gt=vc(oe,Me),or=0;or<Gt.length;or+=3)this.indexArray.emplaceBack(K+Gt[or],K+Gt[or+1],K+Gt[or+2]);W.vertexLength+=D,W.primitiveLength+=Gt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},dn("FillBucket",Us,{omit:["layers","patternFeatures"]});var Of=new Ho({"fill-sort-key":new Cn(fe.layout_fill["fill-sort-key"])}),Qc={paint:new Ho({"fill-antialias":new On(fe.paint_fill["fill-antialias"]),"fill-opacity":new Cn(fe.paint_fill["fill-opacity"]),"fill-color":new Cn(fe.paint_fill["fill-color"]),"fill-outline-color":new Cn(fe.paint_fill["fill-outline-color"]),"fill-translate":new On(fe.paint_fill["fill-translate"]),"fill-translate-anchor":new On(fe.paint_fill["fill-translate-anchor"]),"fill-pattern":new jc(fe.paint_fill["fill-pattern"])}),layout:Of},op=function(t){function o(u){t.call(this,u,Qc)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var y=this.paint._values["fill-outline-color"];y.value.kind==="constant"&&y.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},o.prototype.createBucket=function(u){return new Us(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D){return mu(Bu(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),I.angle,D),b)},o.prototype.isTileClipped=function(){return!0},o}(du),sp=Da([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,kp=El;function El(t,o,u,h,y){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=y,t.readFields(Jc,this,o)}function Jc(t,o,u){t==1?o.id=u.readVarint():t==2?function(h,y){for(var b=h.readVarint()+h.pos;h.pos<b;){var S=y._keys[h.readVarint()],I=y._values[h.readVarint()];y.properties[S]=I}}(u,o):t==3?o.type=u.readVarint():t==4&&(o._geometry=u.pos)}function qh(t){for(var o,u,h=0,y=0,b=t.length,S=b-1;y<b;S=y++)h+=((u=t[S]).x-(o=t[y]).x)*(o.y+u.y);return h}El.types=["Unknown","Point","LineString","Polygon"],El.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var o,u=t.readVarint()+t.pos,h=1,y=0,b=0,S=0,I=[];t.pos<u;){if(y<=0){var D=t.readVarint();h=7&D,y=D>>3}if(y--,h===1||h===2)b+=t.readSVarint(),S+=t.readSVarint(),h===1&&(o&&I.push(o),o=[]),o.push(new ce(b,S));else{if(h!==7)throw new Error("unknown command "+h);o&&o.push(o[0].clone())}}return o&&I.push(o),I},El.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var o=t.readVarint()+t.pos,u=1,h=0,y=0,b=0,S=1/0,I=-1/0,D=1/0,z=-1/0;t.pos<o;){if(h<=0){var j=t.readVarint();u=7&j,h=j>>3}if(h--,u===1||u===2)(y+=t.readSVarint())<S&&(S=y),y>I&&(I=y),(b+=t.readSVarint())<D&&(D=b),b>z&&(z=b);else if(u!==7)throw new Error("unknown command "+u)}return[S,D,I,z]},El.prototype.toGeoJSON=function(t,o,u){var h,y,b=this.extent*Math.pow(2,u),S=this.extent*t,I=this.extent*o,D=this.loadGeometry(),z=El.types[this.type];function j(oe){for(var Me=0;Me<oe.length;Me++){var Oe=oe[Me];oe[Me]=[360*(Oe.x+S)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+I)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(h=0;h<D.length;h++)W[h]=D[h][0];j(D=W);break;case 2:for(h=0;h<D.length;h++)j(D[h]);break;case 3:for(D=function(oe){var Me=oe.length;if(Me<=1)return[oe];for(var Oe,L,Ue=[],ot=0;ot<Me;ot++){var xt=qh(oe[ot]);xt!==0&&(L===void 0&&(L=xt<0),L===xt<0?(Oe&&Ue.push(Oe),Oe=[oe[ot]]):Oe.push(oe[ot]))}return Oe&&Ue.push(Oe),Ue}(D),h=0;h<D.length;h++)for(y=0;y<D[h].length;y++)j(D[h][y])}D.length===1?D=D[0]:z="Multi"+z;var K={type:"Feature",geometry:{type:z,coordinates:D},properties:this.properties};return"id"in this&&(K.id=this.id),K};var Dp=ph;function ph(t,o){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Od,this,o),this.length=this._features.length}function Od(t,o,u){t===15?o.version=u.readVarint():t===1?o.name=u.readString():t===5?o.extent=u.readVarint():t===2?o._features.push(u.pos):t===3?o._keys.push(u.readString()):t===4&&o._values.push(function(h){for(var y=null,b=h.readVarint()+h.pos;h.pos<b;){var S=h.readVarint()>>3;y=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return y}(u))}function Kh(t,o,u){if(t===3){var h=new Dp(u,u.readVarint()+u.pos);h.length&&(o[h.name]=h)}}ph.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var o=this._pbf.readVarint()+this._pbf.pos;return new kp(this._pbf,o,this.extent,this._keys,this._values)};var Eu={VectorTile:function(t,o){this.layers=t.readFields(Kh,{},o)},VectorTileFeature:kp,VectorTileLayer:Dp},Rd=Eu.VectorTileFeature.types,Fp=Math.pow(2,13);function ef(t,o,u,h,y,b,S,I){t.emplaceBack(o,u,2*Math.floor(h*Fp)+S,y*Fp*2,b*Fp*2,Math.round(I))}var zu=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(o){return o.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new vu,this.indexArray=new dl,this.programConfigurations=new Hn(t.layers,t.zoom),this.segments=new pe,this.stateDependentLayerIds=this.layers.filter(function(o){return o.isStateDependent()}).map(function(o){return o.id})};function $h(t,o){return t.x===o.x&&(t.x<0||t.x>8192)||t.y===o.y&&(t.y<0||t.y>8192)}zu.prototype.populate=function(t,o,u){this.features=[],this.hasPattern=$c("fill-extrusion",this.layers,o);for(var h=0,y=t;h<y.length;h+=1){var b=y[h],S=b.feature,I=b.id,D=b.index,z=b.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,W=po(S,j);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),W,u)){var K={id:I,sourceLayerIndex:z,index:D,geometry:j?W.geometry:Wa(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(If("fill-extrusion",this.layers,K,this.zoom,o)):this.addFeature(K,K.geometry,D,u,{}),o.featureIndex.insert(S,K.geometry,D,z,this.index,!0)}}},zu.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.features;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},zu.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},zu.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},zu.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},zu.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sp),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},zu.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},zu.prototype.addFeature=function(t,o,u,h,y){for(var b=0,S=Pf(o,500);b<S.length;b+=1){for(var I=S[b],D=0,z=0,j=I;z<j.length;z+=1)D+=j[z].length;for(var W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),K=0,oe=I;K<oe.length;K+=1){var Me=oe[K];if(Me.length!==0&&!((Vi=Me).every(function(Ai){return Ai.x<0})||Vi.every(function(Ai){return Ai.x>8192})||Vi.every(function(Ai){return Ai.y<0})||Vi.every(function(Ai){return Ai.y>8192})))for(var Oe=0,L=0;L<Me.length;L++){var Ue=Me[L];if(L>=1){var ot=Me[L-1];if(!$h(Ue,ot)){W.vertexLength+4>pe.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var xt=Ue.sub(ot)._perp()._unit(),Ut=ot.dist(Ue);Oe+Ut>32768&&(Oe=0),ef(this.layoutVertexArray,Ue.x,Ue.y,xt.x,xt.y,0,0,Oe),ef(this.layoutVertexArray,Ue.x,Ue.y,xt.x,xt.y,0,1,Oe),ef(this.layoutVertexArray,ot.x,ot.y,xt.x,xt.y,0,0,Oe+=Ut),ef(this.layoutVertexArray,ot.x,ot.y,xt.x,xt.y,0,1,Oe);var Gt=W.vertexLength;this.indexArray.emplaceBack(Gt,Gt+2,Gt+1),this.indexArray.emplaceBack(Gt+1,Gt+2,Gt+3),W.vertexLength+=4,W.primitiveLength+=2}}}}if(W.vertexLength+D>pe.MAX_VERTEX_ARRAY_LENGTH&&(W=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Rd[t.type]==="Polygon"){for(var or=[],Mr=[],Fr=W.vertexLength,Dn=0,cn=I;Dn<cn.length;Dn+=1){var Zn=cn[Dn];if(Zn.length!==0){Zn!==I[0]&&Mr.push(or.length/2);for(var pn=0;pn<Zn.length;pn++){var Ri=Zn[pn];ef(this.layoutVertexArray,Ri.x,Ri.y,0,0,1,1,0),or.push(Ri.x),or.push(Ri.y)}}}for(var ti=vc(or,Mr),wn=0;wn<ti.length;wn+=3)this.indexArray.emplaceBack(Fr+ti[wn],Fr+ti[wn+2],Fr+ti[wn+1]);W.primitiveLength+=ti.length/3,W.vertexLength+=D}}var Vi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},dn("FillExtrusionBucket",zu,{omit:["layers","features"]});var Qh={paint:new Ho({"fill-extrusion-opacity":new On(fe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(fe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(fe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new jc(fe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Cn(fe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(fe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},el=function(t){function o(u){t.call(this,u,Qh)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.createBucket=function(u){return new zu(u)},o.prototype.queryRadius=function(){return Eo(this.paint.get("fill-extrusion-translate"))},o.prototype.is3D=function(){return!0},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D,z){var j=Bu(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),I.angle,D),W=this.paint.get("fill-extrusion-height").evaluate(h,y),K=this.paint.get("fill-extrusion-base").evaluate(h,y),oe=function(Oe,L,Ue,ot){for(var xt=[],Ut=0,Gt=Oe;Ut<Gt.length;Ut+=1){var or=Gt[Ut],Mr=[or.x,or.y,0,1];Xc(Mr,Mr,L),xt.push(new ce(Mr[0]/Mr[3],Mr[1]/Mr[3]))}return xt}(j,z),Me=function(Oe,L,Ue,ot){for(var xt=[],Ut=[],Gt=ot[8]*L,or=ot[9]*L,Mr=ot[10]*L,Fr=ot[11]*L,Dn=ot[8]*Ue,cn=ot[9]*Ue,Zn=ot[10]*Ue,pn=ot[11]*Ue,Ri=0,ti=Oe;Ri<ti.length;Ri+=1){for(var wn=[],Vi=[],Ai=0,ta=ti[Ri];Ai<ta.length;Ai+=1){var Vn=ta[Ai],fa=Vn.x,eo=Vn.y,_o=ot[0]*fa+ot[4]*eo+ot[12],Xa=ot[1]*fa+ot[5]*eo+ot[13],to=ot[2]*fa+ot[6]*eo+ot[14],xo=ot[3]*fa+ot[7]*eo+ot[15],Yo=to+Mr,ts=xo+Fr,Vs=_o+Dn,rs=Xa+cn,Gs=to+Zn,ro=xo+pn,fs=new ce((_o+Gt)/ts,(Xa+or)/ts);fs.z=Yo/ts,wn.push(fs);var wi=new ce(Vs/ro,rs/ro);wi.z=Gs/ro,Vi.push(wi)}xt.push(wn),Ut.push(Vi)}return[xt,Ut]}(b,K,W,z);return function(Oe,L,Ue){var ot=1/0;mu(Ue,L)&&(ot=tf(Ue,L[0]));for(var xt=0;xt<L.length;xt++)for(var Ut=L[xt],Gt=Oe[xt],or=0;or<Ut.length-1;or++){var Mr=Ut[or],Fr=[Mr,Ut[or+1],Gt[or+1],Gt[or],Mr];Du(Ue,Fr)&&(ot=Math.min(ot,tf(Ue,Fr)))}return ot!==1/0&&ot}(Me[0],Me[1],oe)},o}(du);function Rf(t,o){return t.x*o.x+t.y*o.y}function tf(t,o){if(t.length===1){for(var u,h=0,y=o[h++];!u||y.equals(u);)if(!(u=o[h++]))return 1/0;for(;h<o.length;h++){var b=o[h],S=t[0],I=u.sub(y),D=b.sub(y),z=S.sub(y),j=Rf(I,I),W=Rf(I,D),K=Rf(D,D),oe=Rf(z,I),Me=Rf(z,D),Oe=j*K-W*W,L=(K*oe-W*Me)/Oe,Ue=(j*Me-W*oe)/Oe,ot=y.z*(1-L-Ue)+u.z*L+b.z*Ue;if(isFinite(ot))return ot}return 1/0}for(var xt=1/0,Ut=0,Gt=o;Ut<Gt.length;Ut+=1)xt=Math.min(xt,Gt[Ut].z);return xt}var mc=Da([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,hh=Da([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,rf=Eu.VectorTileFeature.types,Bp=Math.cos(Math.PI/180*37.5),Oa=Math.pow(2,14)/.5,Ki=function(t){var o=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){o.gradients[u.id]={}}),this.layoutVertexArray=new bi,this.layoutVertexArray2=new Ns,this.indexArray=new dl,this.programConfigurations=new Hn(t.layers,t.zoom),this.segments=new pe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};Ki.prototype.populate=function(t,o,u){this.hasPattern=$c("line",this.layers,o);for(var h=this.layers[0].layout.get("line-sort-key"),y=[],b=0,S=t;b<S.length;b+=1){var I=S[b],D=I.feature,z=I.id,j=I.index,W=I.sourceLayerIndex,K=this.layers[0]._featureFilter.needGeometry,oe=po(D,K);if(this.layers[0]._featureFilter.filter(new Ti(this.zoom),oe,u)){var Me=h?h.evaluate(oe,{},u):void 0,Oe={id:z,properties:D.properties,type:D.type,sourceLayerIndex:W,index:j,geometry:K?oe.geometry:Wa(D),patterns:{},sortKey:Me};y.push(Oe)}}h&&y.sort(function(Mr,Fr){return Mr.sortKey-Fr.sortKey});for(var L=0,Ue=y;L<Ue.length;L+=1){var ot=Ue[L],xt=ot.geometry,Ut=ot.index,Gt=ot.sourceLayerIndex;if(this.hasPattern){var or=If("line",this.layers,ot,this.zoom,o);this.patternFeatures.push(or)}else this.addFeature(ot,xt,Ut,u,{});o.featureIndex.insert(t[Ut].feature,xt,Ut,Gt,this.index)}},Ki.prototype.update=function(t,o,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,o,this.stateDependentLayers,u)},Ki.prototype.addFeatures=function(t,o,u){for(var h=0,y=this.patternFeatures;h<y.length;h+=1){var b=y[h];this.addFeature(b,b.geometry,b.index,o,u)}},Ki.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ki.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ki.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,hh)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,mc),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ki.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ki.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ki.prototype.addFeature=function(t,o,u,h,y){var b=this.layers[0].layout,S=b.get("line-join").evaluate(t,{}),I=b.get("line-cap"),D=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var j=0,W=o;j<W.length;j+=1)this.addLine(W[j],t,S,I,D,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,y,h)},Ki.prototype.addLine=function(t,o,u,h,y,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var I=rf[o.type]==="Polygon",D=t.length;D>=2&&t[D-1].equals(t[D-2]);)D--;for(var z=0;z<D-1&&t[z].equals(t[z+1]);)z++;if(!(D<(I?3:2))){u==="bevel"&&(y=1.05);var j,W=this.overscaling<=16?122880/(512*this.overscaling):0,K=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),oe=void 0,Me=void 0,Oe=void 0,L=void 0;this.e1=this.e2=-1,I&&(L=t[z].sub(j=t[D-2])._unit()._perp());for(var Ue=z;Ue<D;Ue++)if(!(Me=Ue===D-1?I?t[z+1]:void 0:t[Ue+1])||!t[Ue].equals(Me)){L&&(Oe=L),j&&(oe=j),j=t[Ue],L=Me?Me.sub(j)._unit()._perp():Oe;var ot=(Oe=Oe||L).add(L);ot.x===0&&ot.y===0||ot._unit();var xt=Oe.x*L.x+Oe.y*L.y,Ut=ot.x*L.x+ot.y*L.y,Gt=Ut!==0?1/Ut:1/0,or=2*Math.sqrt(2-2*Ut),Mr=Ut<Bp&&oe&&Me,Fr=Oe.x*L.y-Oe.y*L.x>0;if(Mr&&Ue>z){var Dn=j.dist(oe);if(Dn>2*W){var cn=j.sub(j.sub(oe)._mult(W/Dn)._round());this.updateDistance(oe,cn),this.addCurrentVertex(cn,Oe,0,0,K),oe=cn}}var Zn=oe&&Me,pn=Zn?u:I?"butt":h;if(Zn&&pn==="round"&&(Gt<b?pn="miter":Gt<=2&&(pn="fakeround")),pn==="miter"&&Gt>y&&(pn="bevel"),pn==="bevel"&&(Gt>2&&(pn="flipbevel"),Gt<y&&(pn="miter")),oe&&this.updateDistance(oe,j),pn==="miter")ot._mult(Gt),this.addCurrentVertex(j,ot,0,0,K);else if(pn==="flipbevel"){if(Gt>100)ot=L.mult(-1);else{var Ri=Gt*Oe.add(L).mag()/Oe.sub(L).mag();ot._perp()._mult(Ri*(Fr?-1:1))}this.addCurrentVertex(j,ot,0,0,K),this.addCurrentVertex(j,ot.mult(-1),0,0,K)}else if(pn==="bevel"||pn==="fakeround"){var ti=-Math.sqrt(Gt*Gt-1),wn=Fr?ti:0,Vi=Fr?0:ti;if(oe&&this.addCurrentVertex(j,Oe,wn,Vi,K),pn==="fakeround")for(var Ai=Math.round(180*or/Math.PI/20),ta=1;ta<Ai;ta++){var Vn=ta/Ai;if(Vn!==.5){var fa=Vn-.5;Vn+=Vn*fa*(Vn-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*fa*fa+(.848013+xt*(.215638*xt-1.06021)))}var eo=L.sub(Oe)._mult(Vn)._add(Oe)._unit()._mult(Fr?-1:1);this.addHalfVertex(j,eo.x,eo.y,!1,Fr,0,K)}Me&&this.addCurrentVertex(j,L,-wn,-Vi,K)}else if(pn==="butt")this.addCurrentVertex(j,ot,0,0,K);else if(pn==="square"){var _o=oe?1:-1;this.addCurrentVertex(j,ot,_o,_o,K)}else pn==="round"&&(oe&&(this.addCurrentVertex(j,Oe,0,0,K),this.addCurrentVertex(j,Oe,1,1,K,!0)),Me&&(this.addCurrentVertex(j,L,-1,-1,K,!0),this.addCurrentVertex(j,L,0,0,K)));if(Mr&&Ue<D-1){var Xa=j.dist(Me);if(Xa>2*W){var to=j.add(Me.sub(j)._mult(W/Xa)._round());this.updateDistance(j,to),this.addCurrentVertex(to,L,0,0,K),j=to}}}}},Ki.prototype.addCurrentVertex=function(t,o,u,h,y,b){b===void 0&&(b=!1);var S=o.y*h-o.x,I=-o.y-o.x*h;this.addHalfVertex(t,o.x+o.y*u,o.y-o.x*u,b,!1,u,y),this.addHalfVertex(t,S,I,b,!0,-h,y),this.distance>Oa/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,o,u,h,y,b))},Ki.prototype.addHalfVertex=function(t,o,u,h,y,b,S){var I=.5*(this.lineClips?this.scaledDistance*(Oa-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(y?1:0),Math.round(63*o)+128,Math.round(63*u)+128,1+(b===0?0:b<0?-1:1)|(63&I)<<2,I>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),S.primitiveLength++),y?this.e2=D:this.e1=D},Ki.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ki.prototype.updateDistance=function(t,o){this.distance+=t.dist(o),this.updateScaledDistance()},dn("LineBucket",Ki,{omit:["layers","patternFeatures"]});var gc=new Ho({"line-cap":new On(fe.layout_line["line-cap"]),"line-join":new Cn(fe.layout_line["line-join"]),"line-miter-limit":new On(fe.layout_line["line-miter-limit"]),"line-round-limit":new On(fe.layout_line["line-round-limit"]),"line-sort-key":new Cn(fe.layout_line["line-sort-key"])}),Po={paint:new Ho({"line-opacity":new Cn(fe.paint_line["line-opacity"]),"line-color":new Cn(fe.paint_line["line-color"]),"line-translate":new On(fe.paint_line["line-translate"]),"line-translate-anchor":new On(fe.paint_line["line-translate-anchor"]),"line-width":new Cn(fe.paint_line["line-width"]),"line-gap-width":new Cn(fe.paint_line["line-gap-width"]),"line-offset":new Cn(fe.paint_line["line-offset"]),"line-blur":new Cn(fe.paint_line["line-blur"]),"line-dasharray":new Qo(fe.paint_line["line-dasharray"]),"line-pattern":new jc(fe.paint_line["line-pattern"]),"line-gradient":new Qs(fe.paint_line["line-gradient"])}),layout:gc},Zs=new(function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.possiblyEvaluate=function(u,h){return h=new Ti(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},o.prototype.evaluate=function(u,h,y,b){return h=yt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,y,b)},o}(Cn))(Po.paint.properties["line-width"].specification);Zs.useIntegerZoom=!0;var Jh=function(t){function o(u){t.call(this,u,Po),this.gradientVersion=0}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof _s,this.gradientVersion=(this.gradientVersion+1)%Xe)},o.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},o.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Zs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},o.prototype.createBucket=function(u){return new Ki(u)},o.prototype.queryRadius=function(u){var h=u,y=dh(bu("line-width",this,h),bu("line-gap-width",this,h)),b=bu("line-offset",this,h);return y/2+Math.abs(b)+Eo(this.paint.get("line-translate"))},o.prototype.queryIntersectsFeature=function(u,h,y,b,S,I,D){var z=Bu(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),I.angle,D),j=D/2*dh(this.paint.get("line-width").evaluate(h,y),this.paint.get("line-gap-width").evaluate(h,y)),W=this.paint.get("line-offset").evaluate(h,y);return W&&(b=function(K,oe){for(var Me=[],Oe=new ce(0,0),L=0;L<K.length;L++){for(var Ue=K[L],ot=[],xt=0;xt<Ue.length;xt++){var Ut=Ue[xt],Gt=Ue[xt+1],or=xt===0?Oe:Ut.sub(Ue[xt-1])._unit()._perp(),Mr=xt===Ue.length-1?Oe:Gt.sub(Ut)._unit()._perp(),Fr=or._add(Mr)._unit();Fr._mult(1/(Fr.x*Mr.x+Fr.y*Mr.y)),ot.push(Fr._mult(oe)._add(Ut))}Me.push(ot)}return Me}(b,W*D)),function(K,oe,Me){for(var Oe=0;Oe<oe.length;Oe++){var L=oe[Oe];if(K.length>=3){for(var Ue=0;Ue<L.length;Ue++)if(ru(K,L[Ue]))return!0}if(Rs(K,L,Me))return!0}return!1}(z,b,j)},o.prototype.isTileClipped=function(){return!0},o}(du);function dh(t,o){return o>0?o+2*t:t}var Ld=Da([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Np=Da([{name:"a_projected_pos",components:3,type:"Float32"}],4),kd=(Da([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Da([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),vh=(Da([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Da([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Sl=Da([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function up(t,o,u){return t.sections.forEach(function(h){h.text=function(y,b,S){var I=b.layout.get("text-transform").evaluate(S,{});return I==="uppercase"?y=y.toLocaleUpperCase():I==="lowercase"&&(y=y.toLocaleLowerCase()),Ps.applyArabicShaping&&(y=Ps.applyArabicShaping(y)),y}(h.text,o,u)}),t}Da([{name:"triangle",components:3,type:"Uint16"}]),Da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Da([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Da([{type:"Float32",name:"offsetX"}]),Da([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hl={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},ed=function(t,o,u,h,y){var b,S,I=8*y-h-1,D=(1<<I)-1,z=D>>1,j=-7,W=u?y-1:0,K=u?-1:1,oe=t[o+W];for(W+=K,b=oe&(1<<-j)-1,oe>>=-j,j+=I;j>0;b=256*b+t[o+W],W+=K,j-=8);for(S=b&(1<<-j)-1,b>>=-j,j+=h;j>0;S=256*S+t[o+W],W+=K,j-=8);if(b===0)b=1-z;else{if(b===D)return S?NaN:1/0*(oe?-1:1);S+=Math.pow(2,h),b-=z}return(oe?-1:1)*S*Math.pow(2,b-h)},lp=function(t,o,u,h,y,b){var S,I,D,z=8*b-y-1,j=(1<<z)-1,W=j>>1,K=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,oe=h?0:b-1,Me=h?1:-1,Oe=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(I=isNaN(o)?1:0,S=j):(S=Math.floor(Math.log(o)/Math.LN2),o*(D=Math.pow(2,-S))<1&&(S--,D*=2),(o+=S+W>=1?K/D:K*Math.pow(2,1-W))*D>=2&&(S++,D/=2),S+W>=j?(I=0,S=j):S+W>=1?(I=(o*D-1)*Math.pow(2,y),S+=W):(I=o*Math.pow(2,W-1)*Math.pow(2,y),S=0));y>=8;t[u+oe]=255&I,oe+=Me,I/=256,y-=8);for(S=S<<y|I,z+=y;z>0;t[u+oe]=255&S,oe+=Me,S/=256,z-=8);t[u+oe-Me]|=128*Oe},nf=Ea;function Ea(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ea.Varint=0,Ea.Fixed64=1,Ea.Bytes=2,Ea.Fixed32=5;var zp=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Wl(t){return t.type===Ea.Bytes?t.readVarint()+t.pos:t.pos+1}function Lf(t,o,u){return u?4294967296*o+(t>>>0):4294967296*(o>>>0)+(t>>>0)}function mh(t,o,u){var h=o<=16383?1:o<=2097151?2:o<=268435455?3:Math.floor(Math.log(o)/(7*Math.LN2));u.realloc(h);for(var y=u.pos-1;y>=t;y--)u.buf[y+h]=u.buf[y]}function Dd(t,o){for(var u=0;u<t.length;u++)o.writeVarint(t[u])}function N(t,o){for(var u=0;u<t.length;u++)o.writeSVarint(t[u])}function ge(t,o){for(var u=0;u<t.length;u++)o.writeFloat(t[u])}function Be(t,o){for(var u=0;u<t.length;u++)o.writeDouble(t[u])}function Dt(t,o){for(var u=0;u<t.length;u++)o.writeBoolean(t[u])}function ir(t,o){for(var u=0;u<t.length;u++)o.writeFixed32(t[u])}function Lt(t,o){for(var u=0;u<t.length;u++)o.writeSFixed32(t[u])}function Jt(t,o){for(var u=0;u<t.length;u++)o.writeFixed64(t[u])}function cr(t,o){for(var u=0;u<t.length;u++)o.writeSFixed64(t[u])}function vr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+16777216*t[o+3]}function yr(t,o,u){t[u]=o,t[u+1]=o>>>8,t[u+2]=o>>>16,t[u+3]=o>>>24}function wr(t,o){return(t[o]|t[o+1]<<8|t[o+2]<<16)+(t[o+3]<<24)}function Tr(t,o,u){t===1&&u.readMessage(jr,o)}function jr(t,o,u){if(t===3){var h=u.readMessage(mr,{}),y=h.width,b=h.height,S=h.left,I=h.top,D=h.advance;o.push({id:h.id,bitmap:new au({width:y+6,height:b+6},h.bitmap),metrics:{width:y,height:b,left:S,top:I,advance:D}})}}function mr(t,o,u){t===1?o.id=u.readVarint():t===2?o.bitmap=u.readBytes():t===3?o.width=u.readVarint():t===4?o.height=u.readVarint():t===5?o.left=u.readSVarint():t===6?o.top=u.readSVarint():t===7&&(o.advance=u.readVarint())}function Ar(t){for(var o=0,u=0,h=0,y=t;h<y.length;h+=1){var b=y[h];o+=b.w*b.h,u=Math.max(u,b.w)}t.sort(function(Oe,L){return L.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),u),h:1/0}],I=0,D=0,z=0,j=t;z<j.length;z+=1)for(var W=j[z],K=S.length-1;K>=0;K--){var oe=S[K];if(!(W.w>oe.w||W.h>oe.h)){if(W.x=oe.x,W.y=oe.y,D=Math.max(D,W.y+W.h),I=Math.max(I,W.x+W.w),W.w===oe.w&&W.h===oe.h){var Me=S.pop();K<S.length&&(S[K]=Me)}else W.h===oe.h?(oe.x+=W.w,oe.w-=W.w):W.w===oe.w?(oe.y+=W.h,oe.h-=W.h):(S.push({x:oe.x+W.w,y:oe.y,w:oe.w-W.w,h:W.h}),oe.y+=W.h,oe.h-=W.h);break}}return{w:I,h:D,fill:o/(I*D)||0}}Ea.prototype={destroy:function(){this.buf=null},readFields:function(t,o,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),y=h>>3,b=this.pos;this.type=7&h,t(y,o,this),this.pos===b&&this.skip(h)}return o},readMessage:function(t,o){return this.readFields(t,o,this.readVarint()+this.pos)},readFixed32:function(){var t=vr(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=wr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=vr(this.buf,this.pos)+4294967296*vr(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=vr(this.buf,this.pos)+4294967296*wr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ed(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ed(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var o,u,h=this.buf;return o=127&(u=h[this.pos++]),u<128?o:(o|=(127&(u=h[this.pos++]))<<7,u<128?o:(o|=(127&(u=h[this.pos++]))<<14,u<128?o:(o|=(127&(u=h[this.pos++]))<<21,u<128?o:function(y,b,S){var I,D,z=S.buf;if(I=(112&(D=z[S.pos++]))>>4,D<128||(I|=(127&(D=z[S.pos++]))<<3,D<128)||(I|=(127&(D=z[S.pos++]))<<10,D<128)||(I|=(127&(D=z[S.pos++]))<<17,D<128)||(I|=(127&(D=z[S.pos++]))<<24,D<128)||(I|=(1&(D=z[S.pos++]))<<31,D<128))return Lf(y,I,b);throw new Error("Expected varint not more than 10 bytes")}(o|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,o=this.pos;return this.pos=t,t-o>=12&&zp?function(u,h,y){return zp.decode(u.subarray(h,y))}(this.buf,o,t):function(u,h,y){for(var b="",S=h;S<y;){var I,D,z,j=u[S],W=null,K=j>239?4:j>223?3:j>191?2:1;if(S+K>y)break;K===1?j<128&&(W=j):K===2?(192&(I=u[S+1]))==128&&(W=(31&j)<<6|63&I)<=127&&(W=null):K===3?(D=u[S+2],(192&(I=u[S+1]))==128&&(192&D)==128&&((W=(15&j)<<12|(63&I)<<6|63&D)<=2047||W>=55296&&W<=57343)&&(W=null)):K===4&&(D=u[S+2],z=u[S+3],(192&(I=u[S+1]))==128&&(192&D)==128&&(192&z)==128&&((W=(15&j)<<18|(63&I)<<12|(63&D)<<6|63&z)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,K=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),S+=K}return b}(this.buf,o,t)},readBytes:function(){var t=this.readVarint()+this.pos,o=this.buf.subarray(this.pos,t);return this.pos=t,o},readPackedVarint:function(t,o){if(this.type!==Ea.Bytes)return t.push(this.readVarint(o));var u=Wl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(o));return t},readPackedSVarint:function(t){if(this.type!==Ea.Bytes)return t.push(this.readSVarint());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ea.Bytes)return t.push(this.readBoolean());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ea.Bytes)return t.push(this.readFloat());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ea.Bytes)return t.push(this.readDouble());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ea.Bytes)return t.push(this.readFixed32());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ea.Bytes)return t.push(this.readSFixed32());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ea.Bytes)return t.push(this.readFixed64());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ea.Bytes)return t.push(this.readSFixed64());var o=Wl(this);for(t=t||[];this.pos<o;)t.push(this.readSFixed64());return t},skip:function(t){var o=7&t;if(o===Ea.Varint)for(;this.buf[this.pos++]>127;);else if(o===Ea.Bytes)this.pos=this.readVarint()+this.pos;else if(o===Ea.Fixed32)this.pos+=4;else{if(o!==Ea.Fixed64)throw new Error("Unimplemented type: "+o);this.pos+=8}},writeTag:function(t,o){this.writeVarint(t<<3|o)},realloc:function(t){for(var o=this.length||16;o<this.pos+t;)o*=2;if(o!==this.length){var u=new Uint8Array(o);u.set(this.buf),this.buf=u,this.length=o}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),yr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),yr(this.buf,-1&t,this.pos),yr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(o,u){var h,y;if(o>=0?(h=o%4294967296|0,y=o/4294967296|0):(y=~(-o/4294967296),4294967295^(h=~(-o%4294967296))?h=h+1|0:(h=0,y=y+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,S,I){I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,b>>>=7,I.buf[I.pos++]=127&b|128,I.buf[I.pos]=127&(b>>>=7)}(h,0,u),function(b,S){var I=(7&b)<<4;S.buf[S.pos++]|=I|((b>>>=3)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b|((b>>>=7)?128:0),b&&(S.buf[S.pos++]=127&b)))))}(y,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var o=this.pos;this.pos=function(h,y,b){for(var S,I,D=0;D<y.length;D++){if((S=y.charCodeAt(D))>55295&&S<57344){if(!I){S>56319||D+1===y.length?(h[b++]=239,h[b++]=191,h[b++]=189):I=S;continue}if(S<56320){h[b++]=239,h[b++]=191,h[b++]=189,I=S;continue}S=I-55296<<10|S-56320|65536,I=null}else I&&(h[b++]=239,h[b++]=191,h[b++]=189,I=null);S<128?h[b++]=S:(S<2048?h[b++]=S>>6|192:(S<65536?h[b++]=S>>12|224:(h[b++]=S>>18|240,h[b++]=S>>12&63|128),h[b++]=S>>6&63|128),h[b++]=63&S|128)}return b}(this.buf,t,this.pos);var u=this.pos-o;u>=128&&mh(o,u,this),this.pos=o-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),lp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),lp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var o=t.length;this.writeVarint(o),this.realloc(o);for(var u=0;u<o;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,o){this.pos++;var u=this.pos;t(o,this);var h=this.pos-u;h>=128&&mh(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,o,u){this.writeTag(t,Ea.Bytes),this.writeRawMessage(o,u)},writePackedVarint:function(t,o){o.length&&this.writeMessage(t,Dd,o)},writePackedSVarint:function(t,o){o.length&&this.writeMessage(t,N,o)},writePackedBoolean:function(t,o){o.length&&this.writeMessage(t,Dt,o)},writePackedFloat:function(t,o){o.length&&this.writeMessage(t,ge,o)},writePackedDouble:function(t,o){o.length&&this.writeMessage(t,Be,o)},writePackedFixed32:function(t,o){o.length&&this.writeMessage(t,ir,o)},writePackedSFixed32:function(t,o){o.length&&this.writeMessage(t,Lt,o)},writePackedFixed64:function(t,o){o.length&&this.writeMessage(t,Jt,o)},writePackedSFixed64:function(t,o){o.length&&this.writeMessage(t,cr,o)},writeBytesField:function(t,o){this.writeTag(t,Ea.Bytes),this.writeBytes(o)},writeFixed32Field:function(t,o){this.writeTag(t,Ea.Fixed32),this.writeFixed32(o)},writeSFixed32Field:function(t,o){this.writeTag(t,Ea.Fixed32),this.writeSFixed32(o)},writeFixed64Field:function(t,o){this.writeTag(t,Ea.Fixed64),this.writeFixed64(o)},writeSFixed64Field:function(t,o){this.writeTag(t,Ea.Fixed64),this.writeSFixed64(o)},writeVarintField:function(t,o){this.writeTag(t,Ea.Varint),this.writeVarint(o)},writeSVarintField:function(t,o){this.writeTag(t,Ea.Varint),this.writeSVarint(o)},writeStringField:function(t,o){this.writeTag(t,Ea.Bytes),this.writeString(o)},writeFloatField:function(t,o){this.writeTag(t,Ea.Fixed32),this.writeFloat(o)},writeDoubleField:function(t,o){this.writeTag(t,Ea.Fixed64),this.writeDouble(o)},writeBooleanField:function(t,o){this.writeVarintField(t,Boolean(o))}};var st=function(t,o){var u=o.pixelRatio,h=o.version,y=o.stretchX,b=o.stretchY,S=o.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=y,this.stretchY=b,this.content=S,this.version=h},Vt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Vt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Vt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Vt.tlbr.get=function(){return this.tl.concat(this.br)},Vt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(st.prototype,Vt);var _r=function(t,o){var u={},h={};this.haveRenderCallbacks=[];var y=[];this.addImages(t,u,y),this.addImages(o,h,y);var b=Ar(y),S=new Bo({width:b.w||1,height:b.h||1});for(var I in t){var D=t[I],z=u[I].paddedRect;Bo.copy(D.data,S,{x:0,y:0},{x:z.x+1,y:z.y+1},D.data)}for(var j in o){var W=o[j],K=h[j].paddedRect,oe=K.x+1,Me=K.y+1,Oe=W.data.width,L=W.data.height;Bo.copy(W.data,S,{x:0,y:0},{x:oe,y:Me},W.data),Bo.copy(W.data,S,{x:0,y:L-1},{x:oe,y:Me-1},{width:Oe,height:1}),Bo.copy(W.data,S,{x:0,y:0},{x:oe,y:Me+L},{width:Oe,height:1}),Bo.copy(W.data,S,{x:Oe-1,y:0},{x:oe-1,y:Me},{width:1,height:L}),Bo.copy(W.data,S,{x:0,y:0},{x:oe+Oe,y:Me},{width:1,height:L})}this.image=S,this.iconPositions=u,this.patternPositions=h};_r.prototype.addImages=function(t,o,u){for(var h in t){var y=t[h],b={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(b),o[h]=new st(b,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},_r.prototype.patchUpdatedImages=function(t,o){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),o),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),o)},_r.prototype.patchUpdatedImage=function(t,o,u){if(t&&o&&t.version!==o.version){t.version=o.version;var h=t.tl;u.update(o.data,void 0,{x:h[0],y:h[1]})}},dn("ImagePosition",st),dn("ImageAtlas",_r);var Nr={horizontal:1,vertical:2,horizontalOnly:3},lr=function(){this.scale=1,this.fontStack="",this.imageName=null};lr.forText=function(t,o){var u=new lr;return u.scale=t||1,u.fontStack=o,u},lr.forImage=function(t){var o=new lr;return o.imageName=t,o};var Rr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function qr(t,o,u,h,y,b,S,I,D,z,j,W,K,oe,Me,Oe){var L,Ue=Rr.fromFeature(t,y);W===Nr.vertical&&Ue.verticalizePunctuation();var ot=Ps.processBidirectionalText,xt=Ps.processStyledBidirectionalText;if(ot&&Ue.sections.length===1){L=[];for(var Ut=0,Gt=ot(Ue.toString(),Xr(Ue,z,b,o,h,oe,Me));Ut<Gt.length;Ut+=1){var or=Gt[Ut],Mr=new Rr;Mr.text=or,Mr.sections=Ue.sections;for(var Fr=0;Fr<or.length;Fr++)Mr.sectionIndex.push(0);L.push(Mr)}}else if(xt){L=[];for(var Dn=0,cn=xt(Ue.text,Ue.sectionIndex,Xr(Ue,z,b,o,h,oe,Me));Dn<cn.length;Dn+=1){var Zn=cn[Dn],pn=new Rr;pn.text=Zn[0],pn.sectionIndex=Zn[1],pn.sections=Ue.sections,L.push(pn)}}else L=function(wn,Vi){for(var Ai=[],ta=wn.text,Vn=0,fa=0,eo=Vi;fa<eo.length;fa+=1){var _o=eo[fa];Ai.push(wn.substring(Vn,_o)),Vn=_o}return Vn<ta.length&&Ai.push(wn.substring(Vn,ta.length)),Ai}(Ue,Xr(Ue,z,b,o,h,oe,Me));var Ri=[],ti={positionedLines:Ri,text:Ue.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(wn,Vi,Ai,ta,Vn,fa,eo,_o,Xa,to,xo,Yo){for(var ts=0,Vs=-17,rs=0,Gs=0,ro=_o==="right"?1:_o==="left"?0:.5,fs=0,wi=0,Ba=Vn;wi<Ba.length;wi+=1){var wa=Ba[wi];wa.trim();var sa=wa.getMaxScale(),ps=24*(sa-1),As={positionedGlyphs:[],lineOffset:0};wn.positionedLines[fs]=As;var Ya=As.positionedGlyphs,Ro=0;if(wa.length()){for(var hs=0;hs<wa.length();hs++){var pa=wa.getSection(hs),ql=wa.getSectionIndex(hs),ou=wa.getCharCode(hs),of=0,Lo=null,bc=null,tl=null,Vp=24,Df=!(Xa===Nr.horizontal||!xo&&!Sf(ou)||xo&&(Bn[ou]||(Sc=ou,Zr.Arabic(Sc)||Zr["Arabic Supplement"](Sc)||Zr["Arabic Extended-A"](Sc)||Zr["Arabic Presentation Forms-A"](Sc)||Zr["Arabic Presentation Forms-B"](Sc))));if(pa.imageName){var fp=ta[pa.imageName];if(!fp)continue;tl=pa.imageName,wn.iconsInText=wn.iconsInText||!0,bc=fp.paddedRect;var Ec=fp.displaySize;pa.scale=24*pa.scale/Yo,of=ps+(24-Ec[1]*pa.scale),Vp=(Lo={width:Ec[0],height:Ec[1],left:1,top:-3,advance:Df?Ec[1]:Ec[0]}).advance;var pp=Df?Ec[0]*pa.scale-24*sa:Ec[1]*pa.scale-24*sa;pp>0&&pp>Ro&&(Ro=pp)}else{var gh=Ai[pa.fontStack],hp=gh&&gh[ou];if(hp&&hp.rect)bc=hp.rect,Lo=hp.metrics;else{var Gp=Vi[pa.fontStack],yh=Gp&&Gp[ou];if(!yh)continue;Lo=yh.metrics}of=24*(sa-pa.scale)}Df?(wn.verticalizable=!0,Ya.push({glyph:ou,imageName:tl,x:ts,y:Vs+of,vertical:Df,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:ql,metrics:Lo,rect:bc}),ts+=Vp*pa.scale+to):(Ya.push({glyph:ou,imageName:tl,x:ts,y:Vs+of,vertical:Df,scale:pa.scale,fontStack:pa.fontStack,sectionIndex:ql,metrics:Lo,rect:bc}),ts+=Lo.advance*pa.scale+to)}Ya.length!==0&&(rs=Math.max(ts-to,rs),yi(Ya,0,Ya.length-1,ro,Ro)),ts=0;var _h=fa*sa+Ro;As.lineOffset=Math.max(Ro,ps),Vs+=_h,Gs=Math.max(_h,Gs),++fs}else Vs+=fa,++fs}var Sc,Hp=Vs- -17,dp=Yr(eo),sf=dp.horizontalAlign,vp=dp.verticalAlign;(function(xh,bh,Wp,ds,Eh,Xp,Yp,qp,Sh){var mp,Ch=(bh-Wp)*Eh;mp=Xp!==Yp?-qp*ds- -17:(-ds*Sh+.5)*Yp;for(var gp=0,Kp=xh;gp<Kp.length;gp+=1)for(var Ff=0,$p=Kp[gp].positionedGlyphs;Ff<$p.length;Ff+=1){var yp=$p[Ff];yp.x+=Ch,yp.y+=mp}})(wn.positionedLines,ro,sf,vp,rs,Gs,fa,Hp,Vn.length),wn.top+=-vp*Hp,wn.bottom=wn.top+Hp,wn.left+=-sf*rs,wn.right=wn.left+rs}(ti,o,u,h,L,S,I,D,W,z,K,Oe),!function(wn){for(var Vi=0,Ai=wn;Vi<Ai.length;Vi+=1)if(Ai[Vi].positionedGlyphs.length!==0)return!1;return!0}(Ri)&&ti}Rr.fromFeature=function(t,o){for(var u=new Rr,h=0;h<t.sections.length;h++){var y=t.sections[h];y.image?u.addImageSection(y):u.addTextSection(y,o)}return u},Rr.prototype.length=function(){return this.text.length},Rr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Rr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Rr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Rr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var o="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,y=t.charCodeAt(u-1)||null;o+=h&&ll(h)&&!Hl[t[u+1]]||y&&ll(y)&&!Hl[t[u-1]]||!Hl[t[u]]?t[u]:Hl[t[u]]}return o}(this.text)},Rr.prototype.trim=function(){for(var t=0,o=0;o<this.text.length&&Bn[this.text.charCodeAt(o)];o++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Bn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},Rr.prototype.substring=function(t,o){var u=new Rr;return u.text=this.text.substring(t,o),u.sectionIndex=this.sectionIndex.slice(t,o),u.sections=this.sections,u},Rr.prototype.toString=function(){return this.text},Rr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(o,u){return Math.max(o,t.sections[u].scale)},0)},Rr.prototype.addTextSection=function(t,o){this.text+=t.text,this.sections.push(lr.forText(t.scale,t.fontStack||o));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},Rr.prototype.addImageSection=function(t){var o=t.image?t.image.name:"";if(o.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(lr.forImage(o)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},Rr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},er={};function nr(t,o,u,h,y,b){if(o.imageName){var S=h[o.imageName];return S?S.displaySize[0]*o.scale*24/b+y:0}var I=u[o.fontStack],D=I&&I[t];return D?D.metrics.advance*o.scale+y:0}function xn(t,o,u,h){var y=Math.pow(t-o,2);return h?t<o?y/2:2*y:y+Math.abs(u)*u}function Vr(t,o,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),o!==41&&o!==65289||(h+=50),h}function Er(t,o,u,h,y,b){for(var S=null,I=xn(o,u,y,b),D=0,z=h;D<z.length;D+=1){var j=z[D],W=xn(o-j.x,u,y,b)+j.badness;W<=I&&(S=j,I=W)}return{index:t,x:o,priorBreak:S,badness:I}}function Xr(t,o,u,h,y,b,S){if(b!=="point")return[];if(!t)return[];for(var I,D=[],z=function(L,Ue,ot,xt,Ut,Gt){for(var or=0,Mr=0;Mr<L.length();Mr++){var Fr=L.getSection(Mr);or+=nr(L.getCharCode(Mr),Fr,xt,Ut,Ue,Gt)}return or/Math.max(1,Math.ceil(or/ot))}(t,o,u,h,y,S),j=t.text.indexOf("\u200B")>=0,W=0,K=0;K<t.length();K++){var oe=t.getSection(K),Me=t.getCharCode(K);if(Bn[Me]||(W+=nr(Me,oe,h,y,o,S)),K<t.length()-1){var Oe=!((I=Me)<11904||!(Zr["Bopomofo Extended"](I)||Zr.Bopomofo(I)||Zr["CJK Compatibility Forms"](I)||Zr["CJK Compatibility Ideographs"](I)||Zr["CJK Compatibility"](I)||Zr["CJK Radicals Supplement"](I)||Zr["CJK Strokes"](I)||Zr["CJK Symbols and Punctuation"](I)||Zr["CJK Unified Ideographs Extension A"](I)||Zr["CJK Unified Ideographs"](I)||Zr["Enclosed CJK Letters and Months"](I)||Zr["Halfwidth and Fullwidth Forms"](I)||Zr.Hiragana(I)||Zr["Ideographic Description Characters"](I)||Zr["Kangxi Radicals"](I)||Zr["Katakana Phonetic Extensions"](I)||Zr.Katakana(I)||Zr["Vertical Forms"](I)||Zr["Yi Radicals"](I)||Zr["Yi Syllables"](I)));(er[Me]||Oe||oe.imageName)&&D.push(Er(K+1,W,z,D,Vr(Me,t.getCharCode(K+1),Oe&&j),!1))}}return function L(Ue){return Ue?L(Ue.priorBreak).concat(Ue.index):[]}(Er(t.length(),W,z,D,0,!0))}function Yr(t){var o=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:o,verticalAlign:u}}function yi(t,o,u,h,y){if(h||y)for(var b=t[u],S=(t[u].x+b.metrics.advance*b.scale)*h,I=o;I<=u;I++)t[I].x-=S,t[I].y+=y}function oi(t,o,u,h,y,b){var S,I=t.image;if(I.content){var D=I.content,z=I.pixelRatio||1;S=[D[0]/z,D[1]/z,I.displaySize[0]-D[2]/z,I.displaySize[1]-D[3]/z]}var j,W,K,oe,Me=o.left*b,Oe=o.right*b;u==="width"||u==="both"?(oe=y[0]+Me-h[3],W=y[0]+Oe+h[1]):W=(oe=y[0]+(Me+Oe-I.displaySize[0])/2)+I.displaySize[0];var L=o.top*b,Ue=o.bottom*b;return u==="height"||u==="both"?(j=y[1]+L-h[0],K=y[1]+Ue+h[2]):K=(j=y[1]+(L+Ue-I.displaySize[1])/2)+I.displaySize[1],{image:I,top:j,right:W,bottom:K,left:oe,collisionPadding:S}}er[10]=!0,er[32]=!0,er[38]=!0,er[40]=!0,er[41]=!0,er[43]=!0,er[45]=!0,er[47]=!0,er[173]=!0,er[183]=!0,er[8203]=!0,er[8208]=!0,er[8211]=!0,er[8231]=!0;var Gr=function(t){function o(u,h,y,b){t.call(this,u,h),this.angle=y,b!==void 0&&(this.segment=b)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.clone=function(){return new o(this.x,this.y,this.angle,this.segment)},o}(ce);function rn(t,o){var u=o.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Ti(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,y=u.interpolationType,b=0;b<h.length&&h[b]<=t;)b++;for(var S=b=Math.max(0,b-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var I=h[b],D=h[S];return u.kind==="composite"?{kind:"composite",minZoom:I,maxZoom:D,interpolationType:y}:{kind:"camera",minZoom:I,maxZoom:D,minSize:u.evaluate(new Ti(I)),maxSize:u.evaluate(new Ti(D)),interpolationType:y}}function Jn(t,o,u){var h=o.uSize,y=u.lowerSize;return t.kind==="source"?y/128:t.kind==="composite"?ga(y/128,u.upperSize/128,o.uSizeT):h}function ci(t,o){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var y=t.interpolationType,b=y?gt(xe.interpolationFactor(y,o,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=ga(t.minSize,t.maxSize,b):u=b}return{uSizeT:u,uSize:h}}dn("Anchor",Gr);var zi=Object.freeze({__proto__:null,getSizeData:rn,evaluateSizeForFeature:Jn,evaluateSizeForZoom:ci,SIZE_PACK_FACTOR:128});function so(t,o,u,h,y){if(o.segment===void 0)return!0;for(var b=o,S=o.segment+1,I=0;I>-u/2;){if(--S<0)return!1;I-=t[S].dist(b),b=t[S]}I+=t[S].dist(t[S+1]),S++;for(var D=[],z=0;I<u/2;){var j=t[S],W=t[S+1];if(!W)return!1;var K=t[S-1].angleTo(j)-j.angleTo(W);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:I,angleDelta:K}),z+=K;I-D[0].distance>h;)z-=D.shift().angleDelta;if(z>y)return!1;S++,I+=j.dist(W)}return!0}function uo(t){for(var o=0,u=0;u<t.length-1;u++)o+=t[u].dist(t[u+1]);return o}function Bi(t,o,u){return t?.6*o*u:0}function es(t,o){return Math.max(t?t.right-t.left:0,o?o.right-o.left:0)}function Va(t,o,u,h,y,b){for(var S=Bi(u,y,b),I=es(u,h)*b,D=0,z=uo(t)/2,j=0;j<t.length-1;j++){var W=t[j],K=t[j+1],oe=W.dist(K);if(D+oe>z){var Me=(z-D)/oe,Oe=ga(W.x,K.x,Me),L=ga(W.y,K.y,Me),Ue=new Gr(Oe,L,K.angleTo(W),j);return Ue._round(),!S||so(t,Ue,I,S,o)?Ue:void 0}D+=oe}}function No(t,o,u,h,y,b,S,I,D){var z=Bi(h,b,S),j=es(h,y),W=j*S,K=t[0].x===0||t[0].x===D||t[0].y===0||t[0].y===D;return o-W<o/4&&(o=W+o/4),function oe(Me,Oe,L,Ue,ot,xt,Ut,Gt,or){for(var Mr=xt/2,Fr=uo(Me),Dn=0,cn=Oe-L,Zn=[],pn=0;pn<Me.length-1;pn++){for(var Ri=Me[pn],ti=Me[pn+1],wn=Ri.dist(ti),Vi=ti.angleTo(Ri);cn+L<Dn+wn;){var Ai=((cn+=L)-Dn)/wn,ta=ga(Ri.x,ti.x,Ai),Vn=ga(Ri.y,ti.y,Ai);if(ta>=0&&ta<or&&Vn>=0&&Vn<or&&cn-Mr>=0&&cn+Mr<=Fr){var fa=new Gr(ta,Vn,Vi,pn);fa._round(),Ue&&!so(Me,fa,xt,Ue,ot)||Zn.push(fa)}}Dn+=wn}return Gt||Zn.length||Ut||(Zn=oe(Me,Dn/2,L,Ue,ot,xt,Ut,!0,or)),Zn}(t,K?o/2*I%o:(j/2+2*b)*S*I%o,o,z,u,W,K,!1,D)}function So(t,o,u,h,y){for(var b=[],S=0;S<t.length;S++)for(var I=t[S],D=void 0,z=0;z<I.length-1;z++){var j=I[z],W=I[z+1];j.x<o&&W.x<o||(j.x<o?j=new ce(o,j.y+(o-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x<o&&(W=new ce(o,j.y+(o-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y<u&&W.y<u||(j.y<u?j=new ce(j.x+(u-j.y)/(W.y-j.y)*(W.x-j.x),u)._round():W.y<u&&(W=new ce(j.x+(u-j.y)/(W.y-j.y)*(W.x-j.x),u)._round()),j.x>=h&&W.x>=h||(j.x>=h?j=new ce(h,j.y+(h-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x>=h&&(W=new ce(h,j.y+(h-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y>=y&&W.y>=y||(j.y>=y?j=new ce(j.x+(y-j.y)/(W.y-j.y)*(W.x-j.x),y)._round():W.y>=y&&(W=new ce(j.x+(y-j.y)/(W.y-j.y)*(W.x-j.x),y)._round()),D&&j.equals(D[D.length-1])||b.push(D=[j]),D.push(W)))))}return b}function Wo(t,o,u,h){var y=[],b=t.image,S=b.pixelRatio,I=b.paddedRect.w-2,D=b.paddedRect.h-2,z=t.right-t.left,j=t.bottom-t.top,W=b.stretchX||[[0,I]],K=b.stretchY||[[0,D]],oe=function(ta,Vn){return ta+Vn[1]-Vn[0]},Me=W.reduce(oe,0),Oe=K.reduce(oe,0),L=I-Me,Ue=D-Oe,ot=0,xt=Me,Ut=0,Gt=Oe,or=0,Mr=L,Fr=0,Dn=Ue;if(b.content&&h){var cn=b.content;ot=Io(W,0,cn[0]),Ut=Io(K,0,cn[1]),xt=Io(W,cn[0],cn[2]),Gt=Io(K,cn[1],cn[3]),or=cn[0]-ot,Fr=cn[1]-Ut,Mr=cn[2]-cn[0]-xt,Dn=cn[3]-cn[1]-Gt}var Zn=function(ta,Vn,fa,eo){var _o=ho(ta.stretch-ot,xt,z,t.left),Xa=_i(ta.fixed-or,Mr,ta.stretch,Me),to=ho(Vn.stretch-Ut,Gt,j,t.top),xo=_i(Vn.fixed-Fr,Dn,Vn.stretch,Oe),Yo=ho(fa.stretch-ot,xt,z,t.left),ts=_i(fa.fixed-or,Mr,fa.stretch,Me),Vs=ho(eo.stretch-Ut,Gt,j,t.top),rs=_i(eo.fixed-Fr,Dn,eo.stretch,Oe),Gs=new ce(_o,to),ro=new ce(Yo,to),fs=new ce(Yo,Vs),wi=new ce(_o,Vs),Ba=new ce(Xa/S,xo/S),wa=new ce(ts/S,rs/S),sa=o*Math.PI/180;if(sa){var ps=Math.sin(sa),As=Math.cos(sa),Ya=[As,-ps,ps,As];Gs._matMult(Ya),ro._matMult(Ya),wi._matMult(Ya),fs._matMult(Ya)}var Ro=ta.stretch+ta.fixed,hs=Vn.stretch+Vn.fixed;return{tl:Gs,tr:ro,bl:wi,br:fs,tex:{x:b.paddedRect.x+1+Ro,y:b.paddedRect.y+1+hs,w:fa.stretch+fa.fixed-Ro,h:eo.stretch+eo.fixed-hs},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ba,pixelOffsetBR:wa,minFontScaleX:Mr/S/z,minFontScaleY:Dn/S/j,isSDF:u}};if(h&&(b.stretchX||b.stretchY))for(var pn=us(W,L,Me),Ri=us(K,Ue,Oe),ti=0;ti<pn.length-1;ti++)for(var wn=pn[ti],Vi=pn[ti+1],Ai=0;Ai<Ri.length-1;Ai++)y.push(Zn(wn,Ri[Ai],Vi,Ri[Ai+1]));else y.push(Zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:I+1},{fixed:0,stretch:D+1}));return y}function Io(t,o,u){for(var h=0,y=0,b=t;y<b.length;y+=1){var S=b[y];h+=Math.max(o,Math.min(u,S[1]))-Math.max(o,Math.min(u,S[0]))}return h}function us(t,o,u){for(var h=[{fixed:-1,stretch:0}],y=0,b=t;y<b.length;y+=1){var S=b[y],I=S[0],D=S[1],z=h[h.length-1];h.push({fixed:I-z.stretch,stretch:z.stretch}),h.push({fixed:I-z.stretch,stretch:z.stretch+(D-I)})}return h.push({fixed:o+1,stretch:u}),h}function ho(t,o,u,h){return t/o*u+h}function _i(t,o,u,h){return t-o*u/h}var Oo=function(t,o,u,h,y,b,S,I,D,z){if(this.boxStartIndex=t.length,D){var j=b.top,W=b.bottom,K=b.collisionPadding;K&&(j-=K[1],W+=K[3]);var oe=W-j;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{var Me=b.top*S-I,Oe=b.bottom*S+I,L=b.left*S-I,Ue=b.right*S+I,ot=b.collisionPadding;if(ot&&(L-=ot[0]*S,Me-=ot[1]*S,Ue+=ot[2]*S,Oe+=ot[3]*S),z){var xt=new ce(L,Me),Ut=new ce(Ue,Me),Gt=new ce(L,Oe),or=new ce(Ue,Oe),Mr=z*Math.PI/180;xt._rotate(Mr),Ut._rotate(Mr),Gt._rotate(Mr),or._rotate(Mr),L=Math.min(xt.x,Ut.x,Gt.x,or.x),Ue=Math.max(xt.x,Ut.x,Gt.x,or.x),Me=Math.min(xt.y,Ut.y,Gt.y,or.y),Oe=Math.max(xt.y,Ut.y,Gt.y,or.y)}t.emplaceBack(o.x,o.y,L,Me,Ue,Oe,u,h,y)}this.boxEndIndex=t.length},ea=function(t,o){if(t===void 0&&(t=[]),o===void 0&&(o=zo),this.data=t,this.length=this.data.length,this.compare=o,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function zo(t,o){return t<o?-1:t>o?1:0}function ri(t,o,u){o===void 0&&(o=1),u===void 0&&(u=!1);for(var h=1/0,y=1/0,b=-1/0,S=-1/0,I=t[0],D=0;D<I.length;D++){var z=I[D];(!D||z.x<h)&&(h=z.x),(!D||z.y<y)&&(y=z.y),(!D||z.x>b)&&(b=z.x),(!D||z.y>S)&&(S=z.y)}var j=Math.min(b-h,S-y),W=j/2,K=new ea([],Ui);if(j===0)return new ce(h,y);for(var oe=h;oe<b;oe+=j)for(var Me=y;Me<S;Me+=j)K.push(new va(oe+W,Me+W,W,t));for(var Oe=function(ot){for(var xt=0,Ut=0,Gt=0,or=ot[0],Mr=0,Fr=or.length,Dn=Fr-1;Mr<Fr;Dn=Mr++){var cn=or[Mr],Zn=or[Dn],pn=cn.x*Zn.y-Zn.x*cn.y;Ut+=(cn.x+Zn.x)*pn,Gt+=(cn.y+Zn.y)*pn,xt+=3*pn}return new va(Ut/xt,Gt/xt,0,ot)}(t),L=K.length;K.length;){var Ue=K.pop();(Ue.d>Oe.d||!Oe.d)&&(Oe=Ue,u&&console.log("found best %d after %d probes",Math.round(1e4*Ue.d)/1e4,L)),Ue.max-Oe.d<=o||(K.push(new va(Ue.p.x-(W=Ue.h/2),Ue.p.y-W,W,t)),K.push(new va(Ue.p.x+W,Ue.p.y-W,W,t)),K.push(new va(Ue.p.x-W,Ue.p.y+W,W,t)),K.push(new va(Ue.p.x+W,Ue.p.y+W,W,t)),L+=4)}return u&&(console.log("num probes: "+L),console.log("best distance: "+Oe.d)),Oe.p}function Ui(t,o){return o.max-t.max}function va(t,o,u,h){this.p=new ce(t,o),this.h=u,this.d=function(y,b){for(var S=!1,I=1/0,D=0;D<b.length;D++)for(var z=b[D],j=0,W=z.length,K=W-1;j<W;K=j++){var oe=z[j],Me=z[K];oe.y>y.y!=Me.y>y.y&&y.x<(Me.x-oe.x)*(y.y-oe.y)/(Me.y-oe.y)+oe.x&&(S=!S),I=Math.min(I,gl(y,oe,Me))}return(S?1:-1)*Math.sqrt(I)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ea.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ea.prototype.pop=function(){if(this.length!==0){var t=this.data[0],o=this.data.pop();return this.length--,this.length>0&&(this.data[0]=o,this._down(0)),t}},ea.prototype.peek=function(){return this.data[0]},ea.prototype._up=function(t){for(var o=this.data,u=this.compare,h=o[t];t>0;){var y=t-1>>1,b=o[y];if(u(h,b)>=0)break;o[t]=b,t=y}o[t]=h},ea.prototype._down=function(t){for(var o=this.data,u=this.compare,h=this.length>>1,y=o[t];t<h;){var b=1+(t<<1),S=o[b],I=b+1;if(I<this.length&&u(o[I],S)<0&&(b=I,S=o[I]),u(S,y)>=0)break;o[t]=S,t=b}o[t]=y};var Nn=Number.POSITIVE_INFINITY;function si(t,o){return o[1]!==Nn?function(u,h,y){var b=0,S=0;switch(h=Math.abs(h),y=Math.abs(y),u){case"top-right":case"top-left":case"top":S=y-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-y}switch(u){case"top-right":case"bottom-right":case"right":b=-h;break;case"top-left":case"bottom-left":case"left":b=h}return[b,S]}(t,o[0],o[1]):function(u,h){var y=0,b=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":b=S-7;break;case"bottom-right":case"bottom-left":b=7-S;break;case"bottom":b=7-h;break;case"top":b=h-7}switch(u){case"top-right":case"bottom-right":y=-S;break;case"top-left":case"bottom-left":y=S;break;case"left":y=h;break;case"right":y=-h}return[y,b]}(t,o[0])}function Te(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function zt(t,o,u,h,y,b,S,I,D,z,j,W,K,oe,Me){var Oe=function(Ut,Gt,or,Mr,Fr,Dn,cn,Zn){for(var pn=Mr.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,Ri=[],ti=0,wn=Gt.positionedLines;ti<wn.length;ti+=1)for(var Vi=wn[ti],Ai=0,ta=Vi.positionedGlyphs;Ai<ta.length;Ai+=1){var Vn=ta[Ai];if(Vn.rect){var fa=Vn.rect||{},eo=4,_o=!0,Xa=1,to=0,xo=(Fr||Zn)&&Vn.vertical,Yo=Vn.metrics.advance*Vn.scale/2;if(Zn&&Gt.verticalizable&&(to=Vi.lineOffset/2-(Vn.imageName?-(24-Vn.metrics.width*Vn.scale)/2:24*(Vn.scale-1))),Vn.imageName){var ts=cn[Vn.imageName];_o=ts.sdf,eo=1/(Xa=ts.pixelRatio)}var Vs=Fr?[Vn.x+Yo,Vn.y]:[0,0],rs=Fr?[0,0]:[Vn.x+Yo+or[0],Vn.y+or[1]-to],Gs=[0,0];xo&&(Gs=rs,rs=[0,0]);var ro=(Vn.metrics.left-eo)*Vn.scale-Yo+rs[0],fs=(-Vn.metrics.top-eo)*Vn.scale+rs[1],wi=ro+fa.w*Vn.scale/Xa,Ba=fs+fa.h*Vn.scale/Xa,wa=new ce(ro,fs),sa=new ce(wi,fs),ps=new ce(ro,Ba),As=new ce(wi,Ba);if(xo){var Ya=new ce(-Yo,Yo- -17),Ro=-Math.PI/2,hs=12-Yo,pa=new ce(22-hs,-(Vn.imageName?hs:0)),ql=new(Function.prototype.bind.apply(ce,[null].concat(Gs)));wa._rotateAround(Ro,Ya)._add(pa)._add(ql),sa._rotateAround(Ro,Ya)._add(pa)._add(ql),ps._rotateAround(Ro,Ya)._add(pa)._add(ql),As._rotateAround(Ro,Ya)._add(pa)._add(ql)}if(pn){var ou=Math.sin(pn),of=Math.cos(pn),Lo=[of,-ou,ou,of];wa._matMult(Lo),sa._matMult(Lo),ps._matMult(Lo),As._matMult(Lo)}var bc=new ce(0,0),tl=new ce(0,0);Ri.push({tl:wa,tr:sa,bl:ps,br:As,tex:fa,writingMode:Gt.writingMode,glyphOffset:Vs,sectionIndex:Vn.sectionIndex,isSDF:_o,pixelOffsetTL:bc,pixelOffsetBR:tl,minFontScaleX:0,minFontScaleY:0})}}return Ri}(0,u,I,y,b,S,h,t.allowVerticalPlacement),L=t.textSizeData,Ue=null;L.kind==="source"?(Ue=[128*y.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):L.kind==="composite"&&((Ue=[128*oe.compositeTextSizes[0].evaluate(S,{},Me),128*oe.compositeTextSizes[1].evaluate(S,{},Me)])[0]>32640||Ue[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,Ue,I,b,S,z,o,D.lineStartIndex,D.lineLength,K,Me);for(var ot=0,xt=j;ot<xt.length;ot+=1)W[xt[ot]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function Et(t){for(var o in t)return t[o];return null}function vn(t,o,u,h){var y=t.compareText;if(o in y){for(var b=y[o],S=b.length-1;S>=0;S--)if(h.dist(b[S])<u)return!0}else y[o]=[];return y[o].push(h),!1}var Wi=Eu.VectorTileFeature.types,Ce=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function se(t,o,u,h,y,b,S,I,D,z,j,W,K){var oe=I?Math.min(32640,Math.round(I[0])):0,Me=I?Math.min(32640,Math.round(I[1])):0;t.emplaceBack(o,u,Math.round(32*h),Math.round(32*y),b,S,(oe<<1)+(D?1:0),Me,16*z,16*j,256*W,256*K)}function Ge(t,o,u){t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u),t.emplaceBack(o.x,o.y,u)}function lt(t){for(var o=0,u=t.sections;o<u.length;o+=1)if(Cf(u[o].text))return!0;return!1}var Ot=function(t){this.layoutVertexArray=new hl,this.indexArray=new dl,this.programConfigurations=t,this.segments=new pe,this.dynamicLayoutVertexArray=new ku,this.opacityVertexArray=new Qu,this.placedSymbolArray=new d};Ot.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Ot.prototype.upload=function(t,o,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ld.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,o),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Np.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Ce,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},Ot.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},dn("SymbolBuffers",Ot);var qe=function(t,o,u){this.layoutVertexArray=new t,this.layoutAttributes=o,this.indexArray=new u,this.segments=new pe,this.collisionVertexArray=new Nl};qe.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,kd.members,!0)},qe.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},dn("CollisionBuffers",qe);var Fe=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(b){return b.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=zs([]),this.placementViewportMatrix=zs([]);var o=this.layers[0]._unevaluatedLayout._values;this.textSizeData=rn(this.zoom,o["text-size"]),this.iconSizeData=rn(this.zoom,o["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(b){return Nr[b]})),this.stateDependentLayerIds=this.layers.filter(function(b){return b.isStateDependent()}).map(function(b){return b.id}),this.sourceID=t.sourceID};Fe.prototype.createArrays=function(){this.text=new Ot(new Hn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new Ot(new Hn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new P,this.lineVertexArray=new k,this.symbolInstances=new w},Fe.prototype.calculateGlyphDependencies=function(t,o,u,h,y){for(var b=0;b<t.length;b++)if(o[t.charCodeAt(b)]=!0,(u||h)&&y){var S=Hl[t.charAt(b)];S&&(o[S.charCodeAt(0)]=!0)}},Fe.prototype.populate=function(t,o,u){var h=this.layers[0],y=h.layout,b=y.get("text-font"),S=y.get("text-field"),I=y.get("icon-image"),D=(S.value.kind!=="constant"||S.value.value instanceof _t&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),z=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,j=y.get("symbol-sort-key");if(this.features=[],D||z){for(var W=o.iconDependencies,K=o.glyphDependencies,oe=o.availableImages,Me=new Ti(this.zoom),Oe=0,L=t;Oe<L.length;Oe+=1){var Ue=L[Oe],ot=Ue.feature,xt=Ue.id,Ut=Ue.index,Gt=Ue.sourceLayerIndex,or=h._featureFilter.needGeometry,Mr=po(ot,or);if(h._featureFilter.filter(Me,Mr,u)){or||(Mr.geometry=Wa(ot));var Fr=void 0;if(D){var Dn=h.getValueAndResolveTokens("text-field",Mr,u,oe),cn=_t.factory(Dn);lt(cn)&&(this.hasRTLText=!0),(!this.hasRTLText||Af()==="unavailable"||this.hasRTLText&&Ps.isParsed())&&(Fr=up(cn,h,Mr))}var Zn=void 0;if(z){var pn=h.getValueAndResolveTokens("icon-image",Mr,u,oe);Zn=pn instanceof na?pn:na.fromString(pn)}if(Fr||Zn){var Ri=this.sortFeaturesByKey?j.evaluate(Mr,{},u):void 0;if(this.features.push({id:xt,text:Fr,icon:Zn,index:Ut,sourceLayerIndex:Gt,geometry:Mr.geometry,properties:ot.properties,type:Wi[ot.type],sortKey:Ri}),Zn&&(W[Zn.name]=!0),Fr){var ti=b.evaluate(Mr,{},u).join(","),wn=y.get("text-rotation-alignment")==="map"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nr.vertical)>=0;for(var Vi=0,Ai=Fr.sections;Vi<Ai.length;Vi+=1){var ta=Ai[Vi];if(ta.image)W[ta.image.name]=!0;else{var Vn=lc(Fr.toString()),fa=ta.fontStack||ti,eo=K[fa]=K[fa]||{};this.calculateGlyphDependencies(ta.text,eo,wn,this.allowVerticalPlacement,Vn)}}}}}}y.get("symbol-placement")==="line"&&(this.features=function(_o){var Xa={},to={},xo=[],Yo=0;function ts(Ya){xo.push(_o[Ya]),Yo++}function Vs(Ya,Ro,hs){var pa=to[Ya];return delete to[Ya],to[Ro]=pa,xo[pa].geometry[0].pop(),xo[pa].geometry[0]=xo[pa].geometry[0].concat(hs[0]),pa}function rs(Ya,Ro,hs){var pa=Xa[Ro];return delete Xa[Ro],Xa[Ya]=pa,xo[pa].geometry[0].shift(),xo[pa].geometry[0]=hs[0].concat(xo[pa].geometry[0]),pa}function Gs(Ya,Ro,hs){var pa=hs?Ro[0][Ro[0].length-1]:Ro[0][0];return Ya+":"+pa.x+":"+pa.y}for(var ro=0;ro<_o.length;ro++){var fs=_o[ro],wi=fs.geometry,Ba=fs.text?fs.text.toString():null;if(Ba){var wa=Gs(Ba,wi),sa=Gs(Ba,wi,!0);if(wa in to&&sa in Xa&&to[wa]!==Xa[sa]){var ps=rs(wa,sa,wi),As=Vs(wa,sa,xo[ps].geometry);delete Xa[wa],delete to[sa],to[Gs(Ba,xo[As].geometry,!0)]=As,xo[ps].geometry=null}else wa in to?Vs(wa,sa,wi):sa in Xa?rs(wa,sa,wi):(ts(ro),Xa[wa]=Yo-1,to[sa]=Yo-1)}else ts(ro)}return xo.filter(function(Ya){return Ya.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(_o,Xa){return _o.sortKey-Xa.sortKey})}},Fe.prototype.update=function(t,o,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,o,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,o,this.layers,u))},Fe.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Fe.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Fe.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Fe.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Fe.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Fe.prototype.addToLineVertexArray=function(t,o){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(o[t.segment+1]),y=t.dist(o[t.segment]),b={},S=t.segment+1;S<o.length;S++)b[S]={x:o[S].x,y:o[S].y,tileUnitDistanceFromAnchor:h},S<o.length-1&&(h+=o[S+1].dist(o[S]));for(var I=t.segment||0;I>=0;I--)b[I]={x:o[I].x,y:o[I].y,tileUnitDistanceFromAnchor:y},I>0&&(y+=o[I-1].dist(o[I]));for(var D=0;D<o.length;D++){var z=b[D];this.lineVertexArray.emplaceBack(z.x,z.y,z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Fe.prototype.addSymbols=function(t,o,u,h,y,b,S,I,D,z,j,W){for(var K=t.indexArray,oe=t.layoutVertexArray,Me=t.segments.prepareSegment(4*o.length,oe,K,this.canOverlap?b.sortKey:void 0),Oe=this.glyphOffsetArray.length,L=Me.vertexLength,Ue=this.allowVerticalPlacement&&S===Nr.vertical?Math.PI/2:0,ot=b.text&&b.text.sections,xt=0;xt<o.length;xt++){var Ut=o[xt],Gt=Ut.tl,or=Ut.tr,Mr=Ut.bl,Fr=Ut.br,Dn=Ut.tex,cn=Ut.pixelOffsetTL,Zn=Ut.pixelOffsetBR,pn=Ut.minFontScaleX,Ri=Ut.minFontScaleY,ti=Ut.glyphOffset,wn=Ut.isSDF,Vi=Ut.sectionIndex,Ai=Me.vertexLength,ta=ti[1];se(oe,I.x,I.y,Gt.x,ta+Gt.y,Dn.x,Dn.y,u,wn,cn.x,cn.y,pn,Ri),se(oe,I.x,I.y,or.x,ta+or.y,Dn.x+Dn.w,Dn.y,u,wn,Zn.x,cn.y,pn,Ri),se(oe,I.x,I.y,Mr.x,ta+Mr.y,Dn.x,Dn.y+Dn.h,u,wn,cn.x,Zn.y,pn,Ri),se(oe,I.x,I.y,Fr.x,ta+Fr.y,Dn.x+Dn.w,Dn.y+Dn.h,u,wn,Zn.x,Zn.y,pn,Ri),Ge(t.dynamicLayoutVertexArray,I,Ue),K.emplaceBack(Ai,Ai+1,Ai+2),K.emplaceBack(Ai+1,Ai+2,Ai+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ti[0]),xt!==o.length-1&&Vi===o[xt+1].sectionIndex||t.programConfigurations.populatePaintArrays(oe.length,b,b.index,{},W,ot&&ot[Vi])}t.placedSymbolArray.emplaceBack(I.x,I.y,Oe,this.glyphOffsetArray.length-Oe,L,D,z,I.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,j)},Fe.prototype._addCollisionDebugVertex=function(t,o,u,h,y,b){return o.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,y,Math.round(b.x),Math.round(b.y))},Fe.prototype.addCollisionDebugVertices=function(t,o,u,h,y,b,S){var I=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),D=I.vertexLength,z=y.layoutVertexArray,j=y.collisionVertexArray,W=S.anchorX,K=S.anchorY;this._addCollisionDebugVertex(z,j,b,W,K,new ce(t,o)),this._addCollisionDebugVertex(z,j,b,W,K,new ce(u,o)),this._addCollisionDebugVertex(z,j,b,W,K,new ce(u,h)),this._addCollisionDebugVertex(z,j,b,W,K,new ce(t,h)),I.vertexLength+=4;var oe=y.indexArray;oe.emplaceBack(D,D+1),oe.emplaceBack(D+1,D+2),oe.emplaceBack(D+2,D+3),oe.emplaceBack(D+3,D),I.primitiveLength+=4},Fe.prototype.addDebugCollisionBoxes=function(t,o,u,h){for(var y=t;y<o;y++){var b=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,h?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,u)}},Fe.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qe(Ia,vh.members,zl),this.iconCollisionBox=new qe(Ia,vh.members,zl);for(var t=0;t<this.symbolInstances.length;t++){var o=this.symbolInstances.get(t);this.addDebugCollisionBoxes(o.textBoxStartIndex,o.textBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o,!0),this.addDebugCollisionBoxes(o.iconBoxStartIndex,o.iconBoxEndIndex,o,!1),this.addDebugCollisionBoxes(o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o,!1)}},Fe.prototype._deserializeCollisionBoxesForSymbol=function(t,o,u,h,y,b,S,I,D){for(var z={},j=o;j<u;j++){var W=t.get(j);z.textBox={x1:W.x1,y1:W.y1,x2:W.x2,y2:W.y2,anchorPointX:W.anchorPointX,anchorPointY:W.anchorPointY},z.textFeatureIndex=W.featureIndex;break}for(var K=h;K<y;K++){var oe=t.get(K);z.verticalTextBox={x1:oe.x1,y1:oe.y1,x2:oe.x2,y2:oe.y2,anchorPointX:oe.anchorPointX,anchorPointY:oe.anchorPointY},z.verticalTextFeatureIndex=oe.featureIndex;break}for(var Me=b;Me<S;Me++){var Oe=t.get(Me);z.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},z.iconFeatureIndex=Oe.featureIndex;break}for(var L=I;L<D;L++){var Ue=t.get(L);z.verticalIconBox={x1:Ue.x1,y1:Ue.y1,x2:Ue.x2,y2:Ue.y2,anchorPointX:Ue.anchorPointX,anchorPointY:Ue.anchorPointY},z.verticalIconFeatureIndex=Ue.featureIndex;break}return z},Fe.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Fe.prototype.hasTextData=function(){return this.text.segments.get().length>0},Fe.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Fe.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Fe.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Fe.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Fe.prototype.addIndicesForPlacedSymbol=function(t,o){for(var u=t.placedSymbolArray.get(o),h=u.vertexStartIndex+4*u.numGlyphs,y=u.vertexStartIndex;y<h;y+=4)t.indexArray.emplaceBack(y,y+1,y+2),t.indexArray.emplaceBack(y+1,y+2,y+3)},Fe.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var o=Math.sin(t),u=Math.cos(t),h=[],y=[],b=[],S=0;S<this.symbolInstances.length;++S){b.push(S);var I=this.symbolInstances.get(S);h.push(0|Math.round(o*I.anchorX+u*I.anchorY)),y.push(I.featureIndex)}return b.sort(function(D,z){return h[D]-h[z]||y[z]-y[D]}),b},Fe.prototype.addToSortKeyRanges=function(t,o){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===o?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:o,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Fe.prototype.sortFeatures=function(t){var o=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var y=this.symbolInstances.get(h[u]);this.featureSortOrder.push(y.featureIndex),[y.rightJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.leftJustifiedTextSymbolIndex].forEach(function(b,S,I){b>=0&&I.indexOf(b)===S&&o.addIndicesForPlacedSymbol(o.text,b)}),y.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,y.verticalPlacedTextSymbolIndex),y.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.placedIconSymbolIndex),y.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,y.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},dn("SymbolBucket",Fe,{omit:["layers","collisionBoxArray","features","compareText"]}),Fe.MAX_GLYPHS=65535,Fe.addDynamicAttributes=Ge;var rt=new Ho({"symbol-placement":new On(fe.layout_symbol["symbol-placement"]),"symbol-spacing":new On(fe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(fe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Cn(fe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(fe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(fe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(fe.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(fe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(fe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Cn(fe.layout_symbol["icon-size"]),"icon-text-fit":new On(fe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(fe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Cn(fe.layout_symbol["icon-image"]),"icon-rotate":new Cn(fe.layout_symbol["icon-rotate"]),"icon-padding":new On(fe.layout_symbol["icon-padding"]),"icon-keep-upright":new On(fe.layout_symbol["icon-keep-upright"]),"icon-offset":new Cn(fe.layout_symbol["icon-offset"]),"icon-anchor":new Cn(fe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(fe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(fe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(fe.layout_symbol["text-rotation-alignment"]),"text-field":new Cn(fe.layout_symbol["text-field"]),"text-font":new Cn(fe.layout_symbol["text-font"]),"text-size":new Cn(fe.layout_symbol["text-size"]),"text-max-width":new Cn(fe.layout_symbol["text-max-width"]),"text-line-height":new On(fe.layout_symbol["text-line-height"]),"text-letter-spacing":new Cn(fe.layout_symbol["text-letter-spacing"]),"text-justify":new Cn(fe.layout_symbol["text-justify"]),"text-radial-offset":new Cn(fe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(fe.layout_symbol["text-variable-anchor"]),"text-anchor":new Cn(fe.layout_symbol["text-anchor"]),"text-max-angle":new On(fe.layout_symbol["text-max-angle"]),"text-writing-mode":new On(fe.layout_symbol["text-writing-mode"]),"text-rotate":new Cn(fe.layout_symbol["text-rotate"]),"text-padding":new On(fe.layout_symbol["text-padding"]),"text-keep-upright":new On(fe.layout_symbol["text-keep-upright"]),"text-transform":new Cn(fe.layout_symbol["text-transform"]),"text-offset":new Cn(fe.layout_symbol["text-offset"]),"text-allow-overlap":new On(fe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(fe.layout_symbol["text-ignore-placement"]),"text-optional":new On(fe.layout_symbol["text-optional"])}),_e={paint:new Ho({"icon-opacity":new Cn(fe.paint_symbol["icon-opacity"]),"icon-color":new Cn(fe.paint_symbol["icon-color"]),"icon-halo-color":new Cn(fe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Cn(fe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Cn(fe.paint_symbol["icon-halo-blur"]),"icon-translate":new On(fe.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(fe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Cn(fe.paint_symbol["text-opacity"]),"text-color":new Cn(fe.paint_symbol["text-color"],{runtimeType:Hr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Cn(fe.paint_symbol["text-halo-color"]),"text-halo-width":new Cn(fe.paint_symbol["text-halo-width"]),"text-halo-blur":new Cn(fe.paint_symbol["text-halo-blur"]),"text-translate":new On(fe.paint_symbol["text-translate"]),"text-translate-anchor":new On(fe.paint_symbol["text-translate-anchor"])}),layout:rt},je=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:fn,this.defaultValue=t};je.prototype.evaluate=function(t){if(t.formattedSection){var o=this.defaultValue.property.overrides;if(o&&o.hasOverride(t.formattedSection))return o.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},je.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return null},dn("FormatSectionOverride",je,{omit:["defaultValue"]});var we=function(t){function o(u){t.call(this,u,_e)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var y=this.layout.get("text-writing-mode");if(y){for(var b=[],S=0,I=y;S<I.length;S+=1){var D=I[S];b.indexOf(D)<0&&b.push(D)}this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},o.prototype.getValueAndResolveTokens=function(u,h,y,b){var S=this.layout.get(u).evaluate(h,{},y,b),I=this._unevaluatedLayout._values[u];return I.isDataDriven()||rc(I.value)||!S?S:function(D,z){return z.replace(/{([^{}]+)}/g,function(j,W){return W in D?String(D[W]):""})}(h.properties,S)},o.prototype.createBucket=function(u){return new Fe(u)},o.prototype.queryRadius=function(){return 0},o.prototype.queryIntersectsFeature=function(){return!1},o.prototype._setPaintOverrides=function(){for(var u=0,h=_e.paint.overridableProperties;u<h.length;u+=1){var y=h[u];if(o.hasPaintOverride(this.layout,y)){var b,S=this.paint.get(y),I=new je(S),D=new Bc(I,S.property.specification);b=S.value.kind==="constant"||S.value.kind==="source"?new Il("source",D):new ul("composite",D,S.value.zoomStops,S.value._interpolationType),this.paint._values[y]=new Ss(S.property,b,S.parameters)}}},o.prototype._handleOverridablePaintPropertyUpdate=function(u,h,y){return!(!this.layout||h.isDataDriven()||y.isDataDriven())&&o.hasPaintOverride(this.layout,u)},o.hasPaintOverride=function(u,h){var y=u.get("text-field"),b=_e.paint.properties[h],S=!1,I=function(j){for(var W=0,K=j;W<K.length;W+=1)if(b.overrides&&b.overrides.hasOverride(K[W]))return void(S=!0)};if(y.value.kind==="constant"&&y.value.value instanceof _t)I(y.value.value.sections);else if(y.value.kind==="source"){var D=function(j){S||(j instanceof Ua&&ra(j.value)===Xi?I(j.value.sections):j instanceof Ao?I(j.sections):j.eachChild(D))},z=y.value;z._styleExpression&&D(z._styleExpression.expression)}return S},o}(du),ct={paint:new Ho({"background-color":new On(fe.paint_background["background-color"]),"background-pattern":new Qo(fe.paint_background["background-pattern"]),"background-opacity":new On(fe.paint_background["background-opacity"])})},wt=function(t){function o(u){t.call(this,u,ct)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(du),fr={paint:new Ho({"raster-opacity":new On(fe.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(fe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(fe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(fe.paint_raster["raster-brightness-max"]),"raster-saturation":new On(fe.paint_raster["raster-saturation"]),"raster-contrast":new On(fe.paint_raster["raster-contrast"]),"raster-resampling":new On(fe.paint_raster["raster-resampling"]),"raster-fade-duration":new On(fe.paint_raster["raster-fade-duration"])})},zr=function(t){function o(u){t.call(this,u,fr)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o}(du),Ur=function(t){function o(u){t.call(this,u,{}),this.implementation=u}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},o.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},o.prototype.recalculate=function(){},o.prototype.updateTransitions=function(){},o.prototype.hasTransition=function(){},o.prototype.serialize=function(){},o.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},o.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},o}(du),nn={circle:wf,heatmap:Pp,hillshade:lh,fill:op,"fill-extrusion":el,line:Jh,symbol:we,background:wt,raster:zr},Dr=ee.HTMLImageElement,An=ee.HTMLCanvasElement,un=ee.HTMLVideoElement,En=ee.ImageData,bn=ee.ImageBitmap,ln=function(t,o,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(o,h)};ln.prototype.update=function(t,o,u){var h=t.width,y=t.height,b=!(this.size&&this.size[0]===h&&this.size[1]===y||u),S=this.context,I=S.gl;if(this.useMipmap=Boolean(o&&o.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!o||o.premultiply!==!1)),b)this.size=[h,y],t instanceof Dr||t instanceof An||t instanceof un||t instanceof En||bn&&t instanceof bn?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,t):I.texImage2D(I.TEXTURE_2D,0,this.format,h,y,0,this.format,I.UNSIGNED_BYTE,t.data);else{var D=u||{x:0,y:0},z=D.x,j=D.y;t instanceof Dr||t instanceof An||t instanceof un||t instanceof En||bn&&t instanceof bn?I.texSubImage2D(I.TEXTURE_2D,0,z,j,I.RGBA,I.UNSIGNED_BYTE,t):I.texSubImage2D(I.TEXTURE_2D,0,z,j,h,y,I.RGBA,I.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)},ln.prototype.bind=function(t,o,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),o!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,o),this.wrap=o)},ln.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},ln.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var ei=function(t){var o=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){o._triggered=!1,o._callback()})};ei.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},ei.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Sa=function(t,o,u){this.target=t,this.parent=o,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Zt(["receive","process"],this),this.invoker=new ei(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=kr()?t:ee};function ls(t,o,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,o*h-2*Math.PI*6378137/2]}Sa.prototype.send=function(t,o,u,h,y){var b=this;y===void 0&&(y=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var I=Ae(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:y,sourceMapId:this.mapId,data:Ks(o,I)},I),{cancel:function(){u&&delete b.callbacks[S],b.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:b.mapId})}}},Sa.prototype.receive=function(t){var o=t.data,u=o.id;if(u&&(!o.targetMapId||this.mapId===o.targetMapId))if(o.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else kr()||o.mustQueue?(this.tasks[u]=o,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,o)},Sa.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),o=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),o&&this.processTask(t,o)}},Sa.prototype.processTask=function(t,o){var u=this;if(o.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(o.error?h(Ms(o.error)):h(null,Ms(o.data)))}else{var y=!1,b=Ae(this.globalScope)?void 0:[],S=o.hasCallback?function(j,W){y=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:j?Ks(j):null,data:Ks(W,b)},b)}:function(j){y=!0},I=null,D=Ms(o.data);if(this.parent[o.type])I=this.parent[o.type](o.sourceMapId,D,S);else if(this.parent.getWorkerSource){var z=o.type.split(".");I=this.parent.getWorkerSource(o.sourceMapId,z[0],D.source)[z[1]](D,S)}else S(new Error("Could not find function "+o.type));!y&&I&&I.cancel&&(this.cancelCallbacks[t]=I.cancel)}},Sa.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Ga=function(t,o){t&&(o?this.setSouthWest(t).setNorthEast(o):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Ga.prototype.setNorthEast=function(t){return this._ne=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},Ga.prototype.setSouthWest=function(t){return this._sw=t instanceof _a?new _a(t.lng,t.lat):_a.convert(t),this},Ga.prototype.extend=function(t){var o,u,h=this._sw,y=this._ne;if(t instanceof _a)o=t,u=t;else{if(!(t instanceof Ga))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Ga.convert(t)):this.extend(_a.convert(t)):this;if(u=t._ne,!(o=t._sw)||!u)return this}return h||y?(h.lng=Math.min(o.lng,h.lng),h.lat=Math.min(o.lat,h.lat),y.lng=Math.max(u.lng,y.lng),y.lat=Math.max(u.lat,y.lat)):(this._sw=new _a(o.lng,o.lat),this._ne=new _a(u.lng,u.lat)),this},Ga.prototype.getCenter=function(){return new _a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Ga.prototype.getSouthWest=function(){return this._sw},Ga.prototype.getNorthEast=function(){return this._ne},Ga.prototype.getNorthWest=function(){return new _a(this.getWest(),this.getNorth())},Ga.prototype.getSouthEast=function(){return new _a(this.getEast(),this.getSouth())},Ga.prototype.getWest=function(){return this._sw.lng},Ga.prototype.getSouth=function(){return this._sw.lat},Ga.prototype.getEast=function(){return this._ne.lng},Ga.prototype.getNorth=function(){return this._ne.lat},Ga.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Ga.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Ga.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Ga.prototype.contains=function(t){var o=_a.convert(t),u=o.lng,h=o.lat,y=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&y},Ga.convert=function(t){return!t||t instanceof Ga?t:new Ga(t)};var _a=function(t,o){if(isNaN(t)||isNaN(o))throw new Error("Invalid LngLat object: ("+t+", "+o+")");if(this.lng=+t,this.lat=+o,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};_a.prototype.wrap=function(){return new _a(tr(this.lng,-180,180),this.lat)},_a.prototype.toArray=function(){return[this.lng,this.lat]},_a.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},_a.prototype.distanceTo=function(t){var o=Math.PI/180,u=this.lat*o,h=t.lat*o,y=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*o);return 63710088e-1*Math.acos(Math.min(y,1))},_a.prototype.toBounds=function(t){t===void 0&&(t=0);var o=360*t/40075017,u=o/Math.cos(Math.PI/180*this.lat);return new Ga(new _a(this.lng-u,this.lat-o),new _a(this.lng+u,this.lat+o))},_a.convert=function(t){if(t instanceof _a)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new _a(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new _a(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Xl=2*Math.PI*63710088e-1;function js(t){return Xl*Math.cos(t*Math.PI/180)}function Cl(t){return(180+t)/360}function Uu(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function td(t,o){return t/js(o)}function Zu(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var af=function(t,o,u){u===void 0&&(u=0),this.x=+t,this.y=+o,this.z=+u};af.fromLngLat=function(t,o){o===void 0&&(o=0);var u=_a.convert(t);return new af(Cl(u.lng),Uu(u.lat),td(o,u.lat))},af.prototype.toLngLat=function(){return new _a(360*this.x-180,Zu(this.y))},af.prototype.toAltitude=function(){return this.z*js(Zu(this.y))},af.prototype.meterInMercatorCoordinateUnits=function(){return 1/Xl*(t=Zu(this.y),1/Math.cos(t*Math.PI/180));var t};var Up=function(t,o,u){this.z=t,this.x=o,this.y=u,this.key=Zp(0,t,t,o,u)};Up.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Up.prototype.url=function(t,o){var u,h,y,b,S,I=(h=this.y,y=this.z,b=ls(256*(u=this.x),256*(h=Math.pow(2,y)-h-1),y),S=ls(256*(u+1),256*(h+1),y),b[0]+","+b[1]+","+S[0]+","+S[1]),D=function(z,j,W){for(var K,oe="",Me=z;Me>0;Me--)oe+=(j&(K=1<<Me-1)?1:0)+(W&K?2:0);return oe}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",I)},Up.prototype.getTilePoint=function(t){var o=Math.pow(2,this.z);return new ce(8192*(t.x*o-this.x),8192*(t.y*o-this.y))},Up.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var rd=function(t,o){this.wrap=t,this.canonical=o,this.key=Zp(t,o.z,o.z,o.x,o.y)},Xo=function(t,o,u,h,y){this.overscaledZ=t,this.wrap=o,this.canonical=new Up(u,+h,+y),this.key=Zp(o,t,u,h,y)};function Zp(t,o,u,h,y){(t*=2)<0&&(t=-1*t-1);var b=1<<u;return(b*b*t+b*y+h).toString(36)+u.toString(36)+o.toString(36)}Xo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Xo.prototype.scaledTo=function(t){var o=this.canonical.z-t;return t>this.canonical.z?new Xo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Xo(t,this.wrap,t,this.canonical.x>>o,this.canonical.y>>o)},Xo.prototype.calculateScaledKey=function(t,o){var u=this.canonical.z-t;return t>this.canonical.z?Zp(this.wrap*+o,t,this.canonical.z,this.canonical.x,this.canonical.y):Zp(this.wrap*+o,t,t,this.canonical.x>>u,this.canonical.y>>u)},Xo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var o=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>o&&t.canonical.y===this.canonical.y>>o},Xo.prototype.children=function(t){if(this.overscaledZ>=t)return[new Xo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var o=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Xo(o,this.wrap,o,u,h),new Xo(o,this.wrap,o,u+1,h),new Xo(o,this.wrap,o,u,h+1),new Xo(o,this.wrap,o,u+1,h+1)]},Xo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Xo.prototype.wrapped=function(){return new Xo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.unwrapTo=function(t){return new Xo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Xo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Xo.prototype.toUnwrapped=function(){return new rd(this.wrap,this.canonical)},Xo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Xo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new af(t.x-this.wrap,t.y))},dn("CanonicalTileID",Up),dn("OverscaledTileID",Xo,{omit:["posMatrix"]});var yc=function(t,o,u){if(this.uid=t,o.height!==o.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=o.height;var h=this.dim=o.height-2;this.data=new Uint32Array(o.data.buffer),this.encoding=u||"mapbox";for(var y=0;y<h;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(h,y)]=this.data[this._idx(h-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,h)]=this.data[this._idx(y,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};yc.prototype.get=function(t,o){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,o);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},yc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},yc.prototype._idx=function(t,o){if(t<-1||t>=this.dim+1||o<-1||o>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(o+1)*this.stride+(t+1)},yc.prototype._unpackMapbox=function(t,o,u){return(256*t*256+256*o+u)/10-1e4},yc.prototype._unpackTerrarium=function(t,o,u){return 256*t+o+u/256-32768},yc.prototype.getPixels=function(){return new Bo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},yc.prototype.backfillBorder=function(t,o,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=o*this.dim,y=o*this.dim+this.dim,b=u*this.dim,S=u*this.dim+this.dim;switch(o){case-1:h=y-1;break;case 1:y=h+1}switch(u){case-1:b=S-1;break;case 1:S=b+1}for(var I=-o*this.dim,D=-u*this.dim,z=b;z<S;z++)for(var j=h;j<y;j++)this.data[this._idx(j,z)]=t.data[this._idx(j+I,z+D)]},dn("DEMData",yc);var Yl=function(t){this._stringToNumber={},this._numberToString=[];for(var o=0;o<t.length;o++){var u=t[o];this._stringToNumber[u]=o,this._numberToString[o]=u}};Yl.prototype.encode=function(t){return this._stringToNumber[t]},Yl.prototype.decode=function(t){return this._numberToString[t]};var _c=function(t,o,u,h,y){this.type="Feature",this._vectorTileFeature=t,t._z=o,t._x=u,t._y=h,this.properties=t.properties,this.id=y},nd={geometry:{configurable:!0}};nd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},nd.geometry.set=function(t){this._geometry=t},_c.prototype.toJSON=function(){var t={geometry:this.geometry};for(var o in this)o!=="_geometry"&&o!=="_vectorTileFeature"&&(t[o]=this[o]);return t},Object.defineProperties(_c.prototype,nd);var cp=function(){this.state={},this.stateChanges={},this.deletedStates={}};cp.prototype.updateState=function(t,o,u){var h=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},yt(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var y in this.deletedStates[t]={},this.state[t])y!==h&&(this.deletedStates[t][y]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var b in this.deletedStates[t][h]={},this.state[t][h])u[b]||(this.deletedStates[t][h][b]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},cp.prototype.removeFeatureState=function(t,o,u){if(this.deletedStates[t]!==null){var h=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&o!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},cp.prototype.getState=function(t,o){var u=String(o),h=yt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var y=this.deletedStates[t][o];if(y===null)return{};for(var b in y)delete h[b]}return h},cp.prototype.initializeTileState=function(t,o){t.setFeatureState(this.state,o)},cp.prototype.coalesceChanges=function(t,o){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var y={};for(var b in this.stateChanges[h])this.state[h][b]||(this.state[h][b]={}),yt(this.state[h][b],this.stateChanges[h][b]),y[b]=this.state[h][b];u[h]=y}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var I={};if(this.deletedStates[S]===null)for(var D in this.state[S])I[D]={},this.state[S][D]={};else for(var z in this.deletedStates[S]){if(this.deletedStates[S][z]===null)this.state[S][z]={};else for(var j=0,W=Object.keys(this.deletedStates[S][z]);j<W.length;j+=1)delete this.state[S][z][W[j]];I[z]=this.state[S][z]}u[S]=u[S]||{},yt(u[S],I)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var K in t)t[K].setFeatureState(u,o)};var xc=function(t,o){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Iu(8192,16,0),this.grid3D=new Iu(8192,16,0),this.featureIndexArray=new X,this.promoteId=o};function id(t,o,u,h,y){return qt(t,function(b,S){var I=o instanceof xu?o.get(S):null;return I&&I.evaluate?I.evaluate(u,h,y):I})}function Fd(t){for(var o=1/0,u=1/0,h=-1/0,y=-1/0,b=0,S=t;b<S.length;b+=1){var I=S[b];o=Math.min(o,I.x),u=Math.min(u,I.y),h=Math.max(h,I.x),y=Math.max(y,I.y)}return{minX:o,minY:u,maxX:h,maxY:y}}function yv(t,o){return o-t}xc.prototype.insert=function(t,o,u,h,y,b){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,y);for(var I=b?this.grid3D:this.grid,D=0;D<o.length;D++){for(var z=o[D],j=[1/0,1/0,-1/0,-1/0],W=0;W<z.length;W++){var K=z[W];j[0]=Math.min(j[0],K.x),j[1]=Math.min(j[1],K.y),j[2]=Math.max(j[2],K.x),j[3]=Math.max(j[3],K.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&I.insert(S,j[0],j[1],j[2],j[3])}},xc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Eu.VectorTile(new nf(this.rawTileData)).layers,this.sourceLayerCoder=new Yl(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},xc.prototype.query=function(t,o,u,h){var y=this;this.loadVTLayers();for(var b=t.params||{},S=8192/t.tileSize/t.scale,I=Rl(b.filter),D=t.queryGeometry,z=t.queryPadding*S,j=Fd(D),W=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),K=Fd(t.cameraQueryGeometry),oe=this.grid3D.query(K.minX-z,K.minY-z,K.maxX+z,K.maxY+z,function(Ut,Gt,or,Mr){return function(Fr,Dn,cn,Zn,pn){for(var Ri=0,ti=Fr;Ri<ti.length;Ri+=1){var wn=ti[Ri];if(Dn<=wn.x&&cn<=wn.y&&Zn>=wn.x&&pn>=wn.y)return!0}var Vi=[new ce(Dn,cn),new ce(Dn,pn),new ce(Zn,pn),new ce(Zn,cn)];if(Fr.length>2){for(var Ai=0,ta=Vi;Ai<ta.length;Ai+=1)if(ru(Fr,ta[Ai]))return!0}for(var Vn=0;Vn<Fr.length-1;Vn++)if(yl(Fr[Vn],Fr[Vn+1],Vi))return!0;return!1}(t.cameraQueryGeometry,Ut-z,Gt-z,or+z,Mr+z)}),Me=0,Oe=oe;Me<Oe.length;Me+=1)W.push(Oe[Me]);W.sort(yv);for(var L,Ue={},ot=function(Ut){var Gt=W[Ut];if(Gt!==L){L=Gt;var or=y.featureIndexArray.get(Gt),Mr=null;y.loadMatchingFeature(Ue,or.bucketIndex,or.sourceLayerIndex,or.featureIndex,I,b.layers,b.availableImages,o,u,h,function(Fr,Dn,cn){return Mr||(Mr=Wa(Fr)),Dn.queryIntersectsFeature(D,Fr,cn,Mr,y.z,t.transform,S,t.pixelPosMatrix)})}},xt=0;xt<W.length;xt++)ot(xt);return Ue},xc.prototype.loadMatchingFeature=function(t,o,u,h,y,b,S,I,D,z,j){var W=this.bucketLayerIDs[o];if(!b||function(Fr,Dn){for(var cn=0;cn<Fr.length;cn++)if(Dn.indexOf(Fr[cn])>=0)return!0;return!1}(b,W)){var K=this.sourceLayerCoder.decode(u),oe=this.vtLayers[K].feature(h);if(y.needGeometry){var Me=po(oe,!0);if(!y.filter(new Ti(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!y.filter(new Ti(this.tileID.overscaledZ),oe))return;for(var Oe=this.getId(oe,K),L=0;L<W.length;L++){var Ue=W[L];if(!(b&&b.indexOf(Ue)<0)){var ot=I[Ue];if(ot){var xt={};Oe!==void 0&&z&&(xt=z.getState(ot.sourceLayer||"_geojsonTileLayer",Oe));var Ut=yt({},D[Ue]);Ut.paint=id(Ut.paint,ot.paint,oe,xt,S),Ut.layout=id(Ut.layout,ot.layout,oe,xt,S);var Gt=!j||j(oe,ot,xt);if(Gt){var or=new _c(oe,this.z,this.x,this.y,Oe);or.layer=Ut;var Mr=t[Ue];Mr===void 0&&(Mr=t[Ue]=[]),Mr.push({featureIndex:h,feature:or,intersectionZ:Gt})}}}}}},xc.prototype.lookupSymbolFeatures=function(t,o,u,h,y,b,S,I){var D={};this.loadVTLayers();for(var z=Rl(y),j=0,W=t;j<W.length;j+=1)this.loadMatchingFeature(D,u,h,W[j],z,b,S,I,o);return D},xc.prototype.hasLayer=function(t){for(var o=0,u=this.bucketLayerIDs;o<u.length;o+=1)for(var h=0,y=u[o];h<y.length;h+=1)if(t===y[h])return!0;return!1},xc.prototype.getId=function(t,o){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[o]])=="boolean"&&(u=Number(u)),u},dn("FeatureIndex",xc,{omit:["rawTileData","sourceLayerCoder"]});var cs=function(t,o){this.tileID=t,this.uid=bt(),this.uses=0,this.tileSize=o,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};cs.prototype.registerFadeDuration=function(t){var o=t+this.timeAdded;o<fi.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)},cs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},cs.prototype.loadVectorData=function(t,o,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(z,j){var W={};if(!j)return W;for(var K=function(){var Oe=Me[oe],L=Oe.layerIds.map(function(xt){return j.getLayer(xt)}).filter(Boolean);if(L.length!==0){Oe.layers=L,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(xt){return L.filter(function(Ut){return Ut.id===xt})[0]}));for(var Ue=0,ot=L;Ue<ot.length;Ue+=1)W[ot[Ue].id]=Oe}},oe=0,Me=z;oe<Me.length;oe+=1)K();return W}(t.buckets,o.style),this.hasSymbolBuckets=!1,this.buckets){var y=this.buckets[h];if(y instanceof Fe){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var b in this.buckets){var S=this.buckets[b];if(S instanceof Fe&&S.hasRTLText){this.hasRTLText=!0,Ps.isLoading()||Ps.isLoaded()||Af()!=="deferred"||pu();break}}for(var I in this.queryPadding=0,this.buckets){var D=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,o.style.getLayer(I).queryRadius(D))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},cs.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},cs.prototype.getBucket=function(t){return this.buckets[t.id]},cs.prototype.upload=function(t){for(var o in this.buckets){var u=this.buckets[o];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ln(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ln(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},cs.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},cs.prototype.queryRenderedFeatures=function(t,o,u,h,y,b,S,I,D,z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:y,scale:b,tileSize:this.tileSize,pixelPosMatrix:z,transform:I,params:S,queryPadding:this.queryPadding*D},t,o,u):{}},cs.prototype.querySourceFeatures=function(t,o){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),y=o?o.sourceLayer:"",b=h._geojsonTileLayer||h[y];if(b)for(var S=Rl(o&&o.filter),I=this.tileID.canonical,D=I.z,z=I.x,j=I.y,W={z:D,x:z,y:j},K=0;K<b.length;K++){var oe=b.feature(K);if(S.needGeometry){var Me=po(oe,!0);if(!S.filter(new Ti(this.tileID.overscaledZ),Me,this.tileID.canonical))continue}else if(!S.filter(new Ti(this.tileID.overscaledZ),oe))continue;var Oe=u.getId(oe,y),L=new _c(oe,D,z,j,Oe);L.tile=W,t.push(L)}}},cs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},cs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},cs.prototype.setExpiryData=function(t){var o=this.expirationTime;if(t.cacheControl){var u=Kr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),y=!1;if(this.expirationTime>h)y=!1;else if(o)if(this.expirationTime<o)y=!0;else{var b=this.expirationTime-o;b?this.expirationTime=h+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},cs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},cs.prototype.setFeatureState=function(t,o){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(o.style.hasLayer(h)){var y=this.buckets[h],b=y.layers[0].sourceLayer||"_geojsonTileLayer",S=u[b],I=t[b];if(S&&I&&Object.keys(I).length!==0){y.update(I,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=o&&o.style&&o.style.getLayer(h);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(y)))}}}},cs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},cs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fi.now()},cs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},cs.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=fi.now()+t},cs.prototype.setDependencies=function(t,o){for(var u={},h=0,y=o;h<y.length;h+=1)u[y[h]]=!0;this.dependencies[t]=u},cs.prototype.hasDependency=function(t,o){for(var u=0,h=t;u<h.length;u+=1){var y=this.dependencies[h[u]];if(y){for(var b=0,S=o;b<S.length;b+=1)if(y[S[b]])return!0}}return!1};var kf=ee.performance,jp=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},kf.mark(this._marks.start)};jp.prototype.finish=function(){kf.mark(this._marks.end);var t=kf.getEntriesByName(this._marks.measure);return t.length===0&&(kf.measure(this._marks.measure,this._marks.start,this._marks.end),t=kf.getEntriesByName(this._marks.measure),kf.clearMarks(this._marks.start),kf.clearMarks(this._marks.end),kf.clearMeasures(this._marks.measure)),t},m.Actor=Sa,m.AlphaImage=au,m.CanonicalTileID=Up,m.CollisionBoxArray=f,m.Color=ji,m.DEMData=yc,m.DataConstantProperty=On,m.DictionaryCoder=Yl,m.EXTENT=8192,m.ErrorEvent=He,m.EvaluationParameters=Ti,m.Event=Pe,m.Evented=tt,m.FeatureIndex=xc,m.FillBucket=Us,m.FillExtrusionBucket=zu,m.ImageAtlas=_r,m.ImagePosition=st,m.LineBucket=Ki,m.LngLat=_a,m.LngLatBounds=Ga,m.MercatorCoordinate=af,m.ONE_EM=24,m.OverscaledTileID=Xo,m.Point=ce,m.Point$1=ce,m.Properties=Ho,m.Protobuf=nf,m.RGBAImage=Bo,m.RequestManager=Gi,m.RequestPerformance=jp,m.ResourceType=an,m.SegmentVector=pe,m.SourceFeatureState=cp,m.StructArrayLayout1ui2=Kf,m.StructArrayLayout2f1f2i16=eu,m.StructArrayLayout2i4=cc,m.StructArrayLayout3ui6=dl,m.StructArrayLayout4i8=Js,m.SymbolBucket=Fe,m.Texture=ln,m.Tile=cs,m.Transitionable=Go,m.Uniform1f=Lr,m.Uniform1i=dr,m.Uniform2f=gr,m.Uniform3f=sn,m.Uniform4f=zn,m.UniformColor=Un,m.UniformMatrix4f=ki,m.UnwrappedTileID=rd,m.ValidationError=ke,m.WritingMode=Nr,m.ZoomHistory=Ef,m.add=function(t,o,u){return t[0]=o[0]+u[0],t[1]=o[1]+u[1],t[2]=o[2]+u[2],t},m.addDynamicAttributes=Ge,m.asyncAll=function(t,o,u){if(!t.length)return u(null,[]);var h=t.length,y=new Array(t.length),b=null;t.forEach(function(S,I){o(S,function(D,z){D&&(b=D),y[I]=z,--h==0&&u(b,y)})})},m.bezier=Je,m.bindAll=Zt,m.browser=fi,m.cacheEntryPossiblyAdded=function(t){++di>Cr&&(t.getActor().send("enforceCacheSizeLimit",rr),di=0)},m.clamp=gt,m.clearTileCache=function(t){var o=ee.caches.delete("mapbox-tiles");t&&o.catch(t).then(function(){return t()})},m.clipLine=So,m.clone=function(t){var o=new oa(16);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o[3]=t[3],o[4]=t[4],o[5]=t[5],o[6]=t[6],o[7]=t[7],o[8]=t[8],o[9]=t[9],o[10]=t[10],o[11]=t[11],o[12]=t[12],o[13]=t[13],o[14]=t[14],o[15]=t[15],o},m.clone$1=Qe,m.clone$2=function(t){var o=new oa(3);return o[0]=t[0],o[1]=t[1],o[2]=t[2],o},m.collisionCircleLayout=Sl,m.config=Gn,m.create=function(){var t=new oa(16);return oa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},m.create$1=function(){var t=new oa(9);return oa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},m.create$2=function(){var t=new oa(4);return oa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},m.createCommonjsModule=he,m.createExpression=nc,m.createLayout=Da,m.createStyleLayer=function(t){return t.type==="custom"?new Ur(t):new nn[t.type](t)},m.cross=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=u[0],I=u[1],D=u[2];return t[0]=y*D-b*I,t[1]=b*S-h*D,t[2]=h*I-y*S,t},m.deepEqual=function t(o,u){if(Array.isArray(o)){if(!Array.isArray(u)||o.length!==u.length)return!1;for(var h=0;h<o.length;h++)if(!t(o[h],u[h]))return!1;return!0}if(typeof o=="object"&&o!==null&&u!==null){if(typeof u!="object"||Object.keys(o).length!==Object.keys(u).length)return!1;for(var y in o)if(!t(o[y],u[y]))return!1;return!0}return o===u},m.dot=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]},m.dot$1=function(t,o){return t[0]*o[0]+t[1]*o[1]+t[2]*o[2]+t[3]*o[3]},m.ease=Ze,m.emitValidationErrors=Zc,m.endsWith=Y,m.enforceCacheSizeLimit=function(t){Qr(),Qi&&Qi.then(function(o){o.keys().then(function(u){for(var h=0;h<u.length-t;h++)o.delete(u[h])})})},m.evaluateSizeForFeature=Jn,m.evaluateSizeForZoom=ci,m.evaluateVariableOffset=si,m.evented=Yf,m.extend=yt,m.featureFilter=Rl,m.filterObject=ut,m.fromRotation=function(t,o){var u=Math.sin(o),h=Math.cos(o);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},m.getAnchorAlignment=Yr,m.getAnchorJustification=Te,m.getArrayBuffer=za,m.getImage=J,m.getJSON=function(t,o){return Zo(yt(t,{type:"json"}),o)},m.getRTLTextPluginStatus=Af,m.getReferrer=Li,m.getVideo=function(t,o){var u,h,y=ee.document.createElement("video");y.muted=!0,y.onloadstart=function(){o(null,y)};for(var b=0;b<t.length;b++){var S=ee.document.createElement("source");u=t[b],h=void 0,(h=ee.document.createElement("a")).href=u,(h.protocol!==ee.document.location.protocol||h.host!==ee.document.location.host)&&(y.crossOrigin="Anonymous"),S.src=t[b],y.appendChild(S)}return{cancel:function(){}}},m.identity=zs,m.invert=function(t,o){var u=o[0],h=o[1],y=o[2],b=o[3],S=o[4],I=o[5],D=o[6],z=o[7],j=o[8],W=o[9],K=o[10],oe=o[11],Me=o[12],Oe=o[13],L=o[14],Ue=o[15],ot=u*I-h*S,xt=u*D-y*S,Ut=u*z-b*S,Gt=h*D-y*I,or=h*z-b*I,Mr=y*z-b*D,Fr=j*Oe-W*Me,Dn=j*L-K*Me,cn=j*Ue-oe*Me,Zn=W*L-K*Oe,pn=W*Ue-oe*Oe,Ri=K*Ue-oe*L,ti=ot*Ri-xt*pn+Ut*Zn+Gt*cn-or*Dn+Mr*Fr;return ti?(t[0]=(I*Ri-D*pn+z*Zn)*(ti=1/ti),t[1]=(y*pn-h*Ri-b*Zn)*ti,t[2]=(Oe*Mr-L*or+Ue*Gt)*ti,t[3]=(K*or-W*Mr-oe*Gt)*ti,t[4]=(D*cn-S*Ri-z*Dn)*ti,t[5]=(u*Ri-y*cn+b*Dn)*ti,t[6]=(L*Ut-Me*Mr-Ue*xt)*ti,t[7]=(j*Mr-K*Ut+oe*xt)*ti,t[8]=(S*pn-I*cn+z*Fr)*ti,t[9]=(h*cn-u*pn-b*Fr)*ti,t[10]=(Me*or-Oe*Ut+Ue*ot)*ti,t[11]=(W*Ut-j*or-oe*ot)*ti,t[12]=(I*Dn-S*Zn-D*Fr)*ti,t[13]=(u*Zn-h*Dn+y*Fr)*ti,t[14]=(Oe*xt-Me*Gt-L*ot)*ti,t[15]=(j*Gt-W*xt+K*ot)*ti,t):null},m.isChar=Zr,m.isMapboxURL=Di,m.keysDifference=function(t,o){var u=[];for(var h in t)h in o||u.push(h);return u},m.makeRequest=Zo,m.mapObject=qt,m.mercatorXfromLng=Cl,m.mercatorYfromLat=Uu,m.mercatorZfromAltitude=td,m.mul=Wc,m.multiply=Jo,m.mvt=Eu,m.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},m.normalize=function(t,o){var u=o[0],h=o[1],y=o[2],b=u*u+h*h+y*y;return b>0&&(b=1/Math.sqrt(b)),t[0]=o[0]*b,t[1]=o[1]*b,t[2]=o[2]*b,t},m.number=ga,m.offscreenCanvasSupported=Kn,m.ortho=function(t,o,u,h,y,b,S){var I=1/(o-u),D=1/(h-y),z=1/(b-S);return t[0]=-2*I,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*D,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*z,t[11]=0,t[12]=(o+u)*I,t[13]=(y+h)*D,t[14]=(S+b)*z,t[15]=1,t},m.parseGlyphPBF=function(t){return new nf(t).readFields(Tr,[])},m.pbf=nf,m.performSymbolLayout=function(t,o,u,h,y,b,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var I=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,z={};if(t.textSizeData.kind==="composite"){var j=t.textSizeData,W=j.maxZoom;z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new Ti(j.minZoom),S),D["text-size"].possiblyEvaluate(new Ti(W),S)]}if(t.iconSizeData.kind==="composite"){var K=t.iconSizeData,oe=K.maxZoom;z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new Ti(K.minZoom),S),D["icon-size"].possiblyEvaluate(new Ti(oe),S)]}z.layoutTextSize=D["text-size"].possiblyEvaluate(new Ti(t.zoom+1),S),z.layoutIconSize=D["icon-size"].possiblyEvaluate(new Ti(t.zoom+1),S),z.textMaxSize=D["text-size"].possiblyEvaluate(new Ti(18));for(var Me=24*I.get("text-line-height"),Oe=I.get("text-rotation-alignment")==="map"&&I.get("symbol-placement")!=="point",L=I.get("text-keep-upright"),Ue=I.get("text-size"),ot=function(){var Gt=Ut[xt],or=I.get("text-font").evaluate(Gt,{},S).join(","),Mr=Ue.evaluate(Gt,{},S),Fr=z.layoutTextSize.evaluate(Gt,{},S),Dn=z.layoutIconSize.evaluate(Gt,{},S),cn={horizontal:{},vertical:void 0},Zn=Gt.text,pn=[0,0];if(Zn){var Ri=Zn.toString(),ti=24*I.get("text-letter-spacing").evaluate(Gt,{},S),wn=function(wi){for(var Ba=0,wa=wi;Ba<wa.length;Ba+=1)if(sa=wa[Ba].charCodeAt(0),Zr.Arabic(sa)||Zr["Arabic Supplement"](sa)||Zr["Arabic Extended-A"](sa)||Zr["Arabic Presentation Forms-A"](sa)||Zr["Arabic Presentation Forms-B"](sa))return!1;var sa;return!0}(Ri)?ti:0,Vi=I.get("text-anchor").evaluate(Gt,{},S),Ai=I.get("text-variable-anchor");if(!Ai){var ta=I.get("text-radial-offset").evaluate(Gt,{},S);pn=ta?si(Vi,[24*ta,Nn]):I.get("text-offset").evaluate(Gt,{},S).map(function(wi){return 24*wi})}var Vn=Oe?"center":I.get("text-justify").evaluate(Gt,{},S),fa=I.get("symbol-placement"),eo=fa==="point"?24*I.get("text-max-width").evaluate(Gt,{},S):0,_o=function(){t.allowVerticalPlacement&&lc(Ri)&&(cn.vertical=qr(Zn,o,u,y,or,eo,Me,Vi,"left",wn,pn,Nr.vertical,!0,fa,Fr,Mr))};if(!Oe&&Ai){for(var Xa=Vn==="auto"?Ai.map(function(wi){return Te(wi)}):[Vn],to=!1,xo=0;xo<Xa.length;xo++){var Yo=Xa[xo];if(!cn.horizontal[Yo])if(to)cn.horizontal[Yo]=cn.horizontal[0];else{var ts=qr(Zn,o,u,y,or,eo,Me,"center",Yo,wn,pn,Nr.horizontal,!1,fa,Fr,Mr);ts&&(cn.horizontal[Yo]=ts,to=ts.positionedLines.length===1)}}_o()}else{Vn==="auto"&&(Vn=Te(Vi));var Vs=qr(Zn,o,u,y,or,eo,Me,Vi,Vn,wn,pn,Nr.horizontal,!1,fa,Fr,Mr);Vs&&(cn.horizontal[Vn]=Vs),_o(),lc(Ri)&&Oe&&L&&(cn.vertical=qr(Zn,o,u,y,or,eo,Me,Vi,Vn,wn,pn,Nr.vertical,!1,fa,Fr,Mr))}}var rs=void 0,Gs=!1;if(Gt.icon&&Gt.icon.name){var ro=h[Gt.icon.name];ro&&(rs=function(wi,Ba,wa){var sa=Yr(wa),ps=Ba[0]-wi.displaySize[0]*sa.horizontalAlign,As=Ba[1]-wi.displaySize[1]*sa.verticalAlign;return{image:wi,top:As,bottom:As+wi.displaySize[1],left:ps,right:ps+wi.displaySize[0]}}(y[Gt.icon.name],I.get("icon-offset").evaluate(Gt,{},S),I.get("icon-anchor").evaluate(Gt,{},S)),Gs=ro.sdf,t.sdfIcons===void 0?t.sdfIcons=ro.sdf:t.sdfIcons!==ro.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ro.pixelRatio!==t.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var fs=Et(cn.horizontal)||cn.vertical;t.iconsInText=!!fs&&fs.iconsInText,(fs||rs)&&function(wi,Ba,wa,sa,ps,As,Ya,Ro,hs,pa,ql){var ou=As.textMaxSize.evaluate(Ba,{});ou===void 0&&(ou=Ya);var of,Lo=wi.layers[0].layout,bc=Lo.get("icon-offset").evaluate(Ba,{},ql),tl=Et(wa.horizontal),Vp=Ya/24,Df=wi.tilePixelRatio*Vp,fp=wi.tilePixelRatio*ou/24,Ec=wi.tilePixelRatio*Ro,pp=wi.tilePixelRatio*Lo.get("symbol-spacing"),gh=Lo.get("text-padding")*wi.tilePixelRatio,hp=Lo.get("icon-padding")*wi.tilePixelRatio,Gp=Lo.get("text-max-angle")/180*Math.PI,yh=Lo.get("text-rotation-alignment")==="map"&&Lo.get("symbol-placement")!=="point",_h=Lo.get("icon-rotation-alignment")==="map"&&Lo.get("symbol-placement")!=="point",Sc=Lo.get("symbol-placement"),Hp=pp/2,dp=Lo.get("icon-text-fit");sa&&dp!=="none"&&(wi.allowVerticalPlacement&&wa.vertical&&(of=oi(sa,wa.vertical,dp,Lo.get("icon-text-fit-padding"),bc,Vp)),tl&&(sa=oi(sa,tl,dp,Lo.get("icon-text-fit-padding"),bc,Vp)));var sf=function(_v,Ah){Ah.x<0||Ah.x>=8192||Ah.y<0||Ah.y>=8192||function(Co,Kl,xv,uf,sd,zd,wh,ju,Th,Mh,ud,ld,Ud,y0,Ph,_0,x0,b0,E0,S0,Vu,cd,C0,Cc,bv){var A0,Ac,rl,_p,xp,lf=Co.addToLineVertexArray(Kl,xv),Zd=0,jd=0,w0=0,T0=0,Vd=-1,fd=-1,wc={},Gd=Ee(""),Ih=0,pd=0;if(ju._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ih=(A0=ju.layout.get("text-offset").evaluate(Vu,{},Cc).map(function(Rh){return 24*Rh}))[0],pd=A0[1]):(Ih=24*ju.layout.get("text-radial-offset").evaluate(Vu,{},Cc),pd=Nn),Co.allowVerticalPlacement&&uf.vertical){var M0=ju.layout.get("text-rotate").evaluate(Vu,{},Cc)+90;_p=new Oo(Th,Kl,Mh,ud,ld,uf.vertical,Ud,y0,Ph,M0),wh&&(xp=new Oo(Th,Kl,Mh,ud,ld,wh,x0,b0,Ph,M0))}if(sd){var Hd=ju.layout.get("icon-rotate").evaluate(Vu,{}),Wd=ju.layout.get("icon-text-fit")!=="none",P0=Wo(sd,Hd,C0,Wd),hd=wh?Wo(wh,Hd,C0,Wd):void 0;rl=new Oo(Th,Kl,Mh,ud,ld,sd,x0,b0,!1,Hd),Zd=4*P0.length;var Xd=Co.iconSizeData,Qp=null;Xd.kind==="source"?(Qp=[128*ju.layout.get("icon-size").evaluate(Vu,{})])[0]>32640&&$e(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Xd.kind==="composite"&&((Qp=[128*cd.compositeIconSizes[0].evaluate(Vu,{},Cc),128*cd.compositeIconSizes[1].evaluate(Vu,{},Cc)])[0]>32640||Qp[1]>32640)&&$e(Co.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Co.addSymbols(Co.icon,P0,Qp,S0,E0,Vu,!1,Kl,lf.lineStartIndex,lf.lineLength,-1,Cc),Vd=Co.icon.placedSymbolArray.length-1,hd&&(jd=4*hd.length,Co.addSymbols(Co.icon,hd,Qp,S0,E0,Vu,Nr.vertical,Kl,lf.lineStartIndex,lf.lineLength,-1,Cc),fd=Co.icon.placedSymbolArray.length-1)}for(var Yd in uf.horizontal){var dd=uf.horizontal[Yd];if(!Ac){Gd=Ee(dd.text);var Ev=ju.layout.get("text-rotate").evaluate(Vu,{},Cc);Ac=new Oo(Th,Kl,Mh,ud,ld,dd,Ud,y0,Ph,Ev)}var I0=dd.positionedLines.length===1;if(w0+=zt(Co,Kl,dd,zd,ju,Ph,Vu,_0,lf,uf.vertical?Nr.horizontal:Nr.horizontalOnly,I0?Object.keys(uf.horizontal):[Yd],wc,Vd,cd,Cc),I0)break}uf.vertical&&(T0+=zt(Co,Kl,uf.vertical,zd,ju,Ph,Vu,_0,lf,Nr.vertical,["vertical"],wc,fd,cd,Cc));var Sv=Ac?Ac.boxStartIndex:Co.collisionBoxArray.length,Cv=Ac?Ac.boxEndIndex:Co.collisionBoxArray.length,Av=_p?_p.boxStartIndex:Co.collisionBoxArray.length,wv=_p?_p.boxEndIndex:Co.collisionBoxArray.length,O0=rl?rl.boxStartIndex:Co.collisionBoxArray.length,R0=rl?rl.boxEndIndex:Co.collisionBoxArray.length,L0=xp?xp.boxStartIndex:Co.collisionBoxArray.length,qd=xp?xp.boxEndIndex:Co.collisionBoxArray.length,$l=-1,Oh=function(Rh,Tc){return Rh&&Rh.circleDiameter?Math.max(Rh.circleDiameter,Tc):Tc};$l=Oh(Ac,$l),$l=Oh(_p,$l),$l=Oh(rl,$l);var Jp=($l=Oh(xp,$l))>-1?1:0;Jp&&($l*=bv/24),Co.glyphOffsetArray.length>=Fe.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Vu.sortKey!==void 0&&Co.addToSortKeyRanges(Co.symbolInstances.length,Vu.sortKey),Co.symbolInstances.emplaceBack(Kl.x,Kl.y,wc.right>=0?wc.right:-1,wc.center>=0?wc.center:-1,wc.left>=0?wc.left:-1,wc.vertical||-1,Vd,fd,Gd,Sv,Cv,Av,wv,O0,R0,L0,qd,Mh,w0,T0,Zd,jd,Jp,0,Ud,Ih,pd,$l)}(wi,Ah,_v,wa,sa,ps,of,wi.layers[0],wi.collisionBoxArray,Ba.index,Ba.sourceLayerIndex,wi.index,Df,gh,yh,hs,Ec,hp,_h,bc,Ba,As,pa,ql,Ya)};if(Sc==="line")for(var vp=0,xh=So(Ba.geometry,0,0,8192,8192);vp<xh.length;vp+=1)for(var bh=xh[vp],Wp=0,ds=No(bh,pp,Gp,wa.vertical||tl,sa,24,fp,wi.overscaling,8192);Wp<ds.length;Wp+=1){var Eh=ds[Wp];tl&&vn(wi,tl.text,Hp,Eh)||sf(bh,Eh)}else if(Sc==="line-center")for(var Xp=0,Yp=Ba.geometry;Xp<Yp.length;Xp+=1){var qp=Yp[Xp];if(qp.length>1){var Sh=Va(qp,Gp,wa.vertical||tl,sa,24,fp);Sh&&sf(qp,Sh)}}else if(Ba.type==="Polygon")for(var mp=0,Ch=Pf(Ba.geometry,0);mp<Ch.length;mp+=1){var gp=Ch[mp],Kp=ri(gp,16);sf(gp[0],new Gr(Kp.x,Kp.y,0))}else if(Ba.type==="LineString")for(var Ff=0,$p=Ba.geometry;Ff<$p.length;Ff+=1){var yp=$p[Ff];sf(yp,new Gr(yp[0].x,yp[0].y,0))}else if(Ba.type==="Point")for(var ad=0,Bd=Ba.geometry;ad<Bd.length;ad+=1)for(var od=0,g0=Bd[ad];od<g0.length;od+=1){var Nd=g0[od];sf([Nd],new Gr(Nd.x,Nd.y,0))}}(t,Gt,cn,rs,h,z,Fr,Dn,pn,Gs,S)},xt=0,Ut=t.features;xt<Ut.length;xt+=1)ot();b&&t.generateCollisionDebugBuffers()},m.perspective=function(t,o,u,h,y){var b,S=1/Math.tan(o/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,y!=null&&y!==1/0?(t[10]=(y+h)*(b=1/(h-y)),t[14]=2*y*h*b):(t[10]=-1,t[14]=-2*h),t},m.pick=function(t,o){for(var u={},h=0;h<o.length;h++){var y=o[h];y in t&&(u[y]=t[y])}return u},m.plugin=Ps,m.polygonIntersectsPolygon=Du,m.postMapLoadEvent=Bt,m.postTurnstileEvent=Ha,m.potpack=Ar,m.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],m.register=dn,m.registerForPluginStateChange=function(t){return t({pluginStatus:Bs,pluginURL:Ru}),Yf.on("pluginStateChange",t),t},m.renderColorRamp=$f,m.rotate=function(t,o,u){var h=o[0],y=o[1],b=o[2],S=o[3],I=Math.sin(u),D=Math.cos(u);return t[0]=h*D+b*I,t[1]=y*D+S*I,t[2]=h*-I+b*D,t[3]=y*-I+S*D,t},m.rotateX=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[4],S=o[5],I=o[6],D=o[7],z=o[8],j=o[9],W=o[10],K=o[11];return o!==t&&(t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[4]=b*y+z*h,t[5]=S*y+j*h,t[6]=I*y+W*h,t[7]=D*y+K*h,t[8]=z*y-b*h,t[9]=j*y-S*h,t[10]=W*y-I*h,t[11]=K*y-D*h,t},m.rotateZ=function(t,o,u){var h=Math.sin(u),y=Math.cos(u),b=o[0],S=o[1],I=o[2],D=o[3],z=o[4],j=o[5],W=o[6],K=o[7];return o!==t&&(t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15]),t[0]=b*y+z*h,t[1]=S*y+j*h,t[2]=I*y+W*h,t[3]=D*y+K*h,t[4]=z*y-b*h,t[5]=j*y-S*h,t[6]=W*y-I*h,t[7]=K*y-D*h,t},m.scale=function(t,o,u){var h=u[0],y=u[1],b=u[2];return t[0]=o[0]*h,t[1]=o[1]*h,t[2]=o[2]*h,t[3]=o[3]*h,t[4]=o[4]*y,t[5]=o[5]*y,t[6]=o[6]*y,t[7]=o[7]*y,t[8]=o[8]*b,t[9]=o[9]*b,t[10]=o[10]*b,t[11]=o[11]*b,t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],t},m.scale$1=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t[3]=o[3]*u,t},m.scale$2=function(t,o,u){return t[0]=o[0]*u,t[1]=o[1]*u,t[2]=o[2]*u,t},m.setCacheLimits=function(t,o){rr=t,Cr=o},m.setRTLTextPlugin=function(t,o,u){if(u===void 0&&(u=!1),Bs==="deferred"||Bs==="loading"||Bs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ru=fi.resolveURL(t),Bs="deferred",Ou=o,cl(),u||pu()},m.sphericalToCartesian=function(t){var o=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:o*Math.cos(u)*Math.sin(h),y:o*Math.sin(u)*Math.sin(h),z:o*Math.cos(h)}},m.sqrLen=function(t){var o=t[0],u=t[1];return o*o+u*u},m.styleSpec=fe,m.sub=function(t,o,u){return t[0]=o[0]-u[0],t[1]=o[1]-u[1],t[2]=o[2]-u[2],t},m.symbolSize=zi,m.transformMat3=function(t,o,u){var h=o[0],y=o[1],b=o[2];return t[0]=h*u[0]+y*u[3]+b*u[6],t[1]=h*u[1]+y*u[4]+b*u[7],t[2]=h*u[2]+y*u[5]+b*u[8],t},m.transformMat4=Xc,m.translate=function(t,o,u){var h,y,b,S,I,D,z,j,W,K,oe,Me,Oe=u[0],L=u[1],Ue=u[2];return o===t?(t[12]=o[0]*Oe+o[4]*L+o[8]*Ue+o[12],t[13]=o[1]*Oe+o[5]*L+o[9]*Ue+o[13],t[14]=o[2]*Oe+o[6]*L+o[10]*Ue+o[14],t[15]=o[3]*Oe+o[7]*L+o[11]*Ue+o[15]):(y=o[1],b=o[2],S=o[3],I=o[4],D=o[5],z=o[6],j=o[7],W=o[8],K=o[9],oe=o[10],Me=o[11],t[0]=h=o[0],t[1]=y,t[2]=b,t[3]=S,t[4]=I,t[5]=D,t[6]=z,t[7]=j,t[8]=W,t[9]=K,t[10]=oe,t[11]=Me,t[12]=h*Oe+I*L+W*Ue+o[12],t[13]=y*Oe+D*L+K*Ue+o[13],t[14]=b*Oe+z*L+oe*Ue+o[14],t[15]=S*Oe+j*L+Me*Ue+o[15]),t},m.triggerPluginCompletionEvent=Xf,m.uniqueId=bt,m.validateCustomStyleLayer=function(t){var o=[],u=t.id;return u===void 0&&o.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&o.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&o.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),o},m.validateLight=sc,m.validateStyle=ja,m.values=function(t){var o=[];for(var u in t)o.push(t[u]);return o},m.vectorTile=Eu,m.version="1.13.2",m.warnOnce=$e,m.webpSupported=ni,m.window=ee,m.wrap=tr}),re(["./shared"],function(m){"use strict";function he(H){var J=typeof H;if(J==="number"||J==="boolean"||J==="string"||H==null)return JSON.stringify(H);if(Array.isArray(H)){for(var ae="[",ye=0,Pe=H;ye<Pe.length;ye+=1)ae+=he(Pe[ye])+",";return ae+"]"}for(var He=Object.keys(H).sort(),tt="{",fe=0;fe<He.length;fe++)tt+=JSON.stringify(He[fe])+":"+he(H[He[fe]])+",";return tt+"}"}function V(H){for(var J="",ae=0,ye=m.refProperties;ae<ye.length;ae+=1)J+="/"+he(H[ye[ae]]);return J}var ue=function(H){this.keyCache={},H&&this.replace(H)};ue.prototype.replace=function(H){this._layerConfigs={},this._layers={},this.update(H,[])},ue.prototype.update=function(H,J){for(var ae=this,ye=0,Pe=H;ye<Pe.length;ye+=1){var He=Pe[ye];this._layerConfigs[He.id]=He;var tt=this._layers[He.id]=m.createStyleLayer(He);tt._featureFilter=m.featureFilter(tt.filter),this.keyCache[He.id]&&delete this.keyCache[He.id]}for(var fe=0,ke=J;fe<ke.length;fe+=1){var ht=ke[fe];delete this.keyCache[ht],delete this._layerConfigs[ht],delete this._layers[ht]}this.familiesBySource={};for(var pr=0,kt=function(Br,Hr){for(var gi={},en=0;en<Br.length;en++){var yn=Hr&&Hr[Br[en].id]||V(Br[en]);Hr&&(Hr[Br[en].id]=yn);var Xi=gi[yn];Xi||(Xi=gi[yn]=[]),Xi.push(Br[en])}var vi=[];for(var Pi in gi)vi.push(gi[Pi]);return vi}(m.values(this._layerConfigs),this.keyCache);pr<kt.length;pr+=1){var Nt=kt[pr].map(function(Br){return ae._layers[Br.id]}),hr=Nt[0];if(hr.visibility!=="none"){var _n=hr.source||"",fn=this.familiesBySource[_n];fn||(fn=this.familiesBySource[_n]={});var Pt=hr.sourceLayer||"_geojsonTileLayer",Jr=fn[Pt];Jr||(Jr=fn[Pt]=[]),Jr.push(Nt)}}};var ce=function(H){var J={},ae=[];for(var ye in H){var Pe=H[ye],He=J[ye]={};for(var tt in Pe){var fe=Pe[+tt];if(fe&&fe.bitmap.width!==0&&fe.bitmap.height!==0){var ke={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};ae.push(ke),He[tt]={rect:ke,metrics:fe.metrics}}}}var ht=m.potpack(ae),pr=new m.AlphaImage({width:ht.w||1,height:ht.h||1});for(var kt in H){var Nt=H[kt];for(var hr in Nt){var _n=Nt[+hr];if(_n&&_n.bitmap.width!==0&&_n.bitmap.height!==0){var fn=J[kt][hr].rect;m.AlphaImage.copy(_n.bitmap,pr,{x:0,y:0},{x:fn.x+1,y:fn.y+1},_n.bitmap)}}}this.image=pr,this.positions=J};m.register("GlyphAtlas",ce);var Le=function(H){this.tileID=new m.OverscaledTileID(H.tileID.overscaledZ,H.tileID.wrap,H.tileID.canonical.z,H.tileID.canonical.x,H.tileID.canonical.y),this.uid=H.uid,this.zoom=H.zoom,this.pixelRatio=H.pixelRatio,this.tileSize=H.tileSize,this.source=H.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=H.showCollisionBoxes,this.collectResourceTiming=!!H.collectResourceTiming,this.returnDependencies=!!H.returnDependencies,this.promoteId=H.promoteId};function ee(H,J,ae){for(var ye=new m.EvaluationParameters(J),Pe=0,He=H;Pe<He.length;Pe+=1)He[Pe].recalculate(ye,ae)}function Xe(H,J){var ae=m.getArrayBuffer(H.request,function(ye,Pe,He,tt){ye?J(ye):Pe&&J(null,{vectorTile:new m.vectorTile.VectorTile(new m.pbf(Pe)),rawData:Pe,cacheControl:He,expires:tt})});return function(){ae.cancel(),J()}}Le.prototype.parse=function(H,J,ae,ye,Pe){var He=this;this.status="parsing",this.data=H,this.collisionBoxArray=new m.CollisionBoxArray;var tt=new m.DictionaryCoder(Object.keys(H.layers).sort()),fe=new m.FeatureIndex(this.tileID,this.promoteId);fe.bucketLayerIDs=[];var ke,ht,pr,kt,Nt={},hr={featureIndex:fe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ae},_n=J.familiesBySource[this.source];for(var fn in _n){var Pt=H.layers[fn];if(Pt){Pt.version===1&&m.warnOnce('Vector tile source "'+this.source+'" layer "'+fn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Jr=tt.encode(fn),Br=[],Hr=0;Hr<Pt.length;Hr++){var gi=Pt.feature(Hr),en=fe.getId(gi,fn);Br.push({feature:gi,id:en,index:Hr,sourceLayerIndex:Jr})}for(var yn=0,Xi=_n[fn];yn<Xi.length;yn+=1){var vi=Xi[yn],Pi=vi[0];Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(ee(vi,this.zoom,ae),(Nt[Pi.id]=Pi.createBucket({index:fe.bucketLayerIDs.length,layers:vi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Jr,sourceID:this.source})).populate(Br,hr,this.tileID.canonical),fe.bucketLayerIDs.push(vi.map(function(Ci){return Ci.id})))}}}var xi=m.mapObject(hr.glyphDependencies,function(Ci){return Object.keys(Ci).map(Number)});Object.keys(xi).length?ye.send("getGlyphs",{uid:this.uid,stacks:xi},function(Ci,Ii){ke||(ke=Ci,ht=Ii,Ta.call(He))}):ht={};var dt=Object.keys(hr.iconDependencies);dt.length?ye.send("getImages",{icons:dt,source:this.source,tileID:this.tileID,type:"icons"},function(Ci,Ii){ke||(ke=Ci,pr=Ii,Ta.call(He))}):pr={};var It=Object.keys(hr.patternDependencies);function Ta(){if(ke)return Pe(ke);if(ht&&pr&&kt){var Ci=new ce(ht),Ii=new m.ImageAtlas(pr,kt);for(var ji in Nt){var Ir=Nt[ji];Ir instanceof m.SymbolBucket?(ee(Ir.layers,this.zoom,ae),m.performSymbolLayout(Ir,ht,Ci.positions,pr,Ii.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Ir.hasPattern&&(Ir instanceof m.LineBucket||Ir instanceof m.FillBucket||Ir instanceof m.FillExtrusionBucket)&&(ee(Ir.layers,this.zoom,ae),Ir.addFeatures(hr,this.tileID.canonical,Ii.patternPositions))}this.status="done",Pe(null,{buckets:m.values(Nt).filter(function(on){return!on.isEmpty()}),featureIndex:fe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ci.image,imageAtlas:Ii,glyphMap:this.returnDependencies?ht:null,iconMap:this.returnDependencies?pr:null,glyphPositions:this.returnDependencies?Ci.positions:null})}}It.length?ye.send("getImages",{icons:It,source:this.source,tileID:this.tileID,type:"patterns"},function(Ci,Ii){ke||(ke=Ci,kt=Ii,Ta.call(He))}):kt={},Ta.call(this)};var Je=function(H,J,ae,ye){this.actor=H,this.layerIndex=J,this.availableImages=ae,this.loadVectorData=ye||Xe,this.loading={},this.loaded={}};Je.prototype.loadTile=function(H,J){var ae=this,ye=H.uid;this.loading||(this.loading={});var Pe=!!(H&&H.request&&H.request.collectResourceTiming)&&new m.RequestPerformance(H.request),He=this.loading[ye]=new Le(H);He.abort=this.loadVectorData(H,function(tt,fe){if(delete ae.loading[ye],tt||!fe)return He.status="done",ae.loaded[ye]=He,J(tt);var ke=fe.rawData,ht={};fe.expires&&(ht.expires=fe.expires),fe.cacheControl&&(ht.cacheControl=fe.cacheControl);var pr={};if(Pe){var kt=Pe.finish();kt&&(pr.resourceTiming=JSON.parse(JSON.stringify(kt)))}He.vectorTile=fe.vectorTile,He.parse(fe.vectorTile,ae.layerIndex,ae.availableImages,ae.actor,function(Nt,hr){if(Nt||!hr)return J(Nt);J(null,m.extend({rawTileData:ke.slice(0)},hr,ht,pr))}),ae.loaded=ae.loaded||{},ae.loaded[ye]=He})},Je.prototype.reloadTile=function(H,J){var ae=this,ye=this.loaded,Pe=H.uid,He=this;if(ye&&ye[Pe]){var tt=ye[Pe];tt.showCollisionBoxes=H.showCollisionBoxes;var fe=function(ke,ht){var pr=tt.reloadCallback;pr&&(delete tt.reloadCallback,tt.parse(tt.vectorTile,He.layerIndex,ae.availableImages,He.actor,pr)),J(ke,ht)};tt.status==="parsing"?tt.reloadCallback=fe:tt.status==="done"&&(tt.vectorTile?tt.parse(tt.vectorTile,this.layerIndex,this.availableImages,this.actor,fe):fe())}},Je.prototype.abortTile=function(H,J){var ae=this.loading,ye=H.uid;ae&&ae[ye]&&ae[ye].abort&&(ae[ye].abort(),delete ae[ye]),J()},Je.prototype.removeTile=function(H,J){var ae=this.loaded,ye=H.uid;ae&&ae[ye]&&delete ae[ye],J()};var Ze=m.window.ImageBitmap,gt=function(){this.loaded={}};function tr(H,J){if(H.length!==0){yt(H[0],J);for(var ae=1;ae<H.length;ae++)yt(H[ae],!J)}}function yt(H,J){for(var ae=0,ye=0,Pe=H.length,He=Pe-1;ye<Pe;He=ye++)ae+=(H[ye][0]-H[He][0])*(H[He][1]+H[ye][1]);ae>=0!=!!J&&H.reverse()}gt.prototype.loadTile=function(H,J){var ae=H.uid,ye=H.encoding,Pe=H.rawImageData,He=Ze&&Pe instanceof Ze?this.getImageData(Pe):Pe,tt=new m.DEMData(ae,He,ye);this.loaded=this.loaded||{},this.loaded[ae]=tt,J(null,tt)},gt.prototype.getImageData=function(H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);var J=this.offscreenCanvasContext.getImageData(-1,-1,H.width+2,H.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new m.RGBAImage({width:J.width,height:J.height},J.data)},gt.prototype.removeTile=function(H){var J=this.loaded,ae=H.uid;J&&J[ae]&&delete J[ae]};var Wt=m.vectorTile.VectorTileFeature.prototype.toGeoJSON,bt=function(H){this._feature=H,this.extent=m.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))};bt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var H=[],J=0,ae=this._feature.geometry;J<ae.length;J+=1){var ye=ae[J];H.push([new m.Point$1(ye[0],ye[1])])}return H}for(var Pe=[],He=0,tt=this._feature.geometry;He<tt.length;He+=1){for(var fe=[],ke=0,ht=tt[He];ke<ht.length;ke+=1){var pr=ht[ke];fe.push(new m.Point$1(pr[0],pr[1]))}Pe.push(fe)}return Pe},bt.prototype.toGeoJSON=function(H,J,ae){return Wt.call(this,H,J,ae)};var at=function(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=m.EXTENT,this.length=H.length,this._features=H};at.prototype.feature=function(H){return new bt(this._features[H])};var nt=m.vectorTile.VectorTileFeature,Zt=Y;function Y(H,J){this.options=J||{},this.features=H,this.length=H.length}function qt(H,J){this.id=typeof H.id=="number"?H.id:void 0,this.type=H.type,this.rawGeometry=H.type===1?[H.geometry]:H.geometry,this.properties=H.tags,this.extent=J||4096}Y.prototype.feature=function(H){return new qt(this.features[H],this.options.extent)},qt.prototype.loadGeometry=function(){var H=this.rawGeometry;this.geometry=[];for(var J=0;J<H.length;J++){for(var ae=H[J],ye=[],Pe=0;Pe<ae.length;Pe++)ye.push(new m.Point$1(ae[Pe][0],ae[Pe][1]));this.geometry.push(ye)}return this.geometry},qt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var H=this.geometry,J=1/0,ae=-1/0,ye=1/0,Pe=-1/0,He=0;He<H.length;He++)for(var tt=H[He],fe=0;fe<tt.length;fe++){var ke=tt[fe];J=Math.min(J,ke.x),ae=Math.max(ae,ke.x),ye=Math.min(ye,ke.y),Pe=Math.max(Pe,ke.y)}return[J,ye,ae,Pe]},qt.prototype.toGeoJSON=nt.prototype.toGeoJSON;var ut=Ct,Qe=Zt;function Ct(H){var J=new m.pbf;return function(ae,ye){for(var Pe in ae.layers)ye.writeMessage(3,$e,ae.layers[Pe])}(H,J),J.finish()}function $e(H,J){var ae;J.writeVarintField(15,H.version||1),J.writeStringField(1,H.name||""),J.writeVarintField(5,H.extent||4096);var ye={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<H.length;ae++)ye.feature=H.feature(ae),J.writeMessage(2,Kt,ye);var Pe=ye.keys;for(ae=0;ae<Pe.length;ae++)J.writeStringField(3,Pe[ae]);var He=ye.values;for(ae=0;ae<He.length;ae++)J.writeMessage(4,Ae,He[ae])}function Kt(H,J){var ae=H.feature;ae.id!==void 0&&J.writeVarintField(1,ae.id),J.writeMessage(2,xr,H),J.writeVarintField(3,ae.type),J.writeMessage(4,A,ae)}function xr(H,J){var ae=H.feature,ye=H.keys,Pe=H.values,He=H.keycache,tt=H.valuecache;for(var fe in ae.properties){var ke=He[fe];ke===void 0&&(ye.push(fe),He[fe]=ke=ye.length-1),J.writeVarint(ke);var ht=ae.properties[fe],pr=typeof ht;pr!=="string"&&pr!=="boolean"&&pr!=="number"&&(ht=JSON.stringify(ht));var kt=pr+":"+ht,Nt=tt[kt];Nt===void 0&&(Pe.push(ht),tt[kt]=Nt=Pe.length-1),J.writeVarint(Nt)}}function kr(H,J){return(J<<3)+(7&H)}function Kr(H){return H<<1^H>>31}function A(H,J){for(var ae=H.loadGeometry(),ye=H.type,Pe=0,He=0,tt=ae.length,fe=0;fe<tt;fe++){var ke=ae[fe],ht=1;ye===1&&(ht=ke.length),J.writeVarint(kr(1,ht));for(var pr=ye===3?ke.length-1:ke.length,kt=0;kt<pr;kt++){kt===1&&ye!==1&&J.writeVarint(kr(2,pr-1));var Nt=ke[kt].x-Pe,hr=ke[kt].y-He;J.writeVarint(Kr(Nt)),J.writeVarint(Kr(hr)),Pe+=Nt,He+=hr}ye===3&&J.writeVarint(kr(7,1))}}function Ae(H,J){var ae=typeof H;ae==="string"?J.writeStringField(1,H):ae==="boolean"?J.writeBooleanField(7,H):ae==="number"&&(H%1!=0?J.writeDoubleField(3,H):H<0?J.writeSVarintField(6,H):J.writeVarintField(5,H))}function De(H,J,ae,ye){At(H,ae,ye),At(J,2*ae,2*ye),At(J,2*ae+1,2*ye+1)}function At(H,J,ae){var ye=H[J];H[J]=H[ae],H[ae]=ye}function mt(H,J,ae,ye){var Pe=H-ae,He=J-ye;return Pe*Pe+He*He}ut.fromVectorTileJs=Ct,ut.fromGeojsonVt=function(H,J){J=J||{};var ae={};for(var ye in H)ae[ye]=new Zt(H[ye].features,J),ae[ye].name=ye,ae[ye].version=J.version,ae[ye].extent=J.extent;return Ct({layers:ae})},ut.GeoJSONWrapper=Qe;var Ft=function(H){return H[0]},Yt=function(H){return H[1]},Sr=function(H,J,ae,ye,Pe){J===void 0&&(J=Ft),ae===void 0&&(ae=Yt),ye===void 0&&(ye=64),Pe===void 0&&(Pe=Float64Array),this.nodeSize=ye,this.points=H;for(var He=H.length<65536?Uint16Array:Uint32Array,tt=this.ids=new He(H.length),fe=this.coords=new Pe(2*H.length),ke=0;ke<H.length;ke++)tt[ke]=ke,fe[2*ke]=J(H[ke]),fe[2*ke+1]=ae(H[ke]);(function ht(pr,kt,Nt,hr,_n,fn){if(!(_n-hr<=Nt)){var Pt=hr+_n>>1;(function Jr(Br,Hr,gi,en,yn,Xi){for(;yn>en;){if(yn-en>600){var vi=yn-en+1,Pi=gi-en+1,xi=Math.log(vi),dt=.5*Math.exp(2*xi/3),It=.5*Math.sqrt(xi*dt*(vi-dt)/vi)*(Pi-vi/2<0?-1:1);Jr(Br,Hr,gi,Math.max(en,Math.floor(gi-Pi*dt/vi+It)),Math.min(yn,Math.floor(gi+(vi-Pi)*dt/vi+It)),Xi)}var Ta=Hr[2*gi+Xi],Ci=en,Ii=yn;for(De(Br,Hr,en,gi),Hr[2*yn+Xi]>Ta&&De(Br,Hr,en,yn);Ci<Ii;){for(De(Br,Hr,Ci,Ii),Ci++,Ii--;Hr[2*Ci+Xi]<Ta;)Ci++;for(;Hr[2*Ii+Xi]>Ta;)Ii--}Hr[2*en+Xi]===Ta?De(Br,Hr,en,Ii):De(Br,Hr,++Ii,yn),Ii<=gi&&(en=Ii+1),gi<=Ii&&(yn=Ii-1)}})(pr,kt,Pt,hr,_n,fn%2),ht(pr,kt,Nt,hr,Pt-1,fn+1),ht(pr,kt,Nt,Pt+1,_n,fn+1)}})(tt,fe,ye,0,tt.length-1,0)};Sr.prototype.range=function(H,J,ae,ye){return function(Pe,He,tt,fe,ke,ht,pr){for(var kt,Nt,hr=[0,Pe.length-1,0],_n=[];hr.length;){var fn=hr.pop(),Pt=hr.pop(),Jr=hr.pop();if(Pt-Jr<=pr)for(var Br=Jr;Br<=Pt;Br++)Nt=He[2*Br+1],(kt=He[2*Br])>=tt&&kt<=ke&&Nt>=fe&&Nt<=ht&&_n.push(Pe[Br]);else{var Hr=Math.floor((Jr+Pt)/2);Nt=He[2*Hr+1],(kt=He[2*Hr])>=tt&&kt<=ke&&Nt>=fe&&Nt<=ht&&_n.push(Pe[Hr]);var gi=(fn+1)%2;(fn===0?tt<=kt:fe<=Nt)&&(hr.push(Jr),hr.push(Hr-1),hr.push(gi)),(fn===0?ke>=kt:ht>=Nt)&&(hr.push(Hr+1),hr.push(Pt),hr.push(gi))}}return _n}(this.ids,this.coords,H,J,ae,ye,this.nodeSize)},Sr.prototype.within=function(H,J,ae){return function(ye,Pe,He,tt,fe,ke){for(var ht=[0,ye.length-1,0],pr=[],kt=fe*fe;ht.length;){var Nt=ht.pop(),hr=ht.pop(),_n=ht.pop();if(hr-_n<=ke)for(var fn=_n;fn<=hr;fn++)mt(Pe[2*fn],Pe[2*fn+1],He,tt)<=kt&&pr.push(ye[fn]);else{var Pt=Math.floor((_n+hr)/2),Jr=Pe[2*Pt],Br=Pe[2*Pt+1];mt(Jr,Br,He,tt)<=kt&&pr.push(ye[Pt]);var Hr=(Nt+1)%2;(Nt===0?He-fe<=Jr:tt-fe<=Br)&&(ht.push(_n),ht.push(Pt-1),ht.push(Hr)),(Nt===0?He+fe>=Jr:tt+fe>=Br)&&(ht.push(Pt+1),ht.push(hr),ht.push(Hr))}}return pr}(this.ids,this.coords,H,J,ae,this.nodeSize)};var qn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(H){return H}},hn=function(H){this.options=ua(Object.create(qn),H),this.trees=new Array(this.options.maxZoom+1)};function fi(H,J,ae,ye,Pe){return{x:H,y:J,zoom:1/0,id:ae,parentId:-1,numPoints:ye,properties:Pe}}function Gn(H,J){var ae=H.geometry.coordinates,ye=ae[1];return{x:Wn(ae[0]),y:hi(ye),zoom:1/0,index:J,parentId:-1}}function ni(H){return{type:"Feature",id:H.id,properties:pi(H),geometry:{type:"Point",coordinates:[(ye=H.x,360*(ye-.5)),(J=H.y,ae=(180-360*J)*Math.PI/180,360*Math.atan(Math.exp(ae))/Math.PI-90)]}};var J,ae,ye}function pi(H){var J=H.numPoints,ae=J>=1e4?Math.round(J/1e3)+"k":J>=1e3?Math.round(J/100)/10+"k":J;return ua(ua({},H.properties),{cluster:!0,cluster_id:H.id,point_count:J,point_count_abbreviated:ae})}function Wn(H){return H/360+.5}function hi(H){var J=Math.sin(H*Math.PI/180),ae=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ae<0?0:ae>1?1:ae}function ua(H,J){for(var ae in J)H[ae]=J[ae];return H}function Gi(H){return H.x}function Di(H){return H.y}function $i(H,J,ae,ye,Pe,He){var tt=Pe-ae,fe=He-ye;if(tt!==0||fe!==0){var ke=((H-ae)*tt+(J-ye)*fe)/(tt*tt+fe*fe);ke>1?(ae=Pe,ye=He):ke>0&&(ae+=tt*ke,ye+=fe*ke)}return(tt=H-ae)*tt+(fe=J-ye)*fe}function la(H,J,ae,ye){var Pe={id:H===void 0?null:H,type:J,geometry:ae,tags:ye,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(He){var tt=He.geometry,fe=He.type;if(fe==="Point"||fe==="MultiPoint"||fe==="LineString")Mi(He,tt);else if(fe==="Polygon"||fe==="MultiLineString")for(var ke=0;ke<tt.length;ke++)Mi(He,tt[ke]);else if(fe==="MultiPolygon")for(ke=0;ke<tt.length;ke++)for(var ht=0;ht<tt[ke].length;ht++)Mi(He,tt[ke][ht])}(Pe),Pe}function Mi(H,J){for(var ae=0;ae<J.length;ae+=3)H.minX=Math.min(H.minX,J[ae]),H.minY=Math.min(H.minY,J[ae+1]),H.maxX=Math.max(H.maxX,J[ae]),H.maxY=Math.max(H.maxY,J[ae+1])}function ma(H,J,ae,ye){if(J.geometry){var Pe=J.geometry.coordinates,He=J.geometry.type,tt=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),fe=[],ke=J.id;if(ae.promoteId?ke=J.properties[ae.promoteId]:ae.generateId&&(ke=ye||0),He==="Point")Xn(Pe,fe);else if(He==="MultiPoint")for(var ht=0;ht<Pe.length;ht++)Xn(Pe[ht],fe);else if(He==="LineString")Si(Pe,fe,tt,!1);else if(He==="MultiLineString"){if(ae.lineMetrics){for(ht=0;ht<Pe.length;ht++)Si(Pe[ht],fe=[],tt,!1),H.push(la(ke,"LineString",fe,J.properties));return}Zi(Pe,fe,tt,!1)}else if(He==="Polygon")Zi(Pe,fe,tt,!0);else{if(He!=="MultiPolygon"){if(He==="GeometryCollection"){for(ht=0;ht<J.geometry.geometries.length;ht++)ma(H,{id:ke,geometry:J.geometry.geometries[ht],properties:J.properties},ae,ye);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ht=0;ht<Pe.length;ht++){var pr=[];Zi(Pe[ht],pr,tt,!0),fe.push(pr)}}H.push(la(ke,He,fe,J.properties))}}function Xn(H,J){J.push(Qi(H[0])),J.push(ko(H[1])),J.push(0)}function Si(H,J,ae,ye){for(var Pe,He,tt=0,fe=0;fe<H.length;fe++){var ke=Qi(H[fe][0]),ht=ko(H[fe][1]);J.push(ke),J.push(ht),J.push(0),fe>0&&(tt+=ye?(Pe*ht-ke*He)/2:Math.sqrt(Math.pow(ke-Pe,2)+Math.pow(ht-He,2))),Pe=ke,He=ht}var pr=J.length-3;J[2]=1,function kt(Nt,hr,_n,fn){for(var Pt,Jr=fn,Br=_n-hr>>1,Hr=_n-hr,gi=Nt[hr],en=Nt[hr+1],yn=Nt[_n],Xi=Nt[_n+1],vi=hr+3;vi<_n;vi+=3){var Pi=$i(Nt[vi],Nt[vi+1],gi,en,yn,Xi);if(Pi>Jr)Pt=vi,Jr=Pi;else if(Pi===Jr){var xi=Math.abs(vi-Br);xi<Hr&&(Pt=vi,Hr=xi)}}Jr>fn&&(Pt-hr>3&&kt(Nt,hr,Pt,fn),Nt[Pt+2]=Jr,_n-Pt>3&&kt(Nt,Pt,_n,fn))}(J,0,pr,ae),J[pr+2]=1,J.size=Math.abs(tt),J.start=0,J.end=J.size}function Zi(H,J,ae,ye){for(var Pe=0;Pe<H.length;Pe++){var He=[];Si(H[Pe],He,ae,ye),J.push(He)}}function Qi(H){return H/360+.5}function ko(H){var J=Math.sin(H*Math.PI/180),ae=.5-.25*Math.log((1+J)/(1-J))/Math.PI;return ae<0?0:ae>1?1:ae}function me(H,J,ae,ye,Pe,He,tt,fe){if(ye/=J,He>=(ae/=J)&&tt<ye)return H;if(tt<ae||He>=ye)return null;for(var ke=[],ht=0;ht<H.length;ht++){var pr=H[ht],kt=pr.geometry,Nt=pr.type,hr=Pe===0?pr.minX:pr.minY,_n=Pe===0?pr.maxX:pr.maxY;if(hr>=ae&&_n<ye)ke.push(pr);else if(!(_n<ae||hr>=ye)){var fn=[];if(Nt==="Point"||Nt==="MultiPoint")kn(kt,fn,ae,ye,Pe);else if(Nt==="LineString")Ha(kt,fn,ae,ye,Pe,!1,fe.lineMetrics);else if(Nt==="MultiLineString")Bt(kt,fn,ae,ye,Pe,!1);else if(Nt==="Polygon")Bt(kt,fn,ae,ye,Pe,!0);else if(Nt==="MultiPolygon")for(var Pt=0;Pt<kt.length;Pt++){var Jr=[];Bt(kt[Pt],Jr,ae,ye,Pe,!0),Jr.length&&fn.push(Jr)}if(fn.length){if(fe.lineMetrics&&Nt==="LineString"){for(Pt=0;Pt<fn.length;Pt++)ke.push(la(pr.id,Nt,fn[Pt],pr.tags));continue}Nt!=="LineString"&&Nt!=="MultiLineString"||(fn.length===1?(Nt="LineString",fn=fn[0]):Nt="MultiLineString"),Nt!=="Point"&&Nt!=="MultiPoint"||(Nt=fn.length===3?"Point":"MultiPoint"),ke.push(la(pr.id,Nt,fn,pr.tags))}}}return ke.length?ke:null}function kn(H,J,ae,ye,Pe){for(var He=0;He<H.length;He+=3){var tt=H[He+Pe];tt>=ae&&tt<=ye&&(J.push(H[He]),J.push(H[He+1]),J.push(H[He+2]))}}function Ha(H,J,ae,ye,Pe,He,tt){for(var fe,ke,ht=ns(H),pr=Pe===0?Cr:Qr,kt=H.start,Nt=0;Nt<H.length-3;Nt+=3){var hr=H[Nt],_n=H[Nt+1],fn=H[Nt+2],Pt=H[Nt+3],Jr=H[Nt+4],Br=Pe===0?hr:_n,Hr=Pe===0?Pt:Jr,gi=!1;tt&&(fe=Math.sqrt(Math.pow(hr-Pt,2)+Math.pow(_n-Jr,2))),Br<ae?Hr>ae&&(ke=pr(ht,hr,_n,Pt,Jr,ae),tt&&(ht.start=kt+fe*ke)):Br>ye?Hr<ye&&(ke=pr(ht,hr,_n,Pt,Jr,ye),tt&&(ht.start=kt+fe*ke)):rr(ht,hr,_n,fn),Hr<ae&&Br>=ae&&(ke=pr(ht,hr,_n,Pt,Jr,ae),gi=!0),Hr>ye&&Br<=ye&&(ke=pr(ht,hr,_n,Pt,Jr,ye),gi=!0),!He&&gi&&(tt&&(ht.end=kt+fe*ke),J.push(ht),ht=ns(H)),tt&&(kt+=fe)}var en=H.length-3;hr=H[en],_n=H[en+1],fn=H[en+2],(Br=Pe===0?hr:_n)>=ae&&Br<=ye&&rr(ht,hr,_n,fn),en=ht.length-3,He&&en>=3&&(ht[en]!==ht[0]||ht[en+1]!==ht[1])&&rr(ht,ht[0],ht[1],ht[2]),ht.length&&J.push(ht)}function ns(H){var J=[];return J.size=H.size,J.start=H.start,J.end=H.end,J}function Bt(H,J,ae,ye,Pe,He){for(var tt=0;tt<H.length;tt++)Ha(H[tt],J,ae,ye,Pe,He,!1)}function rr(H,J,ae,ye){H.push(J),H.push(ae),H.push(ye)}function Cr(H,J,ae,ye,Pe,He){var tt=(He-J)/(ye-J);return H.push(He),H.push(ae+(Pe-ae)*tt),H.push(1),tt}function Qr(H,J,ae,ye,Pe,He){var tt=(He-ae)/(Pe-ae);return H.push(J+(ye-J)*tt),H.push(He),H.push(1),tt}function Sn(H,J){for(var ae=[],ye=0;ye<H.length;ye++){var Pe,He=H[ye],tt=He.type;if(tt==="Point"||tt==="MultiPoint"||tt==="LineString")Pe=Fn(He.geometry,J);else if(tt==="MultiLineString"||tt==="Polygon"){Pe=[];for(var fe=0;fe<He.geometry.length;fe++)Pe.push(Fn(He.geometry[fe],J))}else if(tt==="MultiPolygon")for(Pe=[],fe=0;fe<He.geometry.length;fe++){for(var ke=[],ht=0;ht<He.geometry[fe].length;ht++)ke.push(Fn(He.geometry[fe][ht],J));Pe.push(ke)}ae.push(la(He.id,tt,Pe,He.tags))}return ae}function Fn(H,J){var ae=[];ae.size=H.size,H.start!==void 0&&(ae.start=H.start,ae.end=H.end);for(var ye=0;ye<H.length;ye+=3)ae.push(H[ye]+J,H[ye+1],H[ye+2]);return ae}function di(H,J){if(H.transformed)return H;var ae,ye,Pe,He=1<<H.z,tt=H.x,fe=H.y;for(ae=0;ae<H.features.length;ae++){var ke=H.features[ae],ht=ke.geometry,pr=ke.type;if(ke.geometry=[],pr===1)for(ye=0;ye<ht.length;ye+=2)ke.geometry.push(Kn(ht[ye],ht[ye+1],J,He,tt,fe));else for(ye=0;ye<ht.length;ye++){var kt=[];for(Pe=0;Pe<ht[ye].length;Pe+=2)kt.push(Kn(ht[ye][Pe],ht[ye][Pe+1],J,He,tt,fe));ke.geometry.push(kt)}}return H.transformed=!0,H}function Kn(H,J,ae,ye,Pe,He){return[Math.round(ae*(H*ye-Pe)),Math.round(ae*(J*ye-He))]}function an(H,J,ae,ye,Pe){for(var He=J===Pe.maxZoom?0:Pe.tolerance/((1<<J)*Pe.extent),tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:ye,z:J,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},fe=0;fe<H.length;fe++){tt.numFeatures++,Fi(tt,H[fe],He,Pe);var ke=H[fe].minX,ht=H[fe].minY,pr=H[fe].maxX,kt=H[fe].maxY;ke<tt.minX&&(tt.minX=ke),ht<tt.minY&&(tt.minY=ht),pr>tt.maxX&&(tt.maxX=pr),kt>tt.maxY&&(tt.maxY=kt)}return tt}function Fi(H,J,ae,ye){var Pe=J.geometry,He=J.type,tt=[];if(He==="Point"||He==="MultiPoint")for(var fe=0;fe<Pe.length;fe+=3)tt.push(Pe[fe]),tt.push(Pe[fe+1]),H.numPoints++,H.numSimplified++;else if(He==="LineString")Li(tt,Pe,H,ae,!1,!1);else if(He==="MultiLineString"||He==="Polygon")for(fe=0;fe<Pe.length;fe++)Li(tt,Pe[fe],H,ae,He==="Polygon",fe===0);else if(He==="MultiPolygon")for(var ke=0;ke<Pe.length;ke++){var ht=Pe[ke];for(fe=0;fe<ht.length;fe++)Li(tt,ht[fe],H,ae,!0,fe===0)}if(tt.length){var pr=J.tags||null;if(He==="LineString"&&ye.lineMetrics){for(var kt in pr={},J.tags)pr[kt]=J.tags[kt];pr.mapbox_clip_start=Pe.start/Pe.size,pr.mapbox_clip_end=Pe.end/Pe.size}var Nt={geometry:tt,type:He==="Polygon"||He==="MultiPolygon"?3:He==="LineString"||He==="MultiLineString"?2:1,tags:pr};J.id!==null&&(Nt.id=J.id),H.features.push(Nt)}}function Li(H,J,ae,ye,Pe,He){var tt=ye*ye;if(ye>0&&J.size<(Pe?tt:ye))ae.numPoints+=J.length/3;else{for(var fe=[],ke=0;ke<J.length;ke+=3)(ye===0||J[ke+2]>tt)&&(ae.numSimplified++,fe.push(J[ke]),fe.push(J[ke+1])),ae.numPoints++;Pe&&function(ht,pr){for(var kt=0,Nt=0,hr=ht.length,_n=hr-2;Nt<hr;_n=Nt,Nt+=2)kt+=(ht[Nt]-ht[_n])*(ht[Nt+1]+ht[_n+1]);if(kt>0===pr)for(Nt=0,hr=ht.length;Nt<hr/2;Nt+=2){var fn=ht[Nt],Pt=ht[Nt+1];ht[Nt]=ht[hr-2-Nt],ht[Nt+1]=ht[hr-1-Nt],ht[hr-2-Nt]=fn,ht[hr-1-Nt]=Pt}}(fe,He),H.push(fe)}}function ao(H,J){var ae=(J=this.options=function(Pe,He){for(var tt in He)Pe[tt]=He[tt];return Pe}(Object.create(this.options),J)).debug;if(ae&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");var ye=function(Pe,He){var tt=[];if(Pe.type==="FeatureCollection")for(var fe=0;fe<Pe.features.length;fe++)ma(tt,Pe.features[fe],He,fe);else ma(tt,Pe.type==="Feature"?Pe:{geometry:Pe},He);return tt}(H,J);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ye=function(Pe,He){var tt=He.buffer/He.extent,fe=Pe,ke=me(Pe,1,-1-tt,tt,0,-1,2,He),ht=me(Pe,1,1-tt,2+tt,0,-1,2,He);return(ke||ht)&&(fe=me(Pe,1,-tt,1+tt,0,-1,2,He)||[],ke&&(fe=Sn(ke,1).concat(fe)),ht&&(fe=fe.concat(Sn(ht,-1)))),fe}(ye,J)).length&&this.splitTile(ye,0,0,0),ae&&(ye.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vs(H,J,ae){return 32*((1<<H)*ae+J)+H}function Zo(H,J){var ae=H.tileID.canonical;if(!this._geoJSONIndex)return J(null,null);var ye=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!ye)return J(null,null);var Pe=new at(ye.features),He=ut(Pe);He.byteOffset===0&&He.byteLength===He.buffer.byteLength||(He=new Uint8Array(He)),J(null,{vectorTile:Pe,rawData:He.buffer})}hn.prototype.load=function(H){var J=this.options,ae=J.log,ye=J.minZoom,Pe=J.maxZoom,He=J.nodeSize;ae&&console.time("total time");var tt="prepare "+H.length+" points";ae&&console.time(tt),this.points=H;for(var fe=[],ke=0;ke<H.length;ke++)H[ke].geometry&&fe.push(Gn(H[ke],ke));this.trees[Pe+1]=new Sr(fe,Gi,Di,He,Float32Array),ae&&console.timeEnd(tt);for(var ht=Pe;ht>=ye;ht--){var pr=+Date.now();fe=this._cluster(fe,ht),this.trees[ht]=new Sr(fe,Gi,Di,He,Float32Array),ae&&console.log("z%d: %d clusters in %dms",ht,fe.length,+Date.now()-pr)}return ae&&console.timeEnd("total time"),this},hn.prototype.getClusters=function(H,J){var ae=((H[0]+180)%360+360)%360-180,ye=Math.max(-90,Math.min(90,H[1])),Pe=H[2]===180?180:((H[2]+180)%360+360)%360-180,He=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)ae=-180,Pe=180;else if(ae>Pe){var tt=this.getClusters([ae,ye,180,He],J),fe=this.getClusters([-180,ye,Pe,He],J);return tt.concat(fe)}for(var ke=this.trees[this._limitZoom(J)],ht=[],pr=0,kt=ke.range(Wn(ae),hi(He),Wn(Pe),hi(ye));pr<kt.length;pr+=1){var Nt=ke.points[kt[pr]];ht.push(Nt.numPoints?ni(Nt):this.points[Nt.index])}return ht},hn.prototype.getChildren=function(H){var J=this._getOriginId(H),ae=this._getOriginZoom(H),ye="No cluster with the specified id.",Pe=this.trees[ae];if(!Pe)throw new Error(ye);var He=Pe.points[J];if(!He)throw new Error(ye);for(var tt=this.options.radius/(this.options.extent*Math.pow(2,ae-1)),fe=[],ke=0,ht=Pe.within(He.x,He.y,tt);ke<ht.length;ke+=1){var pr=Pe.points[ht[ke]];pr.parentId===H&&fe.push(pr.numPoints?ni(pr):this.points[pr.index])}if(fe.length===0)throw new Error(ye);return fe},hn.prototype.getLeaves=function(H,J,ae){var ye=[];return this._appendLeaves(ye,H,J=J||10,ae=ae||0,0),ye},hn.prototype.getTile=function(H,J,ae){var ye=this.trees[this._limitZoom(H)],Pe=Math.pow(2,H),He=this.options,tt=He.radius/He.extent,fe=(ae-tt)/Pe,ke=(ae+1+tt)/Pe,ht={features:[]};return this._addTileFeatures(ye.range((J-tt)/Pe,fe,(J+1+tt)/Pe,ke),ye.points,J,ae,Pe,ht),J===0&&this._addTileFeatures(ye.range(1-tt/Pe,fe,1,ke),ye.points,Pe,ae,Pe,ht),J===Pe-1&&this._addTileFeatures(ye.range(0,fe,tt/Pe,ke),ye.points,-1,ae,Pe,ht),ht.features.length?ht:null},hn.prototype.getClusterExpansionZoom=function(H){for(var J=this._getOriginZoom(H)-1;J<=this.options.maxZoom;){var ae=this.getChildren(H);if(J++,ae.length!==1)break;H=ae[0].properties.cluster_id}return J},hn.prototype._appendLeaves=function(H,J,ae,ye,Pe){for(var He=0,tt=this.getChildren(J);He<tt.length;He+=1){var fe=tt[He],ke=fe.properties;if(ke&&ke.cluster?Pe+ke.point_count<=ye?Pe+=ke.point_count:Pe=this._appendLeaves(H,ke.cluster_id,ae,ye,Pe):Pe<ye?Pe++:H.push(fe),H.length===ae)break}return Pe},hn.prototype._addTileFeatures=function(H,J,ae,ye,Pe,He){for(var tt=0,fe=H;tt<fe.length;tt+=1){var ke=J[fe[tt]],ht=ke.numPoints,pr={type:1,geometry:[[Math.round(this.options.extent*(ke.x*Pe-ae)),Math.round(this.options.extent*(ke.y*Pe-ye))]],tags:ht?pi(ke):this.points[ke.index].properties},kt=void 0;ht?kt=ke.id:this.options.generateId?kt=ke.index:this.points[ke.index].id&&(kt=this.points[ke.index].id),kt!==void 0&&(pr.id=kt),He.features.push(pr)}},hn.prototype._limitZoom=function(H){return Math.max(this.options.minZoom,Math.min(+H,this.options.maxZoom+1))},hn.prototype._cluster=function(H,J){for(var ae=[],ye=this.options,Pe=ye.reduce,He=ye.minPoints,tt=ye.radius/(ye.extent*Math.pow(2,J)),fe=0;fe<H.length;fe++){var ke=H[fe];if(!(ke.zoom<=J)){ke.zoom=J;for(var ht=this.trees[J+1],pr=ht.within(ke.x,ke.y,tt),kt=ke.numPoints||1,Nt=kt,hr=0,_n=pr;hr<_n.length;hr+=1){var fn=ht.points[_n[hr]];fn.zoom>J&&(Nt+=fn.numPoints||1)}if(Nt>=He){for(var Pt=ke.x*kt,Jr=ke.y*kt,Br=Pe&&kt>1?this._map(ke,!0):null,Hr=(fe<<5)+(J+1)+this.points.length,gi=0,en=pr;gi<en.length;gi+=1){var yn=ht.points[en[gi]];if(!(yn.zoom<=J)){yn.zoom=J;var Xi=yn.numPoints||1;Pt+=yn.x*Xi,Jr+=yn.y*Xi,yn.parentId=Hr,Pe&&(Br||(Br=this._map(ke,!0)),Pe(Br,this._map(yn)))}}ke.parentId=Hr,ae.push(fi(Pt/Nt,Jr/Nt,Hr,Nt,Br))}else if(ae.push(ke),Nt>1)for(var vi=0,Pi=pr;vi<Pi.length;vi+=1){var xi=ht.points[Pi[vi]];xi.zoom<=J||(xi.zoom=J,ae.push(xi))}}}return ae},hn.prototype._getOriginId=function(H){return H-this.points.length>>5},hn.prototype._getOriginZoom=function(H){return(H-this.points.length)%32},hn.prototype._map=function(H,J){if(H.numPoints)return J?ua({},H.properties):H.properties;var ae=this.points[H.index].properties,ye=this.options.map(ae);return J&&ye===ae?ua({},ye):ye},ao.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ao.prototype.splitTile=function(H,J,ae,ye,Pe,He,tt){for(var fe=[H,J,ae,ye],ke=this.options,ht=ke.debug;fe.length;){ye=fe.pop(),ae=fe.pop(),J=fe.pop(),H=fe.pop();var pr=1<<J,kt=vs(J,ae,ye),Nt=this.tiles[kt];if(!Nt&&(ht>1&&console.time("creation"),Nt=this.tiles[kt]=an(H,J,ae,ye,ke),this.tileCoords.push({z:J,x:ae,y:ye}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,ae,ye,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));var hr="z"+J;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(Nt.source=H,Pe){if(J===ke.maxZoom||J===Pe)continue;var _n=1<<Pe-J;if(ae!==Math.floor(He/_n)||ye!==Math.floor(tt/_n))continue}else if(J===ke.indexMaxZoom||Nt.numPoints<=ke.indexMaxPoints)continue;if(Nt.source=null,H.length!==0){ht>1&&console.time("clipping");var fn,Pt,Jr,Br,Hr,gi,en=.5*ke.buffer/ke.extent,yn=.5-en,Xi=.5+en,vi=1+en;fn=Pt=Jr=Br=null,Hr=me(H,pr,ae-en,ae+Xi,0,Nt.minX,Nt.maxX,ke),gi=me(H,pr,ae+yn,ae+vi,0,Nt.minX,Nt.maxX,ke),H=null,Hr&&(fn=me(Hr,pr,ye-en,ye+Xi,1,Nt.minY,Nt.maxY,ke),Pt=me(Hr,pr,ye+yn,ye+vi,1,Nt.minY,Nt.maxY,ke),Hr=null),gi&&(Jr=me(gi,pr,ye-en,ye+Xi,1,Nt.minY,Nt.maxY,ke),Br=me(gi,pr,ye+yn,ye+vi,1,Nt.minY,Nt.maxY,ke),gi=null),ht>1&&console.timeEnd("clipping"),fe.push(fn||[],J+1,2*ae,2*ye),fe.push(Pt||[],J+1,2*ae,2*ye+1),fe.push(Jr||[],J+1,2*ae+1,2*ye),fe.push(Br||[],J+1,2*ae+1,2*ye+1)}}},ao.prototype.getTile=function(H,J,ae){var ye=this.options,Pe=ye.extent,He=ye.debug;if(H<0||H>24)return null;var tt=1<<H,fe=vs(H,J=(J%tt+tt)%tt,ae);if(this.tiles[fe])return di(this.tiles[fe],Pe);He>1&&console.log("drilling down to z%d-%d-%d",H,J,ae);for(var ke,ht=H,pr=J,kt=ae;!ke&&ht>0;)ht--,pr=Math.floor(pr/2),kt=Math.floor(kt/2),ke=this.tiles[vs(ht,pr,kt)];return ke&&ke.source?(He>1&&console.log("found parent tile z%d-%d-%d",ht,pr,kt),He>1&&console.time("drilling down"),this.splitTile(ke.source,ht,pr,kt,H,J,ae),He>1&&console.timeEnd("drilling down"),this.tiles[fe]?di(this.tiles[fe],Pe):null):null};var za=function(H){function J(ae,ye,Pe,He){H.call(this,ae,ye,Pe,Zo),He&&(this.loadGeoJSON=He)}return H&&(J.__proto__=H),(J.prototype=Object.create(H&&H.prototype)).constructor=J,J.prototype.loadData=function(ae,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ye,this._pendingLoadDataParams=ae,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},J.prototype._loadData=function(){var ae=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ye=this._pendingCallback,Pe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var He=!!(Pe&&Pe.request&&Pe.request.collectResourceTiming)&&new m.RequestPerformance(Pe.request);this.loadGeoJSON(Pe,function(tt,fe){if(tt||!fe)return ye(tt);if(typeof fe!="object")return ye(new Error("Input data given to '"+Pe.source+"' is not a valid GeoJSON object."));(function Nt(hr,_n){var fn,Pt=hr&&hr.type;if(Pt==="FeatureCollection")for(fn=0;fn<hr.features.length;fn++)Nt(hr.features[fn],_n);else if(Pt==="GeometryCollection")for(fn=0;fn<hr.geometries.length;fn++)Nt(hr.geometries[fn],_n);else if(Pt==="Feature")Nt(hr.geometry,_n);else if(Pt==="Polygon")tr(hr.coordinates,_n);else if(Pt==="MultiPolygon")for(fn=0;fn<hr.coordinates.length;fn++)tr(hr.coordinates[fn],_n);return hr})(fe,!0);try{if(Pe.filter){var ke=m.createExpression(Pe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ke.result==="error")throw new Error(ke.value.map(function(Nt){return Nt.key+": "+Nt.message}).join(", "));var ht=fe.features.filter(function(Nt){return ke.value.evaluate({zoom:0},Nt)});fe={type:"FeatureCollection",features:ht}}ae._geoJSONIndex=Pe.cluster?new hn(function(Nt){var hr=Nt.superclusterOptions,_n=Nt.clusterProperties;if(!_n||!hr)return hr;for(var fn={},Pt={},Jr={accumulated:null,zoom:0},Br={properties:null},Hr=Object.keys(_n),gi=0,en=Hr;gi<en.length;gi+=1){var yn=en[gi],Xi=_n[yn],vi=Xi[0],Pi=m.createExpression(Xi[1]),xi=m.createExpression(typeof vi=="string"?[vi,["accumulated"],["get",yn]]:vi);fn[yn]=Pi.value,Pt[yn]=xi.value}return hr.map=function(dt){Br.properties=dt;for(var It={},Ta=0,Ci=Hr;Ta<Ci.length;Ta+=1){var Ii=Ci[Ta];It[Ii]=fn[Ii].evaluate(Jr,Br)}return It},hr.reduce=function(dt,It){Br.properties=It;for(var Ta=0,Ci=Hr;Ta<Ci.length;Ta+=1){var Ii=Ci[Ta];Jr.accumulated=dt[Ii],dt[Ii]=Pt[Ii].evaluate(Jr,Br)}},hr}(Pe)).load(fe.features):function(Nt,hr){return new ao(Nt,hr)}(fe,Pe.geojsonVtOptions)}catch(Nt){return ye(Nt)}ae.loaded={};var pr={};if(He){var kt=He.finish();kt&&(pr.resourceTiming={},pr.resourceTiming[Pe.source]=JSON.parse(JSON.stringify(kt)))}ye(null,pr)})}},J.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},J.prototype.reloadTile=function(ae,ye){var Pe=this.loaded;return Pe&&Pe[ae.uid]?H.prototype.reloadTile.call(this,ae,ye):this.loadTile(ae,ye)},J.prototype.loadGeoJSON=function(ae,ye){if(ae.request)m.getJSON(ae.request,ye);else{if(typeof ae.data!="string")return ye(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."));try{return ye(null,JSON.parse(ae.data))}catch(Pe){return ye(new Error("Input data given to '"+ae.source+"' is not a valid GeoJSON object."))}}},J.prototype.removeSource=function(ae,ye){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ye()},J.prototype.getClusterExpansionZoom=function(ae,ye){try{ye(null,this._geoJSONIndex.getClusterExpansionZoom(ae.clusterId))}catch(Pe){ye(Pe)}},J.prototype.getClusterChildren=function(ae,ye){try{ye(null,this._geoJSONIndex.getChildren(ae.clusterId))}catch(Pe){ye(Pe)}},J.prototype.getClusterLeaves=function(ae,ye){try{ye(null,this._geoJSONIndex.getLeaves(ae.clusterId,ae.limit,ae.offset))}catch(Pe){ye(Pe)}},J}(Je),ba=function(H){var J=this;this.self=H,this.actor=new m.Actor(H,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Je,geojson:za},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(ae,ye){if(J.workerSourceTypes[ae])throw new Error('Worker source with name "'+ae+'" already registered.');J.workerSourceTypes[ae]=ye},this.self.registerRTLTextPlugin=function(ae){if(m.plugin.isParsed())throw new Error("RTL text plugin already registered.");m.plugin.applyArabicShaping=ae.applyArabicShaping,m.plugin.processBidirectionalText=ae.processBidirectionalText,m.plugin.processStyledBidirectionalText=ae.processStyledBidirectionalText}};return ba.prototype.setReferrer=function(H,J){this.referrer=J},ba.prototype.setImages=function(H,J,ae){for(var ye in this.availableImages[H]=J,this.workerSources[H]){var Pe=this.workerSources[H][ye];for(var He in Pe)Pe[He].availableImages=J}ae()},ba.prototype.setLayers=function(H,J,ae){this.getLayerIndex(H).replace(J),ae()},ba.prototype.updateLayers=function(H,J,ae){this.getLayerIndex(H).update(J.layers,J.removedIds),ae()},ba.prototype.loadTile=function(H,J,ae){this.getWorkerSource(H,J.type,J.source).loadTile(J,ae)},ba.prototype.loadDEMTile=function(H,J,ae){this.getDEMWorkerSource(H,J.source).loadTile(J,ae)},ba.prototype.reloadTile=function(H,J,ae){this.getWorkerSource(H,J.type,J.source).reloadTile(J,ae)},ba.prototype.abortTile=function(H,J,ae){this.getWorkerSource(H,J.type,J.source).abortTile(J,ae)},ba.prototype.removeTile=function(H,J,ae){this.getWorkerSource(H,J.type,J.source).removeTile(J,ae)},ba.prototype.removeDEMTile=function(H,J){this.getDEMWorkerSource(H,J.source).removeTile(J)},ba.prototype.removeSource=function(H,J,ae){if(this.workerSources[H]&&this.workerSources[H][J.type]&&this.workerSources[H][J.type][J.source]){var ye=this.workerSources[H][J.type][J.source];delete this.workerSources[H][J.type][J.source],ye.removeSource!==void 0?ye.removeSource(J,ae):ae()}},ba.prototype.loadWorkerSource=function(H,J,ae){try{this.self.importScripts(J.url),ae()}catch(ye){ae(ye.toString())}},ba.prototype.syncRTLPluginState=function(H,J,ae){try{m.plugin.setState(J);var ye=m.plugin.getPluginURL();if(m.plugin.isLoaded()&&!m.plugin.isParsed()&&ye!=null){this.self.importScripts(ye);var Pe=m.plugin.isParsed();ae(Pe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ye),Pe)}}catch(He){ae(He.toString())}},ba.prototype.getAvailableImages=function(H){var J=this.availableImages[H];return J||(J=[]),J},ba.prototype.getLayerIndex=function(H){var J=this.layerIndexes[H];return J||(J=this.layerIndexes[H]=new ue),J},ba.prototype.getWorkerSource=function(H,J,ae){var ye=this;return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][J]||(this.workerSources[H][J]={}),this.workerSources[H][J][ae]||(this.workerSources[H][J][ae]=new this.workerSourceTypes[J]({send:function(Pe,He,tt){ye.actor.send(Pe,He,tt,H)}},this.getLayerIndex(H),this.getAvailableImages(H))),this.workerSources[H][J][ae]},ba.prototype.getDEMWorkerSource=function(H,J){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][J]||(this.demWorkerSources[H][J]=new gt),this.demWorkerSources[H][J]},ba.prototype.enforceCacheSizeLimit=function(H,J){m.enforceCacheSizeLimit(J)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new ba(self)),ba}),re(["./shared"],function(m){"use strict";var he=m.createCommonjsModule(function(l){function f(E){return!c(E)}function c(E){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var P,k,Z=new Blob([""],{type:"text/javascript"}),X=URL.createObjectURL(Z);try{k=new Worker(X),P=!0}catch(le){P=!1}return k&&k.terminate(),URL.revokeObjectURL(X),P}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var P=document.createElement("canvas");P.width=P.height=1;var k=P.getContext("2d");if(!k)return!1;var Z=k.getImageData(0,0,1,1);return Z&&Z.width===P.width}()?(d[w=E&&E.failIfMajorPerformanceCaveat]===void 0&&(d[w]=function(P){var k=function(X){var le=document.createElement("canvas"),pe=Object.create(f.webGLContextAttributes);return pe.failIfMajorPerformanceCaveat=X,le.probablySupportsContext?le.probablySupportsContext("webgl",pe)||le.probablySupportsContext("experimental-webgl",pe):le.supportsContext?le.supportsContext("webgl",pe)||le.supportsContext("experimental-webgl",pe):le.getContext("webgl",pe)||le.getContext("experimental-webgl",pe)}(P);if(!k)return!1;var Z=k.createShader(k.VERTEX_SHADER);return!(!Z||k.isContextLost())&&(k.shaderSource(Z,"void main() {}"),k.compileShader(Z),k.getShaderParameter(Z,k.COMPILE_STATUS)===!0)}(w)),d[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),V={create:function(l,f,c){var d=m.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return m.window.document.createElementNS(l,f)}},ue=m.window.document&&m.window.document.documentElement.style;function ce(l){if(!ue)return l[0];for(var f=0;f<l.length;f++)if(l[f]in ue)return l[f];return l[0]}var Le,ee=ce(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);V.disableDrag=function(){ue&&ee&&(Le=ue[ee],ue[ee]="none")},V.enableDrag=function(){ue&&ee&&(ue[ee]=Le)};var Xe=ce(["transform","WebkitTransform"]);V.setTransform=function(l,f){l.style[Xe]=f};var Je=!1;try{var Ze=Object.defineProperty({},"passive",{get:function(){Je=!0}});m.window.addEventListener("test",Ze,Ze),m.window.removeEventListener("test",Ze,Ze)}catch(l){Je=!1}V.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&Je?d:d.capture)},V.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&Je?d:d.capture)};var gt=function(l){l.preventDefault(),l.stopPropagation(),m.window.removeEventListener("click",gt,!0)};function tr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}V.suppressClick=function(){m.window.addEventListener("click",gt,!0),m.window.setTimeout(function(){m.window.removeEventListener("click",gt,!0)},0)},V.mousePos=function(l,f){var c=l.getBoundingClientRect();return new m.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},V.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],E=0;E<f.length;E++)d.push(new m.Point(f[E].clientX-c.left-l.clientLeft,f[E].clientY-c.top-l.clientTop));return d},V.mouseButton=function(l){return m.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&m.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},V.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var yt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new m.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,E=this.requestors;d<E.length;d+=1){var w=E[d];this._notify(w.ids,w.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var E=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),E=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),E=!1),this._validateContent(d.content,d)||(this.fire(new m.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),E=!1),E},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var E=0,w=0,P=c;w<P.length;w+=1){var k=P[w];if(k[0]<E||k[1]<k[0]||d<k[1])return!1;E=k[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var E=!0;if(!this.isLoaded())for(var w=0,P=c;w<P.length;w+=1)this.images[P[w]]||(E=!1);this.isLoaded()||E?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var E={},w=0,P=c;w<P.length;w+=1){var k=P[w];this.images[k]||this.fire(new m.Event("styleimagemissing",{id:k}));var Z=this.images[k];Z?E[k]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:m.warnOnce('Image "'+k+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,E)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],E=this.getImage(c);if(!E)return null;if(d&&d.position.version===E.version)return d.position;if(d)d.position.version=E.version;else{var w={w:E.data.width+2,h:E.data.height+2,x:0,y:0},P=new m.ImagePosition(w,E);this.patterns[c]={bin:w,position:P}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new m.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var E=m.potpack(c),w=E.w,P=E.h,k=this.atlasImage;for(var Z in k.resize({width:w||1,height:P||1}),this.patterns){var X=this.patterns[Z].bin,le=X.x+1,pe=X.y+1,ve=this.images[Z].data,Re=ve.width,Ie=ve.height;m.RGBAImage.copy(ve,k,{x:0,y:0},{x:le,y:pe},{width:Re,height:Ie}),m.RGBAImage.copy(ve,k,{x:0,y:Ie-1},{x:le,y:pe-1},{width:Re,height:1}),m.RGBAImage.copy(ve,k,{x:0,y:0},{x:le,y:pe+Ie},{width:Re,height:1}),m.RGBAImage.copy(ve,k,{x:Re-1,y:0},{x:le-1,y:pe},{width:1,height:Ie}),m.RGBAImage.copy(ve,k,{x:0,y:0},{x:le+Re,y:pe},{width:1,height:Ie})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,E=c;d<E.length;d+=1){var w=E[d];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var P=this.images[w];tr(P)&&this.updateImage(w,P)}}},f}(m.Evented),Wt=nt,bt=nt,at=1e20;function nt(l,f,c,d,E,w){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=E||"sans-serif",this.fontWeight=w||"normal",this.radius=c||8;var P=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=P,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.d=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Int16Array(P),this.middle=Math.round(P/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Zt(l,f,c,d,E,w,P){for(var k=0;k<f;k++){for(var Z=0;Z<c;Z++)d[Z]=l[Z*f+k];for(Y(d,E,w,P,c),Z=0;Z<c;Z++)l[Z*f+k]=E[Z]}for(Z=0;Z<c;Z++){for(k=0;k<f;k++)d[k]=l[Z*f+k];for(Y(d,E,w,P,f),k=0;k<f;k++)l[Z*f+k]=Math.sqrt(E[k])}}function Y(l,f,c,d,E){c[0]=0,d[0]=-at,d[1]=+at;for(var w=1,P=0;w<E;w++){for(var k=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);k<=d[P];)P--,k=(l[w]+w*w-(l[c[P]]+c[P]*c[P]))/(2*w-2*c[P]);c[++P]=w,d[P]=k,d[P+1]=+at}for(w=0,P=0;w<E;w++){for(;d[P+1]<w;)P++;f[w]=(w-c[P])*(w-c[P])+l[c[P]]}}nt.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var E=f.data[4*d+3]/255;this.gridOuter[d]=E===1?0:E===0?at:Math.pow(Math.max(0,.5-E),2),this.gridInner[d]=E===1?at:E===0?0:Math.pow(Math.max(0,E-.5),2)}for(Zt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Zt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Wt.default=bt;var qt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};qt.prototype.setURL=function(l){this.url=l},qt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var E in l)for(var w=0,P=l[E];w<P.length;w+=1)d.push({stack:E,id:P[w]});m.asyncAll(d,function(k,Z){var X=k.stack,le=k.id,pe=c.entries[X];pe||(pe=c.entries[X]={glyphs:{},requests:{},ranges:{}});var ve=pe.glyphs[le];if(ve===void 0){if(ve=c._tinySDF(pe,X,le))return pe.glyphs[le]=ve,void Z(null,{stack:X,id:le,glyph:ve});var Re=Math.floor(le/256);if(256*Re>65535)Z(new Error("glyphs > 65535 not supported"));else if(pe.ranges[Re])Z(null,{stack:X,id:le,glyph:ve});else{var Ie=pe.requests[Re];Ie||(Ie=pe.requests[Re]=[],qt.loadGlyphRange(X,Re,c.url,c.requestManager,function(ze,Ee){if(Ee){for(var Ve in Ee)c._doesCharSupportLocalGlyph(+Ve)||(pe.glyphs[+Ve]=Ee[+Ve]);pe.ranges[Re]=!0}for(var et=0,vt=Ie;et<vt.length;et+=1)(0,vt[et])(ze,Ee);delete pe.requests[Re]})),Ie.push(function(ze,Ee){ze?Z(ze):Ee&&Z(null,{stack:X,id:le,glyph:Ee[le]||null})})}}else Z(null,{stack:X,id:le,glyph:ve})},function(k,Z){if(k)f(k);else if(Z){for(var X={},le=0,pe=Z;le<pe.length;le+=1){var ve=pe[le],Re=ve.stack,Ie=ve.id,ze=ve.glyph;(X[Re]||(X[Re]={}))[Ie]=ze&&{id:ze.id,bitmap:ze.bitmap.clone(),metrics:ze.metrics}}f(null,X)}})},qt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(m.isChar["CJK Unified Ideographs"](l)||m.isChar["Hangul Syllables"](l)||m.isChar.Hiragana(l)||m.isChar.Katakana(l))},qt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var E=l.tinySDF;if(!E){var w="400";/bold/i.test(f)?w="900":/medium/i.test(f)?w="500":/light/i.test(f)&&(w="200"),E=l.tinySDF=new qt.TinySDF(24,3,8,.25,d,w)}return{id:c,bitmap:new m.AlphaImage({width:30,height:30},E.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},qt.loadGlyphRange=function(l,f,c,d,E){var w=256*f,P=w+255,k=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",w+"-"+P),m.ResourceType.Glyphs);m.getArrayBuffer(k,function(Z,X){if(Z)E(Z);else if(X){for(var le={},pe=0,ve=m.parseGlyphPBF(X);pe<ve.length;pe+=1){var Re=ve[pe];le[Re.id]=Re}E(null,le)}})},qt.TinySDF=Wt;var ut=function(){this.specification=m.styleSpec.light.position};ut.prototype.possiblyEvaluate=function(l,f){return m.sphericalToCartesian(l.expression.evaluate(f))},ut.prototype.interpolate=function(l,f,c){return{x:m.number(l.x,f.x,c),y:m.number(l.y,f.y,c),z:m.number(l.z,f.z,c)}};var Qe=new m.Properties({anchor:new m.DataConstantProperty(m.styleSpec.light.anchor),position:new ut,color:new m.DataConstantProperty(m.styleSpec.light.color),intensity:new m.DataConstantProperty(m.styleSpec.light.intensity)}),Ct=function(l){function f(c){l.call(this),this._transitionable=new m.Transitionable(Qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(m.validateLight,c,d))for(var E in c){var w=c[E];m.endsWith(E,"-transition")?this._transitionable.setTransition(E.slice(0,-"-transition".length),w):this._transitionable.setValue(E,w)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,E){return(!E||E.validate!==!1)&&m.emitValidationErrors(this,c.call(m.validateStyle,m.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:m.styleSpec})))},f}(m.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var d=[],E=l.length%2==1?-l[l.length-1]*c:0,w=l[0]*c,P=!0;d.push({left:E,right:w,isDash:P,zeroLength:l[0]===0});for(var k=l[0],Z=1;Z<l.length;Z++){var X=l[Z];d.push({left:E=k*c,right:w=(k+=X)*c,isDash:P=!P,zeroLength:X===0})}return d},$e.prototype.addRoundDash=function(l,f,c){for(var d=f/2,E=-c;E<=c;E++)for(var w=this.width*(this.nextRow+c+E),P=0,k=l[P],Z=0;Z<this.width;Z++){Z/k.right>1&&(k=l[++P]);var X=Math.abs(Z-k.left),le=Math.abs(Z-k.right),pe=Math.min(X,le),ve=void 0,Re=E/c*(d+1);if(k.isDash){var Ie=d-Math.abs(Re);ve=Math.sqrt(pe*pe+Ie*Ie)}else ve=d-Math.sqrt(pe*pe+Re*Re);this.data[w+Z]=Math.max(0,Math.min(255,ve+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var E=l[0],w=l[l.length-1];E.isDash===w.isDash&&(E.left=w.left-this.width,w.right=E.right+this.width);for(var P=this.width*this.nextRow,k=0,Z=l[k],X=0;X<this.width;X++){X/Z.right>1&&(Z=l[++k]);var le=Math.abs(X-Z.left),pe=Math.abs(X-Z.right),ve=Math.min(le,pe);this.data[P+X]=Math.max(0,Math.min(255,(Z.isDash?ve:-ve)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return m.warnOnce("LineAtlas out of space"),null;for(var E=0,w=0;w<l.length;w++)E+=l[w];if(E!==0){var P=this.width/E,k=this.getDashRanges(l,this.width,P);f?this.addRoundDash(k,P,c):this.addRegularDash(k)}var Z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:E};return this.nextRow+=d,this.dirty=!0,Z},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Kt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=m.uniqueId();for(var d=this.workerPool.acquire(this.id),E=0;E<d.length;E++){var w=new l.Actor(d[E],c,this.id);w.name="Worker "+E,this.actors.push(w)}};function xr(l,f,c){var d=function(E,w){if(E)return c(E);if(w){var P=m.pick(m.extend(w,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(P.vectorLayers=w.vector_layers,P.vectorLayerIds=P.vectorLayers.map(function(k){return k.id})),P.tiles=f.canonicalizeTileset(P,l.url),c(null,P)}};return l.url?m.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),m.ResourceType.Source),d):m.browser.frame(function(){return d(null,l)})}Kt.prototype.broadcast=function(l,f,c){m.asyncAll(this.actors,function(d,E){d.send(l,f,E)},c=c||function(){})},Kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Kt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},Kt.Actor=m.Actor;var kr=function(l,f,c){this.bounds=m.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};kr.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},kr.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(m.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(m.mercatorYfromLat(this.bounds.getNorth())*f),E=Math.ceil(m.mercatorXfromLng(this.bounds.getEast())*f),w=Math.ceil(m.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<E&&l.y>=d&&l.y<w};var Kr=function(l){function f(c,d,E,w){if(l.call(this),this.id=c,this.dispatcher=E,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,m.extend(this,m.pick(d,["url","scheme","tileSize","promoteId"])),this._options=m.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles,c.map._requestManager._customAccessToken),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(E,m.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function P(k,Z){return delete c.request,c.aborted?d(null):k&&k.status!==404?d(k):(Z&&Z.resourceTiming&&(c.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&c.setExpiryData(Z),c.loadVectorData(Z,this.map.painter),m.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",w,P.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",w,P.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(m.Evented),A=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=m.extend({type:"raster"},d),m.extend(this,m.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(d,E){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new m.ErrorEvent(d)):E&&(m.extend(c,E),E.bounds&&(c.tileBounds=new kr(E.bounds,c.minzoom,c.maxzoom)),m.postTurnstileEvent(E.tiles),m.postMapLoadEvent(E.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return m.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var E=this,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=m.getImage(this.map._requestManager.transformRequest(w,m.ResourceType.Tile),function(P,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(k){E.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var Z=E.map.painter.context,X=Z.gl;c.texture=E.map.painter.getTileTexture(k.width),c.texture?c.texture.update(k,{useMipmap:!0}):(c.texture=new m.Texture(Z,k,X.RGBA,{useMipmap:!0}),c.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&X.texParameterf(X.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),c.state="loaded",m.cacheEntryPossiblyAdded(E.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ae=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.type="raster-dem",this.maxzoom=22,this._options=m.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var E=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(P,k){P&&(c.state="errored",d(P)),k&&(c.dem=k,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=m.getImage(this.map._requestManager.transformRequest(E,m.ResourceType.Tile),function(P,k){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(P)c.state="errored",d(P);else if(k){this.map._refreshExpiredTiles&&c.setExpiryData(k),delete k.cacheControl,delete k.expires;var Z=m.window.ImageBitmap&&k instanceof m.window.ImageBitmap&&m.offscreenCanvasSupported()?k:m.browser.getImageData(k,1),X={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",X,w.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,E=Math.pow(2,d.z),w=(d.x-1+E)%E,P=d.x===0?c.wrap-1:c.wrap,k=(d.x+1+E)%E,Z=d.x+1===E?c.wrap+1:c.wrap,X={};return X[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,Z,d.z,k,d.y).key]={backfilled:!1},d.y>0&&(X[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y-1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,Z,d.z,k,d.y-1).key]={backfilled:!1}),d.y+1<E&&(X[new m.OverscaledTileID(c.overscaledZ,P,d.z,w,d.y+1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},X[new m.OverscaledTileID(c.overscaledZ,Z,d.z,k,d.y+1).key]={backfilled:!1}),X},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(A),De=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=E.getActor(),this.setEventedParent(w),this._data=d.data,this._options=m.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var P=m.EXTENT/this.tileSize;this.workerOptions=m.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*P,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*P,extent:m.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:m.EXTENT,radius:(d.clusterRadius||50)*P,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new m.ErrorEvent(d));else{var E={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(E.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new m.Event("data",E))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new m.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(E){if(E)d.fire(new m.ErrorEvent(E));else{var w={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(w.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new m.Event("data",w))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,E,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:E},w),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var E=m.extend({},this.workerOptions),w=this._data;typeof w=="string"?(E.request=this.map._requestManager.transformRequest(m.browser.resolveURL(w),m.ResourceType.Source),E.request.collectResourceTiming=this._collectResourceTiming):E.data=JSON.stringify(w),this.actor.send(this.type+".loadData",E,function(P,k){d._removed||k&&k.abandoned||(d._loaded=!0,k&&k.resourceTiming&&k.resourceTiming[d.id]&&(d._resourceTiming=k.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:E.source},null),c(P))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var E=this,w=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(w,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:m.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(P,k){return delete c.request,c.unloadVectorData(),c.aborted?d(null):P?d(P):(c.loadVectorData(k,E.map.painter,w==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return m.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(m.Evented),At=m.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),mt=function(l){function f(c,d,E,w){l.call(this),this.id=c,this.dispatcher=E,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var E=this;this._loaded=!1,this.fire(new m.Event("dataloading",{dataType:"source"})),this.url=this.options.url,m.getImage(this.map._requestManager.transformRequest(this.url,m.ResourceType.Image),function(w,P){E._loaded=!0,w?E.fire(new m.ErrorEvent(w)):P&&(E.image=P,c&&(E.coordinates=c),d&&d(),E._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var E=c.map(m.MercatorCoordinate.fromLngLat);this.tileID=function(P){for(var k=1/0,Z=1/0,X=-1/0,le=-1/0,pe=0,ve=P;pe<ve.length;pe+=1){var Re=ve[pe];k=Math.min(k,Re.x),Z=Math.min(Z,Re.y),X=Math.max(X,Re.x),le=Math.max(le,Re.y)}var Ie=Math.max(X-k,le-Z),ze=Math.max(0,Math.floor(-Math.log(Ie)/Math.LN2)),Ee=Math.pow(2,ze);return new m.CanonicalTileID(ze,Math.floor((k+X)/2*Ee),Math.floor((Z+le)/2*Ee))}(E),this.minzoom=this.maxzoom=this.tileID.z;var w=E.map(function(P){return d.tileID.getTilePoint(P)._round()});return this._boundsArray=new m.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,m.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,m.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,m.EXTENT,m.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new m.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new m.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(m.Evented),Ft=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var E=0,w=d.urls;E<w.length;E+=1)this.urls.push(this.map._requestManager.transformRequest(w[E],m.ResourceType.Source).url);m.getVideo(this.urls,function(P,k){c._loaded=!0,P?c.fire(new m.ErrorEvent(P)):k&&(c.video=k,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new m.ErrorEvent(new m.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var E in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new m.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[E];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(mt),Yt=function(l){function f(c,d,E,w){l.call(this,c,d,E,w),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(P){return!Array.isArray(P)||P.length!==2||P.some(function(k){return typeof k!="number"})})||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof m.window.HTMLCanvasElement||this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new m.ErrorEvent(new m.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof m.window.HTMLCanvasElement?this.options.canvas:m.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new m.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,E=d.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=m.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new m.Texture(d,this.canvas,E.RGBA,{premultiply:!0}),this.tiles){var P=this.tiles[w];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var E=d[c];if(isNaN(E)||E<=0)return!0}return!1},f}(mt),Sr={vector:Kr,raster:A,"raster-dem":Ae,geojson:De,video:Ft,image:mt,canvas:Yt};function qn(l,f){var c=m.identity([]);return m.translate(c,c,[1,1,0]),m.scale(c,c,[.5*l.width,.5*l.height,1]),m.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function hn(l,f,c,d,E,w){var P=function(ze,Ee,Ve){if(ze)for(var et=0,vt=ze;et<vt.length;et+=1){var Xt=Ee[vt[et]];if(Xt&&Xt.source===Ve&&Xt.type==="fill-extrusion")return!0}else for(var jt in Ee){var Qt=Ee[jt];if(Qt.source===Ve&&Qt.type==="fill-extrusion")return!0}return!1}(E&&E.layers,f,l.id),k=w.maxPitchScaleFactor(),Z=l.tilesIn(d,k,P);Z.sort(fi);for(var X=[],le=0,pe=Z;le<pe.length;le+=1){var ve=pe[le];X.push({wrappedTileID:ve.tileID.wrapped().key,queryResults:ve.tile.queryRenderedFeatures(f,c,l._state,ve.queryGeometry,ve.cameraQueryGeometry,ve.scale,E,w,k,qn(l.transform,ve.tileID))})}var Re=function(ze){for(var Ee={},Ve={},et=0,vt=ze;et<vt.length;et+=1){var Xt=vt[et],jt=Xt.queryResults,Qt=Xt.wrappedTileID,dr=Ve[Qt]=Ve[Qt]||{};for(var Lr in jt)for(var gr=jt[Lr],sn=dr[Lr]=dr[Lr]||{},zn=Ee[Lr]=Ee[Lr]||[],Un=0,Ln=gr;Un<Ln.length;Un+=1){var ki=Ln[Un];sn[ki.featureIndex]||(sn[ki.featureIndex]=!0,zn.push(ki))}}return Ee}(X);for(var Ie in Re)Re[Ie].forEach(function(ze){var Ee=ze.feature,Ve=l.getFeatureState(Ee.layer["source-layer"],Ee.id);Ee.source=Ee.layer.source,Ee.layer["source-layer"]&&(Ee.sourceLayer=Ee.layer["source-layer"]),Ee.state=Ve});return Re}function fi(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Gn=function(l,f){this.max=l,this.onRemove=f,this.reset()};Gn.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Gn.prototype.add=function(l,f,c){var d=this,E=l.wrapped().key;this.data[E]===void 0&&(this.data[E]=[]);var w={value:f,timeout:void 0};if(c!==void 0&&(w.timeout=setTimeout(function(){d.remove(l,w)},c)),this.data[E].push(w),this.order.push(E),this.order.length>this.max){var P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this},Gn.prototype.has=function(l){return l.wrapped().key in this.data},Gn.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Gn.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Gn.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Gn.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Gn.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),E=this.data[c][d];return this.data[c].splice(d,1),E.timeout&&clearTimeout(E.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(E.value),this.order.splice(this.order.indexOf(c),1),this},Gn.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Gn.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,E=this.data[c];d<E.length;d+=1){var w=E[d];l(w.value)||f.push(w)}for(var P=0,k=f;P<k.length;P+=1){var Z=k[P];this.remove(Z.value.tileID,Z)}};var ni=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};ni.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},ni.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},ni.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var pi={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Wn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var E=l.gl;this.buffer=E.createBuffer(),l.bindVertexBuffer.set(this.buffer),E.bufferData(E.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Wn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Wn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Wn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Wn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var E=this.attributes[d],w=f.attributes[E.name];w!==void 0&&l.vertexAttribPointer(w,E.components,l[pi[E.type]],!1,this.itemSize,E.offset+this.itemSize*(c||0))}},Wn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var hi=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};hi.prototype.get=function(){return this.current},hi.prototype.set=function(l){},hi.prototype.getDefault=function(){return this.default},hi.prototype.setDefault=function(){this.set(this.default)};var ua=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(hi),Gi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(hi),Di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(hi),$i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(hi),la=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(hi),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(hi),ma=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(hi),Xn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(hi),Si=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(hi),Zi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(hi),Qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(hi),ko=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(hi),me=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(hi),kn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(hi),Ha=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return m.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(hi),ns=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(hi),Bt=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(hi),rr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(hi),Cr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(hi),Qr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(hi),Sn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(hi),Fn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(hi),di=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(hi),Kn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(hi),an=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(hi),Fi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(hi),Li=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(hi),ao=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(hi),vs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(hi),Zo=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(hi),za=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(hi),ba=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(hi),H=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(ba),J=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ba),ae=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var E=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new H(l,E),d&&(this.depthAttachment=new J(l,E))};ae.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ye=function(l,f,c){this.func=l,this.mask=f,this.range=c};ye.ReadOnly=!1,ye.ReadWrite=!0,ye.disabled=new ye(519,ye.ReadOnly,[0,1]);var Pe=function(l,f,c,d,E,w){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=E,this.pass=w};Pe.disabled=new Pe({func:519,mask:0},0,0,7680,7680,7680);var He=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};He.disabled=new He(He.Replace=[1,0],m.Color.transparent,[!1,!1,!1,!1]),He.unblended=new He(He.Replace,m.Color.transparent,[!0,!0,!0,!0]),He.alphaBlended=new He([1,771],m.Color.transparent,[!0,!0,!0,!0]);var tt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};tt.disabled=new tt(!1,1029,2305),tt.backCCW=new tt(!0,1029,2305);var fe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ua(this),this.clearDepth=new Gi(this),this.clearStencil=new Di(this),this.colorMask=new $i(this),this.depthMask=new la(this),this.stencilMask=new Mi(this),this.stencilFunc=new ma(this),this.stencilOp=new Xn(this),this.stencilTest=new Si(this),this.depthRange=new Zi(this),this.depthTest=new Qi(this),this.depthFunc=new ko(this),this.blend=new me(this),this.blendFunc=new kn(this),this.blendColor=new Ha(this),this.blendEquation=new ns(this),this.cullFace=new Bt(this),this.cullFaceSide=new rr(this),this.frontFace=new Cr(this),this.program=new Qr(this),this.activeTexture=new Sn(this),this.viewport=new Fn(this),this.bindFramebuffer=new di(this),this.bindRenderbuffer=new Kn(this),this.bindTexture=new an(this),this.bindVertexBuffer=new Fi(this),this.bindElementBuffer=new Li(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ao(this),this.pixelStoreUnpack=new vs(this),this.pixelStoreUnpackPremultiplyAlpha=new Zo(this),this.pixelStoreUnpackFlipY=new za(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};fe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},fe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},fe.prototype.createIndexBuffer=function(l,f){return new ni(this,l,f)},fe.prototype.createVertexBuffer=function(l,f,c){return new Wn(this,l,f,c)},fe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,E=d.createRenderbuffer();return this.bindRenderbuffer.set(E),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),E},fe.prototype.createFramebuffer=function(l,f,c){return new ae(this,l,f,c)},fe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,E=0;f&&(E|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(E|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(E)},fe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},fe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},fe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},fe.prototype.setColorMode=function(l){m.deepEqual(l.blendFunction,He.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},fe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var ke=function(l){function f(c,d,E){var w=this;l.call(this),this.id=c,this.dispatcher=E,this.on("data",function(P){P.dataType==="source"&&P.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&P.dataType==="source"&&P.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(P,k,Z,X){var le=new Sr[k.type](P,k,Z,X);if(le.id!==P)throw new Error("Expected Source id to be "+P+" instead of "+le.id);return m.bindAll(["load","abort","unload","serialize","prepare"],le),le}(c,d,E,this),this._tiles={},this._cache=new Gn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new m.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var E=this._tiles[d];E.upload(c),E.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return m.values(this._tiles).map(function(c){return c.tileID}).sort(ht).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,E=[];for(var w in this._tiles)this._isIdRenderable(w,c)&&E.push(this._tiles[w]);return c?E.sort(function(P,k){var Z=P.tileID,X=k.tileID,le=new m.Point(Z.canonical.x,Z.canonical.y)._rotate(d.transform.angle),pe=new m.Point(X.canonical.x,X.canonical.y)._rotate(d.transform.angle);return Z.overscaledZ-X.overscaledZ||pe.y-le.y||pe.x-le.x}).map(function(P){return P.tileID.key}):E.map(function(P){return P.tileID}).sort(ht).map(function(P){return P.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var E=this._tiles[c];E&&(E.state!=="loading"&&(E.state=d),this._loadTile(E,this._tileLoaded.bind(this,E,c,d)))},f.prototype._tileLoaded=function(c,d,E,w){if(w)return c.state="errored",void(w.status!==404?this._source.fire(new m.ErrorEvent(w,{tile:c})):this.update(this.transform));c.timeAdded=m.browser.now(),E==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new m.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),E=0;E<d.length;E++){var w=d[E];if(c.neighboringTiles&&c.neighboringTiles[w]){var P=this.getTileByID(w);k(c,P),k(P,c)}}function k(Z,X){Z.needsHillshadePrepare=!0;var le=X.tileID.canonical.x-Z.tileID.canonical.x,pe=X.tileID.canonical.y-Z.tileID.canonical.y,ve=Math.pow(2,Z.tileID.canonical.z),Re=X.tileID.key;le===0&&pe===0||Math.abs(pe)>1||(Math.abs(le)>1&&(Math.abs(le+ve)===1?le+=ve:Math.abs(le-ve)===1&&(le-=ve)),X.dem&&Z.dem&&(Z.dem.backfillBorder(X.dem,le,pe),Z.neighboringTiles&&Z.neighboringTiles[Re]&&(Z.neighboringTiles[Re].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,E,w){for(var P in this._tiles){var k=this._tiles[P];if(!(w[P]||!k.hasData()||k.tileID.overscaledZ<=d||k.tileID.overscaledZ>E)){for(var Z=k.tileID;k&&k.tileID.overscaledZ>d+1;){var X=k.tileID.scaledTo(k.tileID.overscaledZ-1);(k=this._tiles[X.key])&&k.hasData()&&(Z=X)}for(var le=Z;le.overscaledZ>d;)if(c[(le=le.scaledTo(le.overscaledZ-1)).key]){w[Z.key]=Z;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var E=this._loadedParentTiles[c.key];return E&&E.tileID.overscaledZ>=d?E:null}for(var w=c.overscaledZ-1;w>=d;w--){var P=c.scaledTo(w),k=this._getLoadedTile(P);if(k)return k}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,E=Math.ceil(c.height/this._source.tileSize)+1,w=Math.floor(d*E*5),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(P)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var E={};for(var w in this._tiles){var P=this._tiles[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),E[P.tileID.key]=P}for(var k in this._tiles=E,this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var E;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?E=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(dr){return new m.OverscaledTileID(dr.canonical.z,dr.wrap,dr.canonical.z,dr.canonical.x,dr.canonical.y)}):(E=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(E=E.filter(function(dr){return d._source.hasTile(dr)}))):E=[];var w=c.coveringZoomLevel(this._source),P=Math.max(w-f.maxOverzooming,this._source.minzoom),k=Math.max(w+f.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(E,w);if(pr(this._source.type)){for(var X={},le={},pe=0,ve=Object.keys(Z);pe<ve.length;pe+=1){var Re=ve[pe],Ie=Z[Re],ze=this._tiles[Re];if(ze&&!(ze.fadeEndTime&&ze.fadeEndTime<=m.browser.now())){var Ee=this.findLoadedParent(Ie,P);Ee&&(this._addTile(Ee.tileID),X[Ee.tileID.key]=Ee.tileID),le[Re]=Ie}}for(var Ve in this._retainLoadedChildren(le,w,k,Z),X)Z[Ve]||(this._coveredTiles[Ve]=!0,Z[Ve]=X[Ve])}for(var et in Z)this._tiles[et].clearFadeHold();for(var vt=0,Xt=m.keysDifference(this._tiles,Z);vt<Xt.length;vt+=1){var jt=Xt[vt],Qt=this._tiles[jt];Qt.hasSymbolBuckets&&!Qt.holdingForFade()?Qt.setHoldDuration(this.map._fadeDuration):Qt.hasSymbolBuckets&&!Qt.symbolFadeFinished()||this._removeTile(jt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var E={},w={},P=Math.max(d-f.maxOverzooming,this._source.minzoom),k=Math.max(d+f.maxUnderzooming,this._source.minzoom),Z={},X=0,le=c;X<le.length;X+=1){var pe=le[X],ve=this._addTile(pe);E[pe.key]=pe,ve.hasData()||d<this._source.maxzoom&&(Z[pe.key]=pe)}this._retainLoadedChildren(Z,d,k,E);for(var Re=0,Ie=c;Re<Ie.length;Re+=1){var ze=Ie[Re],Ee=this._tiles[ze.key];if(!Ee.hasData()){if(d+1>this._source.maxzoom){var Ve=ze.children(this._source.maxzoom)[0],et=this.getTile(Ve);if(et&&et.hasData()){E[Ve.key]=Ve;continue}}else{var vt=ze.children(this._source.maxzoom);if(E[vt[0].key]&&E[vt[1].key]&&E[vt[2].key]&&E[vt[3].key])continue}for(var Xt=Ee.wasRequested(),jt=ze.overscaledZ-1;jt>=P;--jt){var Qt=ze.scaledTo(jt);if(w[Qt.key]||(w[Qt.key]=!0,!(Ee=this.getTile(Qt))&&Xt&&(Ee=this._addTile(Qt)),Ee&&(E[Qt.key]=Qt,Xt=Ee.wasRequested(),Ee.hasData())))break}}}return E},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],E=void 0,w=this._tiles[c].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){E=this._loadedParentTiles[w.key];break}d.push(w.key);var P=w.scaledTo(w.overscaledZ-1);if(E=this._getLoadedTile(P))break;w=P}for(var k=0,Z=d;k<Z.length;k+=1)this._loadedParentTiles[Z[k]]=E}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var E=Boolean(d);return E||(d=new m.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,E||this._source.fire(new m.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var E=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var w=d.getExpiryTimeout();w&&(this._timers[c]=setTimeout(function(){E._reloadTile(c,"expired"),delete E._timers[c]},w))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,E){var w=this,P=[],k=this.transform;if(!k)return P;for(var Z=E?k.getCameraQueryGeometry(c):c,X=c.map(function(jt){return k.pointCoordinate(jt)}),le=Z.map(function(jt){return k.pointCoordinate(jt)}),pe=this.getIds(),ve=1/0,Re=1/0,Ie=-1/0,ze=-1/0,Ee=0,Ve=le;Ee<Ve.length;Ee+=1){var et=Ve[Ee];ve=Math.min(ve,et.x),Re=Math.min(Re,et.y),Ie=Math.max(Ie,et.x),ze=Math.max(ze,et.y)}for(var vt=function(jt){var Qt=w._tiles[pe[jt]];if(!Qt.holdingForFade()){var dr=Qt.tileID,Lr=Math.pow(2,k.zoom-Qt.tileID.overscaledZ),gr=d*Qt.queryPadding*m.EXTENT/Qt.tileSize/Lr,sn=[dr.getTilePoint(new m.MercatorCoordinate(ve,Re)),dr.getTilePoint(new m.MercatorCoordinate(Ie,ze))];if(sn[0].x-gr<m.EXTENT&&sn[0].y-gr<m.EXTENT&&sn[1].x+gr>=0&&sn[1].y+gr>=0){var zn=X.map(function(Ln){return dr.getTilePoint(Ln)}),Un=le.map(function(Ln){return dr.getTilePoint(Ln)});P.push({tile:Qt,tileID:dr,queryGeometry:zn,cameraQueryGeometry:Un,scale:Lr})}}},Xt=0;Xt<pe.length;Xt++)vt(Xt);return P},f.prototype.getVisibleCoordinates=function(c){for(var d=this,E=this.getRenderableIds(c).map(function(Z){return d._tiles[Z].tileID}),w=0,P=E;w<P.length;w+=1){var k=P[w];k.posMatrix=this.transform.calculatePosMatrix(k.toUnwrapped())}return E},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(pr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=m.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,E){this._state.updateState(c=c||"_geojsonTileLayer",d,E)},f.prototype.removeFeatureState=function(c,d,E){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,E)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,E){var w=this._tiles[c];w&&w.setDependencies(d,E)},f.prototype.reloadTilesForDependencies=function(c,d){for(var E in this._tiles)this._tiles[E].hasDependency(c,d)&&this._reloadTile(E,"reloading");this._cache.filter(function(w){return!w.hasDependency(c,d)})},f}(m.Evented);function ht(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function pr(l){return l==="raster"||l==="image"||l==="video"}function kt(){return new m.window.Worker(Ul.workerUrl)}ke.maxOverzooming=10,ke.maxUnderzooming=3;var Nt="mapboxgl_preloaded_worker_pool",hr=function(){this.active={}};hr.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<hr.workerCount;)this.workers.push(new kt);return this.active[l]=!0,this.workers.slice()},hr.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},hr.prototype.isPreloaded=function(){return!!this.active[Nt]},hr.prototype.numActive=function(){return Object.keys(this.active).length};var _n,fn=Math.floor(m.browser.hardwareConcurrency/2);function Pt(){return _n||(_n=new hr),_n}function Jr(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return m.refProperties.forEach(function(E){E in f&&(c[E]=f[E])}),c}function Br(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=Jr(l[d],f[l[d].ref]));return l}hr.workerCount=Math.max(Math.min(fn,6),1);var Hr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function gi(l,f,c){c.push({command:Hr.addSource,args:[l,f[l]]})}function en(l,f,c){f.push({command:Hr.removeSource,args:[l]}),c[l]=!0}function yn(l,f,c,d){en(l,c,d),gi(l,f,c)}function Xi(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!m.deepEqual(l[c][d],f[c][d]))return!1;return!0}function vi(l,f,c,d,E,w){var P;for(P in f=f||{},l=l||{})l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}));for(P in f)f.hasOwnProperty(P)&&!l.hasOwnProperty(P)&&(m.deepEqual(l[P],f[P])||c.push({command:w,args:[d,P,f[P],E]}))}function Pi(l){return l.id}function xi(l,f){return l[f.id]=f,l}var dt=function(l,f){this.reset(l,f)};dt.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},dt.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=m.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var E=f-1,w=this._distances[E],P=c-w,k=P>0?(d-w)/P:0;return this.points[E].mult(1-k).add(this.points[f].mult(k))};var It=function(l,f,c){var d=this.boxCells=[],E=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var w=0;w<this.xCellCount*this.yCellCount;w++)d.push([]),E.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Ta(l,f,c,d,E){var w=m.create();return f?(m.scale(w,w,[1/E,1/E,1]),c||m.rotateZ(w,w,d.angle)):m.multiply(w,d.labelPlaneMatrix,l),w}function Ci(l,f,c,d,E){if(f){var w=m.clone(l);return m.scale(w,w,[E,E,1]),c||m.rotateZ(w,w,-d.angle),w}return d.glCoordMatrix}function Ii(l,f){var c=[l.x,l.y,0,1];Ma(c,c,f);var d=c[3];return{point:new m.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function ji(l,f){return .5+l/f*.5}function Ir(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function on(l,f,c,d,E,w,P,k){var Z=d?l.textSizeData:l.iconSizeData,X=m.evaluateSizeForZoom(Z,c.transform.zoom),le=[256/c.width*2+1,256/c.height*2+1],pe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;pe.clear();for(var ve=l.lineVertexArray,Re=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Ie=c.transform.width/c.transform.height,ze=!1,Ee=0;Ee<Re.length;Ee++){var Ve=Re.get(Ee);if(Ve.hidden||Ve.writingMode===m.WritingMode.vertical&&!ze)Ua(Ve.numGlyphs,pe);else{ze=!1;var et=[Ve.anchorX,Ve.anchorY,0,1];if(m.transformMat4(et,et,f),Ir(et,le)){var vt=ji(c.transform.cameraToCenterDistance,et[3]),Xt=m.evaluateSizeForFeature(Z,X,Ve),jt=P?Xt/vt:Xt*vt,Qt=new m.Point(Ve.anchorX,Ve.anchorY),dr=Ii(Qt,E).point,Lr={},gr=de(Ve,jt,!1,k,f,E,w,l.glyphOffsetArray,ve,pe,dr,Qt,Lr,Ie);ze=gr.useVertical,(gr.notEnoughRoom||ze||gr.needsFlipping&&de(Ve,jt,!0,k,f,E,w,l.glyphOffsetArray,ve,pe,dr,Qt,Lr,Ie).notEnoughRoom)&&Ua(Ve.numGlyphs,pe)}else Ua(Ve.numGlyphs,pe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(pe):l.icon.dynamicLayoutVertexBuffer.updateData(pe)}function _t(l,f,c,d,E,w,P,k,Z,X,le){var pe=k.glyphStartIndex+k.numGlyphs,ve=k.lineStartIndex,Re=k.lineStartIndex+k.lineLength,Ie=f.getoffsetX(k.glyphStartIndex),ze=f.getoffsetX(pe-1),Ee=ra(l*Ie,c,d,E,w,P,k.segment,ve,Re,Z,X,le);if(!Ee)return null;var Ve=ra(l*ze,c,d,E,w,P,k.segment,ve,Re,Z,X,le);return Ve?{first:Ee,last:Ve}:null}function na(l,f,c,d){return l===m.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===m.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function de(l,f,c,d,E,w,P,k,Z,X,le,pe,ve,Re){var Ie,ze=f/24,Ee=l.lineOffsetX*ze,Ve=l.lineOffsetY*ze;if(l.numGlyphs>1){var et=l.glyphStartIndex+l.numGlyphs,vt=l.lineStartIndex,Xt=l.lineStartIndex+l.lineLength,jt=_t(ze,k,Ee,Ve,c,le,pe,l,Z,w,ve);if(!jt)return{notEnoughRoom:!0};var Qt=Ii(jt.first.point,P).point,dr=Ii(jt.last.point,P).point;if(d&&!c){var Lr=na(l.writingMode,Qt,dr,Re);if(Lr)return Lr}Ie=[jt.first];for(var gr=l.glyphStartIndex+1;gr<et-1;gr++)Ie.push(ra(ze*k.getoffsetX(gr),Ee,Ve,c,le,pe,l.segment,vt,Xt,Z,w,ve));Ie.push(jt.last)}else{if(d&&!c){var sn=Ii(pe,E).point,zn=l.lineStartIndex+l.segment+1,Un=new m.Point(Z.getx(zn),Z.gety(zn)),Ln=Ii(Un,E),ki=Ln.signedDistanceFromCamera>0?Ln.point:Ko(pe,Un,sn,1,E),tn=na(l.writingMode,sn,ki,Re);if(tn)return tn}var ai=ra(ze*k.getoffsetX(l.glyphStartIndex),Ee,Ve,c,le,pe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,Z,w,ve);if(!ai)return{notEnoughRoom:!0};Ie=[ai]}for(var li=0,$n=Ie;li<$n.length;li+=1){var jn=$n[li];m.addDynamicAttributes(X,jn.point,jn.angle)}return{}}function Ko(l,f,c,d,E){var w=Ii(l.add(l.sub(f)._unit()),E).point,P=c.sub(w);return c.add(P._mult(d/P.mag()))}function ra(l,f,c,d,E,w,P,k,Z,X,le,pe){var ve=d?l-f:l+f,Re=ve>0?1:-1,Ie=0;d&&(Re*=-1,Ie=Math.PI),Re<0&&(Ie+=Math.PI);for(var ze=Re>0?k+P:k+P+1,Ee=E,Ve=E,et=0,vt=0,Xt=Math.abs(ve),jt=[];et+vt<=Xt;){if((ze+=Re)<k||ze>=Z)return null;if(Ve=Ee,jt.push(Ee),(Ee=pe[ze])===void 0){var Qt=new m.Point(X.getx(ze),X.gety(ze)),dr=Ii(Qt,le);if(dr.signedDistanceFromCamera>0)Ee=pe[ze]=dr.point;else{var Lr=ze-Re;Ee=Ko(et===0?w:new m.Point(X.getx(Lr),X.gety(Lr)),Qt,Ve,Xt-et+1,le)}}et+=vt,vt=Ve.dist(Ee)}var gr=(Xt-et)/vt,sn=Ee.sub(Ve),zn=sn.mult(gr)._add(Ve);zn._add(sn._unit()._perp()._mult(c*Re));var Un=Ie+Math.atan2(Ee.y-Ve.y,Ee.x-Ve.x);return jt.push(zn),{point:zn,angle:Un,path:jt}}It.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},It.prototype.insert=function(l,f,c,d,E){this._forEachCell(f,c,d,E,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(E)},It.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},It.prototype._insertBoxCell=function(l,f,c,d,E,w){this.boxCells[E].push(w)},It.prototype._insertCircleCell=function(l,f,c,d,E,w){this.circleCells[E].push(w)},It.prototype._query=function(l,f,c,d,E,w){if(c<0||l>this.width||d<0||f>this.height)return!E&&[];var P=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(E)return!0;for(var k=0;k<this.boxKeys.length;k++)P.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var X=this.circles[3*Z],le=this.circles[3*Z+1],pe=this.circles[3*Z+2];P.push({key:this.circleKeys[Z],x1:X-pe,y1:le-pe,x2:X+pe,y2:le+pe})}return w?P.filter(w):P}return this._forEachCell(l,f,c,d,this._queryCell,P,{hitTest:E,seenUids:{box:{},circle:{}}},w),E?P.length>0:P},It.prototype._queryCircle=function(l,f,c,d,E){var w=l-c,P=l+c,k=f-c,Z=f+c;if(P<0||w>this.width||Z<0||k>this.height)return!d&&[];var X=[];return this._forEachCell(w,k,P,Z,this._queryCellCircle,X,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},E),d?X.length>0:X},It.prototype.query=function(l,f,c,d,E){return this._query(l,f,c,d,!1,E)},It.prototype.hitTest=function(l,f,c,d,E){return this._query(l,f,c,d,!0,E)},It.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},It.prototype._queryCell=function(l,f,c,d,E,w,P,k){var Z=P.seenUids,X=this.boxCells[E];if(X!==null)for(var le=this.bboxes,pe=0,ve=X;pe<ve.length;pe+=1){var Re=ve[pe];if(!Z.box[Re]){Z.box[Re]=!0;var Ie=4*Re;if(l<=le[Ie+2]&&f<=le[Ie+3]&&c>=le[Ie+0]&&d>=le[Ie+1]&&(!k||k(this.boxKeys[Re]))){if(P.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Re],x1:le[Ie],y1:le[Ie+1],x2:le[Ie+2],y2:le[Ie+3]})}}}var ze=this.circleCells[E];if(ze!==null)for(var Ee=this.circles,Ve=0,et=ze;Ve<et.length;Ve+=1){var vt=et[Ve];if(!Z.circle[vt]){Z.circle[vt]=!0;var Xt=3*vt;if(this._circleAndRectCollide(Ee[Xt],Ee[Xt+1],Ee[Xt+2],l,f,c,d)&&(!k||k(this.circleKeys[vt]))){if(P.hitTest)return w.push(!0),!0;var jt=Ee[Xt],Qt=Ee[Xt+1],dr=Ee[Xt+2];w.push({key:this.circleKeys[vt],x1:jt-dr,y1:Qt-dr,x2:jt+dr,y2:Qt+dr})}}}},It.prototype._queryCellCircle=function(l,f,c,d,E,w,P,k){var Z=P.circle,X=P.seenUids,le=this.boxCells[E];if(le!==null)for(var pe=this.bboxes,ve=0,Re=le;ve<Re.length;ve+=1){var Ie=Re[ve];if(!X.box[Ie]){X.box[Ie]=!0;var ze=4*Ie;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,pe[ze+0],pe[ze+1],pe[ze+2],pe[ze+3])&&(!k||k(this.boxKeys[Ie])))return w.push(!0),!0}}var Ee=this.circleCells[E];if(Ee!==null)for(var Ve=this.circles,et=0,vt=Ee;et<vt.length;et+=1){var Xt=vt[et];if(!X.circle[Xt]){X.circle[Xt]=!0;var jt=3*Xt;if(this._circlesCollide(Ve[jt],Ve[jt+1],Ve[jt+2],Z.x,Z.y,Z.radius)&&(!k||k(this.circleKeys[Xt])))return w.push(!0),!0}}},It.prototype._forEachCell=function(l,f,c,d,E,w,P,k){for(var Z=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),le=this._convertToXCellCoord(c),pe=this._convertToYCellCoord(d),ve=Z;ve<=le;ve++)for(var Re=X;Re<=pe;Re++)if(E.call(this,l,f,c,d,this.xCellCount*Re+ve,w,P,k))return},It.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},It.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},It.prototype._circlesCollide=function(l,f,c,d,E,w){var P=d-l,k=E-f,Z=c+w;return Z*Z>P*P+k*k},It.prototype._circleAndRectCollide=function(l,f,c,d,E,w,P){var k=(w-d)/2,Z=Math.abs(l-(d+k));if(Z>k+c)return!1;var X=(P-E)/2,le=Math.abs(f-(E+X));if(le>X+c)return!1;if(Z<=k||le<=X)return!0;var pe=Z-k,ve=le-X;return pe*pe+ve*ve<=c*c};var _u=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ua(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(_u,3*d)}}function Ma(l,f,c){var d=f[0],E=f[1];return l[0]=c[0]*d+c[4]*E+c[12],l[1]=c[1]*d+c[5]*E+c[13],l[3]=c[3]*d+c[7]*E+c[15],l}var Ka=function(l,f,c){f===void 0&&(f=new It(l.width+200,l.height+200,25)),c===void 0&&(c=new It(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function ia(l,f,c){return f*(m.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}Ka.prototype.placeCollisionBox=function(l,f,c,d,E){var w=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),P=c*w.perspectiveRatio,k=l.x1*P+w.point.x,Z=l.y1*P+w.point.y,X=l.x2*P+w.point.x,le=l.y2*P+w.point.y;return!this.isInsideGrid(k,Z,X,le)||!f&&this.grid.hitTest(k,Z,X,le,E)?{box:[],offscreen:!1}:{box:[k,Z,X,le],offscreen:this.isOffscreen(k,Z,X,le)}},Ka.prototype.placeCollisionCircles=function(l,f,c,d,E,w,P,k,Z,X,le,pe,ve){var Re=[],Ie=new m.Point(f.anchorX,f.anchorY),ze=Ii(Ie,w),Ee=ji(this.transform.cameraToCenterDistance,ze.signedDistanceFromCamera),Ve=(X?E/Ee:E*Ee)/m.ONE_EM,et=Ii(Ie,P).point,vt=_t(Ve,d,f.lineOffsetX*Ve,f.lineOffsetY*Ve,!1,et,Ie,f,c,P,{}),Xt=!1,jt=!1,Qt=!0;if(vt){for(var dr=.5*pe*Ee+ve,Lr=new m.Point(-100,-100),gr=new m.Point(this.screenRightBoundary,this.screenBottomBoundary),sn=new dt,zn=vt.first,Un=vt.last,Ln=[],ki=zn.path.length-1;ki>=1;ki--)Ln.push(zn.path[ki]);for(var tn=1;tn<Un.path.length;tn++)Ln.push(Un.path[tn]);var ai=2.5*dr;if(k){var li=Ln.map(function(Rs){return Ii(Rs,k)});Ln=li.some(function(Rs){return Rs.signedDistanceFromCamera<=0})?[]:li.map(function(Rs){return Rs.point})}var $n=[];if(Ln.length>0){for(var jn=Ln[0].clone(),mi=Ln[0].clone(),Yn=1;Yn<Ln.length;Yn++)jn.x=Math.min(jn.x,Ln[Yn].x),jn.y=Math.min(jn.y,Ln[Yn].y),mi.x=Math.max(mi.x,Ln[Yn].x),mi.y=Math.max(mi.y,Ln[Yn].y);$n=jn.x>=Lr.x&&mi.x<=gr.x&&jn.y>=Lr.y&&mi.y<=gr.y?[Ln]:mi.x<Lr.x||jn.x>gr.x||mi.y<Lr.y||jn.y>gr.y?[]:m.clipLine([Ln],Lr.x,Lr.y,gr.x,gr.y)}for(var Hn=0,yo=$n;Hn<yo.length;Hn+=1){var Ja;sn.reset(yo[Hn],.25*dr),Ja=sn.length<=.5*dr?1:Math.ceil(sn.paddedLength/ai)+1;for(var To=0;To<Ja;To++){var Fa=To/Math.max(Ja-1,1),Wa=sn.lerp(Fa),po=Wa.x+100,Os=Wa.y+100;Re.push(po,Os,dr,0);var os=po-dr,Du=Os-dr,ss=po+dr,mu=Os+dr;if(Qt=Qt&&this.isOffscreen(os,Du,ss,mu),jt=jt||this.isInsideGrid(os,Du,ss,mu),!l&&this.grid.hitTestCircle(po,Os,dr,le)&&(Xt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Xt}}}}return{circles:!Z&&Xt||!jt?[]:Re,offscreen:Qt,collisionDetected:Xt}},Ka.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,E=-1/0,w=-1/0,P=0,k=l;P<k.length;P+=1){var Z=k[P],X=new m.Point(Z.x+100,Z.y+100);c=Math.min(c,X.x),d=Math.min(d,X.y),E=Math.max(E,X.x),w=Math.max(w,X.y),f.push(X)}for(var le={},pe={},ve=0,Re=this.grid.query(c,d,E,w).concat(this.ignoredGrid.query(c,d,E,w));ve<Re.length;ve+=1){var Ie=Re[ve],ze=Ie.key;if(le[ze.bucketInstanceId]===void 0&&(le[ze.bucketInstanceId]={}),!le[ze.bucketInstanceId][ze.featureIndex]){var Ee=[new m.Point(Ie.x1,Ie.y1),new m.Point(Ie.x2,Ie.y1),new m.Point(Ie.x2,Ie.y2),new m.Point(Ie.x1,Ie.y2)];m.polygonIntersectsPolygon(f,Ee)&&(le[ze.bucketInstanceId][ze.featureIndex]=!0,pe[ze.bucketInstanceId]===void 0&&(pe[ze.bucketInstanceId]=[]),pe[ze.bucketInstanceId].push(ze.featureIndex))}}return pe},Ka.prototype.insertCollisionBox=function(l,f,c,d,E){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:E},l[0],l[1],l[2],l[3])},Ka.prototype.insertCollisionCircles=function(l,f,c,d,E){for(var w=f?this.ignoredGrid:this.grid,P={bucketInstanceId:c,featureIndex:d,collisionGroupID:E},k=0;k<l.length;k+=4)w.insertCircle(P,l[k],l[k+1],l[k+2])},Ka.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return Ma(d,d,l),{point:new m.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},Ka.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},Ka.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},Ka.prototype.getViewportMatrix=function(){var l=m.identity([]);return m.translate(l,l,[-100,-100,0]),l};var Ao=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};Ao.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var jo=function(l,f,c,d,E){this.text=new Ao(l?l.text:null,f,c,E),this.icon=new Ao(l?l.icon:null,f,d,E)};jo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Cu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},vo=function(){this.invProjMatrix=m.create(),this.viewportMatrix=m.create(),this.circles=[]},Do=function(l,f,c,d,E){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=E},aa=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function $a(l,f,c,d,E){var w=m.getAnchorAlignment(l),P=-(w.horizontalAlign-.5)*f,k=-(w.verticalAlign-.5)*c,Z=m.evaluateVariableOffset(l,d);return new m.Point(P+Z[0]*E,k+Z[1]*E)}function Fo(l,f,c,d,E,w){var P=l.x1,k=l.x2,Z=l.y1,X=l.y2,le=l.anchorPointX,pe=l.anchorPointY,ve=new m.Point(f,c);return d&&ve._rotate(E?w:-w),{x1:P+ve.x,y1:Z+ve.y,x2:k+ve.x,y2:X+ve.y,anchorPointX:le,anchorPointY:pe}}aa.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var Qa=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new Ka(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new aa(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ws(l,f,c,d,E){l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0),l.emplaceBack(f?1:0,c?1:0,d||0,E||0)}Qa.prototype.getBucketParts=function(l,f,c,d){var E=c.getBucket(f),w=c.latestFeatureIndex;if(E&&w&&f.id===E.layerIds[0]){var P=c.collisionBoxArray,k=E.layers[0].layout,Z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),X=c.tileSize/m.EXTENT,le=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),pe=k.get("text-pitch-alignment")==="map",ve=k.get("text-rotation-alignment")==="map",Re=ia(c,1,this.transform.zoom),Ie=Ta(le,pe,ve,this.transform,Re),ze=null;if(pe){var Ee=Ci(le,pe,ve,this.transform,Re);ze=m.multiply([],this.transform.labelPlaneMatrix,Ee)}this.retainedQueryData[E.bucketInstanceId]=new Do(E.bucketInstanceId,w,E.sourceLayerIndex,E.index,c.tileID);var Ve={bucket:E,layout:k,posMatrix:le,textLabelPlaneMatrix:Ie,labelToScreenMatrix:ze,scale:Z,textPixelRatio:X,holdingForFade:c.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:m.evaluateSizeForZoom(E.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(E.sourceID)};if(d)for(var et=0,vt=E.sortKeyRanges;et<vt.length;et+=1){var Xt=vt[et];l.push({sortKey:Xt.sortKey,symbolInstanceStart:Xt.symbolInstanceStart,symbolInstanceEnd:Xt.symbolInstanceEnd,parameters:Ve})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:E.symbolInstances.length,parameters:Ve})}},Qa.prototype.attemptAnchorPlacement=function(l,f,c,d,E,w,P,k,Z,X,le,pe,ve,Re,Ie){var ze,Ee=[pe.textOffset0,pe.textOffset1],Ve=$a(l,c,d,Ee,E),et=this.collisionIndex.placeCollisionBox(Fo(f,Ve.x,Ve.y,w,P,this.transform.angle),le,k,Z,X.predicate);if(!Ie||this.collisionIndex.placeCollisionBox(Fo(Ie,Ve.x,Ve.y,w,P,this.transform.angle),le,k,Z,X.predicate).box.length!==0)return et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID]&&this.prevPlacement.placements[pe.crossTileID].text&&(ze=this.prevPlacement.variableOffsets[pe.crossTileID].anchor),this.variableOffsets[pe.crossTileID]={textOffset:Ee,width:c,height:d,anchor:l,textBoxScale:E,prevAnchor:ze},this.markUsedJustification(ve,l,pe,Re),ve.allowVerticalPlacement&&(this.markUsedOrientation(ve,Re,pe),this.placedOrientations[pe.crossTileID]=Re),{shift:Ve,placedGlyphBoxes:et}):void 0},Qa.prototype.placeLayerBucketPart=function(l,f,c){var d=this,E=l.parameters,w=E.bucket,P=E.layout,k=E.posMatrix,Z=E.textLabelPlaneMatrix,X=E.labelToScreenMatrix,le=E.textPixelRatio,pe=E.holdingForFade,ve=E.collisionBoxArray,Re=E.partiallyEvaluatedTextSize,Ie=E.collisionGroup,ze=P.get("text-optional"),Ee=P.get("icon-optional"),Ve=P.get("text-allow-overlap"),et=P.get("icon-allow-overlap"),vt=P.get("text-rotation-alignment")==="map",Xt=P.get("text-pitch-alignment")==="map",jt=P.get("icon-text-fit")!=="none",Qt=P.get("symbol-z-order")==="viewport-y",dr=Ve&&(et||!w.hasIconData()||Ee),Lr=et&&(Ve||!w.hasTextData()||ze);!w.collisionArrays&&ve&&w.deserializeCollisionBoxes(ve);var gr=function(tn,ai){if(!f[tn.crossTileID])if(pe)d.placements[tn.crossTileID]=new Cu(!1,!1,!1);else{var li,$n=!1,jn=!1,mi=!0,Yn=null,Hn={box:null,offscreen:null},yo={box:null,offscreen:null},Ja=null,To=null,Fa=0,Wa=0,po=0;ai.textFeatureIndex?Fa=ai.textFeatureIndex:tn.useRuntimeCollisionCircles&&(Fa=tn.featureIndex),ai.verticalTextFeatureIndex&&(Wa=ai.verticalTextFeatureIndex);var Os=ai.textBox;if(Os){var os=function(oa){var zs=m.WritingMode.horizontal;if(w.allowVerticalPlacement&&!oa&&d.prevPlacement){var Jo=d.prevPlacement.placedOrientations[tn.crossTileID];Jo&&(d.placedOrientations[tn.crossTileID]=Jo,d.markUsedOrientation(w,zs=Jo,tn))}return zs},Du=function(oa,zs){if(w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&ai.verticalTextBox)for(var Jo=0,gu=w.writingModes;Jo<gu.length&&(gu[Jo]===m.WritingMode.vertical?(Hn=zs(),yo=Hn):Hn=oa(),!(Hn&&Hn.box&&Hn.box.length));Jo+=1);else Hn=oa()};if(P.get("text-variable-anchor")){var ss=P.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[tn.crossTileID]){var mu=d.prevPlacement.variableOffsets[tn.crossTileID];ss.indexOf(mu.anchor)>0&&(ss=ss.filter(function(oa){return oa!==mu.anchor})).unshift(mu.anchor)}var Rs=function(oa,zs,Jo){for(var gu=oa.x2-oa.x1,Wc=oa.y2-oa.y1,Xc=tn.textBoxScale,wf=jt&&!et?zs:null,nu={box:[],offscreen:!1},pc=Ve?2*ss.length:ss.length,iu=0;iu<pc;++iu){var _l=d.attemptAnchorPlacement(ss[iu%ss.length],oa,gu,Wc,Xc,vt,Xt,le,k,Ie,iu>=ss.length,tn,w,Jo,wf);if(_l&&(nu=_l.placedGlyphBoxes)&&nu.box&&nu.box.length){$n=!0,Yn=_l.shift;break}}return nu};Du(function(){return Rs(Os,ai.iconBox,m.WritingMode.horizontal)},function(){var oa=ai.verticalTextBox;return w.allowVerticalPlacement&&!(Hn&&Hn.box&&Hn.box.length)&&tn.numVerticalGlyphVertices>0&&oa?Rs(oa,ai.verticalIconBox,m.WritingMode.vertical):{box:null,offscreen:null}}),Hn&&($n=Hn.box,mi=Hn.offscreen);var Cs=os(Hn&&Hn.box);if(!$n&&d.prevPlacement){var Zl=d.prevPlacement.variableOffsets[tn.crossTileID];Zl&&(d.variableOffsets[tn.crossTileID]=Zl,d.markUsedJustification(w,Zl.anchor,tn,Cs))}}else{var Fu=function(oa,zs){var Jo=d.collisionIndex.placeCollisionBox(oa,Ve,le,k,Ie.predicate);return Jo&&Jo.box&&Jo.box.length&&(d.markUsedOrientation(w,zs,tn),d.placedOrientations[tn.crossTileID]=zs),Jo};Du(function(){return Fu(Os,m.WritingMode.horizontal)},function(){var oa=ai.verticalTextBox;return w.allowVerticalPlacement&&tn.numVerticalGlyphVertices>0&&oa?Fu(oa,m.WritingMode.vertical):{box:null,offscreen:null}}),os(Hn&&Hn.box&&Hn.box.length)}}if($n=(li=Hn)&&li.box&&li.box.length>0,mi=li&&li.offscreen,tn.useRuntimeCollisionCircles){var gl=w.text.placedSymbolArray.get(tn.centerJustifiedTextSymbolIndex),jl=m.evaluateSizeForFeature(w.textSizeData,Re,gl),ru=P.get("text-padding");Ja=d.collisionIndex.placeCollisionCircles(Ve,gl,w.lineVertexArray,w.glyphOffsetArray,jl,k,Z,X,c,Xt,Ie.predicate,tn.collisionCircleDiameter,ru),$n=Ve||Ja.circles.length>0&&!Ja.collisionDetected,mi=mi&&Ja.offscreen}if(ai.iconFeatureIndex&&(po=ai.iconFeatureIndex),ai.iconBox){var yl=function(oa){var zs=jt&&Yn?Fo(oa,Yn.x,Yn.y,vt,Xt,d.transform.angle):oa;return d.collisionIndex.placeCollisionBox(zs,et,le,k,Ie.predicate)};jn=yo&&yo.box&&yo.box.length&&ai.verticalIconBox?(To=yl(ai.verticalIconBox)).box.length>0:(To=yl(ai.iconBox)).box.length>0,mi=mi&&To.offscreen}var bu=ze||tn.numHorizontalGlyphVertices===0&&tn.numVerticalGlyphVertices===0,Eo=Ee||tn.numIconVertices===0;if(bu||Eo?Eo?bu||(jn=jn&&$n):$n=jn&&$n:jn=$n=jn&&$n,$n&&li&&li.box&&d.collisionIndex.insertCollisionBox(li.box,P.get("text-ignore-placement"),w.bucketInstanceId,yo&&yo.box&&Wa?Wa:Fa,Ie.ID),jn&&To&&d.collisionIndex.insertCollisionBox(To.box,P.get("icon-ignore-placement"),w.bucketInstanceId,po,Ie.ID),Ja&&($n&&d.collisionIndex.insertCollisionCircles(Ja.circles,P.get("text-ignore-placement"),w.bucketInstanceId,Fa,Ie.ID),c)){var Bu=w.bucketInstanceId,Nu=d.collisionCircleArrays[Bu];Nu===void 0&&(Nu=d.collisionCircleArrays[Bu]=new vo);for(var Ju=0;Ju<Ja.circles.length;Ju+=4)Nu.circles.push(Ja.circles[Ju+0]),Nu.circles.push(Ja.circles[Ju+1]),Nu.circles.push(Ja.circles[Ju+2]),Nu.circles.push(Ja.collisionDetected?1:0)}d.placements[tn.crossTileID]=new Cu($n||dr,jn||Lr,mi||w.justReloaded),f[tn.crossTileID]=!0}};if(Qt)for(var sn=w.getSortedSymbolIndexes(this.transform.angle),zn=sn.length-1;zn>=0;--zn){var Un=sn[zn];gr(w.symbolInstances.get(Un),w.collisionArrays[Un])}else for(var Ln=l.symbolInstanceStart;Ln<l.symbolInstanceEnd;Ln++)gr(w.symbolInstances.get(Ln),w.collisionArrays[Ln]);if(c&&w.bucketInstanceId in this.collisionCircleArrays){var ki=this.collisionCircleArrays[w.bucketInstanceId];m.invert(ki.invProjMatrix,k),ki.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},Qa.prototype.markUsedJustification=function(l,f,c,d){var E;E=d===m.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[m.getAnchorJustification(f)];for(var w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];w<P.length;w+=1){var k=P[w];k>=0&&(l.text.placedSymbolArray.get(k).crossTileID=E>=0&&k!==E?0:c.crossTileID)}},Qa.prototype.markUsedOrientation=function(l,f,c){for(var d=f===m.WritingMode.horizontal||f===m.WritingMode.horizontalOnly?f:0,E=f===m.WritingMode.vertical?f:0,w=0,P=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];w<P.length;w+=1)l.text.placedSymbolArray.get(P[w]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=E)},Qa.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,E=f?f.opacities:{},w=f?f.variableOffsets:{},P=f?f.placedOrientations:{};for(var k in this.placements){var Z=this.placements[k],X=E[k];X?(this.opacities[k]=new jo(X,d,Z.text,Z.icon),c=c||Z.text!==X.text.placed||Z.icon!==X.icon.placed):(this.opacities[k]=new jo(null,d,Z.text,Z.icon,Z.skipFade),c=c||Z.text||Z.icon)}for(var le in E){var pe=E[le];if(!this.opacities[le]){var ve=new jo(pe,d,!1,!1);ve.isHidden()||(this.opacities[le]=ve,c=c||pe.text.placed||pe.icon.placed)}}for(var Re in w)this.variableOffsets[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.variableOffsets[Re]=w[Re]);for(var Ie in P)this.placedOrientations[Ie]||!this.opacities[Ie]||this.opacities[Ie].isHidden()||(this.placedOrientations[Ie]=P[Ie]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},Qa.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,E=f;d<E.length;d+=1){var w=E[d],P=w.getBucket(l);P&&w.latestFeatureIndex&&l.id===P.layerIds[0]&&this.updateBucketOpacities(P,c,w.collisionBoxArray)}},Qa.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var E=l.layers[0].layout,w=new jo(null,0,!1,!1,!0),P=E.get("text-allow-overlap"),k=E.get("icon-allow-overlap"),Z=E.get("text-variable-anchor"),X=E.get("text-rotation-alignment")==="map",le=E.get("text-pitch-alignment")==="map",pe=E.get("icon-text-fit")!=="none",ve=new jo(null,0,P&&(k||!l.hasIconData()||E.get("icon-optional")),k&&(P||!l.hasTextData()||E.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var Re=function(Ve,et,vt){for(var Xt=0;Xt<et/4;Xt++)Ve.opacityVertexArray.emplaceBack(vt)},Ie=function(Ve){var et=l.symbolInstances.get(Ve),vt=et.numHorizontalGlyphVertices,Xt=et.numVerticalGlyphVertices,jt=et.crossTileID,Qt=d.opacities[jt];f[jt]?Qt=w:Qt||(d.opacities[jt]=Qt=ve),f[jt]=!0;var dr=et.numIconVertices>0,Lr=d.placedOrientations[et.crossTileID],gr=Lr===m.WritingMode.vertical,sn=Lr===m.WritingMode.horizontal||Lr===m.WritingMode.horizontalOnly;if(vt>0||Xt>0){var zn=Pn(Qt.text);Re(l.text,vt,gr?Oi:zn),Re(l.text,Xt,sn?Oi:zn);var Un=Qt.text.isHidden();[et.rightJustifiedTextSymbolIndex,et.centerJustifiedTextSymbolIndex,et.leftJustifiedTextSymbolIndex].forEach(function(Hn){Hn>=0&&(l.text.placedSymbolArray.get(Hn).hidden=Un||gr?1:0)}),et.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(et.verticalPlacedTextSymbolIndex).hidden=Un||sn?1:0);var Ln=d.variableOffsets[et.crossTileID];Ln&&d.markUsedJustification(l,Ln.anchor,et,Lr);var ki=d.placedOrientations[et.crossTileID];ki&&(d.markUsedJustification(l,"left",et,ki),d.markUsedOrientation(l,ki,et))}if(dr){var tn=Pn(Qt.icon),ai=!(pe&&et.verticalPlacedIconSymbolIndex&&gr);et.placedIconSymbolIndex>=0&&(Re(l.icon,et.numIconVertices,ai?tn:Oi),l.icon.placedSymbolArray.get(et.placedIconSymbolIndex).hidden=Qt.icon.isHidden()),et.verticalPlacedIconSymbolIndex>=0&&(Re(l.icon,et.numVerticalIconVertices,ai?Oi:tn),l.icon.placedSymbolArray.get(et.verticalPlacedIconSymbolIndex).hidden=Qt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var li=l.collisionArrays[Ve];if(li){var $n=new m.Point(0,0);if(li.textBox||li.verticalTextBox){var jn=!0;if(Z){var mi=d.variableOffsets[jt];mi?($n=$a(mi.anchor,mi.width,mi.height,mi.textOffset,mi.textBoxScale),X&&$n._rotate(le?d.transform.angle:-d.transform.angle)):jn=!1}li.textBox&&ws(l.textCollisionBox.collisionVertexArray,Qt.text.placed,!jn||gr,$n.x,$n.y),li.verticalTextBox&&ws(l.textCollisionBox.collisionVertexArray,Qt.text.placed,!jn||sn,$n.x,$n.y)}var Yn=Boolean(!sn&&li.verticalIconBox);li.iconBox&&ws(l.iconCollisionBox.collisionVertexArray,Qt.icon.placed,Yn,pe?$n.x:0,pe?$n.y:0),li.verticalIconBox&&ws(l.iconCollisionBox.collisionVertexArray,Qt.icon.placed,!Yn,pe?$n.x:0,pe?$n.y:0)}}},ze=0;ze<l.symbolInstances.length;ze++)Ie(ze);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ee=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ee.invProjMatrix,l.placementViewportMatrix=Ee.viewportMatrix,l.collisionCircleArray=Ee.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},Qa.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Qa.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},Qa.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},Qa.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},Qa.prototype.setStale=function(){this.stale=!0};var wl=Math.pow(2,25),ms=Math.pow(2,24),ne=Math.pow(2,17),be=Math.pow(2,16),Ye=Math.pow(2,9),Rt=Math.pow(2,8),Or=Math.pow(2,1);function Pn(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*wl+f*ms+c*ne+f*be+c*Ye+f*Rt+c*Or+f}var Oi=0,oo=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};oo.prototype.continuePlacement=function(l,f,c,d,E){for(var w=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(w,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,E())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(P,k){return P.sortKey-k.sortKey}));this._currentPartIndex<w.length;)if(f.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,E())return!0;return!1};var La=function(l,f,c,d,E,w,P){this.placement=new Qa(l,E,w,P),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};La.prototype.isDone=function(){return this._done},La.prototype.continuePlacement=function(l,f,c){for(var d=this,E=m.browser.now(),w=function(){var Z=m.browser.now()-E;return!d._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var P=f[l[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=k)&&(!P.maxzoom||P.maxzoom>k)){if(this._inProgressLayer||(this._inProgressLayer=new oo(P)),this._inProgressLayer.continuePlacement(c[P.source],this.placement,this._showCollisionBoxes,P,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},La.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Za=512/m.EXTENT/2,Vo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var E=f.get(d),w=E.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:E.crossTileID,coord:this.getScaledCoordinates(E,l)})}};Vo.prototype.getScaledCoordinates=function(l,f){var c=Za/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*m.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*m.EXTENT+l.anchorY)*c)}},Vo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),E=0;E<l.length;E++){var w=l.get(E);if(!w.crossTileID){var P=this.indexedSymbolInstances[w.key];if(P)for(var k=this.getScaledCoordinates(w,f),Z=0,X=P;Z<X.length;Z+=1){var le=X[Z];if(Math.abs(le.coord.x-k.x)<=d&&Math.abs(le.coord.y-k.y)<=d&&!c[le.crossTileID]){c[le.crossTileID]=!0,w.crossTileID=le.crossTileID;break}}}}};var gs=function(){this.maxCrossTileID=0};gs.prototype.generate=function(){return++this.maxCrossTileID};var lo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};lo.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],E={};for(var w in d){var P=d[w];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+f),E[P.tileID.key]=P}this.indexes[c]=E}this.lng=l},lo.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var E=this.usedCrossTileIDs[l.overscaledZ];for(var w in this.indexes){var P=this.indexes[w];if(Number(w)>l.overscaledZ)for(var k in P){var Z=P[k];Z.tileID.isChildOf(l)&&Z.findMatches(f.symbolInstances,l,E)}else{var X=P[l.scaledTo(Number(w)).key];X&&X.findMatches(f.symbolInstances,l,E)}}for(var le=0;le<f.symbolInstances.length;le++){var pe=f.symbolInstances.get(le);pe.crossTileID||(pe.crossTileID=c.generate(),E[pe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Vo(l,f.symbolInstances,f.bucketInstanceId),!0},lo.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,E=f.indexedSymbolInstances[c];d<E.length;d+=1)delete this.usedCrossTileIDs[l][E[d].crossTileID]},lo.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var E in d)l[d[E].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[E]),delete d[E],f=!0)}return f};var wo=function(){this.layerIndexes={},this.crossTileIDs=new gs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};wo.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new lo);var E=!1,w={};d.handleWrapJump(c);for(var P=0,k=f;P<k.length;P+=1){var Z=k[P],X=Z.getBucket(l);X&&l.id===X.layerIds[0]&&(X.bucketInstanceId||(X.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(Z.tileID,X,this.crossTileIDs)&&(E=!0),w[X.bucketInstanceId]=!0)}return d.removeStaleBuckets(w)&&(E=!0),E},wo.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var ys=function(l,f){return m.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},Ts=m.pick(Hr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Fs=m.pick(Hr,["setCenter","setZoom","setBearing","setPitch"]),uu=function(){var l={},f=m.styleSpec.$version;for(var c in m.styleSpec.$root){var d,E=m.styleSpec.$root[c];E.required&&(d=c==="version"?f:E.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),_s=function(l){function f(c,d){var E=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new Kt(Pt(),this),this.imageManager=new yt,this.imageManager.setEventedParent(this),this.glyphManager=new qt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new wo,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new m.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",m.getReferrer());var w=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(P){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:P.pluginStatus,pluginURL:P.pluginURL},function(k,Z){if(m.triggerPluginCompletionEvent(k),Z&&Z.every(function(le){return le}))for(var X in w.sourceCaches)w.sourceCaches[X].reload()})}),this.on("data",function(P){if(P.dataType==="source"&&P.sourceDataType==="metadata"){var k=E.sourceCaches[P.sourceId];if(k){var Z=k.getSource();if(Z&&Z.vectorLayerIds)for(var X in E._layers){var le=E._layers[X];le.source===Z.id&&E._validateLayer(le)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"}));var w=typeof d.validate=="boolean"?d.validate:!m.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var P=this.map._requestManager.transformRequest(c,m.ResourceType.Style);this._request=m.getJSON(P,function(k,Z){E._request=null,k?E.fire(new m.ErrorEvent(k)):Z&&E._load(Z,w)})},f.prototype.loadJSON=function(c,d){var E=this;d===void 0&&(d={}),this.fire(new m.Event("dataloading",{dataType:"style"})),this._request=m.browser.frame(function(){E._request=null,E._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new m.Event("dataloading",{dataType:"style"})),this._load(uu,!1)},f.prototype._load=function(c,d){if(!d||!ys(this,m.validateStyle(c))){for(var E in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(E,c.sources[E],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var w=Br(this.stylesheet.layers);this._order=w.map(function(X){return X.id}),this._layers={},this._serializedLayers={};for(var P=0,k=w;P<k.length;P+=1){var Z=k[P];(Z=m.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ct(this.stylesheet.light),this.fire(new m.Event("data",{dataType:"style"})),this.fire(new m.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(E,w,P){var k,Z,X,le=m.browser.devicePixelRatio>1?"@2x":"",pe=m.getJSON(w.transformRequest(w.normalizeSpriteURL(E,le,".json"),m.ResourceType.SpriteJSON),function(Ie,ze){pe=null,X||(X=Ie,k=ze,Re())}),ve=m.getImage(w.transformRequest(w.normalizeSpriteURL(E,le,".png"),m.ResourceType.SpriteImage),function(Ie,ze){ve=null,X||(X=Ie,Z=ze,Re())});function Re(){if(X)P(X);else if(k&&Z){var Ie=m.browser.getImageData(Z),ze={};for(var Ee in k){var Ve=k[Ee],et=Ve.width,vt=Ve.height,Xt=Ve.x,jt=Ve.y,Qt=Ve.sdf,dr=Ve.pixelRatio,Lr=Ve.stretchX,gr=Ve.stretchY,sn=Ve.content,zn=new m.RGBAImage({width:et,height:vt});m.RGBAImage.copy(Ie,zn,{x:Xt,y:jt},{x:0,y:0},{width:et,height:vt}),ze[Ee]={data:zn,pixelRatio:dr,sdf:Qt,stretchX:Lr,stretchY:gr,content:sn}}P(null,ze)}}return{cancel:function(){pe&&(pe.cancel(),pe=null),ve&&(ve.cancel(),ve=null)}}}(c,this.map._requestManager,function(E,w){if(d._spriteRequest=null,E)d.fire(new m.ErrorEvent(E));else if(w)for(var P in w)d.imageManager.addImage(P,w[P]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new m.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var E=c.sourceLayer;if(E){var w=d.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(E)===-1)&&this.fire(new m.ErrorEvent(new Error('Source layer "'+E+'" does not exist on source "'+w.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],E=0,w=c;E<w.length;E+=1){var P=this._layers[w[E]];P.type!=="custom"&&d.push(P.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var E=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var P in(E.length||w.length)&&this._updateWorkerLayers(E,w),this._updatedSources){var k=this._updatedSources[P];k==="reload"?this._reloadSource(P):k==="clear"&&this._clearSource(P)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var X={};for(var le in this.sourceCaches){var pe=this.sourceCaches[le];X[le]=pe.used,pe.used=!1}for(var ve=0,Re=this._order;ve<Re.length;ve+=1){var Ie=this._layers[Re[ve]];Ie.recalculate(c,this._availableImages),!Ie.isHidden(c.zoom)&&Ie.source&&(this.sourceCaches[Ie.source].used=!0)}for(var ze in X){var Ee=this.sourceCaches[ze];X[ze]!==Ee.used&&Ee.fire(new m.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ze}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new m.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),ys(this,m.validateStyle(c)))return!1;(c=m.clone$1(c)).layers=Br(c.layers);var E=function(P,k){if(!P)return[{command:Hr.setStyle,args:[k]}];var Z=[];try{if(!m.deepEqual(P.version,k.version))return[{command:Hr.setStyle,args:[k]}];m.deepEqual(P.center,k.center)||Z.push({command:Hr.setCenter,args:[k.center]}),m.deepEqual(P.zoom,k.zoom)||Z.push({command:Hr.setZoom,args:[k.zoom]}),m.deepEqual(P.bearing,k.bearing)||Z.push({command:Hr.setBearing,args:[k.bearing]}),m.deepEqual(P.pitch,k.pitch)||Z.push({command:Hr.setPitch,args:[k.pitch]}),m.deepEqual(P.sprite,k.sprite)||Z.push({command:Hr.setSprite,args:[k.sprite]}),m.deepEqual(P.glyphs,k.glyphs)||Z.push({command:Hr.setGlyphs,args:[k.glyphs]}),m.deepEqual(P.transition,k.transition)||Z.push({command:Hr.setTransition,args:[k.transition]}),m.deepEqual(P.light,k.light)||Z.push({command:Hr.setLight,args:[k.light]});var X={},le=[];(function(ve,Re,Ie,ze){var Ee;for(Ee in Re=Re||{},ve=ve||{})ve.hasOwnProperty(Ee)&&(Re.hasOwnProperty(Ee)||en(Ee,Ie,ze));for(Ee in Re)Re.hasOwnProperty(Ee)&&(ve.hasOwnProperty(Ee)?m.deepEqual(ve[Ee],Re[Ee])||(ve[Ee].type==="geojson"&&Re[Ee].type==="geojson"&&Xi(ve,Re,Ee)?Ie.push({command:Hr.setGeoJSONSourceData,args:[Ee,Re[Ee].data]}):yn(Ee,Re,Ie,ze)):gi(Ee,Re,Ie))})(P.sources,k.sources,le,X);var pe=[];P.layers&&P.layers.forEach(function(ve){X[ve.source]?Z.push({command:Hr.removeLayer,args:[ve.id]}):pe.push(ve)}),Z=Z.concat(le),function(ve,Re,Ie){Re=Re||[];var ze,Ee,Ve,et,vt,Xt,jt,Qt=(ve=ve||[]).map(Pi),dr=Re.map(Pi),Lr=ve.reduce(xi,{}),gr=Re.reduce(xi,{}),sn=Qt.slice(),zn=Object.create(null);for(ze=0,Ee=0;ze<Qt.length;ze++)gr.hasOwnProperty(Ve=Qt[ze])?Ee++:(Ie.push({command:Hr.removeLayer,args:[Ve]}),sn.splice(sn.indexOf(Ve,Ee),1));for(ze=0,Ee=0;ze<dr.length;ze++)sn[sn.length-1-ze]!==(Ve=dr[dr.length-1-ze])&&(Lr.hasOwnProperty(Ve)?(Ie.push({command:Hr.removeLayer,args:[Ve]}),sn.splice(sn.lastIndexOf(Ve,sn.length-Ee),1)):Ee++,Ie.push({command:Hr.addLayer,args:[gr[Ve],Xt=sn[sn.length-ze]]}),sn.splice(sn.length-ze,0,Ve),zn[Ve]=!0);for(ze=0;ze<dr.length;ze++)if(et=Lr[Ve=dr[ze]],vt=gr[Ve],!zn[Ve]&&!m.deepEqual(et,vt))if(m.deepEqual(et.source,vt.source)&&m.deepEqual(et["source-layer"],vt["source-layer"])&&m.deepEqual(et.type,vt.type)){for(jt in vi(et.layout,vt.layout,Ie,Ve,null,Hr.setLayoutProperty),vi(et.paint,vt.paint,Ie,Ve,null,Hr.setPaintProperty),m.deepEqual(et.filter,vt.filter)||Ie.push({command:Hr.setFilter,args:[Ve,vt.filter]}),m.deepEqual(et.minzoom,vt.minzoom)&&m.deepEqual(et.maxzoom,vt.maxzoom)||Ie.push({command:Hr.setLayerZoomRange,args:[Ve,vt.minzoom,vt.maxzoom]}),et)et.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?vi(et[jt],vt[jt],Ie,Ve,jt.slice(6),Hr.setPaintProperty):m.deepEqual(et[jt],vt[jt])||Ie.push({command:Hr.setLayerProperty,args:[Ve,jt,vt[jt]]}));for(jt in vt)vt.hasOwnProperty(jt)&&!et.hasOwnProperty(jt)&&jt!=="layout"&&jt!=="paint"&&jt!=="filter"&&jt!=="metadata"&&jt!=="minzoom"&&jt!=="maxzoom"&&(jt.indexOf("paint.")===0?vi(et[jt],vt[jt],Ie,Ve,jt.slice(6),Hr.setPaintProperty):m.deepEqual(et[jt],vt[jt])||Ie.push({command:Hr.setLayerProperty,args:[Ve,jt,vt[jt]]}))}else Ie.push({command:Hr.removeLayer,args:[Ve]}),Xt=sn[sn.lastIndexOf(Ve)+1],Ie.push({command:Hr.addLayer,args:[vt,Xt]})}(pe,k.layers,Z)}catch(ve){console.warn("Unable to compute style diff:",ve),Z=[{command:Hr.setStyle,args:[k]}]}return Z}(this.serialize(),c).filter(function(P){return!(P.command in Fs)});if(E.length===0)return!1;var w=E.filter(function(P){return!(P.command in Ts)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(P){return P.command}).join(", ")+".");return E.forEach(function(P){P.command!=="setTransition"&&d[P.command].apply(d,P.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new m.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new m.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new m.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,E){var w=this;if(E===void 0&&(E={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(m.validateStyle.source,"sources."+c,d,null,E))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var P=this.sourceCaches[c]=new ke(c,d,this.dispatcher);P.style=this,P.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:P.serialize(),sourceId:c}}),P.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new m.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var E=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],E.fire(new m.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),E.setEventedParent(null),E.clearTiles(),E.onRemove&&E.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=c.id;if(this.getLayer(w))this.fire(new m.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var P;if(c.type==="custom"){if(ys(this,m.validateCustomStyleLayer(c)))return;P=m.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=m.clone$1(c),c=m.extend(c,{source:w})),this._validate(m.validateStyle.layer,"layers."+w,c,{arrayIndex:-1},E))return;P=m.createStyleLayer(c),this._validateLayer(P),P.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[P.id]=P.serialize()}var k=d?this._order.indexOf(d):this._order.length;if(d&&k===-1)this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(k,0,w),this._layerOrderChanged=!0,this._layers[w]=P,this._removedLayers[w]&&P.source&&P.type!=="custom"){var Z=this._removedLayers[w];delete this._removedLayers[w],Z.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var E=this._order.indexOf(c);this._order.splice(E,1);var w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new m.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(w,0,c),this._layerOrderChanged=!0)}}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var E=this._order.indexOf(c);this._order.splice(E,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,E){this._checkLoaded();var w=this.getLayer(c);w?w.minzoom===d&&w.maxzoom===E||(d!=null&&(w.minzoom=d),E!=null&&(w.maxzoom=E),this._updateLayer(w)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,E){E===void 0&&(E={}),this._checkLoaded();var w=this.getLayer(c);if(w){if(!m.deepEqual(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(m.validateStyle.filter,"layers."+w.id+".filter",d,null,E)||(w.filter=m.clone$1(d),this._updateLayer(w)))}else this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return m.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getLayoutProperty(d),E)||(P.setLayoutProperty(d,E,w),this._updateLayer(P)):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var E=this.getLayer(c);if(E)return E.getLayoutProperty(d);this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,E,w){w===void 0&&(w={}),this._checkLoaded();var P=this.getLayer(c);P?m.deepEqual(P.getPaintProperty(d),E)||(P.setPaintProperty(d,E,w)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new m.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=c.sourceLayer,P=this.sourceCaches[E];if(P!==void 0){var k=P.getSource().type;k==="geojson"&&w?this.fire(new m.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):k!=="vector"||w?(c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),P.setFeatureState(w,c.id,d)):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var E=c.source,w=this.sourceCaches[E];if(w!==void 0){var P=w.getSource().type,k=P==="vector"?c.sourceLayer:void 0;P!=="vector"||k?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new m.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(k,c.id,d):this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+E+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,E=c.sourceLayer,w=this.sourceCaches[d];if(w!==void 0){if(w.getSource().type!=="vector"||E)return c.id===void 0&&this.fire(new m.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(E,c.id);this.fire(new m.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new m.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return m.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return m.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:m.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,E=function(Lr){return d._layers[Lr].type==="fill-extrusion"},w={},P=[],k=this._order.length-1;k>=0;k--){var Z=this._order[k];if(E(Z)){w[Z]=k;for(var X=0,le=c;X<le.length;X+=1){var pe=le[X][Z];if(pe)for(var ve=0,Re=pe;ve<Re.length;ve+=1)P.push(Re[ve])}}}P.sort(function(Lr,gr){return gr.intersectionZ-Lr.intersectionZ});for(var Ie=[],ze=this._order.length-1;ze>=0;ze--){var Ee=this._order[ze];if(E(Ee))for(var Ve=P.length-1;Ve>=0;Ve--){var et=P[Ve].feature;if(w[et.layer.id]<ze)break;Ie.push(et),P.pop()}else for(var vt=0,Xt=c;vt<Xt.length;vt+=1){var jt=Xt[vt][Ee];if(jt)for(var Qt=0,dr=jt;Qt<dr.length;Qt+=1)Ie.push(dr[Qt].feature)}}return Ie},f.prototype.queryRenderedFeatures=function(c,d,E){d&&d.filter&&this._validate(m.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new m.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var P=0,k=d.layers;P<k.length;P+=1){var Z=k[P],X=this._layers[Z];if(!X)return this.fire(new m.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];w[X.source]=!0}}var le=[];for(var pe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!w[pe]||le.push(hn(this.sourceCaches[pe],this._layers,this._serializedLayers,c,d,E));return this.placement&&le.push(function(ve,Re,Ie,ze,Ee,Ve,et){for(var vt={},Xt=Ve.queryRenderedSymbols(ze),jt=[],Qt=0,dr=Object.keys(Xt).map(Number);Qt<dr.length;Qt+=1)jt.push(et[dr[Qt]]);jt.sort(fi);for(var Lr=function(){var Ln=sn[gr],ki=Ln.featureIndex.lookupSymbolFeatures(Xt[Ln.bucketInstanceId],Re,Ln.bucketIndex,Ln.sourceLayerIndex,Ee.filter,Ee.layers,Ee.availableImages,ve);for(var tn in ki){var ai=vt[tn]=vt[tn]||[],li=ki[tn];li.sort(function(mi,Yn){var Hn=Ln.featureSortOrder;if(Hn){var yo=Hn.indexOf(mi.featureIndex);return Hn.indexOf(Yn.featureIndex)-yo}return Yn.featureIndex-mi.featureIndex});for(var $n=0,jn=li;$n<jn.length;$n+=1)ai.push(jn[$n])}},gr=0,sn=jt;gr<sn.length;gr+=1)Lr();var zn=function(Ln){vt[Ln].forEach(function(ki){var tn=ki.feature,ai=Ie[ve[Ln].source].getFeatureState(tn.layer["source-layer"],tn.id);tn.source=tn.layer.source,tn.layer["source-layer"]&&(tn.sourceLayer=tn.layer["source-layer"]),tn.state=ai})};for(var Un in vt)zn(Un);return vt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(m.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var E=this.sourceCaches[c];return E?function(w,P){for(var k=w.getRenderableIds().map(function(Re){return w.getTileByID(Re)}),Z=[],X={},le=0;le<k.length;le++){var pe=k[le],ve=pe.tileID.canonical.key;X[ve]||(X[ve]=!0,pe.querySourceFeatures(Z,P))}return Z}(E,d):[]},f.prototype.addSourceType=function(c,d,E){return f.getSourceType(c)?E(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},E):E(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var E=this.light.getLight(),w=!1;for(var P in c)if(!m.deepEqual(c[P],E[P])){w=!0;break}if(w){var k={now:m.browser.now(),transition:m.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(k)}},f.prototype._validate=function(c,d,E,w,P){return P===void 0&&(P={}),(!P||P.validate!==!1)&&ys(this,c.call(m.validateStyle,m.extend({key:d,style:this.serialize(),value:E,styleSpec:m.styleSpec},w)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),m.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,E,w,P){P===void 0&&(P=!1);for(var k=!1,Z=!1,X={},le=0,pe=this._order;le<pe.length;le+=1){var ve=this._layers[pe[le]];if(ve.type==="symbol"){if(!X[ve.source]){var Re=this.sourceCaches[ve.source];X[ve.source]=Re.getRenderableIds(!0).map(function(et){return Re.getTileByID(et)}).sort(function(et,vt){return vt.tileID.overscaledZ-et.tileID.overscaledZ||(et.tileID.isLessThan(vt.tileID)?-1:1)})}var Ie=this.crossTileSymbolIndex.addLayer(ve,X[ve.source],c.center.lng);k=k||Ie}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||E===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(m.browser.now(),c.zoom))&&(this.pauseablePlacement=new La(c,this._order,P,d,E,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,X),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(m.browser.now()),Z=!0),k&&this.pauseablePlacement.placement.setStale()),Z||k)for(var ze=0,Ee=this._order;ze<Ee.length;ze+=1){var Ve=this._layers[Ee[ze]];Ve.type==="symbol"&&this.placement.updateLayerOpacities(Ve,X[Ve.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(m.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,E){this.imageManager.getImages(d.icons,E),this._updateTilesForChangedImages();var w=this.sourceCaches[d.source];w&&w.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,E){this.glyphManager.getGlyphs(d.stacks,E)},f.prototype.getResource=function(c,d,E){return m.makeRequest(d,E)},f}(m.Evented);_s.getSourceType=function(l){return Sr[l]},_s.setSourceType=function(l,f){Sr[l]=f},_s.registerForPluginStateChange=m.registerForPluginStateChange;var ga=m.createLayout([{name:"a_pos",type:"Int16",components:2}]),xa=Hi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),is=Hi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hf=Hi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Tl=Hi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Xs=Hi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),tc=Hi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Wu=Hi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),Ys=Hi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),al=Hi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),_=Hi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),M=Hi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=Hi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Hi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),$=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),xe=Hi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),We=Hi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ft=Hi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),pt=Hi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),ar=Hi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ur=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Tn=Hi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),ii=Hi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Rn=Hi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Yi=Hi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),da=Hi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ca=Hi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Hi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),E=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=w?w.concat(E):E,k={};return{fragmentSource:l=l.replace(c,function(Z,X,le,pe,ve){return k[ve]=!0,X==="define"?`
#ifndef HAS_UNIFORM_u_`+ve+`
varying `+le+" "+pe+" "+ve+`;
#else
uniform `+le+" "+pe+" u_"+ve+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ve+`
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`}),vertexSource:f=f.replace(c,function(Z,X,le,pe,ve){var Re=pe==="float"?"vec2":"vec4",Ie=ve.match(/color/)?"color":Re;return k[ve]?X==="define"?`
#ifndef HAS_UNIFORM_u_`+ve+`
uniform lowp float u_`+ve+`_t;
attribute `+le+" "+Re+" a_"+ve+`;
varying `+le+" "+pe+" "+ve+`;
#else
uniform `+le+" "+pe+" u_"+ve+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+ve+" = a_"+ve+`;
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+ve+" = unpack_mix_"+Ie+"(a_"+ve+", u_"+ve+`_t);
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`:X==="define"?`
#ifndef HAS_UNIFORM_u_`+ve+`
uniform lowp float u_`+ve+`_t;
attribute `+le+" "+Re+" a_"+ve+`;
#else
uniform `+le+" "+pe+" u_"+ve+`;
#endif
`:Ie==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+le+" "+pe+" "+ve+" = a_"+ve+`;
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ve+`
    `+le+" "+pe+" "+ve+" = unpack_mix_"+Ie+"(a_"+ve+", u_"+ve+`_t);
#else
    `+le+" "+pe+" "+ve+" = u_"+ve+`;
#endif
`}),staticAttributes:d,staticUniforms:P}}var xs=Object.freeze({__proto__:null,prelude:xa,background:is,backgroundPattern:hf,circle:Tl,clippingMask:Xs,heatmap:tc,heatmapTexture:Wu,collisionBox:Ys,collisionCircle:al,debug:_,fill:M,fillOutline:B,fillOutlinePattern:O,fillPattern:$,fillExtrusion:xe,fillExtrusionPattern:We,hillshadePrepare:ft,hillshade:pt,line:ar,lineGradient:ur,linePattern:Tn,lineSDF:ii,raster:Rn,symbolIcon:Yi,symbolSDF:da,symbolTextAndIcon:Ca}),lu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Xu(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}lu.prototype.bind=function(l,f,c,d,E,w,P,k){this.context=l;for(var Z=this.boundPaintVertexBuffers.length!==d.length,X=0;!Z&&X<d.length;X++)this.boundPaintVertexBuffers[X]!==d[X]&&(Z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!Z&&this.boundIndexBuffer===E&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===P&&this.boundDynamicVertexBuffer2===k?(l.bindVertexArrayOES.set(this.vao),P&&P.bind(),E&&E.dynamicDraw&&E.bind(),k&&k.bind()):this.freshBind(f,c,d,E,w,P,k)},lu.prototype.freshBind=function(l,f,c,d,E,w,P){var k,Z=l.numAttributes,X=this.context,le=X.gl;if(X.extVertexArrayObject)this.vao&&this.destroy(),this.vao=X.extVertexArrayObject.createVertexArrayOES(),X.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=E,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=P;else{k=X.currentNumAttributes||0;for(var pe=Z;pe<k;pe++)le.disableVertexAttribArray(pe)}f.enableAttributes(le,l);for(var ve=0,Re=c;ve<Re.length;ve+=1)Re[ve].enableAttributes(le,l);w&&w.enableAttributes(le,l),P&&P.enableAttributes(le,l),f.bind(),f.setVertexAttribPointers(le,l,E);for(var Ie=0,ze=c;Ie<ze.length;Ie+=1){var Ee=ze[Ie];Ee.bind(),Ee.setVertexAttribPointers(le,l,E)}w&&(w.bind(),w.setVertexAttribPointers(le,l,E)),d&&d.bind(),P&&(P.bind(),P.setVertexAttribPointers(le,l,E)),X.currentNumAttributes=Z},lu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var df=function(l,f,c,d,E,w){var P=l.gl;this.program=P.createProgram();for(var k=Xu(c.staticAttributes),Z=d?d.getBinderAttributes():[],X=k.concat(Z),le=c.staticUniforms?Xu(c.staticUniforms):[],pe=d?d.getBinderUniforms():[],ve=[],Re=0,Ie=le.concat(pe);Re<Ie.length;Re+=1){var ze=Ie[Re];ve.indexOf(ze)<0&&ve.push(ze)}var Ee=d?d.defines():[];w&&Ee.push("#define OVERDRAW_INSPECTOR;");var Ve=Ee.concat(xa.fragmentSource,c.fragmentSource).join(`
`),et=Ee.concat(xa.vertexSource,c.vertexSource).join(`
`),vt=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(vt,Ve),P.compileShader(vt),P.attachShader(this.program,vt);var Xt=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())this.failedToCreate=!0;else{P.shaderSource(Xt,et),P.compileShader(Xt),P.attachShader(this.program,Xt),this.attributes={};var jt={};this.numAttributes=X.length;for(var Qt=0;Qt<this.numAttributes;Qt++)X[Qt]&&(P.bindAttribLocation(this.program,Qt,X[Qt]),this.attributes[X[Qt]]=Qt);P.linkProgram(this.program),P.deleteShader(Xt),P.deleteShader(vt);for(var dr=0;dr<ve.length;dr++){var Lr=ve[dr];if(Lr&&!jt[Lr]){var gr=P.getUniformLocation(this.program,Lr);gr&&(jt[Lr]=gr)}}this.fixedUniforms=E(l,jt),this.binderUniforms=d?d.getUniforms(l,jt):[]}}};function ol(l,f,c){var d=1/ia(c,1,f.transform.tileZoom),E=Math.pow(2,c.tileID.overscaledZ),w=c.tileSize*Math.pow(2,f.transform.tileZoom)/E,P=w*(c.tileID.canonical.x+c.tileID.wrap*E),k=w*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[P>>16,k>>16],u_pixel_coord_lower:[65535&P,65535&k]}}df.prototype.draw=function(l,f,c,d,E,w,P,k,Z,X,le,pe,ve,Re,Ie,ze){var Ee,Ve=l.gl;if(!this.failedToCreate){for(var et in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(E),l.setCullFace(w),this.fixedUniforms)this.fixedUniforms[et].set(P[et]);Re&&Re.setUniforms(l,this.binderUniforms,pe,{zoom:ve});for(var vt=(Ee={},Ee[Ve.LINES]=2,Ee[Ve.TRIANGLES]=3,Ee[Ve.LINE_STRIP]=1,Ee)[f],Xt=0,jt=le.get();Xt<jt.length;Xt+=1){var Qt=jt[Xt],dr=Qt.vaos||(Qt.vaos={});(dr[k]||(dr[k]=new lu)).bind(l,this,Z,Re?Re.getPaintVertexBuffers():[],X,Qt.vertexOffset,Ie,ze),Ve.drawElements(f,Qt.primitiveLength*vt,Ve.UNSIGNED_SHORT,Qt.primitiveOffset*vt*2)}}};var kc=function(l,f,c,d){var E=f.style.light,w=E.properties.get("position"),P=[w.x,w.y,w.z],k=m.create$1();E.properties.get("anchor")==="viewport"&&m.fromRotation(k,-f.transform.angle),m.transformMat3(P,P,k);var Z=E.properties.get("color");return{u_matrix:l,u_lightpos:P,u_lightintensity:E.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+c,u_opacity:d}},Au=function(l,f,c,d,E,w,P){return m.extend(kc(l,f,c,d),ol(w,f,P),{u_height_factor:-Math.pow(2,E.overscaledZ)/P.tileSize/8})},wu=function(l){return{u_matrix:l}},Tu=function(l,f,c,d){return m.extend(wu(l),ol(c,f,d))},co=function(l,f){return{u_matrix:l,u_world:f}},jf=function(l,f,c,d,E){return m.extend(Tu(l,f,c,d),{u_world:E})},Vf=function(l,f,c,d){var E,w,P=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var k=ia(c,1,P.zoom);E=!0,w=[k,k]}else E=!1,w=P.pixelsToGLUnits;return{u_camera_to_center_distance:P.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+E,u_device_pixel_ratio:m.browser.devicePixelRatio,u_extrude_scale:w}},$o=function(l,f,c){var d=ia(c,1,f.zoom),E=Math.pow(2,f.zoom-c.tileID.overscaledZ),w=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*E),f.pixelsToGLUnits[1]/(d*E)],u_overscale_factor:w}},Dc=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},Mu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},cu=function(l){return{u_matrix:l}},vf=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:ia(f,1,c),u_intensity:d}},Ml=function(l,f,c){var d=l.transform;return{u_matrix:Fc(l,f,c),u_ratio:1/ia(f,1,d.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ni=function(l,f,c,d){return m.extend(Ml(l,f,c),{u_image:0,u_image_height:d})},Pl=function(l,f,c,d){var E=l.transform,w=sl(f,E);return{u_matrix:Fc(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/ia(f,1,E.zoom),u_device_pixel_ratio:m.browser.devicePixelRatio,u_image:0,u_scale:[w,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/E.pixelsToGLUnits[0],1/E.pixelsToGLUnits[1]]}},Cp=function(l,f,c,d,E){var w=l.lineAtlas,P=sl(f,l.transform),k=c.layout.get("line-cap")==="round",Z=w.getDash(d.from,k),X=w.getDash(d.to,k),le=Z.width*E.fromScale,pe=X.width*E.toScale;return m.extend(Ml(l,f,c),{u_patternscale_a:[P/le,-Z.height/2],u_patternscale_b:[P/pe,-X.height/2],u_sdfgamma:w.width/(256*Math.min(le,pe)*m.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:X.y,u_mix:E.t})};function sl(l,f){return 1/ia(l,1,f.tileZoom)}function Fc(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var Gf=function(l,f,c,d,E){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(P=E.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(w=E.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Ap(E.paint.get("raster-hue-rotate"))};var w,P};function Ap(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Hf,Bc=function(l,f,c,d,E,w,P,k,Z,X){var le=E.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:le.width/le.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:P,u_coord_matrix:k,u_is_text:+Z,u_pitch_with_map:+d,u_texsize:X,u_texture:0}},rc=function(l,f,c,d,E,w,P,k,Z,X,le){var pe=E.transform;return m.extend(Bc(l,f,c,d,E,w,P,k,Z,X),{u_gamma_scale:d?Math.cos(pe._pitch)*pe.cameraToCenterDistance:1,u_device_pixel_ratio:m.browser.devicePixelRatio,u_is_halo:+le})},nc=function(l,f,c,d,E,w,P,k,Z,X){return m.extend(rc(l,f,c,d,E,w,P,k,!0,Z,!0),{u_texsize_icon:X,u_texture_icon:1})},Il=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},ul=function(l,f,c,d,E,w){return m.extend(function(P,k,Z,X){var le=Z.imageManager.getPattern(P.from.toString()),pe=Z.imageManager.getPattern(P.to.toString()),ve=Z.imageManager.getPixelSize(),Re=ve.width,Ie=ve.height,ze=Math.pow(2,X.tileID.overscaledZ),Ee=X.tileSize*Math.pow(2,Z.transform.tileZoom)/ze,Ve=Ee*(X.tileID.canonical.x+X.tileID.wrap*ze),et=Ee*X.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:pe.tl,u_pattern_br_b:pe.br,u_texsize:[Re,Ie],u_mix:k.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:pe.displaySize,u_scale_a:k.fromScale,u_scale_b:k.toScale,u_tile_units_to_pixels:1/ia(X,1,Z.transform.tileZoom),u_pixel_coord_upper:[Ve>>16,et>>16],u_pixel_coord_lower:[65535&Ve,65535&et]}}(d,w,c,E),{u_matrix:l,u_opacity:f})},Ol={fillExtrusion:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_lightpos:new m.Uniform3f(l,f.u_lightpos),u_lightintensity:new m.Uniform1f(l,f.u_lightintensity),u_lightcolor:new m.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new m.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new m.Uniform1f(l,f.u_height_factor),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade),u_opacity:new m.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_texsize:new m.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new m.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new m.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new m.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new m.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new m.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new m.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new m.UniformColor(l,f.u_color),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_overlay:new m.Uniform1i(l,f.u_overlay),u_overlay_scale:new m.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new m.Uniform1f(l,f.u_extrude_scale),u_intensity:new m.Uniform1f(l,f.u_intensity),u_matrix:new m.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_world:new m.Uniform2f(l,f.u_world),u_image:new m.Uniform1i(l,f.u_image),u_color_ramp:new m.Uniform1i(l,f.u_color_ramp),u_opacity:new m.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_latrange:new m.Uniform2f(l,f.u_latrange),u_light:new m.Uniform2f(l,f.u_light),u_shadow:new m.UniformColor(l,f.u_shadow),u_highlight:new m.UniformColor(l,f.u_highlight),u_accent:new m.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_image:new m.Uniform1i(l,f.u_image),u_dimension:new m.Uniform2f(l,f.u_dimension),u_zoom:new m.Uniform1f(l,f.u_zoom),u_unpack:new m.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_image:new m.Uniform1i(l,f.u_image),u_image_height:new m.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_texsize:new m.Uniform2f(l,f.u_texsize),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_image:new m.Uniform1i(l,f.u_image),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_scale:new m.Uniform3f(l,f.u_scale),u_fade:new m.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_ratio:new m.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new m.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new m.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new m.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new m.Uniform1f(l,f.u_sdfgamma),u_image:new m.Uniform1i(l,f.u_image),u_tex_y_a:new m.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new m.Uniform1f(l,f.u_tex_y_b),u_mix:new m.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new m.Uniform2f(l,f.u_tl_parent),u_scale_parent:new m.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new m.Uniform1f(l,f.u_buffer_scale),u_fade_t:new m.Uniform1f(l,f.u_fade_t),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image0:new m.Uniform1i(l,f.u_image0),u_image1:new m.Uniform1i(l,f.u_image1),u_brightness_low:new m.Uniform1f(l,f.u_brightness_low),u_brightness_high:new m.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new m.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new m.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new m.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texture:new m.Uniform1i(l,f.u_texture),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new m.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new m.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new m.Uniform1f(l,f.u_size_t),u_size:new m.Uniform1f(l,f.u_size),u_camera_to_center_distance:new m.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new m.Uniform1f(l,f.u_pitch),u_rotate_symbol:new m.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new m.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new m.Uniform1f(l,f.u_fade_change),u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new m.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new m.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new m.Uniform1i(l,f.u_is_text),u_pitch_with_map:new m.Uniform1i(l,f.u_pitch_with_map),u_texsize:new m.Uniform2f(l,f.u_texsize),u_texsize_icon:new m.Uniform2f(l,f.u_texsize_icon),u_texture:new m.Uniform1i(l,f.u_texture),u_texture_icon:new m.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new m.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new m.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new m.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_color:new m.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new m.UniformMatrix4f(l,f.u_matrix),u_opacity:new m.Uniform1f(l,f.u_opacity),u_image:new m.Uniform1i(l,f.u_image),u_pattern_tl_a:new m.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new m.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new m.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new m.Uniform2f(l,f.u_pattern_br_b),u_texsize:new m.Uniform2f(l,f.u_texsize),u_mix:new m.Uniform1f(l,f.u_mix),u_pattern_size_a:new m.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new m.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new m.Uniform1f(l,f.u_scale_a),u_scale_b:new m.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new m.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new m.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new m.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Yu(l,f,c,d,E,w,P){for(var k=l.context,Z=k.gl,X=l.useProgram("collisionBox"),le=[],pe=0,ve=0,Re=0;Re<d.length;Re++){var Ie=d[Re],ze=f.getTile(Ie),Ee=ze.getBucket(c);if(Ee){var Ve=Ie.posMatrix;E[0]===0&&E[1]===0||(Ve=l.translatePosMatrix(Ie.posMatrix,ze,E,w));var et=P?Ee.textCollisionBox:Ee.iconCollisionBox,vt=Ee.collisionCircleArray;if(vt.length>0){var Xt=m.create(),jt=Ve;m.mul(Xt,Ee.placementInvProjMatrix,l.transform.glCoordMatrix),m.mul(Xt,Xt,Ee.placementViewportMatrix),le.push({circleArray:vt,circleOffset:ve,transform:jt,invTransform:Xt}),ve=pe+=vt.length/4}et&&X.draw(k,Z.LINES,ye.disabled,Pe.disabled,l.colorModeForRenderPass(),tt.disabled,$o(Ve,l.transform,ze),c.id,et.layoutVertexBuffer,et.indexBuffer,et.segments,null,l.transform.zoom,null,null,et.collisionVertexBuffer)}}if(P&&le.length){var Qt=l.useProgram("collisionCircle"),dr=new m.StructArrayLayout2f1f2i16;dr.resize(4*pe),dr._trim();for(var Lr=0,gr=0,sn=le;gr<sn.length;gr+=1)for(var zn=sn[gr],Un=0;Un<zn.circleArray.length/4;Un++){var Ln=4*Un,ki=zn.circleArray[Ln+0],tn=zn.circleArray[Ln+1],ai=zn.circleArray[Ln+2],li=zn.circleArray[Ln+3];dr.emplace(Lr++,ki,tn,ai,li,0),dr.emplace(Lr++,ki,tn,ai,li,1),dr.emplace(Lr++,ki,tn,ai,li,2),dr.emplace(Lr++,ki,tn,ai,li,3)}(!Hf||Hf.length<2*pe)&&(Hf=function(Ja){var To=2*Ja,Fa=new m.StructArrayLayout3ui6;Fa.resize(To),Fa._trim();for(var Wa=0;Wa<To;Wa++){var po=6*Wa;Fa.uint16[po+0]=4*Wa+0,Fa.uint16[po+1]=4*Wa+1,Fa.uint16[po+2]=4*Wa+2,Fa.uint16[po+3]=4*Wa+2,Fa.uint16[po+4]=4*Wa+3,Fa.uint16[po+5]=4*Wa+0}return Fa}(pe));for(var $n=k.createIndexBuffer(Hf,!0),jn=k.createVertexBuffer(dr,m.collisionCircleLayout.members,!0),mi=0,Yn=le;mi<Yn.length;mi+=1){var Hn=Yn[mi],yo=Dc(Hn.transform,Hn.invTransform,l.transform);Qt.draw(k,Z.TRIANGLES,ye.disabled,Pe.disabled,l.colorModeForRenderPass(),tt.disabled,yo,c.id,jn,$n,m.SegmentVector.simpleSegment(0,2*Hn.circleOffset,Hn.circleArray.length,Hn.circleArray.length/2),null,l.transform.zoom,null,null,null)}jn.destroy(),$n.destroy()}}var qs=m.identity(new Float32Array(16));function mf(l,f,c,d,E,w){var P=m.getAnchorAlignment(l),k=-(P.horizontalAlign-.5)*f,Z=-(P.verticalAlign-.5)*c,X=m.evaluateVariableOffset(l,d);return new m.Point((k/E+X[0])*w,(Z/E+X[1])*w)}function gf(l,f,c,d,E,w,P,k,Z,X,le){var pe=l.text.placedSymbolArray,ve=l.text.dynamicLayoutVertexArray,Re=l.icon.dynamicLayoutVertexArray,Ie={};ve.clear();for(var ze=0;ze<pe.length;ze++){var Ee=pe.get(ze),Ve=Ee.hidden||!Ee.crossTileID||l.allowVerticalPlacement&&!Ee.placedOrientation?null:d[Ee.crossTileID];if(Ve){var et=new m.Point(Ee.anchorX,Ee.anchorY),vt=Ii(et,c?k:P),Xt=ji(w.cameraToCenterDistance,vt.signedDistanceFromCamera),jt=E.evaluateSizeForFeature(l.textSizeData,X,Ee)*Xt/m.ONE_EM;c&&(jt*=l.tilePixelRatio/Z);for(var Qt=mf(Ve.anchor,Ve.width,Ve.height,Ve.textOffset,Ve.textBoxScale,jt),dr=c?Ii(et.add(Qt),P).point:vt.point.add(f?Qt.rotate(-w.angle):Qt),Lr=l.allowVerticalPlacement&&Ee.placedOrientation===m.WritingMode.vertical?Math.PI/2:0,gr=0;gr<Ee.numGlyphs;gr++)m.addDynamicAttributes(ve,dr,Lr);le&&Ee.associatedIconIndex>=0&&(Ie[Ee.associatedIconIndex]={shiftedAnchor:dr,angle:Lr})}else Ua(Ee.numGlyphs,ve)}if(le){Re.clear();for(var sn=l.icon.placedSymbolArray,zn=0;zn<sn.length;zn++){var Un=sn.get(zn);if(Un.hidden)Ua(Un.numGlyphs,Re);else{var Ln=Ie[zn];if(Ln)for(var ki=0;ki<Un.numGlyphs;ki++)m.addDynamicAttributes(Re,Ln.shiftedAnchor,Ln.angle);else Ua(Un.numGlyphs,Re)}}l.icon.dynamicLayoutVertexBuffer.updateData(Re)}l.text.dynamicLayoutVertexBuffer.updateData(ve)}function Wf(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function fu(l,f,c,d,E,w,P,k,Z,X,le,pe){for(var ve=l.context,Re=ve.gl,Ie=l.transform,ze=k==="map",Ee=Z==="map",Ve=ze&&c.layout.get("symbol-placement")!=="point",et=ze&&!Ee&&!Ve,vt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Xt=!1,jt=l.depthModeForSublayer(0,ye.ReadOnly),Qt=c.layout.get("text-variable-anchor"),dr=[],Lr=0,gr=d;Lr<gr.length;Lr+=1){var sn=gr[Lr],zn=f.getTile(sn),Un=zn.getBucket(c);if(Un){var Ln=E?Un.text:Un.icon;if(Ln&&Ln.segments.get().length){var ki=Ln.programConfigurations.get(c.id),tn=E||Un.sdfIcons,ai=E?Un.textSizeData:Un.iconSizeData,li=Ee||Ie.pitch!==0,$n=l.useProgram(Wf(tn,E,Un),ki),jn=m.evaluateSizeForZoom(ai,Ie.zoom),mi=void 0,Yn=[0,0],Hn=void 0,yo=void 0,Ja=null,To=void 0;if(E)Hn=zn.glyphAtlasTexture,yo=Re.LINEAR,mi=zn.glyphAtlasTexture.size,Un.iconsInText&&(Yn=zn.imageAtlasTexture.size,Ja=zn.imageAtlasTexture,To=li||l.options.rotating||l.options.zooming||ai.kind==="composite"||ai.kind==="camera"?Re.LINEAR:Re.NEAREST);else{var Fa=c.layout.get("icon-size").constantOr(0)!==1||Un.iconsNeedLinear;Hn=zn.imageAtlasTexture,yo=tn||l.options.rotating||l.options.zooming||Fa||li?Re.LINEAR:Re.NEAREST,mi=zn.imageAtlasTexture.size}var Wa=ia(zn,1,l.transform.zoom),po=Ta(sn.posMatrix,Ee,ze,l.transform,Wa),Os=Ci(sn.posMatrix,Ee,ze,l.transform,Wa),os=Qt&&Un.hasTextData(),Du=c.layout.get("icon-text-fit")!=="none"&&os&&Un.hasIconData();Ve&&on(Un,sn.posMatrix,l,E,po,Os,Ee,X);var ss=l.translatePosMatrix(sn.posMatrix,zn,w,P),mu=Ve||E&&Qt||Du?qs:po,Rs=l.translatePosMatrix(Os,zn,w,P,!0),Cs=tn&&c.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Zl={program:$n,buffers:Ln,uniformValues:tn?Un.iconsInText?nc(ai.kind,jn,et,Ee,l,ss,mu,Rs,mi,Yn):rc(ai.kind,jn,et,Ee,l,ss,mu,Rs,E,mi,!0):Bc(ai.kind,jn,et,Ee,l,ss,mu,Rs,E,mi),atlasTexture:Hn,atlasTextureIcon:Ja,atlasInterpolation:yo,atlasInterpolationIcon:To,isSDF:tn,hasHalo:Cs};if(vt&&Un.canOverlap){Xt=!0;for(var Fu=0,gl=Ln.segments.get();Fu<gl.length;Fu+=1){var jl=gl[Fu];dr.push({segments:new m.SegmentVector([jl]),sortKey:jl.sortKey,state:Zl})}}else dr.push({segments:Ln.segments,sortKey:0,state:Zl})}}}Xt&&dr.sort(function(Nu,Ju){return Nu.sortKey-Ju.sortKey});for(var ru=0,yl=dr;ru<yl.length;ru+=1){var bu=yl[ru],Eo=bu.state;if(ve.activeTexture.set(Re.TEXTURE0),Eo.atlasTexture.bind(Eo.atlasInterpolation,Re.CLAMP_TO_EDGE),Eo.atlasTextureIcon&&(ve.activeTexture.set(Re.TEXTURE1),Eo.atlasTextureIcon&&Eo.atlasTextureIcon.bind(Eo.atlasInterpolationIcon,Re.CLAMP_TO_EDGE)),Eo.isSDF){var Bu=Eo.uniformValues;Eo.hasHalo&&(Bu.u_is_halo=1,ic(Eo.buffers,bu.segments,c,l,Eo.program,jt,le,pe,Bu)),Bu.u_is_halo=0}ic(Eo.buffers,bu.segments,c,l,Eo.program,jt,le,pe,Eo.uniformValues)}}function ic(l,f,c,d,E,w,P,k,Z){var X=d.context;E.draw(X,X.gl.TRIANGLES,w,P,k,tt.disabled,Z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Nc(l,f,c,d,E,w,P){var k,Z,X,le,pe,ve=l.context.gl,Re=c.paint.get("fill-pattern"),Ie=Re&&Re.constantOr(1),ze=c.getCrossfadeParameters();P?(Z=Ie&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=ve.LINES):(Z=Ie?"fillPattern":"fill",k=ve.TRIANGLES);for(var Ee=0,Ve=d;Ee<Ve.length;Ee+=1){var et=Ve[Ee],vt=f.getTile(et);if(!Ie||vt.patternsLoaded()){var Xt=vt.getBucket(c);if(Xt){var jt=Xt.programConfigurations.get(c.id),Qt=l.useProgram(Z,jt);Ie&&(l.context.activeTexture.set(ve.TEXTURE0),vt.imageAtlasTexture.bind(ve.LINEAR,ve.CLAMP_TO_EDGE),jt.updatePaintBuffers(ze));var dr=Re.constantOr(null);if(dr&&vt.imageAtlas){var Lr=vt.imageAtlas,gr=Lr.patternPositions[dr.to.toString()],sn=Lr.patternPositions[dr.from.toString()];gr&&sn&&jt.setConstantPatternPositions(gr,sn)}var zn=l.translatePosMatrix(et.posMatrix,vt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(P){le=Xt.indexBuffer2,pe=Xt.segments2;var Un=[ve.drawingBufferWidth,ve.drawingBufferHeight];X=Z==="fillOutlinePattern"&&Ie?jf(zn,l,ze,vt,Un):co(zn,Un)}else le=Xt.indexBuffer,pe=Xt.segments,X=Ie?Tu(zn,l,ze,vt):wu(zn);Qt.draw(l.context,k,E,l.stencilModeForClipping(et),w,tt.disabled,X,c.id,Xt.layoutVertexBuffer,le,pe,c.paint,l.transform.zoom,jt)}}}}function yf(l,f,c,d,E,w,P){for(var k=l.context,Z=k.gl,X=c.paint.get("fill-extrusion-pattern"),le=X.constantOr(1),pe=c.getCrossfadeParameters(),ve=c.paint.get("fill-extrusion-opacity"),Re=0,Ie=d;Re<Ie.length;Re+=1){var ze=Ie[Re],Ee=f.getTile(ze),Ve=Ee.getBucket(c);if(Ve){var et=Ve.programConfigurations.get(c.id),vt=l.useProgram(le?"fillExtrusionPattern":"fillExtrusion",et);le&&(l.context.activeTexture.set(Z.TEXTURE0),Ee.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),et.updatePaintBuffers(pe));var Xt=X.constantOr(null);if(Xt&&Ee.imageAtlas){var jt=Ee.imageAtlas,Qt=jt.patternPositions[Xt.to.toString()],dr=jt.patternPositions[Xt.from.toString()];Qt&&dr&&et.setConstantPatternPositions(Qt,dr)}var Lr=l.translatePosMatrix(ze.posMatrix,Ee,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),gr=c.paint.get("fill-extrusion-vertical-gradient"),sn=le?Au(Lr,l,gr,ve,ze,pe,Ee):kc(Lr,l,gr,ve);vt.draw(k,k.gl.TRIANGLES,E,w,P,tt.backCCW,sn,c.id,Ve.layoutVertexBuffer,Ve.indexBuffer,Ve.segments,c.paint,l.transform.zoom,et)}}}function Rl(l,f,c,d,E,w){var P=l.context,k=P.gl,Z=f.fbo;if(Z){var X=l.useProgram("hillshade");P.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,Z.colorAttachment.get());var le=function(pe,ve,Re){var Ie=Re.paint.get("hillshade-shadow-color"),ze=Re.paint.get("hillshade-highlight-color"),Ee=Re.paint.get("hillshade-accent-color"),Ve=Re.paint.get("hillshade-illumination-direction")*(Math.PI/180);Re.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ve-=pe.transform.angle);var et,vt,Xt,jt=!pe.options.moving;return{u_matrix:pe.transform.calculatePosMatrix(ve.tileID.toUnwrapped(),jt),u_image:0,u_latrange:(et=ve.tileID,vt=Math.pow(2,et.canonical.z),Xt=et.canonical.y,[new m.MercatorCoordinate(0,Xt/vt).toLngLat().lat,new m.MercatorCoordinate(0,(Xt+1)/vt).toLngLat().lat]),u_light:[Re.paint.get("hillshade-exaggeration"),Ve],u_shadow:Ie,u_highlight:ze,u_accent:Ee}}(l,f,c);X.draw(P,k.TRIANGLES,d,E,w,tt.disabled,le,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function uh(l,f,c,d,E,w){var P=l.context,k=P.gl,Z=f.dem;if(Z&&Z.data){var X=Z.dim,le=Z.stride,pe=Z.getPixels();if(P.activeTexture.set(k.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(le),f.demTexture){var ve=f.demTexture;ve.update(pe,{premultiply:!1}),ve.bind(k.NEAREST,k.CLAMP_TO_EDGE)}else f.demTexture=new m.Texture(P,pe,k.RGBA,{premultiply:!1}),f.demTexture.bind(k.NEAREST,k.CLAMP_TO_EDGE);P.activeTexture.set(k.TEXTURE0);var Re=f.fbo;if(!Re){var Ie=new m.Texture(P,{width:X,height:X,data:null},k.RGBA);Ie.bind(k.LINEAR,k.CLAMP_TO_EDGE),(Re=f.fbo=P.createFramebuffer(X,X,!0)).colorAttachment.set(Ie.texture)}P.bindFramebuffer.set(Re.framebuffer),P.viewport.set([0,0,X,X]),l.useProgram("hillshadePrepare").draw(P,k.TRIANGLES,d,E,w,tt.disabled,function(ze,Ee){var Ve=Ee.stride,et=m.create();return m.ortho(et,0,m.EXTENT,-m.EXTENT,0,0,1),m.translate(et,et,[0,-m.EXTENT,0]),{u_matrix:et,u_image:1,u_dimension:[Ve,Ve],u_zoom:ze.overscaledZ,u_unpack:Ee.getUnpackVector()}}(f.tileID,Z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function _f(l,f,c,d,E){var w=d.paint.get("raster-fade-duration");if(w>0){var P=m.browser.now(),k=(P-l.timeAdded)/w,Z=f?(P-f.timeAdded)/w:-1,X=c.getSource(),le=E.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),pe=!f||Math.abs(f.tileID.overscaledZ-le)>Math.abs(l.tileID.overscaledZ-le),ve=pe&&l.refreshedUponExpiration?1:m.clamp(pe?k:1-Z,0,1);return l.refreshedUponExpiration&&k>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-ve}:{opacity:ve,mix:0}}return{opacity:1,mix:0}}var Ll=new m.Color(1,0,0,1),xf=new m.Color(0,1,0,1),bf=new m.Color(0,0,1,1),kl=new m.Color(1,0,1,1),zc=new m.Color(0,1,1,1);function wp(l,f,c,d){ac(l,0,f+c/2,l.transform.width,c,d)}function Tp(l,f,c,d){ac(l,f-c/2,0,c,l.transform.height,d)}function ac(l,f,c,d,E,w){var P=l.context,k=P.gl;k.enable(k.SCISSOR_TEST),k.scissor(f*m.browser.devicePixelRatio,c*m.browser.devicePixelRatio,d*m.browser.devicePixelRatio,E*m.browser.devicePixelRatio),P.clear({color:w}),k.disable(k.SCISSOR_TEST)}function Mp(l,f,c){var d=l.context,E=d.gl,w=c.posMatrix,P=l.useProgram("debug"),k=ye.disabled,Z=Pe.disabled,X=l.colorModeForRenderPass();d.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),P.draw(d,E.LINE_STRIP,k,Z,X,tt.disabled,Mu(w,m.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var le=f.getTileByID(c.key).latestRawTileData,pe=Math.floor((le&&le.byteLength||0)/1024),ve=f.getTile(c).tileSize,Re=512/Math.min(ve,512)*(c.overscaledZ/l.transform.zoom)*.5,Ie=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ie+=" => "+c.overscaledZ),function(ze,Ee){ze.initDebugOverlayCanvas();var Ve=ze.debugOverlayCanvas,et=ze.context.gl,vt=ze.debugOverlayCanvas.getContext("2d");vt.clearRect(0,0,Ve.width,Ve.height),vt.shadowColor="white",vt.shadowBlur=2,vt.lineWidth=1.5,vt.strokeStyle="white",vt.textBaseline="top",vt.font="bold 36px Open Sans, sans-serif",vt.fillText(Ee,5,5),vt.strokeText(Ee,5,5),ze.debugOverlayTexture.update(Ve),ze.debugOverlayTexture.bind(et.LINEAR,et.CLAMP_TO_EDGE)}(l,Ie+" "+pe+"kb"),P.draw(d,E.TRIANGLES,k,Z,He.alphaBlended,tt.disabled,Mu(w,m.Color.transparent,Re),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var Dl={symbol:function(l,f,c,d,E){if(l.renderPass==="translucent"){var w=Pe.disabled,P=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(k,Z,X,le,pe,ve,Re){for(var Ie=Z.transform,ze=pe==="map",Ee=ve==="map",Ve=0,et=k;Ve<et.length;Ve+=1){var vt=et[Ve],Xt=le.getTile(vt),jt=Xt.getBucket(X);if(jt&&jt.text&&jt.text.segments.get().length){var Qt=m.evaluateSizeForZoom(jt.textSizeData,Ie.zoom),dr=ia(Xt,1,Z.transform.zoom),Lr=Ta(vt.posMatrix,Ee,ze,Z.transform,dr),gr=X.layout.get("icon-text-fit")!=="none"&&jt.hasIconData();if(Qt){var sn=Math.pow(2,Ie.zoom-Xt.tileID.overscaledZ);gf(jt,ze,Ee,Re,m.symbolSize,Ie,Lr,vt.posMatrix,sn,Qt,gr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),E),c.paint.get("icon-opacity").constantOr(1)!==0&&fu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),w,P),c.paint.get("text-opacity").constantOr(1)!==0&&fu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),w,P),f.map.showCollisionBoxes&&(Yu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Yu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),P=c.paint.get("circle-stroke-opacity"),k=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(E.constantOr(1)!==0||w.constantOr(1)!==0&&P.constantOr(1)!==0){for(var Z=l.context,X=Z.gl,le=l.depthModeForSublayer(0,ye.ReadOnly),pe=Pe.disabled,ve=l.colorModeForRenderPass(),Re=[],Ie=0;Ie<d.length;Ie++){var ze=d[Ie],Ee=f.getTile(ze),Ve=Ee.getBucket(c);if(Ve){var et=Ve.programConfigurations.get(c.id),vt={programConfiguration:et,program:l.useProgram("circle",et),layoutVertexBuffer:Ve.layoutVertexBuffer,indexBuffer:Ve.indexBuffer,uniformValues:Vf(l,ze,Ee,c)};if(k)for(var Xt=0,jt=Ve.segments.get();Xt<jt.length;Xt+=1){var Qt=jt[Xt];Re.push({segments:new m.SegmentVector([Qt]),sortKey:Qt.sortKey,state:vt})}else Re.push({segments:Ve.segments,sortKey:0,state:vt})}}k&&Re.sort(function(zn,Un){return zn.sortKey-Un.sortKey});for(var dr=0,Lr=Re;dr<Lr.length;dr+=1){var gr=Lr[dr],sn=gr.state;sn.program.draw(Z,X.TRIANGLES,le,pe,ve,tt.disabled,sn.uniformValues,c.id,sn.layoutVertexBuffer,sn.indexBuffer,gr.segments,c.paint,l.transform.zoom,sn.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var E=l.context,w=E.gl,P=Pe.disabled,k=new He([w.ONE,w.ONE],m.Color.transparent,[!0,!0,!0,!0]);(function(Re,Ie,ze){var Ee=Re.gl;Re.activeTexture.set(Ee.TEXTURE1),Re.viewport.set([0,0,Ie.width/4,Ie.height/4]);var Ve=ze.heatmapFbo;if(Ve)Ee.bindTexture(Ee.TEXTURE_2D,Ve.colorAttachment.get()),Re.bindFramebuffer.set(Ve.framebuffer);else{var et=Ee.createTexture();Ee.bindTexture(Ee.TEXTURE_2D,et),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_WRAP_S,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_WRAP_T,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_MIN_FILTER,Ee.LINEAR),Ee.texParameteri(Ee.TEXTURE_2D,Ee.TEXTURE_MAG_FILTER,Ee.LINEAR),Ve=ze.heatmapFbo=Re.createFramebuffer(Ie.width/4,Ie.height/4,!1),function(vt,Xt,jt,Qt){var dr=vt.gl;dr.texImage2D(dr.TEXTURE_2D,0,dr.RGBA,Xt.width/4,Xt.height/4,0,dr.RGBA,vt.extRenderToTextureHalfFloat?vt.extTextureHalfFloat.HALF_FLOAT_OES:dr.UNSIGNED_BYTE,null),Qt.colorAttachment.set(jt)}(Re,Ie,et,Ve)}})(E,l,c),E.clear({color:m.Color.transparent});for(var Z=0;Z<d.length;Z++){var X=d[Z];if(!f.hasRenderableParent(X)){var le=f.getTile(X),pe=le.getBucket(c);if(pe){var ve=pe.programConfigurations.get(c.id);l.useProgram("heatmap",ve).draw(E,w.TRIANGLES,ye.disabled,P,k,tt.disabled,vf(X.posMatrix,le,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segments,c.paint,l.transform.zoom,ve)}}}E.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(Re,Ie){var ze=Re.context,Ee=ze.gl,Ve=Ie.heatmapFbo;if(Ve){ze.activeTexture.set(Ee.TEXTURE0),Ee.bindTexture(Ee.TEXTURE_2D,Ve.colorAttachment.get()),ze.activeTexture.set(Ee.TEXTURE1);var et=Ie.colorRampTexture;et||(et=Ie.colorRampTexture=new m.Texture(ze,Ie.colorRamp,Ee.RGBA)),et.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE),Re.useProgram("heatmapTexture").draw(ze,Ee.TRIANGLES,ye.disabled,Pe.disabled,Re.colorModeForRenderPass(),tt.disabled,function(vt,Xt,jt,Qt){var dr=m.create();m.ortho(dr,0,vt.width,vt.height,0,0,1);var Lr=vt.context.gl;return{u_matrix:dr,u_world:[Lr.drawingBufferWidth,Lr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Xt.paint.get("heatmap-opacity")}}(Re,Ie),Ie.id,Re.viewportBuffer,Re.quadTriangleIndexBuffer,Re.viewportSegments,Ie.paint,Re.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var E=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(E.constantOr(1)!==0&&w.constantOr(1)!==0)for(var P=l.depthModeForSublayer(0,ye.ReadOnly),k=l.colorModeForRenderPass(),Z=c.paint.get("line-dasharray"),X=c.paint.get("line-pattern"),le=X.constantOr(1),pe=c.paint.get("line-gradient"),ve=c.getCrossfadeParameters(),Re=le?"linePattern":Z?"lineSDF":pe?"lineGradient":"line",Ie=l.context,ze=Ie.gl,Ee=!0,Ve=0,et=d;Ve<et.length;Ve+=1){var vt=et[Ve],Xt=f.getTile(vt);if(!le||Xt.patternsLoaded()){var jt=Xt.getBucket(c);if(jt){var Qt=jt.programConfigurations.get(c.id),dr=l.context.program.get(),Lr=l.useProgram(Re,Qt),gr=Ee||Lr.program!==dr,sn=X.constantOr(null);if(sn&&Xt.imageAtlas){var zn=Xt.imageAtlas,Un=zn.patternPositions[sn.to.toString()],Ln=zn.patternPositions[sn.from.toString()];Un&&Ln&&Qt.setConstantPatternPositions(Un,Ln)}var ki=le?Pl(l,Xt,c,ve):Z?Cp(l,Xt,c,Z,ve):pe?Ni(l,Xt,c,jt.lineClipsArray.length):Ml(l,Xt,c);if(le)Ie.activeTexture.set(ze.TEXTURE0),Xt.imageAtlasTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),Qt.updatePaintBuffers(ve);else if(Z&&(gr||l.lineAtlas.dirty))Ie.activeTexture.set(ze.TEXTURE0),l.lineAtlas.bind(Ie);else if(pe){var tn=jt.gradients[c.id],ai=tn.texture;if(c.gradientVersion!==tn.version){var li=256;if(c.stepInterpolant){var $n=f.getSource().maxzoom,jn=vt.canonical.z===$n?Math.ceil(1<<l.transform.maxZoom-vt.canonical.z):1;li=m.clamp(m.nextPowerOfTwo(jt.maxLineLength/m.EXTENT*1024*jn),256,Ie.maxTextureSize)}tn.gradient=m.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:li,image:tn.gradient||void 0,clips:jt.lineClipsArray}),tn.texture?tn.texture.update(tn.gradient):tn.texture=new m.Texture(Ie,tn.gradient,ze.RGBA),tn.version=c.gradientVersion,ai=tn.texture}Ie.activeTexture.set(ze.TEXTURE0),ai.bind(c.stepInterpolant?ze.NEAREST:ze.LINEAR,ze.CLAMP_TO_EDGE)}Lr.draw(Ie,ze.TRIANGLES,P,l.stencilModeForClipping(vt),k,tt.disabled,ki,c.id,jt.layoutVertexBuffer,jt.indexBuffer,jt.segments,c.paint,l.transform.zoom,Qt,jt.layoutVertexBuffer2),Ee=!1}}}}},fill:function(l,f,c,d){var E=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)!==0){var P=l.colorModeForRenderPass(),k=c.paint.get("fill-pattern"),Z=l.opaquePassEnabledForLayer()&&!k.constantOr(1)&&E.constantOr(m.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===Z){var X=l.depthModeForSublayer(1,l.renderPass==="opaque"?ye.ReadWrite:ye.ReadOnly);Nc(l,f,c,d,X,P,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var le=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ye.ReadOnly);Nc(l,f,c,d,le,P,!0)}}},"fill-extrusion":function(l,f,c,d){var E=c.paint.get("fill-extrusion-opacity");if(E!==0&&l.renderPass==="translucent"){var w=new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D);if(E!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))yf(l,f,c,d,w,Pe.disabled,He.disabled),yf(l,f,c,d,w,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var P=l.colorModeForRenderPass();yf(l,f,c,d,w,Pe.disabled,P)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var E=l.context,w=l.depthModeForSublayer(0,ye.ReadOnly),P=l.colorModeForRenderPass(),k=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],Z=k[0],X=0,le=k[1];X<le.length;X+=1){var pe=le[X],ve=f.getTile(pe);ve.needsHillshadePrepare&&l.renderPass==="offscreen"?uh(l,ve,c,w,Pe.disabled,P):l.renderPass==="translucent"&&Rl(l,ve,c,w,Z[pe.overscaledZ],P)}E.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var E=l.context,w=E.gl,P=f.getSource(),k=l.useProgram("raster"),Z=l.colorModeForRenderPass(),X=P instanceof mt?[{},d]:l.stencilConfigForOverlap(d),le=X[0],pe=X[1],ve=pe[pe.length-1].overscaledZ,Re=!l.options.moving,Ie=0,ze=pe;Ie<ze.length;Ie+=1){var Ee=ze[Ie],Ve=l.depthModeForSublayer(Ee.overscaledZ-ve,c.paint.get("raster-opacity")===1?ye.ReadWrite:ye.ReadOnly,w.LESS),et=f.getTile(Ee),vt=l.transform.calculatePosMatrix(Ee.toUnwrapped(),Re);et.registerFadeDuration(c.paint.get("raster-fade-duration"));var Xt=f.findLoadedParent(Ee,0),jt=_f(et,Xt,f,c,l.transform),Qt=void 0,dr=void 0,Lr=c.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;E.activeTexture.set(w.TEXTURE0),et.texture.bind(Lr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),E.activeTexture.set(w.TEXTURE1),Xt?(Xt.texture.bind(Lr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),Qt=Math.pow(2,Xt.tileID.overscaledZ-et.tileID.overscaledZ),dr=[et.tileID.canonical.x*Qt%1,et.tileID.canonical.y*Qt%1]):et.texture.bind(Lr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var gr=Gf(vt,dr||[0,0],Qt||1,jt,c);P instanceof mt?k.draw(E,w.TRIANGLES,Ve,Pe.disabled,Z,tt.disabled,gr,c.id,P.boundsBuffer,l.quadTriangleIndexBuffer,P.boundsSegments):k.draw(E,w.TRIANGLES,Ve,le[Ee.overscaledZ],Z,tt.disabled,gr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),E=c.paint.get("background-opacity");if(E!==0){var w=l.context,P=w.gl,k=l.transform,Z=k.tileSize,X=c.paint.get("background-pattern");if(!l.isPatternMissing(X)){var le=!X&&d.a===1&&E===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===le){var pe=Pe.disabled,ve=l.depthModeForSublayer(0,le==="opaque"?ye.ReadWrite:ye.ReadOnly),Re=l.colorModeForRenderPass(),Ie=l.useProgram(X?"backgroundPattern":"background"),ze=k.coveringTiles({tileSize:Z});X&&(w.activeTexture.set(P.TEXTURE0),l.imageManager.bind(l.context));for(var Ee=c.getCrossfadeParameters(),Ve=0,et=ze;Ve<et.length;Ve+=1){var vt=et[Ve],Xt=l.transform.calculatePosMatrix(vt.toUnwrapped()),jt=X?ul(Xt,E,l,X,{tileID:vt,tileSize:Z},Ee):Il(Xt,E,d);Ie.draw(w,P.TRIANGLES,ve,pe,Re,tt.disabled,jt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)Mp(l,f,c[d])},custom:function(l,f,c){var d=l.context,E=c.implementation;if(l.renderPass==="offscreen"){var w=E.prerender;w&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),w.call(E,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Pe.disabled);var P=E.renderingMode==="3d"?new ye(l.context.gl.LEQUAL,ye.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ye.ReadOnly);d.setDepthMode(P),E.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Ji=function(l,f){this.context=new fe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=ke.maxUnderzooming+ke.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new wo,this.gpuTimers={}};Ji.prototype.resize=function(l,f){if(this.width=l*m.browser.devicePixelRatio,this.height=f*m.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Ji.prototype.setup=function(){var l=this.context,f=new m.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(m.EXTENT,0),f.emplaceBack(0,m.EXTENT),f.emplaceBack(m.EXTENT,m.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,ga.members),this.tileExtentSegments=m.SegmentVector.simpleSegment(0,0,4,2);var c=new m.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(m.EXTENT,0),c.emplaceBack(0,m.EXTENT),c.emplaceBack(m.EXTENT,m.EXTENT),this.debugBuffer=l.createVertexBuffer(c,ga.members),this.debugSegments=m.SegmentVector.simpleSegment(0,0,4,5);var d=new m.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(m.EXTENT,0,m.EXTENT,0),d.emplaceBack(0,m.EXTENT,0,m.EXTENT),d.emplaceBack(m.EXTENT,m.EXTENT,m.EXTENT,m.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,At.members),this.rasterBoundsSegments=m.SegmentVector.simpleSegment(0,0,4,2);var E=new m.StructArrayLayout2i4;E.emplaceBack(0,0),E.emplaceBack(1,0),E.emplaceBack(0,1),E.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(E,ga.members),this.viewportSegments=m.SegmentVector.simpleSegment(0,0,4,2);var w=new m.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(w);var P=new m.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(P),this.emptyTexture=new m.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var k=this.context.gl;this.stencilClearMode=new Pe({func:k.ALWAYS,mask:0},0,255,k.ZERO,k.ZERO,k.ZERO)},Ji.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=m.create();m.ortho(c,0,this.width,this.height,0,0,1),m.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ye.disabled,this.stencilClearMode,He.disabled,tt.disabled,cu(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Ji.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(He.disabled),c.setDepthMode(ye.disabled);var E=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,P=f;w<P.length;w+=1){var k=P[w],Z=this._tileClippingMaskIDs[k.key]=this.nextStencilID++;E.draw(c,d.TRIANGLES,ye.disabled,new Pe({func:d.ALWAYS,mask:0},Z,255,d.KEEP,d.KEEP,d.REPLACE),He.disabled,tt.disabled,cu(k.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Ji.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Pe({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Ji.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Pe({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Ji.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(Z,X){return X.overscaledZ-Z.overscaledZ}),E=d[d.length-1].overscaledZ,w=d[0].overscaledZ-E+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var P={},k=0;k<w;k++)P[k+E]=new Pe({func:c.GEQUAL,mask:255},k+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[P,d]}return[(f={},f[E]=Pe.disabled,f),d]},Ji.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new He([l.CONSTANT_COLOR,l.ONE],new m.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?He.unblended:He.alphaBlended},Ji.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ye.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ye(c||this.context.gl.LEQUAL,f,[d,d])},Ji.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Ji.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(m.browser.now()),this.imageManager.beginFrame();var d=this.style._order,E=this.style.sourceCaches;for(var w in E){var P=E[w];P.used&&P.prepare(this.context)}var k,Z,X={},le={},pe={};for(var ve in E){var Re=E[ve];X[ve]=Re.getVisibleCoordinates(),le[ve]=X[ve].slice().reverse(),pe[ve]=Re.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ie=0;Ie<d.length;Ie++)if(this.style._layers[d[Ie]].is3D()){this.opaquePassCutoff=Ie;break}this.renderPass="offscreen";for(var ze=0,Ee=d;ze<Ee.length;ze+=1){var Ve=this.style._layers[Ee[ze]];if(Ve.hasOffscreenPass()&&!Ve.isHidden(this.transform.zoom)){var et=le[Ve.source];(Ve.type==="custom"||et.length)&&this.renderLayer(this,E[Ve.source],Ve,et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?m.Color.black:m.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var vt=this.style._layers[d[this.currentLayer]],Xt=E[vt.source],jt=X[vt.source];this._renderTileClippingMasks(vt,jt),this.renderLayer(this,Xt,vt,jt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var Qt=this.style._layers[d[this.currentLayer]],dr=E[Qt.source],Lr=(Qt.type==="symbol"?pe:le)[Qt.source];this._renderTileClippingMasks(Qt,X[Qt.source]),this.renderLayer(this,dr,Qt,Lr)}this.options.showTileBoundaries&&(m.values(this.style._layers).forEach(function(gr){gr.source&&!gr.isHidden(c.transform.zoom)&&(gr.source!==(Z&&Z.id)&&(Z=c.style.sourceCaches[gr.source]),(!k||k.getSource().maxzoom<Z.getSource().maxzoom)&&(k=Z))}),k&&Dl.debug(this,k,k.getVisibleCoordinates())),this.options.showPadding&&function(gr){var sn=gr.transform.padding;wp(gr,gr.transform.height-(sn.top||0),3,Ll),wp(gr,sn.bottom||0,3,xf),Tp(gr,sn.left||0,3,bf),Tp(gr,gr.transform.width-(sn.right||0),3,kl);var zn=gr.transform.centerPoint;(function(Un,Ln,ki,tn){ac(Un,Ln-1,ki-10,2,20,tn),ac(Un,Ln-10,ki-1,20,2,tn)})(gr,zn.x,gr.transform.height-zn.y,zc)}(this),this.context.setDefault()},Ji.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),Dl[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Ji.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Ji.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Ji.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Ji.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],E=this.context.extTimerQuery,w=E.getQueryObjectEXT(d.query,E.QUERY_RESULT_EXT)/1e6;E.deleteQueryEXT(d.query),f[c]=w}return f},Ji.prototype.translatePosMatrix=function(l,f,c,d,E){if(!c[0]&&!c[1])return l;var w=E?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(w){var P=Math.sin(w),k=Math.cos(w);c=[c[0]*k-c[1]*P,c[0]*P+c[1]*k]}var Z=[E?c[0]:ia(f,c[0],this.transform.zoom),E?c[1]:ia(f,c[1],this.transform.zoom),0],X=new Float32Array(16);return m.translate(X,l,Z),X},Ji.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Ji.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Ji.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Ji.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new df(this.context,l,xs[l],f,Ol[l],this._showOverdrawInspector)),this.cache[c]},Ji.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Ji.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Ji.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=m.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new m.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Ji.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var oc=function(l,f){this.points=l,this.planes=f};oc.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),E=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(P){return m.transformMat4([],P,l)}).map(function(P){return m.scale$1([],P,1/P[3]/f*d)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(P){var k=m.sub([],E[P[0]],E[P[1]]),Z=m.sub([],E[P[2]],E[P[1]]),X=m.normalize([],m.cross([],k,Z)),le=-m.dot(X,E[P[1]]);return X.concat(le)});return new oc(E,w)};var ca=function(l,f){this.min=l,this.max=f,this.center=m.scale$2([],m.add([],this.min,this.max),.5)};ca.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=m.clone$2(this.min),d=m.clone$2(this.max),E=0;E<f.length;E++)c[E]=f[E]?this.min[E]:this.center[E],d[E]=f[E]?this.center[E]:this.max[E];return d[2]=this.max[2],new ca(c,d)},ca.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},ca.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},ca.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var E=l.planes[d],w=0,P=0;P<f.length;P++)w+=m.dot$1(E,f[P])>=0;if(w===0)return 0;w!==f.length&&(c=!1)}if(c)return 2;for(var k=0;k<3;k++){for(var Z=Number.MAX_VALUE,X=-Number.MAX_VALUE,le=0;le<l.points.length;le++){var pe=l.points[le][k]-this.min[k];Z=Math.min(Z,pe),X=Math.max(X,pe)}if(X<0||Z>this.max[k]-this.min[k])return 0}return 1};var Pu=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};Pu.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=m.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=m.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=m.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=m.number(l.right,f.right,c)),this},Pu.prototype.getCenter=function(l,f){var c=m.clamp((this.left+l-this.right)/2,0,l),d=m.clamp((this.top+f-this.bottom)/2,0,f);return new m.Point(c,d)},Pu.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},Pu.prototype.clone=function(){return new Pu(this.top,this.bottom,this.left,this.right)},Pu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var qi=function(l,f,c,d,E){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=E===void 0||E,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new m.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Pu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Pa={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};qi.prototype.clone=function(){var l=new qi(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},Pa.minZoom.get=function(){return this._minZoom},Pa.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},Pa.maxZoom.get=function(){return this._maxZoom},Pa.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},Pa.minPitch.get=function(){return this._minPitch},Pa.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},Pa.maxPitch.get=function(){return this._maxPitch},Pa.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},Pa.renderWorldCopies.get=function(){return this._renderWorldCopies},Pa.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},Pa.worldSize.get=function(){return this.tileSize*this.scale},Pa.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Pa.size.get=function(){return new m.Point(this.width,this.height)},Pa.bearing.get=function(){return-this.angle/Math.PI*180},Pa.bearing.set=function(l){var f=-m.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=m.create$2(),m.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Pa.pitch.get=function(){return this._pitch/Math.PI*180},Pa.pitch.set=function(l){var f=m.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Pa.fov.get=function(){return this._fov/Math.PI*180},Pa.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},Pa.zoom.get=function(){return this._zoom},Pa.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Pa.center.get=function(){return this._center},Pa.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},Pa.padding.get=function(){return this._edgeInsets.toJSON()},Pa.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},Pa.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},qi.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},qi.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},qi.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},qi.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new m.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new m.Point(0,0)),d=this.pointCoordinate(new m.Point(this.width,0)),E=this.pointCoordinate(new m.Point(this.width,this.height)),w=this.pointCoordinate(new m.Point(0,this.height)),P=Math.floor(Math.min(c.x,d.x,E.x,w.x)),k=Math.floor(Math.max(c.x,d.x,E.x,w.x)),Z=P-1;Z<=k+1;Z++)Z!==0&&f.push(new m.UnwrappedTileID(Z,l));return f},qi.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=m.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,f),w=[E*d.x,E*d.y,0],P=oc.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),k=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(k=f);var Z=function(gr){return{aabb:new ca([gr*E,0,0],[(gr+1)*E,E,0]),zoom:0,x:0,y:0,wrap:gr,fullyVisible:!1}},X=[],le=[],pe=f,ve=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var Re=1;Re<=3;Re++)X.push(Z(-Re)),X.push(Z(Re));for(X.push(Z(0));X.length>0;){var Ie=X.pop(),ze=Ie.x,Ee=Ie.y,Ve=Ie.fullyVisible;if(!Ve){var et=Ie.aabb.intersects(P);if(et===0)continue;Ve=et===2}var vt=Ie.aabb.distanceX(w),Xt=Ie.aabb.distanceY(w),jt=Math.max(Math.abs(vt),Math.abs(Xt));if(Ie.zoom===pe||jt>3+(1<<pe-Ie.zoom)-2&&Ie.zoom>=k)le.push({tileID:new m.OverscaledTileID(Ie.zoom===pe?ve:Ie.zoom,Ie.wrap,Ie.zoom,ze,Ee),distanceSq:m.sqrLen([w[0]-.5-ze,w[1]-.5-Ee])});else for(var Qt=0;Qt<4;Qt++){var dr=(ze<<1)+Qt%2,Lr=(Ee<<1)+(Qt>>1);X.push({aabb:Ie.aabb.quadrant(Qt),zoom:Ie.zoom+1,x:dr,y:Lr,wrap:Ie.wrap,fullyVisible:Ve})}}return le.sort(function(gr,sn){return gr.distanceSq-sn.distanceSq}).map(function(gr){return gr.tileID})},qi.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},Pa.unmodified.get=function(){return this._unmodified},qi.prototype.zoomScale=function(l){return Math.pow(2,l)},qi.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},qi.prototype.project=function(l){var f=m.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new m.Point(m.mercatorXfromLng(l.lng)*this.worldSize,m.mercatorYfromLat(f)*this.worldSize)},qi.prototype.unproject=function(l){return new m.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},Pa.point.get=function(){return this.project(this.center)},qi.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),E=this.locationCoordinate(l),w=new m.MercatorCoordinate(E.x-(c.x-d.x),E.y-(c.y-d.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},qi.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},qi.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},qi.prototype.locationCoordinate=function(l){return m.MercatorCoordinate.fromLngLat(l)},qi.prototype.coordinateLocation=function(l){return l.toLngLat()},qi.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];m.transformMat4(f,f,this.pixelMatrixInverse),m.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],E=c[3],w=f[1]/d,P=c[1]/E,k=f[2]/d,Z=c[2]/E,X=k===Z?0:(0-k)/(Z-k);return new m.MercatorCoordinate(m.number(f[0]/d,c[0]/E,X)/this.worldSize,m.number(w,P,X)/this.worldSize)},qi.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix),new m.Point(f[0]/f[3],f[1]/f[3])},qi.prototype.getBounds=function(){return new m.LngLatBounds().extend(this.pointLocation(new m.Point(0,0))).extend(this.pointLocation(new m.Point(this.width,0))).extend(this.pointLocation(new m.Point(this.width,this.height))).extend(this.pointLocation(new m.Point(0,this.height)))},qi.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new m.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},qi.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},qi.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var E=l.canonical,w=this.worldSize/this.zoomScale(E.z),P=E.x+Math.pow(2,E.z)*l.wrap,k=m.identity(new Float64Array(16));return m.translate(k,k,[P*w,E.y*w,0]),m.scale(k,k,[w/m.EXTENT,w/m.EXTENT,1]),m.multiply(k,f?this.alignedProjMatrix:this.projMatrix,k),d[c]=new Float32Array(k),d[c]},qi.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},qi.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,E=-90,w=90,P=-180,k=180,Z=this.size,X=this._unmodified;if(this.latRange){var le=this.latRange;E=m.mercatorYfromLat(le[1])*this.worldSize,l=(w=m.mercatorYfromLat(le[0])*this.worldSize)-E<Z.y?Z.y/(w-E):0}if(this.lngRange){var pe=this.lngRange;P=m.mercatorXfromLng(pe[0])*this.worldSize,f=(k=m.mercatorXfromLng(pe[1])*this.worldSize)-P<Z.x?Z.x/(k-P):0}var ve=this.point,Re=Math.max(f||0,l||0);if(Re)return this.center=this.unproject(new m.Point(f?(k+P)/2:ve.x,l?(w+E)/2:ve.y)),this.zoom+=this.scaleZoom(Re),this._unmodified=X,void(this._constraining=!1);if(this.latRange){var Ie=ve.y,ze=Z.y/2;Ie-ze<E&&(d=E+ze),Ie+ze>w&&(d=w-ze)}if(this.lngRange){var Ee=ve.x,Ve=Z.x/2;Ee-Ve<P&&(c=P+Ve),Ee+Ve>k&&(c=k-Ve)}c===void 0&&d===void 0||(this.center=this.unproject(new m.Point(c!==void 0?c:ve.x,d!==void 0?d:ve.y))),this._unmodified=X,this._constraining=!1}},qi.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(m.clamp(Math.PI-f-c,.01,Math.PI-.01)),E=this.point,w=E.x,P=E.y,k=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),Z=this.height/50,X=new Float64Array(16);m.perspective(X,this._fov,this.width/this.height,Z,k),X[8]=2*-l.x/this.width,X[9]=2*l.y/this.height,m.scale(X,X,[1,-1,1]),m.translate(X,X,[0,0,-this.cameraToCenterDistance]),m.rotateX(X,X,this._pitch),m.rotateZ(X,X,this.angle),m.translate(X,X,[-w,-P,0]),this.mercatorMatrix=m.scale([],X,[this.worldSize,this.worldSize,this.worldSize]),m.scale(X,X,[1,1,m.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=X,this.invProjMatrix=m.invert([],this.projMatrix);var le=this.width%2/2,pe=this.height%2/2,ve=Math.cos(this.angle),Re=Math.sin(this.angle),Ie=w-Math.round(w)+ve*le+Re*pe,ze=P-Math.round(P)+ve*pe+Re*le,Ee=new Float64Array(X);if(m.translate(Ee,Ee,[Ie>.5?Ie-1:Ie,ze>.5?ze-1:ze,0]),this.alignedProjMatrix=Ee,X=m.create(),m.scale(X,X,[this.width/2,-this.height/2,1]),m.translate(X,X,[1,-1,0]),this.labelPlaneMatrix=X,X=m.create(),m.scale(X,X,[1,-1,1]),m.translate(X,X,[-1,-1,0]),m.scale(X,X,[2/this.width,2/this.height,1]),this.glCoordMatrix=X,this.pixelMatrix=m.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(X=m.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=X,this._posMatrixCache={},this._alignedPosMatrixCache={}}},qi.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new m.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return m.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},qi.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new m.Point(0,l))},qi.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,E=f.x,w=f.y,P=0,k=l;P<k.length;P+=1){var Z=k[P];c=Math.min(c,Z.x),d=Math.min(d,Z.y),E=Math.max(E,Z.x),w=Math.max(w,Z.y)}return[new m.Point(c,d),new m.Point(E,d),new m.Point(E,w),new m.Point(c,w),new m.Point(c,d)]},Object.defineProperties(qi.prototype,Pa);var bs=function(l){var f,c,d,E;this._hashName=l&&encodeURIComponent(l),m.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,E=function(){d=null,c&&(f(),d=setTimeout(E,300),c=!1)},function(){return c=!0,d||E(),d})};bs.prototype.addTo=function(l){return this._map=l,m.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},bs.prototype.remove=function(){return m.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},bs.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),E=Math.pow(10,d),w=Math.round(f.lng*E)/E,P=Math.round(f.lat*E)/E,k=this._map.getBearing(),Z=this._map.getPitch(),X="";if(X+=l?"/"+w+"/"+P+"/"+c:c+"/"+P+"/"+w,(k||Z)&&(X+="/"+Math.round(10*k)/10),Z&&(X+="/"+Math.round(Z)),this._hashName){var le=this._hashName,pe=!1,ve=m.window.location.hash.slice(1).split("&").map(function(Re){var Ie=Re.split("=")[0];return Ie===le?(pe=!0,Ie+"="+X):Re}).filter(function(Re){return Re});return pe||ve.push(le+"="+X),"#"+ve.join("&")}return"#"+X},bs.prototype._getCurrentHash=function(){var l,f=this,c=m.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},bs.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},bs.prototype._updateHashUnthrottled=function(){var l=m.window.location.href.replace(/(#.+)?$/,this.getHashString());try{m.window.history.replaceState(m.window.history.state,null,l)}catch(f){}};var Uc={linearity:.3,easing:m.bezier(0,0,.3,1)},qu=m.extend({deceleration:2500,maxSpeed:1400},Uc),ja=m.extend({deceleration:20,maxSpeed:1400},Uc),sc=m.extend({deceleration:1e3,maxSpeed:360},Uc),Fl=m.extend({deceleration:1e3,maxSpeed:90},Uc),Ku=function(l){this._map=l,this.clear()};function Zc(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Iu(l,f,c){var d=c.maxSpeed,E=c.linearity,w=c.deceleration,P=m.clamp(l*E/(f/1e3),-d,d),k=Math.abs(P)/(w*E);return{easing:c.easing,duration:1e3*k,amount:P*(k/2)}}Ku.prototype.clear=function(){this._inertiaBuffer=[]},Ku.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:m.browser.now(),settings:l})},Ku.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=m.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Ku.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new m.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var E=d[c].settings;f.zoom+=E.zoomDelta||0,f.bearing+=E.bearingDelta||0,f.pitch+=E.pitchDelta||0,E.panDelta&&f.pan._add(E.panDelta),E.around&&(f.around=E.around),E.pinchAround&&(f.pinchAround=E.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,P={};if(f.pan.mag()){var k=Iu(f.pan.mag(),w,m.extend({},qu,l||{}));P.offset=f.pan.mult(k.amount/f.pan.mag()),P.center=this._map.transform.center,Zc(P,k)}if(f.zoom){var Z=Iu(f.zoom,w,ja);P.zoom=this._map.transform.zoom+Z.amount,Zc(P,Z)}if(f.bearing){var X=Iu(f.bearing,w,sc);P.bearing=this._map.transform.bearing+m.clamp(X.amount,-179,179),Zc(P,X)}if(f.pitch){var le=Iu(f.pitch,w,Fl);P.pitch=this._map.transform.pitch+le.amount,Zc(P,le)}if(P.zoom||P.bearing){var pe=f.pinchAround===void 0?f.around:f.pinchAround;P.around=pe?this._map.unproject(pe):this._map.getCenter()}return this.clear(),m.extend(P,{noMoveStart:!0})}};var mo=function(l){function f(d,E,w,P){P===void 0&&(P={});var k=V.mousePos(E.getCanvasContainer(),w),Z=E.unproject(k);l.call(this,d,m.extend({point:k,lngLat:Z,originalEvent:w},P)),this._defaultPrevented=!1,this.target=E}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),Bl=function(l){function f(d,E,w){var P=d==="touchend"?w.changedTouches:w.touches,k=V.touchPos(E.getCanvasContainer(),P),Z=k.map(function(pe){return E.unproject(pe)}),X=k.reduce(function(pe,ve,Re,Ie){return pe.add(ve.div(Ie.length))},new m.Point(0,0)),le=E.unproject(X);l.call(this,d,{points:k,point:X,lngLats:Z,lngLat:le,originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),uc=function(l){function f(d,E,w){l.call(this,d,{originalEvent:w}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(m.Event),go=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};go.prototype.reset=function(){delete this._mousedownPos},go.prototype.wheel=function(l){return this._firePreventable(new uc(l.type,this._map,l))},go.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseup=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new mo(l.type,this._map,l))},go.prototype.dblclick=function(l){return this._firePreventable(new mo(l.type,this._map,l))},go.prototype.mouseover=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.mouseout=function(l){this._map.fire(new mo(l.type,this._map,l))},go.prototype.touchstart=function(l){return this._firePreventable(new Bl(l.type,this._map,l))},go.prototype.touchmove=function(l){this._map.fire(new Bl(l.type,this._map,l))},go.prototype.touchend=function(l){this._map.fire(new Bl(l.type,this._map,l))},go.prototype.touchcancel=function(l){this._map.fire(new Bl(l.type,this._map,l))},go.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},go.prototype.isEnabled=function(){return!0},go.prototype.isActive=function(){return!1},go.prototype.enable=function(){},go.prototype.disable=function(){};var dn=function(l){this._map=l};dn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},dn.prototype.mousemove=function(l){this._map.fire(new mo(l.type,this._map,l))},dn.prototype.mousedown=function(){this._delayContextMenu=!0},dn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new mo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},dn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new mo(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},dn.prototype.isEnabled=function(){return!0},dn.prototype.isActive=function(){return!1},dn.prototype.enable=function(){},dn.prototype.disable=function(){};var fo=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function $u(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}fo.prototype.isEnabled=function(){return!!this._enabled},fo.prototype.isActive=function(){return!!this._active},fo.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},fo.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},fo.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(V.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},fo.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=V.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var E=Math.min(d.x,c.x),w=Math.max(d.x,c.x),P=Math.min(d.y,c.y),k=Math.max(d.y,c.y);V.setTransform(this._box,"translate("+E+"px,"+P+"px)"),this._box.style.width=w-E+"px",this._box.style.height=k-P+"px"}}},fo.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,E=f;if(this.reset(),V.suppressClick(),d.x!==E.x||d.y!==E.y)return this._map.fire(new m.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(w){return w.fitScreenCoordinates(d,E,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},fo.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},fo.prototype.blur=function(){this.reset()},fo.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(V.remove(this._box),this._box=null),V.enableDrag(),delete this._startPos,delete this._lastPos},fo.prototype._fireEvent=function(l,f){return this._map.fire(new m.Event(l,{originalEvent:f}))};var ka=function(l){this.reset(),this.numTouches=l.numTouches};ka.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},ka.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var E=new m.Point(0,0),w=0,P=d;w<P.length;w+=1)E._add(P[w]);return E.div(d.length)}(f),this.touches=$u(c,f)))},ka.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=$u(c,f);for(var E in this.touches){var w=d[E];(!w||w.dist(this.touches[E])>30)&&(this.aborted=!0)}}},ka.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var Ks=function(l){this.singleTap=new ka(l),this.numTaps=l.numTaps,this.reset()};Ks.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Ks.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},Ks.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},Ks.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var E=l.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(d)<30;if(E&&w||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var Ms=function(){this._zoomIn=new Ks({numTouches:1,numTaps:2}),this._zoomOut=new Ks({numTouches:2,numTaps:1}),this.reset()};Ms.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Ms.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},Ms.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},Ms.prototype.touchend=function(l,f,c){var d=this,E=this._zoomIn.touchend(l,f,c),w=this._zoomOut.touchend(l,f,c);return E?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(E)},{originalEvent:l})}}):w?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(P){return P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(w)},{originalEvent:l})}}):void 0},Ms.prototype.touchcancel=function(){this.reset()},Ms.prototype.enable=function(){this._enabled=!0},Ms.prototype.disable=function(){this._enabled=!1,this.reset()},Ms.prototype.isEnabled=function(){return this._enabled},Ms.prototype.isActive=function(){return this._active};var Ef={0:1,2:2},Zr=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};Zr.prototype.blur=function(){this.reset()},Zr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Zr.prototype._correctButton=function(l,f){return!1},Zr.prototype._move=function(l,f){return{}},Zr.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=V.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},Zr.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,E){var w=Ef[E];return d.buttons===void 0||(d.buttons&w)!==w}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},Zr.prototype.mouseupWindow=function(l){this._lastPoint&&V.mouseButton(l)===this._eventButton&&(this._moved&&V.suppressClick(),this.reset())},Zr.prototype.enable=function(){this._enabled=!0},Zr.prototype.disable=function(){this._enabled=!1,this.reset()},Zr.prototype.isEnabled=function(){return this._enabled},Zr.prototype.isActive=function(){return this._active};var lc=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}(Zr),Sf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=.8*(d.x-c.x);if(E)return this._active=!0,{bearingDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Zr),ll=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var E=-.5*(d.y-c.y);if(E)return this._active=!0,{pitchDelta:E}},f.prototype.contextmenu=function(c){c.preventDefault()},f}(Zr),Aa=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};Aa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new m.Point(0,0)},Aa.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},Aa.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},Aa.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},Aa.prototype.touchcancel=function(){this.reset()},Aa.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=$u(c,f),E=new m.Point(0,0),w=new m.Point(0,0),P=0;for(var k in d){var Z=d[k],X=this._touches[k];X&&(E._add(Z),w._add(Z.sub(X)),P++,d[k]=Z)}if(this._touches=d,!(P<this._minTouches)&&w.mag()){var le=w.div(P);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:E.div(P),panDelta:le}}},Aa.prototype.enable=function(){this._enabled=!0},Aa.prototype.disable=function(){this._enabled=!1,this.reset()},Aa.prototype.isEnabled=function(){return this._enabled},Aa.prototype.isActive=function(){return this._active};var Es=function(){this.reset()};function Cf(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Ou(l,f){return Math.log(l/f)/Math.LN2}Es.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Es.prototype._start=function(l){},Es.prototype._move=function(l,f,c){return{}},Es.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Es.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,E=d[1],w=Cf(c,f,d[0]),P=Cf(c,f,E);if(w&&P){var k=this._aroundCenter?null:w.add(P).div(2);return this._move([w,P],k,l)}}},Es.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,E=d[1],w=Cf(c,f,d[0]),P=Cf(c,f,E);w&&P||(this._active&&V.suppressClick(),this.reset())}},Es.prototype.touchcancel=function(){this.reset()},Es.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Es.prototype.disable=function(){this._enabled=!1,this.reset()},Es.prototype.isEnabled=function(){return this._enabled},Es.prototype.isActive=function(){return this._active};var Bs=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Ou(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ou(this._distance,E),pinchAround:d}},f}(Es);function Ru(l,f){return 180*l.angleWith(f)/Math.PI}var Xf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var E=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ru(this._vector,E),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,E=Ru(c,this._startVector);return Math.abs(E)<d},f}(Es);function cl(l){return Math.abs(l.y)>Math.abs(l.x)}var Yf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,cl(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,E){var w=c[0].sub(this._lastPoints[0]),P=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,P,E.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(w.y+P.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,E){if(this._valid!==void 0)return this._valid;var w=c.mag()>=2,P=d.mag()>=2;if(w||P){if(!w||!P)return this._firstMove===void 0&&(this._firstMove=E),E-this._firstMove<100&&void 0;var k=c.y>0==d.y>0;return cl(c)&&cl(d)&&k}},f}(Es),Af={panStep:100,bearingStep:15,pitchStep:10},pu=function(){var l=Af;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function Ps(l){return l*(2-l)}pu.prototype.blur=function(){this.reset()},pu.prototype.reset=function(){this._active=!1},pu.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,E=0,w=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),w=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),w=1);break;case 38:l.shiftKey?E=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?E=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(d=0,E=0),{cameraAnimation:function(k){var Z=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Ps,zoom:c?Math.round(Z)+c*(l.shiftKey?2:1):Z,bearing:k.getBearing()+d*f._bearingStep,pitch:k.getPitch()+E*f._pitchStep,offset:[-w*f._panStep,-P*f._panStep],center:k.getCenter()},{originalEvent:l})}}}},pu.prototype.enable=function(){this._enabled=!0},pu.prototype.disable=function(){this._enabled=!1,this.reset()},pu.prototype.isEnabled=function(){return this._enabled},pu.prototype.isActive=function(){return this._active},pu.prototype.disableRotation=function(){this._rotationDisabled=!0},pu.prototype.enableRotation=function(){this._rotationDisabled=!1};var Ti=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,m.bindAll(["_onTimeout"],this)};Ti.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Ti.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Ti.prototype.isEnabled=function(){return!!this._enabled},Ti.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Ti.prototype.isZooming=function(){return!!this._zooming},Ti.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Ti.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ti.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===m.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=m.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Ti.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Ti.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=V.mousePos(this._el,l);this._around=m.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Ti.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var E=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(E*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,P=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,k=this._startZoom,Z=this._easing,X=!1;if(this._type==="wheel"&&k&&Z){var le=Math.min((m.browser.now()-this._lastWheelEventTime)/200,1),pe=Z(le);w=m.number(k,P,pe),le<1?this._frameId||(this._frameId=!0):X=!0}else w=P,X=!0;return this._active=!0,X&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!X,zoomDelta:w-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Ti.prototype._smoothOutEasing=function(l){var f=m.ease;if(this._prevEase){var c=this._prevEase,d=(m.browser.now()-c.start)/c.duration,E=c.easing(d+.01)-c.easing(d),w=.27/Math.sqrt(E*E+1e-4)*.01,P=Math.sqrt(.0729-w*w);f=m.bezier(w,P,.25,1)}return this._prevEase={start:m.browser.now(),duration:l,easing:f},f},Ti.prototype.blur=function(){this.reset()},Ti.prototype.reset=function(){this._active=!1};var Lu=function(l,f){this._clickZoom=l,this._tapZoom=f};Lu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Lu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Lu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Lu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var hu=function(){this.reset()};hu.prototype.reset=function(){this._active=!1},hu.prototype.blur=function(){this.reset()},hu.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},hu.prototype.enable=function(){this._enabled=!0},hu.prototype.disable=function(){this._enabled=!1,this.reset()},hu.prototype.isEnabled=function(){return this._enabled},hu.prototype.isActive=function(){return this._active};var Go=function(){this._tap=new Ks({numTouches:1,numTaps:1}),this.reset()};Go.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Go.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},Go.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],E=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:E/128}}}else this._tap.touchmove(l,f,c)},Go.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},Go.prototype.touchcancel=function(){this.reset()},Go.prototype.enable=function(){this._enabled=!0},Go.prototype.disable=function(){this._enabled=!1,this.reset()},Go.prototype.isEnabled=function(){return this._enabled},Go.prototype.isActive=function(){return this._active};var fl=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};fl.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},fl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},fl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},fl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var as=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};as.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},as.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},as.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},as.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var $s=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};$s.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},$s.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},$s.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},$s.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},$s.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},$s.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ss=function(l){return l.zoom||l.drag||l.pitch||l.rotate},xu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(m.Event);function On(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var Cn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ku(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),m.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[m.window.document,"mousemove",{capture:!0}],[m.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[m.window,"blur",void 0]];for(var d=0,E=this._listeners;d<E.length;d+=1){var w=E[d],P=w[0];V.addEventListener(P,w[1],P===m.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};Cn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];V.removeEventListener(d,c[1],d===m.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},Cn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new go(f,l));var d=f.boxZoom=new fo(f,l);this._add("boxZoom",d);var E=new Ms,w=new hu;f.doubleClickZoom=new Lu(w,E),this._add("tapZoom",E),this._add("clickZoom",w);var P=new Go;this._add("tapDragZoom",P);var k=f.touchPitch=new Yf;this._add("touchPitch",k);var Z=new Sf(l),X=new ll(l);f.dragRotate=new as(l,Z,X),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);var le=new lc(l),pe=new Aa(l);f.dragPan=new fl(c,le,pe),this._add("mousePan",le),this._add("touchPan",pe,["touchZoom","touchRotate"]);var ve=new Xf,Re=new Bs;f.touchZoomRotate=new $s(c,Re,ve,P),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",Re,["touchPan","touchRotate"]);var Ie=f.scrollZoom=new Ti(f,this);this._add("scrollZoom",Ie,["mousePan"]);var ze=f.keyboard=new pu;this._add("keyboard",ze),this._add("blockableMapEvent",new dn(f));for(var Ee=0,Ve=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ee<Ve.length;Ee+=1){var et=Ve[Ee];l.interactive&&l[et]&&f[et].enable(l[et])}},Cn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},Cn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},Cn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},Cn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Cn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Cn.prototype.isMoving=function(){return Boolean(Ss(this._eventsInProgress))||this.isZooming()},Cn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},Cn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},Cn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var E=d[c];this._el.contains(E.target)&&f.push(E)}return f},Cn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},E={},w={},P=l.touches?this._getMapTouches(l.touches):void 0,k=P?V.touchPos(this._el,P):V.mousePos(this._el,l),Z=0,X=this._handlers;Z<X.length;Z+=1){var le=X[Z],pe=le.handlerName,ve=le.handler,Re=le.allowed;if(ve.isEnabled()){var Ie=void 0;this._blockedByActive(w,Re,pe)?ve.reset():ve[f||l.type]&&(Ie=ve[f||l.type](l,k,P),this.mergeHandlerResult(d,E,Ie,pe,c),Ie&&Ie.needsRenderFrame&&this._triggerRenderFrame()),(Ie||ve.isActive())&&(w[pe]=ve)}}var ze={};for(var Ee in this._previousActiveHandlers)w[Ee]||(ze[Ee]=c);this._previousActiveHandlers=w,(Object.keys(ze).length||On(d))&&(this._changes.push([d,E,ze]),this._triggerRenderFrame()),(Object.keys(w).length||On(d))&&this._map._stop(!0),this._updatingCamera=!1;var Ve=d.cameraAnimation;Ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ve(this._map))},Cn.prototype.mergeHandlerResult=function(l,f,c,d,E){if(c){m.extend(l,c);var w={handlerName:d,originalEvent:c.originalEvent||E};c.zoomDelta!==void 0&&(f.zoom=w),c.panDelta!==void 0&&(f.drag=w),c.pitchDelta!==void 0&&(f.pitch=w),c.bearingDelta!==void 0&&(f.rotate=w)}},Cn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,E=this._changes;d<E.length;d+=1){var w=E[d],P=w[0],k=w[1],Z=w[2];P.panDelta&&(l.panDelta=(l.panDelta||new m.Point(0,0))._add(P.panDelta)),P.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+P.zoomDelta),P.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+P.bearingDelta),P.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+P.pitchDelta),P.around!==void 0&&(l.around=P.around),P.pinchAround!==void 0&&(l.pinchAround=P.pinchAround),P.noInertia&&(l.noInertia=P.noInertia),m.extend(f,k),m.extend(c,Z)}this._updateMapTransform(l,f,c),this._changes=[]},Cn.prototype._updateMapTransform=function(l,f,c){var d=this._map,E=d.transform;if(!On(l))return this._fireEvents(f,c,!0);var w=l.panDelta,P=l.zoomDelta,k=l.bearingDelta,Z=l.pitchDelta,X=l.around,le=l.pinchAround;le!==void 0&&(X=le),d._stop(!0),X=X||d.transform.centerPoint;var pe=E.pointLocation(w?X.sub(w):X);k&&(E.bearing+=k),Z&&(E.pitch+=Z),P&&(E.zoom+=P),E.setLocationAtPoint(pe,X),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},Cn.prototype._fireEvents=function(l,f,c){var d=this,E=Ss(this._eventsInProgress),w=Ss(l),P={};for(var k in l)this._eventsInProgress[k]||(P[k+"start"]=l[k].originalEvent),this._eventsInProgress[k]=l[k];for(var Z in!E&&w&&this._fireEvent("movestart",w.originalEvent),P)this._fireEvent(Z,P[Z]);for(var X in w&&this._fireEvent("move",w.originalEvent),l)this._fireEvent(X,l[X].originalEvent);var le,pe={};for(var ve in this._eventsInProgress){var Re=this._eventsInProgress[ve],Ie=Re.handlerName,ze=Re.originalEvent;this._handlersById[Ie].isActive()||(delete this._eventsInProgress[ve],pe[ve+"end"]=le=f[Ie]||ze)}for(var Ee in pe)this._fireEvent(Ee,pe[Ee]);var Ve=Ss(this._eventsInProgress);if(c&&(E||w)&&!Ve){this._updatingCamera=!0;var et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),vt=function(Xt){return Xt!==0&&-d._bearingSnap<Xt&&Xt<d._bearingSnap};et?(vt(et.bearing||this._map.getBearing())&&(et.bearing=0),this._map.easeTo(et,{originalEvent:le})):(this._map.fire(new m.Event("moveend",{originalEvent:le})),vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Cn.prototype._fireEvent=function(l,f){this._map.fire(new m.Event(l,f?{originalEvent:f}:{}))},Cn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new xu("renderFrame",{timeStamp:f})),l._applyChanges()})},Cn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var jc=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,m.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new m.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,E){return c=m.Point.convert(c).mult(-1),this.panTo(this.transform.center,m.extend({offset:c},d),E)},f.prototype.panTo=function(c,d,E){return this.easeTo(m.extend({center:c},d),E)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,E){return this.easeTo(m.extend({zoom:c},d),E)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,E){return this.easeTo(m.extend({bearing:c},d),E)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,m.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(m.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=m.LngLatBounds.convert(c);var E=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),E,d)},f.prototype._cameraForBoxAndBearing=function(c,d,E,w){var P={top:0,bottom:0,right:0,left:0};if(typeof(w=m.extend({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var k=w.padding;w.padding={top:k,bottom:k,right:k,left:k}}w.padding=m.extend(P,w.padding);var Z=this.transform,X=Z.padding,le=Z.project(m.LngLat.convert(c)),pe=Z.project(m.LngLat.convert(d)),ve=le.rotate(-E*Math.PI/180),Re=pe.rotate(-E*Math.PI/180),Ie=new m.Point(Math.max(ve.x,Re.x),Math.max(ve.y,Re.y)),ze=new m.Point(Math.min(ve.x,Re.x),Math.min(ve.y,Re.y)),Ee=Ie.sub(ze),Ve=(Z.width-(X.left+X.right+w.padding.left+w.padding.right))/Ee.x,et=(Z.height-(X.top+X.bottom+w.padding.top+w.padding.bottom))/Ee.y;if(!(et<0||Ve<0)){var vt=Math.min(Z.scaleZoom(Z.scale*Math.min(Ve,et)),w.maxZoom),Xt=typeof w.offset.x=="number"?new m.Point(w.offset.x,w.offset.y):m.Point.convert(w.offset),jt=new m.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(E*Math.PI/180),Qt=Xt.add(jt).mult(Z.scale/Z.zoomScale(vt));return{center:Z.unproject(le.add(pe).div(2).sub(Qt)),zoom:vt,bearing:E}}m.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,E){return this._fitInternal(this.cameraForBounds(c,d),d,E)},f.prototype.fitScreenCoordinates=function(c,d,E,w,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(m.Point.convert(c)),this.transform.pointLocation(m.Point.convert(d)),E,w),w,P)},f.prototype._fitInternal=function(c,d,E){return c?(delete(d=m.extend(c,d)).padding,d.linear?this.easeTo(d,E):this.flyTo(d,E)):this},f.prototype.jumpTo=function(c,d){this.stop();var E=this.transform,w=!1,P=!1,k=!1;return"zoom"in c&&E.zoom!==+c.zoom&&(w=!0,E.zoom=+c.zoom),c.center!==void 0&&(E.center=m.LngLat.convert(c.center)),"bearing"in c&&E.bearing!==+c.bearing&&(P=!0,E.bearing=+c.bearing),"pitch"in c&&E.pitch!==+c.pitch&&(k=!0,E.pitch=+c.pitch),c.padding==null||E.isPaddingEqual(c.padding)||(E.padding=c.padding),this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),w&&this.fire(new m.Event("zoomstart",d)).fire(new m.Event("zoom",d)).fire(new m.Event("zoomend",d)),P&&this.fire(new m.Event("rotatestart",d)).fire(new m.Event("rotate",d)).fire(new m.Event("rotateend",d)),k&&this.fire(new m.Event("pitchstart",d)).fire(new m.Event("pitch",d)).fire(new m.Event("pitchend",d)),this.fire(new m.Event("moveend",d))},f.prototype.easeTo=function(c,d){var E=this;this._stop(!1,c.easeId),((c=m.extend({offset:[0,0],duration:500,easing:m.ease},c)).animate===!1||!c.essential&&m.browser.prefersReducedMotion)&&(c.duration=0);var w=this.transform,P=this.getZoom(),k=this.getBearing(),Z=this.getPitch(),X=this.getPadding(),le="zoom"in c?+c.zoom:P,pe="bearing"in c?this._normalizeBearing(c.bearing,k):k,ve="pitch"in c?+c.pitch:Z,Re="padding"in c?c.padding:w.padding,Ie=m.Point.convert(c.offset),ze=w.centerPoint.add(Ie),Ee=w.pointLocation(ze),Ve=m.LngLat.convert(c.center||Ee);this._normalizeCenter(Ve);var et,vt,Xt=w.project(Ee),jt=w.project(Ve).sub(Xt),Qt=w.zoomScale(le-P);c.around&&(et=m.LngLat.convert(c.around),vt=w.locationPoint(et));var dr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==P,this._rotating=this._rotating||k!==pe,this._pitching=this._pitching||ve!==Z,this._padding=!w.isPaddingEqual(Re),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,dr),this._ease(function(Lr){if(E._zooming&&(w.zoom=m.number(P,le,Lr)),E._rotating&&(w.bearing=m.number(k,pe,Lr)),E._pitching&&(w.pitch=m.number(Z,ve,Lr)),E._padding&&(w.interpolatePadding(X,Re,Lr),ze=w.centerPoint.add(Ie)),et)w.setLocationAtPoint(et,vt);else{var gr=w.zoomScale(w.zoom-P),sn=le>P?Math.min(2,Qt):Math.max(.5,Qt),zn=Math.pow(sn,1-Lr),Un=w.unproject(Xt.add(jt.mult(Lr*zn)).mult(gr));w.setLocationAtPoint(w.renderWorldCopies?Un.wrap():Un,ze)}E._fireMoveEvents(d)},function(Lr){E._afterEase(d,Lr)},c),this},f.prototype._prepareEase=function(c,d,E){E===void 0&&(E={}),this._moving=!0,d||E.moving||this.fire(new m.Event("movestart",c)),this._zooming&&!E.zooming&&this.fire(new m.Event("zoomstart",c)),this._rotating&&!E.rotating&&this.fire(new m.Event("rotatestart",c)),this._pitching&&!E.pitching&&this.fire(new m.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new m.Event("move",c)),this._zooming&&this.fire(new m.Event("zoom",c)),this._rotating&&this.fire(new m.Event("rotate",c)),this._pitching&&this.fire(new m.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var E=this._zooming,w=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,E&&this.fire(new m.Event("zoomend",c)),w&&this.fire(new m.Event("rotateend",c)),P&&this.fire(new m.Event("pitchend",c)),this.fire(new m.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var E=this;if(!c.essential&&m.browser.prefersReducedMotion){var w=m.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,d)}this.stop(),c=m.extend({offset:[0,0],speed:1.2,curve:1.42,easing:m.ease},c);var P=this.transform,k=this.getZoom(),Z=this.getBearing(),X=this.getPitch(),le=this.getPadding(),pe="zoom"in c?m.clamp(+c.zoom,P.minZoom,P.maxZoom):k,ve="bearing"in c?this._normalizeBearing(c.bearing,Z):Z,Re="pitch"in c?+c.pitch:X,Ie="padding"in c?c.padding:P.padding,ze=P.zoomScale(pe-k),Ee=m.Point.convert(c.offset),Ve=P.centerPoint.add(Ee),et=P.pointLocation(Ve),vt=m.LngLat.convert(c.center||et);this._normalizeCenter(vt);var Xt=P.project(et),jt=P.project(vt).sub(Xt),Qt=c.curve,dr=Math.max(P.width,P.height),Lr=dr/ze,gr=jt.mag();if("minZoom"in c){var sn=m.clamp(Math.min(c.minZoom,k,pe),P.minZoom,P.maxZoom),zn=dr/P.zoomScale(sn-k);Qt=Math.sqrt(zn/gr*2)}var Un=Qt*Qt;function Ln(Yn){var Hn=(Lr*Lr-dr*dr+(Yn?-1:1)*Un*Un*gr*gr)/(2*(Yn?Lr:dr)*Un*gr);return Math.log(Math.sqrt(Hn*Hn+1)-Hn)}function ki(Yn){return(Math.exp(Yn)-Math.exp(-Yn))/2}function tn(Yn){return(Math.exp(Yn)+Math.exp(-Yn))/2}var ai=Ln(0),li=function(Yn){return tn(ai)/tn(ai+Qt*Yn)},$n=function(Yn){return dr*((tn(ai)*(ki(Hn=ai+Qt*Yn)/tn(Hn))-ki(ai))/Un)/gr;var Hn},jn=(Ln(1)-ai)/Qt;if(Math.abs(gr)<1e-6||!isFinite(jn)){if(Math.abs(dr-Lr)<1e-6)return this.easeTo(c,d);var mi=Lr<dr?-1:1;jn=Math.abs(Math.log(Lr/dr))/Qt,$n=function(){return 0},li=function(Yn){return Math.exp(mi*Qt*Yn)}}return c.duration="duration"in c?+c.duration:1e3*jn/("screenSpeed"in c?+c.screenSpeed/Qt:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=Z!==ve,this._pitching=Re!==X,this._padding=!P.isPaddingEqual(Ie),this._prepareEase(d,!1),this._ease(function(Yn){var Hn=Yn*jn,yo=1/li(Hn);P.zoom=Yn===1?pe:k+P.scaleZoom(yo),E._rotating&&(P.bearing=m.number(Z,ve,Yn)),E._pitching&&(P.pitch=m.number(X,Re,Yn)),E._padding&&(P.interpolatePadding(le,Ie,Yn),Ve=P.centerPoint.add(Ee));var Ja=Yn===1?vt:P.unproject(Xt.add(jt.mult($n(Hn))).mult(yo));P.setLocationAtPoint(P.renderWorldCopies?Ja.wrap():Ja,Ve),E._fireMoveEvents(d)},function(){return E._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var E=this._onEaseEnd;delete this._onEaseEnd,E.call(this,d)}if(!c){var w=this.handlers;w&&w.stop(!1)}return this},f.prototype._ease=function(c,d,E){E.animate===!1||E.duration===0?(c(1),d()):(this._easeStart=m.browser.now(),this._easeOptions=E,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((m.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=m.wrap(c,-180,180);var E=Math.abs(c-d);return Math.abs(c-360-d)<E&&(c-=360),Math.abs(c+360-d)<E&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var E=c.lng-d.center.lng;c.lng+=E>180?-360:E<-180?360:0}},f}(m.Evented),Qo=function(l){l===void 0&&(l={}),this.options=l,m.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};Qo.prototype.getDefaultPosition=function(){return"bottom-right"},Qo.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=V.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=V.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},Qo.prototype.onRemove=function(){V.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},Qo.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},Qo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},Qo.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||m.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,E,w){return E.value&&(d+=E.key+"="+E.value+(w<f.length-1?"&":"")),d},"?");l.href=m.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},Qo.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},Qo.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(k){return typeof k!="string"?"":k})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var E=c[d];if(E.used){var w=E.getSource();w.attribution&&l.indexOf(w.attribution)<0&&l.push(w.attribution)}}l.sort(function(k,Z){return k.length-Z.length});var P=(l=l.filter(function(k,Z){for(var X=Z+1;X<l.length;X++)if(l[X].indexOf(k)>=0)return!1;return!0})).join(" | ");P!==this._attribHTML&&(this._attribHTML=P,l.length?(this._innerContainer.innerHTML=P,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},Qo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Qs=function(){m.bindAll(["_updateLogo"],this),m.bindAll(["_updateCompact"],this)};Qs.prototype.onAdd=function(l){this._map=l,this._container=V.create("div","mapboxgl-ctrl");var f=V.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Qs.prototype.onRemove=function(){V.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Qs.prototype.getDefaultPosition=function(){return"bottom-left"},Qs.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Qs.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},Qs.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Ho=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ho.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Ho.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var E=d[c];if(E.id===l)return void(E.cancelled=!0)}},Ho.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var E=d[c];if(!E.cancelled&&(E.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ho.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var du={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},qf=m.window.HTMLImageElement,Vc=m.window.HTMLElement,ya=m.window.ImageBitmap,Da={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},pl=function(l){function f(d){var E=this;if((d=m.extend({},Da,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new qi(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,w,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ho,this._controls=[],this._mapId=m.uniqueId(),this._locale=m.extend({},du,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new m.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=m.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Vc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),m.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return E._update(!1)}),this.on("moveend",function(){return E._update(!1)}),this.on("zoom",function(){return E._update(!0)}),m.window!==void 0&&(m.window.addEventListener("online",this._onWindowOnline,!1),m.window.addEventListener("resize",this._onWindowResize,!1),m.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Cn(this,d),this._hash=d.hash&&new bs(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,m.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Qo({customAttribution:d.customAttribution})),this.addControl(new Qs,d.logoPosition),this.on("style.load",function(){E.transform.unmodified&&E.jumpTo(E.style.stylesheet)}),this.on("data",function(P){E._update(P.dataType==="style"),E.fire(new m.Event(P.dataType+"data",P))}),this.on("dataloading",function(P){E.fire(new m.Event(P.dataType+"dataloading",P))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,E){if(E===void 0&&(E=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=d.onAdd(this);this._controls.push(d);var P=this._controlPositions[E];return E.indexOf("bottom")!==-1?P.insertBefore(w,P.firstChild):P.appendChild(w),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new m.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var E=this._controls.indexOf(d);return E>-1&&this._controls.splice(E,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var E=this._containerDimensions(),w=E[0],P=E[1];if(w===this.transform.width&&P===this.transform.height)return this;this._resizeCanvas(w,P),this.transform.resize(w,P),this.painter.resize(w,P);var k=!this._moving;return k&&this.fire(new m.Event("movestart",d)).fire(new m.Event("move",d)),this.fire(new m.Event("resize",d)),k&&this.fire(new m.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(m.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(m.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(m.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,E,w){var P,k=this;if(d==="mouseenter"||d==="mouseover"){var Z=!1;return{layer:E,listener:w,delegates:{mousemove:function(le){var pe=k.getLayer(E)?k.queryRenderedFeatures(le.point,{layers:[E]}):[];pe.length?Z||(Z=!0,w.call(k,new mo(d,k,le.originalEvent,{features:pe}))):Z=!1},mouseout:function(){Z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var X=!1;return{layer:E,listener:w,delegates:{mousemove:function(le){(k.getLayer(E)?k.queryRenderedFeatures(le.point,{layers:[E]}):[]).length?X=!0:X&&(X=!1,w.call(k,new mo(d,k,le.originalEvent)))},mouseout:function(le){X&&(X=!1,w.call(k,new mo(d,k,le.originalEvent)))}}}}return{layer:E,listener:w,delegates:(P={},P[d]=function(le){var pe=k.getLayer(E)?k.queryRenderedFeatures(le.point,{layers:[E]}):[];pe.length&&(le.features=pe,w.call(k,le),delete le.features)},P)}},f.prototype.on=function(d,E,w){if(w===void 0)return l.prototype.on.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var k in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(P),P.delegates)this.on(k,P.delegates[k]);return this},f.prototype.once=function(d,E,w){if(w===void 0)return l.prototype.once.call(this,d,E);var P=this._createDelegatedListener(d,E,w);for(var k in P.delegates)this.once(k,P.delegates[k]);return this},f.prototype.off=function(d,E,w){var P=this;return w===void 0?l.prototype.off.call(this,d,E):(this._delegatedListeners&&this._delegatedListeners[d]&&function(k){for(var Z=k[d],X=0;X<Z.length;X++){var le=Z[X];if(le.layer===E&&le.listener===w){for(var pe in le.delegates)P.off(pe,le.delegates[pe]);return Z.splice(X,1),P}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,E){if(!this.style)return[];var w;if(E!==void 0||d===void 0||d instanceof m.Point||Array.isArray(d)||(E=d,d=void 0),E=E||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof m.Point||typeof d[0]=="number")w=[m.Point.convert(d)];else{var P=m.Point.convert(d[0]),k=m.Point.convert(d[1]);w=[P,new m.Point(k.x,P.y),k,new m.Point(P.x,k.y),P]}return this.style.queryRenderedFeatures(w,E,this.transform)},f.prototype.querySourceFeatures=function(d,E){return this.style.querySourceFeatures(d,E)},f.prototype.setStyle=function(d,E){return(E=m.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},E)).diff!==!1&&E.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,E),this):(this._localIdeographFontFamily=E.localIdeographFontFamily,this._updateStyle(d,E))},f.prototype._getUIString=function(d){var E=this._locale[d];if(E==null)throw new Error("Missing UI string '"+d+"'");return E},f.prototype._updateStyle=function(d,E){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new _s(this,E||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new _s(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,E){var w=this;if(typeof d=="string"){var P=this._requestManager.normalizeStyleURL(d),k=this._requestManager.transformRequest(P,m.ResourceType.Style);m.getJSON(k,function(Z,X){Z?w.fire(new m.ErrorEvent(Z)):X&&w._updateDiff(X,E)})}else typeof d=="object"&&this._updateDiff(d,E)},f.prototype._updateDiff=function(d,E){try{this.style.setState(d)&&this._update(!0)}catch(w){m.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(d,E)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():m.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,E){return this._lazyInitEmptyStyle(),this.style.addSource(d,E),this._update(!0)},f.prototype.isSourceLoaded=function(d){var E=this.style&&this.style.sourceCaches[d];if(E!==void 0)return E.loaded();this.fire(new m.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var E in d){var w=d[E]._tiles;for(var P in w){var k=w[P];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,E,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,E,w)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,E,w){w===void 0&&(w={});var P=w.pixelRatio;P===void 0&&(P=1);var k=w.sdf;k===void 0&&(k=!1);var Z=w.stretchX,X=w.stretchY,le=w.content;if(this._lazyInitEmptyStyle(),E instanceof qf||ya&&E instanceof ya){var pe=m.browser.getImageData(E);this.style.addImage(d,{data:new m.RGBAImage({width:pe.width,height:pe.height},pe.data),pixelRatio:P,stretchX:Z,stretchY:X,content:le,sdf:k,version:0})}else{if(E.width===void 0||E.height===void 0)return this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ve=E;this.style.addImage(d,{data:new m.RGBAImage({width:E.width,height:E.height},new Uint8Array(E.data)),pixelRatio:P,stretchX:Z,stretchY:X,content:le,sdf:k,version:0,userImage:ve}),ve.onAdd&&ve.onAdd(this,d)}},f.prototype.updateImage=function(d,E){var w=this.style.getImage(d);if(!w)return this.fire(new m.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var P=E instanceof qf||ya&&E instanceof ya?m.browser.getImageData(E):E,k=P.width,Z=P.height,X=P.data;return k===void 0||Z===void 0?this.fire(new m.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):k!==w.data.width||Z!==w.data.height?this.fire(new m.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(X,!(E instanceof qf||ya&&E instanceof ya)),void this.style.updateImage(d,w))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new m.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,E){m.getImage(this._requestManager.transformRequest(d,m.ResourceType.Image),E)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,E){return this._lazyInitEmptyStyle(),this.style.addLayer(d,E),this._update(!0)},f.prototype.moveLayer=function(d,E){return this.style.moveLayer(d,E),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,E,w){return this.style.setLayerZoomRange(d,E,w),this._update(!0)},f.prototype.setFilter=function(d,E,w){return w===void 0&&(w={}),this.style.setFilter(d,E,w),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setPaintProperty(d,E,w,P),this._update(!0)},f.prototype.getPaintProperty=function(d,E){return this.style.getPaintProperty(d,E)},f.prototype.setLayoutProperty=function(d,E,w,P){return P===void 0&&(P={}),this.style.setLayoutProperty(d,E,w,P),this._update(!0)},f.prototype.getLayoutProperty=function(d,E){return this.style.getLayoutProperty(d,E)},f.prototype.setLight=function(d,E){return E===void 0&&(E={}),this._lazyInitEmptyStyle(),this.style.setLight(d,E),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,E){return this.style.setFeatureState(d,E),this._update()},f.prototype.removeFeatureState=function(d,E){return this.style.removeFeatureState(d,E),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,E=0;return this._container&&(d=this._container.clientWidth||400,E=this._container.clientHeight||300),[d,E]},f.prototype._detectMissingCSS=function(){m.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&m.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=V.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var E=this._canvasContainer=V.create("div","mapboxgl-canvas-container",d);this._interactive&&E.classList.add("mapboxgl-interactive"),this._canvas=V.create("canvas","mapboxgl-canvas",E),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var P=this._controlContainer=V.create("div","mapboxgl-control-container",d),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){k[Z]=V.create("div","mapboxgl-ctrl-"+Z,P)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,E){var w=m.browser.devicePixelRatio||1;this._canvas.width=w*d,this._canvas.height=w*E,this._canvas.style.width=d+"px",this._canvas.style.height=E+"px"},f.prototype._setupPainter=function(){var d=m.extend({},he.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),E=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);E?(this.painter=new Ji(E,this.transform),m.webpSupported.testSupport(E)):this.fire(new m.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new m.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new m.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var E,w=this,P=0,k=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(E=k.createQueryEXT(),k.beginQueryEXT(k.TIME_ELAPSED_EXT,E),P=m.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var X=this.transform.zoom,le=m.browser.now();this.style.zoomHistory.update(X,le);var pe=new m.EvaluationParameters(X,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ve=pe.crossFadingFactor();ve===1&&ve===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=ve),this.style.update(pe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new m.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new m.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Re=m.browser.now()-P;k.endQueryEXT(k.TIME_ELAPSED_EXT,E),setTimeout(function(){var Ee=k.getQueryObjectEXT(E,k.QUERY_RESULT_EXT)/1e6;k.deleteQueryEXT(E),w.fire(new m.Event("gpu-timing-frame",{cpuTime:Re,gpuTime:Ee}))},50)}if(this.listens("gpu-timing-layer")){var Ie=this.painter.collectGpuTimers();setTimeout(function(){var Ee=w.painter.queryGpuTimers(Ie);w.fire(new m.Event("gpu-timing-layer",{layerTimes:Ee}))},50)}var ze=this._sourcesDirty||this._styleDirty||this._placementDirty;return ze||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new m.Event("idle")),!this._loaded||this._fullyLoaded||ze||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,E=this._controls;d<E.length;d+=1)E[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),m.window!==void 0&&(m.window.removeEventListener("resize",this._onWindowResize,!1),m.window.removeEventListener("orientationchange",this._onWindowResize,!1),m.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),cc(this._canvasContainer),cc(this._controlContainer),cc(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new m.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=m.browser.frame(function(E){d._frame=null,d._render(E)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,E){m.setCacheLimits(d,E)},c.version.get=function(){return m.version},Object.defineProperties(f.prototype,c),f}(jc);function cc(l){l.parentNode&&l.parentNode.removeChild(l)}var Js={showCompass:!0,showZoom:!0,visualizePitch:!1},vu=function(l){var f=this;this.options=m.extend({},Js,l),this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(m.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),V.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),V.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(m.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=V.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};vu.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},vu.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},vu.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bi(this._map,this._compass,this.options.visualizePitch)),this._container},vu.prototype.onRemove=function(){V.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},vu.prototype._createButton=function(l,f){var c=V.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},vu.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var bi=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Sf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new ll({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),m.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),V.addEventListener(f,"mousedown",this.mousedown),V.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),V.addEventListener(f,"touchmove",this.touchmove),V.addEventListener(f,"touchend",this.touchend),V.addEventListener(f,"touchcancel",this.reset)};function Ns(l,f,c){if(l=new m.LngLat(l.lng,l.lat),f){var d=new m.LngLat(l.lng-360,l.lat),E=new m.LngLat(l.lng+360,l.lat),w=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<w?l=d:c.locationPoint(E).distSqr(f)<w&&(l=E)}for(;Math.abs(l.lng-c.center.lng)>180;){var P=c.locationPoint(l);if(P.x>=0&&P.y>=0&&P.x<=c.width&&P.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}bi.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),V.disableDrag()},bi.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var E=this.mousePitch.mousemoveWindow(l,f);E&&E.pitchDelta&&c.setPitch(c.getPitch()+E.pitchDelta)}},bi.prototype.off=function(){var l=this.element;V.removeEventListener(l,"mousedown",this.mousedown),V.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),V.removeEventListener(l,"touchmove",this.touchmove),V.removeEventListener(l,"touchend",this.touchend),V.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},bi.prototype.offTemp=function(){V.enableDrag(),V.removeEventListener(m.window,"mousemove",this.mousemove),V.removeEventListener(m.window,"mouseup",this.mouseup)},bi.prototype.mousedown=function(l){this.down(m.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),V.mousePos(this.element,l)),V.addEventListener(m.window,"mousemove",this.mousemove),V.addEventListener(m.window,"mouseup",this.mouseup)},bi.prototype.mousemove=function(l){this.move(l,V.mousePos(this.element,l))},bi.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},bi.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},bi.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=V.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},bi.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},bi.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Is={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function hl(l,f,c){var d=l.classList;for(var E in Is)d.remove("mapboxgl-"+c+"-anchor-"+E);d.add("mapboxgl-"+c+"-anchor-"+f)}var ku,Qu=function(l){function f(c,d){if(l.call(this),(c instanceof m.window.HTMLElement||d)&&(c=m.extend({element:c},d)),m.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=m.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=V.create("div"),this._element.setAttribute("aria-label","Map marker");var E=V.createNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","41px"),E.setAttributeNS(null,"width","27px"),E.setAttributeNS(null,"viewBox","0 0 27 41");var w=V.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var P=V.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");var k=V.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"transform","translate(3.0, 29.0)"),k.setAttributeNS(null,"fill","#000000");for(var Z=0,X=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<X.length;Z+=1){var le=X[Z],pe=V.createNS("http://www.w3.org/2000/svg","ellipse");pe.setAttributeNS(null,"opacity","0.04"),pe.setAttributeNS(null,"cx","10.5"),pe.setAttributeNS(null,"cy","5.80029008"),pe.setAttributeNS(null,"rx",le.rx),pe.setAttributeNS(null,"ry",le.ry),k.appendChild(pe)}var ve=V.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"fill",this._color);var Re=V.createNS("http://www.w3.org/2000/svg","path");Re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ve.appendChild(Re);var Ie=V.createNS("http://www.w3.org/2000/svg","g");Ie.setAttributeNS(null,"opacity","0.25"),Ie.setAttributeNS(null,"fill","#000000");var ze=V.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ie.appendChild(ze);var Ee=V.createNS("http://www.w3.org/2000/svg","g");Ee.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ee.setAttributeNS(null,"fill","#FFFFFF");var Ve=V.createNS("http://www.w3.org/2000/svg","g");Ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");var et=V.createNS("http://www.w3.org/2000/svg","circle");et.setAttributeNS(null,"fill","#000000"),et.setAttributeNS(null,"opacity","0.25"),et.setAttributeNS(null,"cx","5.5"),et.setAttributeNS(null,"cy","5.5"),et.setAttributeNS(null,"r","5.4999962");var vt=V.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#FFFFFF"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962"),Ve.appendChild(et),Ve.appendChild(vt),P.appendChild(k),P.appendChild(ve),P.appendChild(Ie),P.appendChild(Ee),P.appendChild(Ve),E.appendChild(P),E.setAttributeNS(null,"height",41*this._scale+"px"),E.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(E),this._offset=m.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Xt){Xt.preventDefault()}),this._element.addEventListener("mousedown",function(Xt){Xt.preventDefault()}),hl(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),V.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,E=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&E!==32&&E!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,E=this._element;this._popup&&(d===E||E.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ns(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),V.setTransform(this._element,Is[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+E+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=m.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new m.Event("dragstart"))),this.fire(new m.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new m.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(m.Evented),Gc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ia=0,eu=!1,Nl=function(l){function f(c){l.call(this),this.options=m.extend({},Gc,c),m.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,ku!==void 0?d(ku):m.window.navigator.permissions!==void 0?m.window.navigator.permissions.query({name:"geolocation"}).then(function(E){d(ku=E.state!=="denied")}):d(ku=!!m.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),V.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ia=0,eu=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),E=c.coords;return d&&(E.longitude<d.getWest()||E.longitude>d.getEast()||E.latitude<d.getSouth()||E.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new m.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude),E=c.coords.accuracy,w=this._map.getBearing(),P=m.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(E),P,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new m.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),E=this._map.unproject([1,c]),w=d.distanceTo(E),P=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=P+"px",this._circleElement.style.height=P+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&eu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new m.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(P){return P.preventDefault()}),this._geolocateButton=V.create("button","mapboxgl-ctrl-geolocate",this._container),V.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){m.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var E=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=E,this._geolocateButton.setAttribute("aria-label",E)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=V.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Qu(this._dotElement),this._circleElement=V.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(P){P.geolocateSource||d._watchState!=="ACTIVE_LOCK"||P.originalEvent&&P.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new m.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return m.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new m.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ia--,eu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new m.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new m.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ia>1?(c={maximumAge:6e5,timeout:0},eu=!0):(c=this.options.positionOptions,eu=!1),this._geolocationWatchID=m.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else m.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){m.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(m.Evented),dl={maxWidth:100,unit:"metric"},vl=function(l){this.options=m.extend({},dl,l),m.bindAll(["_onMove","setUnit"],this)};function Hc(l,f,c){var d=c&&c.maxWidth||100,E=l._container.clientHeight/2,w=l.unproject([0,E]),P=l.unproject([d,E]),k=w.distanceTo(P);if(c&&c.unit==="imperial"){var Z=3.2808*k;Z>5280?ml(f,d,Z/5280,l._getUIString("ScaleControl.Miles")):ml(f,d,Z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?ml(f,d,k/1852,l._getUIString("ScaleControl.NauticalMiles")):k>=1e3?ml(f,d,k/1e3,l._getUIString("ScaleControl.Kilometers")):ml(f,d,k,l._getUIString("ScaleControl.Meters"))}function ml(l,f,c,d){var E,w,P,k=(E=c,(w=Math.pow(10,(""+Math.floor(E)).length-1))*(P=(P=E/w)>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(Z){var X=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*X)/X}(P)));l.style.width=f*(k/c)+"px",l.innerHTML=k+"&nbsp;"+d}vl.prototype.getDefaultPosition=function(){return"bottom-left"},vl.prototype._onMove=function(){Hc(this._map,this._container,this.options)},vl.prototype.onAdd=function(l){return this._map=l,this._container=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},vl.prototype.onRemove=function(){V.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},vl.prototype.setUnit=function(l){this.options.unit=l,Hc(this._map,this._container,this.options)};var tu=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof m.window.HTMLElement?this._container=l.container:m.warnOnce("Full screen control 'container' must be a DOM element.")),m.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in m.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in m.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in m.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in m.window.document&&(this._fullscreenchange="MSFullscreenChange")};tu.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=V.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",m.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},tu.prototype.onRemove=function(){V.remove(this._controlContainer),this._map=null,m.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},tu.prototype._checkFullscreenSupport=function(){return!!(m.window.document.fullscreenEnabled||m.window.document.mozFullScreenEnabled||m.window.document.msFullscreenEnabled||m.window.document.webkitFullscreenEnabled)},tu.prototype._setupUI=function(){var l=this._fullscreenButton=V.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);V.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),m.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},tu.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},tu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},tu.prototype._isFullscreen=function(){return this._fullscreen},tu.prototype._changeIcon=function(){(m.window.document.fullscreenElement||m.window.document.mozFullScreenElement||m.window.document.webkitFullscreenElement||m.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},tu.prototype._onClickFullscreen=function(){this._isFullscreen()?m.window.document.exitFullscreen?m.window.document.exitFullscreen():m.window.document.mozCancelFullScreen?m.window.document.mozCancelFullScreen():m.window.document.msExitFullscreen?m.window.document.msExitFullscreen():m.window.document.webkitCancelFullScreen&&m.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var fc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},zl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Kf=function(l){function f(c){l.call(this),this.options=m.extend(Object.create(fc),c),m.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new m.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&V.remove(this._content),this._container&&(V.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new m.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=m.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(m.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,E=m.window.document.createDocumentFragment(),w=m.window.document.createElement("body");for(w.innerHTML=c;d=w.firstChild;)E.appendChild(d);return this.setDOMContent(E)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=V.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=V.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=V.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=V.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(pe){return d._container.classList.add(pe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ns(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var E=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),w=this.options.anchor,P=function pe(ve){if(ve){if(typeof ve=="number"){var Re=Math.round(Math.sqrt(.5*Math.pow(ve,2)));return{center:new m.Point(0,0),top:new m.Point(0,ve),"top-left":new m.Point(Re,Re),"top-right":new m.Point(-Re,Re),bottom:new m.Point(0,-ve),"bottom-left":new m.Point(Re,-Re),"bottom-right":new m.Point(-Re,-Re),left:new m.Point(ve,0),right:new m.Point(-ve,0)}}if(ve instanceof m.Point||Array.isArray(ve)){var Ie=m.Point.convert(ve);return{center:Ie,top:Ie,"top-left":Ie,"top-right":Ie,bottom:Ie,"bottom-left":Ie,"bottom-right":Ie,left:Ie,right:Ie}}return{center:m.Point.convert(ve.center||[0,0]),top:m.Point.convert(ve.top||[0,0]),"top-left":m.Point.convert(ve["top-left"]||[0,0]),"top-right":m.Point.convert(ve["top-right"]||[0,0]),bottom:m.Point.convert(ve.bottom||[0,0]),"bottom-left":m.Point.convert(ve["bottom-left"]||[0,0]),"bottom-right":m.Point.convert(ve["bottom-right"]||[0,0]),left:m.Point.convert(ve.left||[0,0]),right:m.Point.convert(ve.right||[0,0])}}return pe(new m.Point(0,0))}(this.options.offset);if(!w){var k,Z=this._container.offsetWidth,X=this._container.offsetHeight;k=E.y+P.bottom.y<X?["top"]:E.y>this._map.transform.height-X?["bottom"]:[],E.x<Z/2?k.push("left"):E.x>this._map.transform.width-Z/2&&k.push("right"),w=k.length===0?"bottom":k.join("-")}var le=E.add(P[w]).round();V.setTransform(this._container,Is[w]+" translate("+le.x+"px,"+le.y+"px)"),hl(this._container,w,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(zl);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(m.Evented),Ul={version:m.version,supported:he,setRTLTextPlugin:m.setRTLTextPlugin,getRTLTextPluginStatus:m.getRTLTextPluginStatus,Map:pl,NavigationControl:vu,GeolocateControl:Nl,AttributionControl:Qo,ScaleControl:vl,FullscreenControl:tu,Popup:Kf,Marker:Qu,Style:_s,LngLat:m.LngLat,LngLatBounds:m.LngLatBounds,Point:m.Point,MercatorCoordinate:m.MercatorCoordinate,Evented:m.Evented,config:m.config,prewarm:function(){Pt().acquire(Nt)},clearPrewarmedResources:function(){var l=_n;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Nt),_n=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return m.config.ACCESS_TOKEN},set accessToken(l){m.config.ACCESS_TOKEN=l},get baseApiUrl(){return m.config.API_URL},set baseApiUrl(l){m.config.API_URL=l},get workerCount(){return hr.workerCount},set workerCount(l){hr.workerCount=l},get maxParallelImageRequests(){return m.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){m.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){m.clearTileCache(l)},workerUrl:""};return Ul}),ie})},28660:function(Mt,Q,U){var ie=U(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var re;(function(m){(function(he){var V=typeof U.g=="object"?U.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ue=ce(m);typeof V.Reflect=="undefined"?V.Reflect=m:ue=ce(V.Reflect,ue),he(ue);function ce(Le,ee){return function(Xe,Je){typeof Le[Xe]!="function"&&Object.defineProperty(Le,Xe,{configurable:!0,writable:!0,value:Je}),ee&&ee(Xe,Je)}}})(function(he){var V=Object.prototype.hasOwnProperty,ue=typeof Symbol=="function",ce=ue&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Le=ue&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ee=typeof Object.create=="function",Xe={__proto__:[]}instanceof Array,Je=!ee&&!Xe,Ze={create:ee?function(){return ns(Object.create(null))}:Xe?function(){return ns({__proto__:null})}:function(){return ns({})},has:Je?function(Bt,rr){return V.call(Bt,rr)}:function(Bt,rr){return rr in Bt},get:Je?function(Bt,rr){return V.call(Bt,rr)?Bt[rr]:void 0}:function(Bt,rr){return Bt[rr]}},gt=Object.getPrototypeOf(Function),tr=typeof ie=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",yt=!tr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:me(),Wt=!tr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:kn(),bt=!tr&&typeof WeakMap=="function"?WeakMap:Ha(),at=new bt;function nt(Bt,rr,Cr,Qr){if(hn(Cr)){if(!Di(Bt))throw new TypeError;if(!la(rr))throw new TypeError;return kr(Bt,rr)}else{if(!Di(Bt))throw new TypeError;if(!ni(rr))throw new TypeError;if(!ni(Qr)&&!hn(Qr)&&!fi(Qr))throw new TypeError;return fi(Qr)&&(Qr=void 0),Cr=Gi(Cr),Kr(Bt,rr,Cr,Qr)}}he("decorate",nt);function Zt(Bt,rr){function Cr(Qr,Sn){if(!ni(Qr))throw new TypeError;if(!hn(Sn)&&!Mi(Sn))throw new TypeError;Ft(Bt,rr,Qr,Sn)}return Cr}he("metadata",Zt);function Y(Bt,rr,Cr,Qr){if(!ni(Cr))throw new TypeError;return hn(Qr)||(Qr=Gi(Qr)),Ft(Bt,rr,Cr,Qr)}he("defineMetadata",Y);function qt(Bt,rr,Cr){if(!ni(rr))throw new TypeError;return hn(Cr)||(Cr=Gi(Cr)),Ae(Bt,rr,Cr)}he("hasMetadata",qt);function ut(Bt,rr,Cr){if(!ni(rr))throw new TypeError;return hn(Cr)||(Cr=Gi(Cr)),De(Bt,rr,Cr)}he("hasOwnMetadata",ut);function Qe(Bt,rr,Cr){if(!ni(rr))throw new TypeError;return hn(Cr)||(Cr=Gi(Cr)),At(Bt,rr,Cr)}he("getMetadata",Qe);function Ct(Bt,rr,Cr){if(!ni(rr))throw new TypeError;return hn(Cr)||(Cr=Gi(Cr)),mt(Bt,rr,Cr)}he("getOwnMetadata",Ct);function $e(Bt,rr){if(!ni(Bt))throw new TypeError;return hn(rr)||(rr=Gi(rr)),Yt(Bt,rr)}he("getMetadataKeys",$e);function Kt(Bt,rr){if(!ni(Bt))throw new TypeError;return hn(rr)||(rr=Gi(rr)),Sr(Bt,rr)}he("getOwnMetadataKeys",Kt);function xr(Bt,rr,Cr){if(!ni(rr))throw new TypeError;hn(Cr)||(Cr=Gi(Cr));var Qr=A(rr,Cr,!1);if(hn(Qr)||!Qr.delete(Bt))return!1;if(Qr.size>0)return!0;var Sn=at.get(rr);return Sn.delete(Cr),Sn.size>0||at.delete(rr),!0}he("deleteMetadata",xr);function kr(Bt,rr){for(var Cr=Bt.length-1;Cr>=0;--Cr){var Qr=Bt[Cr],Sn=Qr(rr);if(!hn(Sn)&&!fi(Sn)){if(!la(Sn))throw new TypeError;rr=Sn}}return rr}function Kr(Bt,rr,Cr,Qr){for(var Sn=Bt.length-1;Sn>=0;--Sn){var Fn=Bt[Sn],di=Fn(rr,Cr,Qr);if(!hn(di)&&!fi(di)){if(!ni(di))throw new TypeError;Qr=di}}return Qr}function A(Bt,rr,Cr){var Qr=at.get(Bt);if(hn(Qr)){if(!Cr)return;Qr=new yt,at.set(Bt,Qr)}var Sn=Qr.get(rr);if(hn(Sn)){if(!Cr)return;Sn=new yt,Qr.set(rr,Sn)}return Sn}function Ae(Bt,rr,Cr){var Qr=De(Bt,rr,Cr);if(Qr)return!0;var Sn=ko(rr);return fi(Sn)?!1:Ae(Bt,Sn,Cr)}function De(Bt,rr,Cr){var Qr=A(rr,Cr,!1);return hn(Qr)?!1:hi(Qr.has(Bt))}function At(Bt,rr,Cr){var Qr=De(Bt,rr,Cr);if(Qr)return mt(Bt,rr,Cr);var Sn=ko(rr);if(!fi(Sn))return At(Bt,Sn,Cr)}function mt(Bt,rr,Cr){var Qr=A(rr,Cr,!1);if(!hn(Qr))return Qr.get(Bt)}function Ft(Bt,rr,Cr,Qr){var Sn=A(Cr,Qr,!0);Sn.set(Bt,rr)}function Yt(Bt,rr){var Cr=Sr(Bt,rr),Qr=ko(Bt);if(Qr===null)return Cr;var Sn=Yt(Qr,rr);if(Sn.length<=0)return Cr;if(Cr.length<=0)return Sn;for(var Fn=new Wt,di=[],Kn=0,an=Cr;Kn<an.length;Kn++){var Fi=an[Kn],Li=Fn.has(Fi);Li||(Fn.add(Fi),di.push(Fi))}for(var ao=0,vs=Sn;ao<vs.length;ao++){var Fi=vs[ao],Li=Fn.has(Fi);Li||(Fn.add(Fi),di.push(Fi))}return di}function Sr(Bt,rr){var Cr=[],Qr=A(Bt,rr,!1);if(hn(Qr))return Cr;for(var Sn=Qr.keys(),Fn=Xn(Sn),di=0;;){var Kn=Zi(Fn);if(!Kn)return Cr.length=di,Cr;var an=Si(Kn);try{Cr[di]=an}catch(Fi){try{Qi(Fn)}finally{throw Fi}}di++}}function qn(Bt){if(Bt===null)return 1;switch(typeof Bt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Bt===null?1:6;default:return 6}}function hn(Bt){return Bt===void 0}function fi(Bt){return Bt===null}function Gn(Bt){return typeof Bt=="symbol"}function ni(Bt){return typeof Bt=="object"?Bt!==null:typeof Bt=="function"}function pi(Bt,rr){switch(qn(Bt)){case 0:return Bt;case 1:return Bt;case 2:return Bt;case 3:return Bt;case 4:return Bt;case 5:return Bt}var Cr=rr===3?"string":rr===5?"number":"default",Qr=ma(Bt,ce);if(Qr!==void 0){var Sn=Qr.call(Bt,Cr);if(ni(Sn))throw new TypeError;return Sn}return Wn(Bt,Cr==="default"?"number":Cr)}function Wn(Bt,rr){if(rr==="string"){var Cr=Bt.toString;if($i(Cr)){var Qr=Cr.call(Bt);if(!ni(Qr))return Qr}var Sn=Bt.valueOf;if($i(Sn)){var Qr=Sn.call(Bt);if(!ni(Qr))return Qr}}else{var Sn=Bt.valueOf;if($i(Sn)){var Qr=Sn.call(Bt);if(!ni(Qr))return Qr}var Fn=Bt.toString;if($i(Fn)){var Qr=Fn.call(Bt);if(!ni(Qr))return Qr}}throw new TypeError}function hi(Bt){return!!Bt}function ua(Bt){return""+Bt}function Gi(Bt){var rr=pi(Bt,3);return Gn(rr)?rr:ua(rr)}function Di(Bt){return Array.isArray?Array.isArray(Bt):Bt instanceof Object?Bt instanceof Array:Object.prototype.toString.call(Bt)==="[object Array]"}function $i(Bt){return typeof Bt=="function"}function la(Bt){return typeof Bt=="function"}function Mi(Bt){switch(qn(Bt)){case 3:return!0;case 4:return!0;default:return!1}}function ma(Bt,rr){var Cr=Bt[rr];if(Cr!=null){if(!$i(Cr))throw new TypeError;return Cr}}function Xn(Bt){var rr=ma(Bt,Le);if(!$i(rr))throw new TypeError;var Cr=rr.call(Bt);if(!ni(Cr))throw new TypeError;return Cr}function Si(Bt){return Bt.value}function Zi(Bt){var rr=Bt.next();return rr.done?!1:rr}function Qi(Bt){var rr=Bt.return;rr&&rr.call(Bt)}function ko(Bt){var rr=Object.getPrototypeOf(Bt);if(typeof Bt!="function"||Bt===gt||rr!==gt)return rr;var Cr=Bt.prototype,Qr=Cr&&Object.getPrototypeOf(Cr);if(Qr==null||Qr===Object.prototype)return rr;var Sn=Qr.constructor;return typeof Sn!="function"||Sn===Bt?rr:Sn}function me(){var Bt={},rr=[],Cr=function(){function di(Kn,an,Fi){this._index=0,this._keys=Kn,this._values=an,this._selector=Fi}return di.prototype["@@iterator"]=function(){return this},di.prototype[Le]=function(){return this},di.prototype.next=function(){var Kn=this._index;if(Kn>=0&&Kn<this._keys.length){var an=this._selector(this._keys[Kn],this._values[Kn]);return Kn+1>=this._keys.length?(this._index=-1,this._keys=rr,this._values=rr):this._index++,{value:an,done:!1}}return{value:void 0,done:!0}},di.prototype.throw=function(Kn){throw this._index>=0&&(this._index=-1,this._keys=rr,this._values=rr),Kn},di.prototype.return=function(Kn){return this._index>=0&&(this._index=-1,this._keys=rr,this._values=rr),{value:Kn,done:!0}},di}();return function(){function di(){this._keys=[],this._values=[],this._cacheKey=Bt,this._cacheIndex=-2}return Object.defineProperty(di.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),di.prototype.has=function(Kn){return this._find(Kn,!1)>=0},di.prototype.get=function(Kn){var an=this._find(Kn,!1);return an>=0?this._values[an]:void 0},di.prototype.set=function(Kn,an){var Fi=this._find(Kn,!0);return this._values[Fi]=an,this},di.prototype.delete=function(Kn){var an=this._find(Kn,!1);if(an>=0){for(var Fi=this._keys.length,Li=an+1;Li<Fi;Li++)this._keys[Li-1]=this._keys[Li],this._values[Li-1]=this._values[Li];return this._keys.length--,this._values.length--,Kn===this._cacheKey&&(this._cacheKey=Bt,this._cacheIndex=-2),!0}return!1},di.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Bt,this._cacheIndex=-2},di.prototype.keys=function(){return new Cr(this._keys,this._values,Qr)},di.prototype.values=function(){return new Cr(this._keys,this._values,Sn)},di.prototype.entries=function(){return new Cr(this._keys,this._values,Fn)},di.prototype["@@iterator"]=function(){return this.entries()},di.prototype[Le]=function(){return this.entries()},di.prototype._find=function(Kn,an){return this._cacheKey!==Kn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Kn)),this._cacheIndex<0&&an&&(this._cacheIndex=this._keys.length,this._keys.push(Kn),this._values.push(void 0)),this._cacheIndex},di}();function Qr(di,Kn){return di}function Sn(di,Kn){return Kn}function Fn(di,Kn){return[di,Kn]}}function kn(){return function(){function Bt(){this._map=new yt}return Object.defineProperty(Bt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Bt.prototype.has=function(rr){return this._map.has(rr)},Bt.prototype.add=function(rr){return this._map.set(rr,rr),this},Bt.prototype.delete=function(rr){return this._map.delete(rr)},Bt.prototype.clear=function(){this._map.clear()},Bt.prototype.keys=function(){return this._map.keys()},Bt.prototype.values=function(){return this._map.values()},Bt.prototype.entries=function(){return this._map.entries()},Bt.prototype["@@iterator"]=function(){return this.keys()},Bt.prototype[Le]=function(){return this.keys()},Bt}()}function Ha(){var Bt=16,rr=Ze.create(),Cr=Qr();return function(){function an(){this._key=Qr()}return an.prototype.has=function(Fi){var Li=Sn(Fi,!1);return Li!==void 0?Ze.has(Li,this._key):!1},an.prototype.get=function(Fi){var Li=Sn(Fi,!1);return Li!==void 0?Ze.get(Li,this._key):void 0},an.prototype.set=function(Fi,Li){var ao=Sn(Fi,!0);return ao[this._key]=Li,this},an.prototype.delete=function(Fi){var Li=Sn(Fi,!1);return Li!==void 0?delete Li[this._key]:!1},an.prototype.clear=function(){this._key=Qr()},an}();function Qr(){var an;do an="@@WeakMap@@"+Kn();while(Ze.has(rr,an));return rr[an]=!0,an}function Sn(an,Fi){if(!V.call(an,Cr)){if(!Fi)return;Object.defineProperty(an,Cr,{value:Ze.create()})}return an[Cr]}function Fn(an,Fi){for(var Li=0;Li<Fi;++Li)an[Li]=Math.random()*255|0;return an}function di(an){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(an)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(an)):Fn(new Uint8Array(an),an):Fn(new Array(an),an)}function Kn(){var an=di(Bt);an[6]=an[6]&79|64,an[8]=an[8]&191|128;for(var Fi="",Li=0;Li<Bt;++Li){var ao=an[Li];(Li===4||Li===6||Li===8)&&(Fi+="-"),ao<16&&(Fi+="0"),Fi+=ao.toString(16).toLowerCase()}return Fi}}function ns(Bt){return Bt.__=void 0,delete Bt.__,Bt}})})(re||(re={}))},69848:function(Mt){(function(Q,U){Mt.exports=U()})(this,function(){"use strict";function Q(ut,Qe,Ct,$e,Kt,xr){if(!(Kt-$e<=Ct)){var kr=$e+Kt>>1;U(ut,Qe,kr,$e,Kt,xr%2),Q(ut,Qe,Ct,$e,kr-1,xr+1),Q(ut,Qe,Ct,kr+1,Kt,xr+1)}}function U(ut,Qe,Ct,$e,Kt,xr){for(;Kt>$e;){if(Kt-$e>600){var kr=Kt-$e+1,Kr=Ct-$e+1,A=Math.log(kr),Ae=.5*Math.exp(2*A/3),De=.5*Math.sqrt(A*Ae*(kr-Ae)/kr)*(Kr-kr/2<0?-1:1),At=Math.max($e,Math.floor(Ct-Kr*Ae/kr+De)),mt=Math.min(Kt,Math.floor(Ct+(kr-Kr)*Ae/kr+De));U(ut,Qe,Ct,At,mt,xr)}var Ft=Qe[2*Ct+xr],Yt=$e,Sr=Kt;for(ie(ut,Qe,$e,Ct),Qe[2*Kt+xr]>Ft&&ie(ut,Qe,$e,Kt);Yt<Sr;){for(ie(ut,Qe,Yt,Sr),Yt++,Sr--;Qe[2*Yt+xr]<Ft;)Yt++;for(;Qe[2*Sr+xr]>Ft;)Sr--}Qe[2*$e+xr]===Ft?ie(ut,Qe,$e,Sr):(Sr++,ie(ut,Qe,Sr,Kt)),Sr<=Ct&&($e=Sr+1),Ct<=Sr&&(Kt=Sr-1)}}function ie(ut,Qe,Ct,$e){re(ut,Ct,$e),re(Qe,2*Ct,2*$e),re(Qe,2*Ct+1,2*$e+1)}function re(ut,Qe,Ct){var $e=ut[Qe];ut[Qe]=ut[Ct],ut[Ct]=$e}function m(ut,Qe,Ct,$e,Kt,xr,kr){for(var Kr=[0,ut.length-1,0],A=[],Ae,De;Kr.length;){var At=Kr.pop(),mt=Kr.pop(),Ft=Kr.pop();if(mt-Ft<=kr){for(var Yt=Ft;Yt<=mt;Yt++)Ae=Qe[2*Yt],De=Qe[2*Yt+1],Ae>=Ct&&Ae<=Kt&&De>=$e&&De<=xr&&A.push(ut[Yt]);continue}var Sr=Math.floor((Ft+mt)/2);Ae=Qe[2*Sr],De=Qe[2*Sr+1],Ae>=Ct&&Ae<=Kt&&De>=$e&&De<=xr&&A.push(ut[Sr]);var qn=(At+1)%2;(At===0?Ct<=Ae:$e<=De)&&(Kr.push(Ft),Kr.push(Sr-1),Kr.push(qn)),(At===0?Kt>=Ae:xr>=De)&&(Kr.push(Sr+1),Kr.push(mt),Kr.push(qn))}return A}function he(ut,Qe,Ct,$e,Kt,xr){for(var kr=[0,ut.length-1,0],Kr=[],A=Kt*Kt;kr.length;){var Ae=kr.pop(),De=kr.pop(),At=kr.pop();if(De-At<=xr){for(var mt=At;mt<=De;mt++)V(Qe[2*mt],Qe[2*mt+1],Ct,$e)<=A&&Kr.push(ut[mt]);continue}var Ft=Math.floor((At+De)/2),Yt=Qe[2*Ft],Sr=Qe[2*Ft+1];V(Yt,Sr,Ct,$e)<=A&&Kr.push(ut[Ft]);var qn=(Ae+1)%2;(Ae===0?Ct-Kt<=Yt:$e-Kt<=Sr)&&(kr.push(At),kr.push(Ft-1),kr.push(qn)),(Ae===0?Ct+Kt>=Yt:$e+Kt>=Sr)&&(kr.push(Ft+1),kr.push(De),kr.push(qn))}return Kr}function V(ut,Qe,Ct,$e){var Kt=ut-Ct,xr=Qe-$e;return Kt*Kt+xr*xr}var ue=function(ut){return ut[0]},ce=function(ut){return ut[1]},Le=function(Qe,Ct,$e,Kt,xr){Ct===void 0&&(Ct=ue),$e===void 0&&($e=ce),Kt===void 0&&(Kt=64),xr===void 0&&(xr=Float64Array),this.nodeSize=Kt,this.points=Qe;for(var kr=Qe.length<65536?Uint16Array:Uint32Array,Kr=this.ids=new kr(Qe.length),A=this.coords=new xr(Qe.length*2),Ae=0;Ae<Qe.length;Ae++)Kr[Ae]=Ae,A[2*Ae]=Ct(Qe[Ae]),A[2*Ae+1]=$e(Qe[Ae]);Q(Kr,A,Kt,0,Kr.length-1,0)};Le.prototype.range=function(Qe,Ct,$e,Kt){return m(this.ids,this.coords,Qe,Ct,$e,Kt,this.nodeSize)},Le.prototype.within=function(Qe,Ct,$e){return he(this.ids,this.coords,Qe,Ct,$e,this.nodeSize)};var ee={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ut){return ut}},Xe=Math.fround||function(ut){return function(Qe){return ut[0]=+Qe,ut[0]}}(new Float32Array(1)),Je=function(Qe){this.options=Zt(Object.create(ee),Qe),this.trees=new Array(this.options.maxZoom+1)};Je.prototype.load=function(Qe){var Ct=this.options,$e=Ct.log,Kt=Ct.minZoom,xr=Ct.maxZoom,kr=Ct.nodeSize;$e&&console.time("total time");var Kr="prepare "+Qe.length+" points";$e&&console.time(Kr),this.points=Qe;for(var A=[],Ae=0;Ae<Qe.length;Ae++)!Qe[Ae].geometry||A.push(gt(Qe[Ae],Ae));this.trees[xr+1]=new Le(A,Y,qt,kr,Float32Array),$e&&console.timeEnd(Kr);for(var De=xr;De>=Kt;De--){var At=+Date.now();A=this._cluster(A,De),this.trees[De]=new Le(A,Y,qt,kr,Float32Array),$e&&console.log("z%d: %d clusters in %dms",De,A.length,+Date.now()-At)}return $e&&console.timeEnd("total time"),this},Je.prototype.getClusters=function(Qe,Ct){var $e=((Qe[0]+180)%360+360)%360-180,Kt=Math.max(-90,Math.min(90,Qe[1])),xr=Qe[2]===180?180:((Qe[2]+180)%360+360)%360-180,kr=Math.max(-90,Math.min(90,Qe[3]));if(Qe[2]-Qe[0]>=360)$e=-180,xr=180;else if($e>xr){var Kr=this.getClusters([$e,Kt,180,kr],Ct),A=this.getClusters([-180,Kt,xr,kr],Ct);return Kr.concat(A)}for(var Ae=this.trees[this._limitZoom(Ct)],De=Ae.range(Wt($e),bt(kr),Wt(xr),bt(Kt)),At=[],mt=0,Ft=De;mt<Ft.length;mt+=1){var Yt=Ft[mt],Sr=Ae.points[Yt];At.push(Sr.numPoints?tr(Sr):this.points[Sr.index])}return At},Je.prototype.getChildren=function(Qe){var Ct=this._getOriginId(Qe),$e=this._getOriginZoom(Qe),Kt="No cluster with the specified id.",xr=this.trees[$e];if(!xr)throw new Error(Kt);var kr=xr.points[Ct];if(!kr)throw new Error(Kt);for(var Kr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),A=xr.within(kr.x,kr.y,Kr),Ae=[],De=0,At=A;De<At.length;De+=1){var mt=At[De],Ft=xr.points[mt];Ft.parentId===Qe&&Ae.push(Ft.numPoints?tr(Ft):this.points[Ft.index])}if(Ae.length===0)throw new Error(Kt);return Ae},Je.prototype.getLeaves=function(Qe,Ct,$e){Ct=Ct||10,$e=$e||0;var Kt=[];return this._appendLeaves(Kt,Qe,Ct,$e,0),Kt},Je.prototype.getTile=function(Qe,Ct,$e){var Kt=this.trees[this._limitZoom(Qe)],xr=Math.pow(2,Qe),kr=this.options,Kr=kr.extent,A=kr.radius,Ae=A/Kr,De=($e-Ae)/xr,At=($e+1+Ae)/xr,mt={features:[]};return this._addTileFeatures(Kt.range((Ct-Ae)/xr,De,(Ct+1+Ae)/xr,At),Kt.points,Ct,$e,xr,mt),Ct===0&&this._addTileFeatures(Kt.range(1-Ae/xr,De,1,At),Kt.points,xr,$e,xr,mt),Ct===xr-1&&this._addTileFeatures(Kt.range(0,De,Ae/xr,At),Kt.points,-1,$e,xr,mt),mt.features.length?mt:null},Je.prototype.getClusterExpansionZoom=function(Qe){for(var Ct=this._getOriginZoom(Qe)-1;Ct<=this.options.maxZoom;){var $e=this.getChildren(Qe);if(Ct++,$e.length!==1)break;Qe=$e[0].properties.cluster_id}return Ct},Je.prototype._appendLeaves=function(Qe,Ct,$e,Kt,xr){for(var kr=this.getChildren(Ct),Kr=0,A=kr;Kr<A.length;Kr+=1){var Ae=A[Kr],De=Ae.properties;if(De&&De.cluster?xr+De.point_count<=Kt?xr+=De.point_count:xr=this._appendLeaves(Qe,De.cluster_id,$e,Kt,xr):xr<Kt?xr++:Qe.push(Ae),Qe.length===$e)break}return xr},Je.prototype._addTileFeatures=function(Qe,Ct,$e,Kt,xr,kr){for(var Kr=0,A=Qe;Kr<A.length;Kr+=1){var Ae=A[Kr],De=Ct[Ae],At=De.numPoints,mt=void 0,Ft=void 0,Yt=void 0;if(At)mt=yt(De),Ft=De.x,Yt=De.y;else{var Sr=this.points[De.index];mt=Sr.properties,Ft=Wt(Sr.geometry.coordinates[0]),Yt=bt(Sr.geometry.coordinates[1])}var qn={type:1,geometry:[[Math.round(this.options.extent*(Ft*xr-$e)),Math.round(this.options.extent*(Yt*xr-Kt))]],tags:mt},hn=void 0;At?hn=De.id:this.options.generateId?hn=De.index:this.points[De.index].id&&(hn=this.points[De.index].id),hn!==void 0&&(qn.id=hn),kr.features.push(qn)}},Je.prototype._limitZoom=function(Qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Qe),this.options.maxZoom+1))},Je.prototype._cluster=function(Qe,Ct){for(var $e=[],Kt=this.options,xr=Kt.radius,kr=Kt.extent,Kr=Kt.reduce,A=Kt.minPoints,Ae=xr/(kr*Math.pow(2,Ct)),De=0;De<Qe.length;De++){var At=Qe[De];if(!(At.zoom<=Ct)){At.zoom=Ct;for(var mt=this.trees[Ct+1],Ft=mt.within(At.x,At.y,Ae),Yt=At.numPoints||1,Sr=Yt,qn=0,hn=Ft;qn<hn.length;qn+=1){var fi=hn[qn],Gn=mt.points[fi];Gn.zoom>Ct&&(Sr+=Gn.numPoints||1)}if(Sr>Yt&&Sr>=A){for(var ni=At.x*Yt,pi=At.y*Yt,Wn=Kr&&Yt>1?this._map(At,!0):null,hi=(De<<5)+(Ct+1)+this.points.length,ua=0,Gi=Ft;ua<Gi.length;ua+=1){var Di=Gi[ua],$i=mt.points[Di];if(!($i.zoom<=Ct)){$i.zoom=Ct;var la=$i.numPoints||1;ni+=$i.x*la,pi+=$i.y*la,$i.parentId=hi,Kr&&(Wn||(Wn=this._map(At,!0)),Kr(Wn,this._map($i)))}}At.parentId=hi,$e.push(Ze(ni/Sr,pi/Sr,hi,Sr,Wn))}else if($e.push(At),Sr>1)for(var Mi=0,ma=Ft;Mi<ma.length;Mi+=1){var Xn=ma[Mi],Si=mt.points[Xn];Si.zoom<=Ct||(Si.zoom=Ct,$e.push(Si))}}}return $e},Je.prototype._getOriginId=function(Qe){return Qe-this.points.length>>5},Je.prototype._getOriginZoom=function(Qe){return(Qe-this.points.length)%32},Je.prototype._map=function(Qe,Ct){if(Qe.numPoints)return Ct?Zt({},Qe.properties):Qe.properties;var $e=this.points[Qe.index].properties,Kt=this.options.map($e);return Ct&&Kt===$e?Zt({},Kt):Kt};function Ze(ut,Qe,Ct,$e,Kt){return{x:Xe(ut),y:Xe(Qe),zoom:Infinity,id:Ct,parentId:-1,numPoints:$e,properties:Kt}}function gt(ut,Qe){var Ct=ut.geometry.coordinates,$e=Ct[0],Kt=Ct[1];return{x:Xe(Wt($e)),y:Xe(bt(Kt)),zoom:Infinity,index:Qe,parentId:-1}}function tr(ut){return{type:"Feature",id:ut.id,properties:yt(ut),geometry:{type:"Point",coordinates:[at(ut.x),nt(ut.y)]}}}function yt(ut){var Qe=ut.numPoints,Ct=Qe>=1e4?Math.round(Qe/1e3)+"k":Qe>=1e3?Math.round(Qe/100)/10+"k":Qe;return Zt(Zt({},ut.properties),{cluster:!0,cluster_id:ut.id,point_count:Qe,point_count_abbreviated:Ct})}function Wt(ut){return ut/360+.5}function bt(ut){var Qe=Math.sin(ut*Math.PI/180),Ct=.5-.25*Math.log((1+Qe)/(1-Qe))/Math.PI;return Ct<0?0:Ct>1?1:Ct}function at(ut){return(ut-.5)*360}function nt(ut){var Qe=(180-ut*360)*Math.PI/180;return 360*Math.atan(Math.exp(Qe))/Math.PI-90}function Zt(ut,Qe){for(var Ct in Qe)ut[Ct]=Qe[Ct];return ut}function Y(ut){return ut.x}function qt(ut){return ut.y}return Je})},75752:function(Mt){Mt.exports.RADIUS=6378137,Mt.exports.FLATTENING=1/298.257223563,Mt.exports.POLAR_RADIUS=63567523142e-4}}]);
